;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_font_provider";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_featureswitcher":dependencies[3],"prezi_logger":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_service_fontcatalogue":dependencies[6],"prezi_utils":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(n){var v=n.dependencies.prezi_editor_commander,x=n.dependencies.prezi_utils,f=n.dependencies.prezi_service_fontcatalogue,t=n.dependencies.prezi_logger,m={},z=this&&m.ba||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(g,c){function y(a){try{l(d.next(a))}catch(h){c(h)}}function f(a){try{l(d["throw"](a))}catch(h){c(h)}}function l(a){a.done?g(a.value):e(a.value).then(y,f)}l((d=d.apply(a,b||[])).next())})};Object.defineProperty(m,
"__esModule",{value:!0});m.aa=class{fa(){return z(this,void 0,void 0,function*(){var a=yield(yield fetch("https://fonts.prezi.com/metadata/public-font-index.json",{cache:"no-cache"})).json();a=Object.values(a).filter((a)=>this.ha(a)).map((a)=>this.ca(a));if(0<a.length)return a;throw Error("not found any valid fonts");})}ha(a){const {fontFamily:b,fontFaces:c,category:d,subsets:e,thumbnails:g}=a;return"string"!==typeof b||Object.values(k.FontCategory).every((a)=>a!==d)||!Array.isArray(e)||e.some((a)=>
Object.values(k.FontScript).every((b)=>b!==a))||!Array.isArray(c)||"string"!==typeof(null===g||void 0===g?void 0:g.default)||"string"!==typeof(null===g||void 0===g?void 0:g.quickBrownFox)?(console.warn(`font ${b} is not valid: ${a}`),!1):!0}ca(a){const {fontFamily:b,displayName:c,origin:d,license:e,fontFaces:g}=a;return{fontFamily:b,displayName:c,category:a.category,subsets:a.subsets,source:d,license:e,fontFaces:g.map((a)=>({style:a.style,weight:a.weight,fileWithOrigin:{source:a.file,origin:f.FontOrigin.prezi}})),
thumbnailUrls:{default:"https://fonts.prezi.com/svg/"+a.thumbnails.default,quickBrownFox:"https://fonts.prezi.com/svg/"+a.thumbnails.quickBrownFox}}}};var p={};Object.defineProperty(p,"__esModule",{value:!0});p.j=class{constructor(a){this.service=a}getUserFontSelection(){return this.service.read("GET",[],{})}saveUserFontSelection(a){return this.service.access("POST",[],{},a)}};p.j.baseUrl=["api","v4","usersettings","selected_fonts"];var q={},r=this&&q.ba||function(a,b,c,d){function e(a){return a instanceof
c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function g(a){try{l(d.next(a))}catch(h){f(h)}}function k(a){try{l(d["throw"](a))}catch(h){f(h)}}function l(a){a.done?c(a.value):e(a.value).then(g,k)}l((d=d.apply(a,b||[])).next())})};Object.defineProperty(q,"__esModule",{value:!0});q.$=class{constructor(a){this.i=[];this.w=[];this.f=null;this.logger=t.LoggerModule.getLoggerManager().createLogger("FontProviderImpl");this.da=new m.aa;this.v=a.service(p.j.baseUrl,(a)=>new p.j(a));
this.u=this.da.fa();this.u.then((a)=>{this.f=new Map(a.map((a)=>[a.fontFamily,a]));this.o()}).catch((a)=>t.LoggerModule.logException(this.logger,"font_provider","catalogue_load_failed",a));this.ga()}getFontCatalogue(){return this.u}getUserSelectedFonts(){return null!=this.f?(0<this.i.length?[...this.i].sort((a,b)=>a.localeCompare(b)):f.getBuiltinFontDescriptionsOrderedByName().map((a)=>a.fontFamily)).filter((a)=>this.f.has(a)).map((a)=>this.f.get(a)).map((a)=>this.createFontDescriptionFromMetadata(a)):
f.getBuiltinFontDescriptionsOrderedByName()}onUserSelectedFontsChange(a){this.w.push(a)}createFontPresetData(a,b){return null!=this.f&&this.f.has(a.fontFamily)?(a=this.f.get(a.fontFamily),Promise.resolve({imageUrl:a.thumbnailUrls.default,hasLightColor:!1})):this.createPresetData(a,f.FontWeight.Normal,f.FontStyle.Normal,{r:0,g:0,b:0},null,1,b,this.ea(a.fontFamily),180,36)}ea(a){const b=a.indexOf("--");return-1===b?a:a.substring(0,b)}o(){const a=this.getUserSelectedFonts();this.w.forEach((b)=>b(a))}createFontDescriptionFromMetadata(a){const b=
a.fontFaces.find((a)=>a.style===f.FontStyle.Normal&&a.weight===f.FontWeight.Normal),c=a.fontFaces.find((a)=>a.style===f.FontStyle.Normal&&a.weight===f.FontWeight.Bold),d=a.fontFaces.find((a)=>a.style===f.FontStyle.Italic&&a.weight===f.FontWeight.Normal),e=a.fontFaces.find((a)=>a.style===f.FontStyle.Italic&&a.weight===f.FontWeight.Bold);return{fontFamily:a.fontFamily,hasNormal:null!=b,hasBold:null!=c,hasItalic:null!=d,hasBoldItalic:null!=e,normalKeg:null===b||void 0===b?void 0:b.fileWithOrigin,boldKeg:null===
c||void 0===c?void 0:c.fileWithOrigin,italicKeg:null===d||void 0===d?void 0:d.fileWithOrigin,boldItalicKeg:null===e||void 0===e?void 0:e.fileWithOrigin,imageUri:a.thumbnailUrls.default}}ga(){r(this,void 0,void 0,function*(){this.i=yield this.v.getUserFontSelection();this.o()})}saveUserFontSelection(a){return r(this,void 0,void 0,function*(){yield this.v.saveUserFontSelection(a);this.i=a;this.o()})}createPresetData(a,b,c,d,e,f,k,p,n,l){return r(this,void 0,void 0,function*(){var g=(yield(yield k.downloadFont(a)).getCompatibleDrawer(b,
c)).getPath(p,0,0,100),h=g.getBoundingBox();g=g.drawSvg();var m=h.x2-h.x1;h=h.y2-h.y1;const u=.15*m;m+=u;const q=h+u,r=null==e?null:`rgba(${e.color.r}, ${e.color.g}, ${e.color.b}, ${e.a})`,w=.75*Math.min(n/m,l/q)*f,t=null==d?"black":v.toCssColor(d);g=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${[0,0,n,l]}" height="${l}" width="${n}">
					${`<g
					${null==t?"":`fill="${t}"`}
					transform="translate(${null==e?0:u/2*w},${(l-w*h)/2}) scale(${w})"
				>
					${null==r?"":`<rect
						x="${-u/2}"
						y="${-u/2}"
						width="${m}"
						height="${q}"
						fill="${r}" />`}
					${g}
				</g>`}
				</svg>`;h=null!=e?v.hasLightColor(e.color,e.a):null!=d?v.hasLightColor(d,1):!1;return{imageUrl:x.Utils.svgToUrl(g),hasLightColor:h}})}};var k={};Object.defineProperty(k,"__esModule",{value:!0});(function(a){a.SansSerif="sansSerif";a.Serif="serif";a.Display="display";a.Handwriting="handwriting";a.Monospace="monospace"})(k.FontCategory||(k.FontCategory={}));(function(a){a.Arabic="Arabic";a.Bengali="Bengali";a.ChineseHongKong="ChineseHongKong";a.ChineseSimplified="ChineseSimplified";a.ChineseTraditional=
"ChineseTraditional";a.Cyrillic="Cyrillic";a.CyrillicExtended="CyrillicExtended";a.Devanagari="Devanagari";a.Ethiopic="Ethiopic";a.Greek="Greek";a.GreekExtended="GreekExtended";a.Gujarati="Gujarati";a.Gurmukhi="Gurmukhi";a.Hebrew="Hebrew";a.Japanese="Japanese";a.Kannada="Kannada";a.Khmer="Khmer";a.Korean="Korean";a.Lao="Lao";a.Latin="Latin";a.LatinExtended="LatinExtended";a.Malayalam="Malayalam";a.Myanmar="Myanmar";a.Oriya="Oriya";a.Sinhala="Sinhala";a.Tamil="Tamil";a.Telugu="Telugu";a.Thai="Thai";
a.Tibetan="Tibetan";a.Vietnamese="Vietnamese"})(k.FontScript||(k.FontScript={}));(function(a){let b;a.getFontProvider=function(a){null==b&&(b=new q.$(a));return b}})(k.FontProviderModule||(k.FontProviderModule={}));return k});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_font_provider",["require","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_logger","prezi_plugin_api","prezi_service_fontcatalogue","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_font_provider.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_service_fontcatalogue"),require("prezi_utils"));}else{this["prezi_font_provider"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_service_fontcatalogue"],this["prezi_utils"]);}}).call(this);