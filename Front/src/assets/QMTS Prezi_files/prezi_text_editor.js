;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_text_editor";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_brand_kit_cta":dependencies[1],"prezi_cet_model":dependencies[2],"prezi_cet_model_editor":dependencies[3],"prezi_editor_commander":dependencies[4],"prezi_featureswitcher":dependencies[5],"prezi_font_provider":dependencies[6],"prezi_i18n":dependencies[7],"prezi_logger":dependencies[8],"prezi_plugin_api":dependencies[9],"prezi_plugin_meta":dependencies[10],"prezi_service_fontcatalogue":dependencies[11],"prezi_shared_ui":dependencies[12],"prezi_utils":dependencies[13],"prezi_widgets":dependencies[14]}};})());};})(arguments);var moduleImpl=(function(){return module(function(m){var Q=m.dependencies.prezi_service_fontcatalogue,I=m.dependencies.prezi_shared_ui,f=m.dependencies.prezi_cet_model_editor,p=m.dependencies.prezi_logger,R=m.dependencies["prezi.geometry"],k=m.dependencies.prezi_plugin_api,v=m.dependencies.prezi_utils,F=m.dependencies.prezi_editor_commander,l=m.dependencies.prezi_i18n,r=m.dependencies.prezi_widgets,S=m.dependencies.prezi_cet_model,y=m.dependencies.prezi_featureswitcher,J=m.dependencies.prezi_plugin_meta,T=m.dependencies.prezi_font_provider,
z=m.dependencies.prezi_brand_kit_cta,A={};Object.defineProperty(A,"__esModule",{value:!0});var K=f.base.ObjectKind,L;(function(a){a.DocumentChange="documentChange";a.SelectionChange="selectionChange";a.Typing="typing"})(L=A.ChangeSource||(A.ChangeSource={}));class U{constructor(a,b,c){this.session=a;this.uiRoot=b;this.updateTextState2=c}setCharacterProps(a,b,c){this.validateAndUpdateProps(a,c,(c,d,n)=>{this.runCommand(a,"set"+b+"Cmd",(a)=>{this.applyCharacterProps(a,c,d,n)})})}setCharacterPropsInTransaction(a,
b,c,e=!1){this.validateAndUpdateProps(a,c,(a,c,e)=>this.applyCharacterProps(b,a,c,e),e)}applyCharacterProps(a,b,c,e){this.getSelectionFlattenVisuals(a).forEach((d)=>{if(d.is(f.base.ObjectKind.text)){var n=d.textBox.topLeft,h=this.getTextRangeToEdit(d,b);0<h.length&&h.setAllCharacterProps(c);h=d.position;d.position={x:h.x+(n.x-d.textBox.topLeft.x),y:h.y+(n.y-d.textBox.topLeft.y)};a.toDecorator(d).inEditFontSize=e.fontSize;this.logStyleChange(d)}})}validateAndUpdateProps(a,b,c,e=!1){var d=this.getActiveLastCharacterProps();
null!=d&&(e=e?null:this.session.selection.getTextSelectionInfo(),b=b(d),this.validProps(this.uiRoot.getState(),b)&&(d=Object.assign(Object.assign({},d),b),c(e,b,d),null!=e&&(this.session.selection.setTextSelection(a,e),0===e.length&&this.uiRoot.setState({activeCharacterProps:[{id:this.uiRoot.getState().activeCharacterProps[0].id,textSelectionInfo:this.uiRoot.getState().activeCharacterProps[0].textSelectionInfo,characterProps:[d]}]}))))}validProps(a,b){b=Object.assign(Object.assign({},this.getActiveLastCharacterProps()),
b);return b.fontWeight===f.base.FontWeight.Bold&&b.fontStyle===f.base.FontStyle.Italic?a.activeFontHasBoldItalic:b.fontWeight===f.base.FontWeight.Normal&&b.fontStyle===f.base.FontStyle.Italic?a.activeFontHasItalic:b.fontWeight===f.base.FontWeight.Bold&&b.fontStyle===f.base.FontStyle.Normal?a.activeFontHasBold:b.fontWeight===f.base.FontWeight.Normal&&b.fontStyle===f.base.FontStyle.Normal?a.activeFontHasNormal:!1}runCommand(a,b,c){return this.session.document.executeApiCommand(a,{name:b,run:(a)=>{const b=
c(a);this.updateTextState2(a,L.DocumentChange);return b}})}logCTAOpened(a){y.isActive("js-present-editor-brandkit-enabled")&&y.isActive("js-show-brand-kit-paywalls")&&p.avro.Avro.createDefaultLogger().logShownUpgradeToTeamCta({team_upgrade_trigger:a})}logStyleChange(a){p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"TEXT",modify_action:"STYLE_CHANGE",topic_relationship:a,object_id:a.id})}preserveTopLeft(a,b){const c=a.textBox.topLeft;b(a);b=a.position;a.position={x:b.x+(c.x-a.textBox.topLeft.x),
y:b.y+(c.y-a.textBox.topLeft.y)}}getAllCharacterProps(a,b){return a.map((a)=>({id:a.id,textSelectionInfo:(null===b||void 0===b?void 0:b.id)===a.id?b:null,characterProps:this.getCharacterProps(a,b)}))}getCharacterProps(a,b){var c=this.getTextRangeToEdit(a,b);if(0<c.length)return c.getCharacterProps();if(0<b.offset&&"\n"===a.getText()[b.offset-1])return a.getTextRange(b.offset,1).getCharacterProps();{c=b.offset-1;let e=a.getTextRange(Math.max(0,c),1).getCharacterProps()[0];a=a.getTextRange(b.offset,
1);b=a.getCharacterProps()[0];b=null!=e.url&&null!=e&&e.url===b.url;return 0>c||!b||"\n"===a.getText()?[Object.assign(Object.assign({},e),{url:null})]:[e]}}getActiveLastCharacterProps(){const a=this.uiRoot.getState().activeCharacterProps[0].characterProps;return a[a.length-1]}getLastLastCharacterProps(){const a=this.uiRoot.getState().lastCharacterProps[0].characterProps;return a[a.length-1]}getActiveCharacterPropsForInsert(a,b){var c;a=null===(c=a.styleSheet.styleSheets.find((a)=>a.className===b.textStyle&&
(null==a.styledObjectKind||a.styledObjectKind===f.base.ObjectKind.text)))||void 0===c?void 0:c.styleBlock;c=this.getActiveLastCharacterProps();const e=this.getLastLastCharacterProps();let d=c;null!=a&&(d={fontWeight:a.text.font.weight!==c.fontWeight||a.text.font.weight!==e.fontWeight?c.fontWeight:null,fontStyle:a.text.font.style!==c.fontStyle||a.text.font.style!==e.fontStyle?c.fontStyle:null,color:this.styleColorEquals(a.fill.color,c.color)?null:c.color,fontSize:c.fontSize,url:c.url});return d}getTextRangeToEdit(a,
b){return null!=b&&b.id===a.id?a.getTextRange(b.offset,b.length):a}exactRadiusMultiplier(a){const b=(a.layoutBox.size.height-a.glyphBox.size.height)/2,c=(a.layoutBox.size.width-a.glyphBox.size.width)/2;return Math.min(Math.min(a.layoutBox.size.height,a.layoutBox.size.width)/2,b+c+Math.sqrt(2*b*c))}flatten(a){if(!a.every((a)=>a.is(K.topic)&&1===a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside).length))return a;let b=[];a.forEach((a)=>{a.is(K.topic)&&b.push(...a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside))});
return b}getReadonlySelectionFlattenVisuals(a){return this.flatten(this.session.selection.getReadonlySelectionInfo(a).allObjects)}getSelectionFlattenVisuals(a){return this.flatten(this.session.selection.getSelectionInfo(a).allObjects)}styleColorEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&a.r===b.r&&a.g===b.g&&a.b===b.b}deepPartialEquals(a,b){for(const c of Object.keys(a)){const e=a[c],d=b[c];if(e!==d&&(null==e||null==d||"object"!==typeof e||!this.deepPartialEquals(e,d)))return!1}return!0}}
A.Common=U;var B={};Object.defineProperty(B,"__esModule",{value:!0});const t=new Map([["title",{weight:0,title:l.I18n.ts("Title"),relativeFontSize:1}],["subtitle",{weight:1,title:l.I18n.ts("Subtitle"),relativeFontSize:20/24}],["subtitle_2",{weight:2,title:l.I18n.ts("Subtitle 2"),relativeFontSize:20/24}],["body",{weight:3,title:l.I18n.ts("Body"),relativeFontSize:14/24}],["body_2",{weight:4,title:l.I18n.ts("Body 2"),relativeFontSize:14/24}]]);B.getDefaultStylePresetState=()=>({activeStyleId:null,stylePresets:new Map});
B.StylePresetPart=class{constructor(a,b,c,e){this.common=a;this.session=b;this.uiRoot=c;this.fontProvider=e}updateStyleId(a){a=new Set(a.filter((a)=>null!=a.textStyle).map((a)=>a.textStyle));this.setState({activeStyleId:1===a.size?a.values().next().value:null})}declareUI(a){this.createPresetChooser(a)}createPresetChooser(a){const b=this.getState(),c=t.size+10,e=(a,c,d)=>a.imageCheckbox({id:c,imgUrl:d.imageUrl,checked:b.activeStyleId===c,hasLightColor:d.hasLightColor,onCheck:(a,b)=>{b&&this.common.runCommand(a,
"Change text style",(a)=>{this.common.getSelectionFlattenVisuals(a).forEach((b)=>{b.is(f.base.ObjectKind.text)&&(b=a.toDecorator(b),b.textStyle=c,b.caretOffset=b.getText().length,b.selection=null,this.common.logStyleChange(b))})})}}),d=l.I18n.ts("Text style");a.createPropertyBarItem((a)=>a.popupButton((a)=>({id:"text-editor-preset-dropdown",tooltipText:d,content:{text:null==b.activeStyleId?d:this.formatTextStyle(b.activeStyleId)},groupWeight:1,weight:0,showArrow:!0,height:k.PopupHeight.Full,popupHeader:[a.sectionHeader({content:l.I18n.ts("Text style")})],
popupContent:[...b.stylePresets.entries()].sort(([a],[b])=>{const d=t.has(a)?t.get(a).weight:c,e=t.has(b)?t.get(b).weight:c;return d!==c&&e!==c?d-e:a.localeCompare(b)}).map(([b,c])=>e(a,b,c))})))}generateStylePresetThumbnails(){this.session.document.read((a)=>{this.setState({stylePresets:new Map});a.styleSheet.styleSheets.forEach((a)=>{if(a.styledObjectKind===f.base.ObjectKind.text&&null!=a.className&&null!=a.styleBlock.text.font){const b=a.className,e=a.styleBlock;this.fontProvider.createPresetData(e.text.font.description,
e.text.font.weight,e.text.font.style,e.fill&&e.fill.color,null!=e.text.background&&e.text.background.display?{a:e.text.background.alpha,color:e.text.background.color}:null,((a)=>t.has(a)?t.get(a).relativeFontSize:1)(a.className),this.session.document.progressiveAssetManager,this.formatTextStyle(b),216,48).then((a)=>{const c=this.getState();this.setState({stylePresets:(new Map(c.stylePresets)).set(b,a)})}).catch(()=>{})}})})}getState(){return this.uiRoot.getState().stylePresetState}setState(a){const b=
this.getState();this.uiRoot.setState({stylePresetState:Object.assign(Object.assign({},b),a)})}formatTextStyle(a){return t.has(a)?t.get(a).title:a.replace("_"," ")}};var C={};Object.defineProperty(C,"__esModule",{value:!0});C.getDefaultFontStyleState=()=>({activeFontId:null,fontFamiliesInDocument:new Map,fontPresets:new Map});C.FontFamilyPart=class{constructor(a,b,c,e,d){this.common=a;this.session=b;this.uiRoot=c;this.pluginAccess=e;this.fontProvider=d}updateFontId(a){a=new Set(a.filter((a)=>null!=
a.font).map((a)=>a.font.fontFamily));this.setState({activeFontId:1===a.size?a.values().next().value:null})}updateFontList(){var {isNetworkOffline:a}=this.uiRoot.getState();a=a?Q.getBuiltinFontDescriptionsOrderedByName():this.fontProvider.getUserSelectedFonts();a=new Map(a.map((a)=>[a.fontFamily,{preset:{imageUrl:a.imageUri,hasLightColor:!1},fontDescription:a}]));this.setState({fontPresets:a});this.session.document.read((a)=>{this.updateFontFamiliesInDocument(a)})}updateFontFamiliesInDocument(a){a=
this.getFontFamiliesInDocument(a);const b=this.getState().fontPresets;for(let [c,e]of a)b.has(c)||this.fontProvider.createFontPresetData(e,this.session.document.progressiveAssetManager).then((a)=>{const b=this.getState();this.setState({fontPresets:(new Map(b.fontPresets)).set(c,{preset:a,fontDescription:e})})});this.setState({fontFamiliesInDocument:a})}declareUI(a){this.createFontChooser(a)}createFontChooser(a){const b=this.getState(),c=(a,c)=>{var e;const d=null===(e=b.fontPresets.get(c.fontFamily))||
void 0===e?void 0:e.preset;return null==d?null:a.imageCheckbox({id:c.fontFamily,imgUrl:d.imageUrl,checked:b.activeFontId===c.fontFamily,onCheck:(a,b)=>{b&&a.doAsync(this.session.document.progressiveAssetManager.downloadFont(c),(a,b)=>{a.isValid()&&this.common.runCommand(a,"setFontFamilyCmd",(a)=>{this.common.getSelectionFlattenVisuals(a).forEach((a)=>{a.is(f.base.ObjectKind.text)&&(a.font=b,this.common.logStyleChange(a))});this.updateFontFamiliesInDocument(a)})})}})};a.createPropertyBarItem((a)=>
{const e=(a,b)=>a.fontFamily.localeCompare(b.fontFamily),n=(a,b)=>a.fontDescription.fontFamily.localeCompare(b.fontDescription.fontFamily);return a.popupButton((a)=>{var d=[...b.fontFamiliesInDocument.values()].sort(e).map((b)=>c(a,b)).filter((a)=>null!=a),h=[...b.fontPresets.values()].sort(n).map((b)=>c(a,b.fontDescription)).filter((a)=>null!=a);d={id:"text-editor-font-dropdown",showArrow:!0,tooltipText:l.I18n.ts("Font"),content:{text:null==b.activeFontId?l.I18n.ts("Font-family"):this.getNameFromFontId(b.activeFontId)},
groupWeight:1,weight:0,popupHeader:[a.sectionHeader({content:l.I18n.ts("Font")})],popupHeight:k.PopupHeight.Short,onOpen:()=>this.common.logCTAOpened("PRESENT_FONT_DROPDOWN"),popupContent:[...z.createBrandKitFontCTA(a,this.uiRoot.getState().brandKitCTA,"PRESENT_FONT_DROPDOWN"),a.sectionHeader({content:l.I18n.ts("Used in the document")}),...d,a.separator(),...h]};h=[a.button(k.ButtonSize.Large,k.ButtonAlign.Start,(a)=>[a.button({id:"showMoreFontsButton",color:k.ButtonColor.Gray,content:{text:l.I18n.ts("More fonts")},
onClick:()=>{p.avro.Avro.createDefaultLogger().logOpenMoreFontsDialog({font_dialog_source:"PROPERTY_BAR_DROPDOWN"});this.pluginAccess.send(J.fontSelector,{kind:"openFontSelectorModal"})},disabled:this.uiRoot.getState().isNetworkOffline})])];return d=Object.assign(Object.assign({},d),{popupFooter:h})})})}getState(){return this.uiRoot.getState().fontStyleState}setState(a){const b=this.getState();this.uiRoot.setState({fontStyleState:Object.assign(Object.assign({},b),a)})}getNameFromFontId(a){const b=
a.indexOf("--");return-1===b?a:a.substring(0,b)}getFontFamiliesInDocument(a){return new Map(a.styleSheet.fontDescriptions.filter((a)=>a.hasNormal).map((a)=>[a.fontFamily,a]))}};var D={};Object.defineProperty(D,"__esModule",{value:!0});const V=["\n"," "];D.getDefaultHyperlinkState=()=>({propertyBarButtonDisabled:!1,urlInputFieldText:""});D.HyperlinkPart=class{constructor(a,b){this.common=a;this.uiRoot=b;this.urlUtils=v.Utils.createUrlUtils()}markUrl(a,b){const c=a.getTextRange(0,b).getText();let e=
0;for(let a=c.length-1;0<=a;a--)if(-1<V.indexOf(c[a])){e=a+1;break}a.getTextRange(e,b-e).markUrls(!1)}declareUI(a){this.createHyperLinkDialog(a)}createHyperLinkDialog(a){var {urlInputFieldText:b}=this.getState();const c=v.Utils.isEmptyString(this.common.getActiveLastCharacterProps().url)?I.HyperlinkDialogMode.insert:I.HyperlinkDialogMode.edit;b={propertyBarGroupWeight:4,propertyBarWeight:7,propertyBarDisabled:this.getState().propertyBarButtonDisabled,urlText:b,mode:c,applyLink:(a)=>this.applyLink(a),
removeLink:(a)=>this.removeLink(a),onLinkOpened:()=>this.onOpenHyperlink(),onUrlTextInputValueChange:(a,b)=>this.onUrlTextInputValueChange(a,b),onPopupOpen:()=>this.onOpenPropertyBarItem()};I.createHyperLinkPropertyBarItem(a,b)}applyLink(a){const b=!v.Utils.isEmptyString(this.common.getActiveLastCharacterProps().url);this.common.setCharacterProps(a,"hyperlink",()=>{const a=this.urlUtils.ensureProtocolInUrl(this.getState().urlInputFieldText.trim());this.setState({urlInputFieldText:a});return{url:a}});
this.logHyperlinkApplied(b);this.uiRoot.popup.closePopup("hyperlinkPopup")}removeLink(a){var b;const c=null!==(b=this.common.getActiveLastCharacterProps().url)&&void 0!==b?b:"";this.common.setCharacterProps(a,"hyperlink",()=>{this.setState({urlInputFieldText:""});return{url:null}});this.logRemoveLink(c);this.uiRoot.popup.closePopup("hyperlinkPopup")}onUrlTextInputValueChange(a,b){this.setState({urlInputFieldText:b});return!0}onOpenPropertyBarItem(){var a;this.logOnPropertyBarButtonClicked();this.setState({urlInputFieldText:null!==
(a=this.common.getActiveLastCharacterProps().url)&&void 0!==a?a:""})}onOpenHyperlink(){const a=this.urlUtils.ensureProtocolInUrl(this.getState().urlInputFieldText.trim());this.uiRoot.getState().selectedTextIds.forEach((b)=>{p.avro.Avro.createDefaultLogger().logOpenHyperlink({hyperlink_url:a,object_id:b,object_type:"TEXT"})})}logHyperlinkApplied(a){const b=this.urlUtils.ensureProtocolInUrl(this.getState().urlInputFieldText.trim());this.uiRoot.getState().selectedTextIds.forEach((c)=>{a?p.avro.Avro.createDefaultLogger().logEditedHyperlink({hyperlink_url:b,
object_id:c,object_type:"TEXT"}):p.avro.Avro.createDefaultLogger().logInsertedHyperlink({hyperlink_url:b,object_id:c,object_type:"TEXT"})})}logRemoveLink(a){this.uiRoot.getState().selectedTextIds.forEach((b)=>{p.avro.Avro.createDefaultLogger().logRemovedHyperlink({hyperlink_url:a,object_id:b,object_type:"TEXT"})})}logOnPropertyBarButtonClicked(){this.uiRoot.getState().selectedTextIds.forEach((a)=>{p.avro.Avro.createDefaultLogger().logInsertHyperlink({object_id:a,object_type:"TEXT"})})}getState(){return this.uiRoot.getState().hyperlinkState}setState(a){const b=
this.getState();this.uiRoot.setState({hyperlinkState:Object.assign(Object.assign({},b),a)})}};var E={};Object.defineProperty(E,"__esModule",{value:!0});var w=f.base.TextAlignment,H=f.base.TextListType;E.getDefaultParagraphState=()=>({activeAlignment:null,activeListType:null});E.ParagraphPart=class{constructor(a,b,c){this.common=a;this.session=b;this.uiRoot=c}updateAlignments(a,b){a=new Set(a.map((a)=>{a=this.common.getTextRangeToEdit(a,b).getParagraphs();return a[a.length-1].getParagraphProps().alignment}));
this.setState({activeAlignment:1===a.size?a.values().next().value:null})}updateListTypes(a,b){a=new Set(a.map((a)=>{a=this.common.getTextRangeToEdit(a,b).getParagraphs();return a[a.length-1].getParagraphProps().listType}));this.setState({activeListType:1===a.size?a.values().next().value:null})}declareUI(a){this.createAlignmentChanger(a);this.createListTypeAndIndentChanger(a)}createListTypeAndIndentChanger(a){a.createPropertyBarItem((a)=>a.submenu({id:"text-editor-listtype-indent",groupWeight:6,weight:10,
icon:k.IconSmallId.BulletPoint,tooltip:l.I18n.ts("List and indentation"),items:[this.createListTypeChangerDesc(),this.createDecreaseIndentDesc(),this.createIncreaseIndentDesc()]}))}createAlignmentChanger(a){const b=this.getState();let c=k.IconSmallId.AlignLeft;switch(b.activeAlignment){case w.Center:c=k.IconSmallId.AlignCenter;break;case w.Justify:c=k.IconSmallId.AlignJustify;break;case w.Left:c=k.IconSmallId.AlignLeft;break;case w.Right:c=k.IconSmallId.AlignRight;break;case null:c=k.IconSmallId.AlignLeft;
break;default:throw v.Utils.assertNever(b.activeAlignment,"alignment");}const e=(a,b,e)=>({id:`text-editor-alignment-${b}`,icon:a,tooltip:e,pushed:c===a,onClick:(a)=>{this.setParagraphProps(a,"alignment",()=>({alignment:b}))}});a.createPropertyBarItem((a)=>a.submenu({id:"text-editor-alignment",groupWeight:5,weight:9,icon:c,tooltip:l.I18n.ts("Alignment"),items:[e(k.IconSmallId.AlignLeft,w.Left,l.I18n.ts("Align left")),e(k.IconSmallId.AlignCenter,w.Center,l.I18n.ts("Align center")),e(k.IconSmallId.AlignRight,
w.Right,l.I18n.ts("Align right")),e(k.IconSmallId.AlignJustify,w.Justify,l.I18n.ts("Justify"))]}))}createDecreaseIndentDesc(){return{id:"text-editor-decrease-indent",tooltip:l.I18n.ts("Outdent"),icon:k.IconSmallId.Outdent,onClick:(a)=>{this.setParagraphProps(a,"indent",(a)=>({indent:Math.max(0,a.indent-1)}))}}}createIncreaseIndentDesc(){return{id:"text-editor-increase-indent",tooltip:l.I18n.ts("Indent"),icon:k.IconSmallId.Indent,onClick:(a)=>{this.setParagraphProps(a,"indent",(a)=>({indent:a.indent+
1}))}}}createListTypeChangerDesc(){const a=this.getState();return{id:"text-editor-listtype",tooltip:l.I18n.ts("Bulleted list"),icon:k.IconSmallId.BulletPoint,pushed:a.activeListType===H.Bullet,onClick:(b)=>{this.setParagraphProps(b,"listtype",()=>({listType:a.activeListType===H.Bullet?H.None:H.Bullet}))}}}getState(){return this.uiRoot.getState().paragraphState}setState(a){const b=this.getState();this.uiRoot.setState({paragraphState:Object.assign(Object.assign({},b),a)})}setParagraphProps(a,b,c){const e=
this.session.selection.getTextSelectionInfo();this.common.runCommand(a,"set"+b+"Cmd",(a)=>{this.common.getSelectionFlattenVisuals(a).forEach((b)=>{b.is(f.base.ObjectKind.text)&&(this.common.preserveTopLeft(a.toDecorator(b),(a)=>{this.common.getTextRangeToEdit(a,e).getParagraphs().forEach((a)=>{const b=c(a.getParagraphProps());a.setAllParagraphProps(b)})}),this.common.logStyleChange(b))})});null!=e&&this.session.selection.setTextSelection(a,e)}};var x={};Object.defineProperty(x,"__esModule",{value:!0});
var M=f.base.TextListType,q=f.base.ObjectKind,N=f.base.readerIs;m={color:{r:0,g:0,b:0},fontStyle:f.base.FontStyle.Normal,fontWeight:f.base.FontWeight.Normal,fontSize:10,url:null};const W={fontStyleState:C.getDefaultFontStyleState(),hyperlinkState:D.getDefaultHyperlinkState(),paragraphState:E.getDefaultParagraphState(),stylePresetState:B.getDefaultStylePresetState(),activeCharacterProps:[{id:null,textSelectionInfo:null,characterProps:[m]}],activeFontHasBold:!0,activeFontHasBoldItalic:!0,activeFontHasItalic:!0,
activeFontHasNormal:!0,activePresetSelector:null,activeTextSize:null,backgroundColorPicker:{solidFill:{fillKind:r.FillKind.solid,color:{r:0,g:0,b:0,a:1}},canPickClearFill:!0,current:r.FillKind.solid,hasAlpha:!0},backgroundCornerRadius:0,brandKitCTA:y.isActive("js-present-editor-brandkit-enabled")&&y.isActive("js-show-brand-kit-paywalls")?z.BrandKitCTA.sul:z.BrandKitCTA.none,currentTopic:null,isActiveTextSizeMixed:!1,isNetworkOffline:!1,lastCharacterProps:[{id:null,textSelectionInfo:null,characterProps:[m]}],
parentZoomAreaLayoutBox:null,preziTitleUpdated:!1,selectedTextIds:[],textColorGrid:null,textSizeDropdownText:null,visible:!1};var u;(function(a){a.DocumentChange="documentChange";a.SelectionChange="selectionChange";a.Typing="typing"})(u||(u={}));const O=2.3/900,X=[10,12,14,18,24,30,36,48,60,80],P={[q.zoomArea]:"ZOOM_AREA",[q.planetTopic]:"TOPIC",[q.stackTopic]:"TOPIC",[q.overview]:"OVERVIEW"};x.TextEditorPlugin=class{constructor(){this.longRunningCtx=null;this.standAloneKoreanChars=[12671,12673,12678,
44341,44411,59594,44425,44445,44473,44501,44551,44558,44559,44561,44564,44639,44781,44809,44880,44991,45152,47556,50509,50511,50514,50603,50609,50716,50717,50941,50967,50995,52044];this.CHARACTERS_KOREAN="hangul";this.CHARACTERS_CJK="cjk";this.CHARACTERS_JAPANESE="kata-or-hira"}static getOriginalPlaceholderInfo(){null==x.TextEditorPlugin.originalPlaceholderInfo&&(x.TextEditorPlugin.originalPlaceholderInfo=S.CetModel.createValueComponentKey("originalPlaceholderInto",!1,!1));return x.TextEditorPlugin.originalPlaceholderInfo}init(a){this.textHyperlinkActive=
this.session.document.read((a)=>a.meta.isSupportedGeneration(f.base.DocumentGeneration.RichText))&&y.isActive("js-disable-auto-urls");this.longRunningExecutor=F.createLongRunningExecutor(this.session);this.fontProvider=T.FontProviderModule.getFontProvider(a);this.fontProvider.onUserSelectedFontsChange(()=>this.fontFamilyPart.updateFontList());this.uiRoot=a.declareUI(W,(a,b)=>{this.createMenu(a,b);a.visible&&(this.stylePresetPart.declareUI(b),this.fontFamilyPart.declareUI(b),this.createTextSizeChangers(a,
b),this.createFontStyleChangers(a,this.pluginDescription,b),this.createColorChangers(a,b),this.paragraphPart.declareUI(b),this.textHyperlinkActive&&this.hyperlinkPart.declareUI(b),this.createUpdatePresetMenuItem(a,b))});this.common=new A.Common(this.session,this.uiRoot,(a,b)=>this.updateTextState2(a,b));this.fontFamilyPart=new C.FontFamilyPart(this.common,this.session,this.uiRoot,this.pluginAccess,this.fontProvider);this.textHyperlinkActive&&(this.hyperlinkPart=new D.HyperlinkPart(this.common,this.uiRoot));
this.paragraphPart=new E.ParagraphPart(this.common,this.session,this.uiRoot);this.stylePresetPart=new B.StylePresetPart(this.common,this.session,this.uiRoot,this.fontProvider);y.isActive("js-autotitle")&&this.session.document.preziMetaData.title===l.I18n.ts("Untitled presentation")||this.uiRoot.setState({preziTitleUpdated:!0});this.fontFamilyPart.updateFontList();a.onStyleSheetChange(()=>{this.stylePresetPart.generateStylePresetThumbnails();this.session.document.read((a)=>{this.updateTextColorGrid(a);
this.fontFamilyPart.updateFontFamiliesInDocument(a)})});a.onSelectionChange(()=>{this.uiRoot.getState().preziTitleUpdated||this.session.document.preziMetaData.title===l.I18n.ts("Untitled presentation")||this.uiRoot.setState({preziTitleUpdated:!0});this.updateTextState(u.SelectionChange)});a.onDocumentChange(()=>{const {visible:a,selectedTextIds:b}=this.uiRoot.getState();(a||0<b.length)&&this.updateTextState(u.DocumentChange)});let b=null;a.onTextSelectionChange((a)=>{if(null==b||null==a||b.id!==a.id||
b.length!==a.length||b.offset!==a.offset||b.caretPosition!==a.caretPosition)b=a,this.uiRoot.getState().visible&&this.updateTextState(u.SelectionChange),null!=a&&null!=a.id||this.longRunningExecutor.close("text edit")});a.onTextDrop((a,b)=>this.common.runCommand(a,"paste text",(d)=>{const c=this.session.selection.getTextSelectionInfo(),e={text:b.data.text.slice(0,3E3),characterPropss:null==b.data.characterPropss?null:b.data.characterPropss.slice(0,3E3)};if(null!=c)return this.preservePlaceholderText(d,
c.id,(b)=>{if(null==b)return!1;this.common.preserveTopLeft(b,(b)=>{this.ensureFontToSupportCurrentLanguageHack(d,b,(b)=>{this.fillText({textEditor:b,textWithStyle:e,offset:c.offset,length:c.length});this.session.selection.setTextSelection(a,Object.assign(Object.assign({},c),{offset:c.offset+e.text.length,length:0}))})});return!0});var g=this.session.selection.getSelectionInfo(d).allObjects;g=1===g.length?g[0]:null;null!=g&&g.is(q.text)&&g.isPlaceholder?(this.preservePlaceholderText(d,g.id,(a)=>{this.common.preserveTopLeft(a,
(a)=>{this.ensureFontToSupportCurrentLanguageHack(d,a,(a)=>{this.fillText({textEditor:a,textWithStyle:e})})})}),this.session.selection.setTextSelection(a,{offset:e.text.length,length:0,caretPosition:k.CaretPosition.End,id:g.id,isFocused:!0})):this.insertNewText(a,d,e,!1,null,b.data.pointSize);return!0}));a.onTextEdit((a,b)=>{const d=this.session.selection.getTextSelectionInfo(),c=this.session.document.read((a)=>{const b=this.common.getReadonlySelectionFlattenVisuals(a).filter(N(f.base.ObjectKind.text))[0];
return this.common.getActiveCharacterPropsForInsert(a,b)});let e=!1;const g=!this.uiRoot.getState().preziTitleUpdated;if(null==d)return!1;this.longRunningExecutor.update("text edit",a,{isFinal:!1},(h)=>{this.preservePlaceholderText(h,d.id,(g)=>{null!=g&&this.common.preserveTopLeft(g,(g)=>{this.ensureFontToSupportCurrentLanguageHack(h,g,(h)=>{this.logTextEdit(e,h);if(b.kind===k.TextEditEventKind.Insert){const {offset:e,length:n}=d;var g=b.text;h.setText(g,e,n).setAllCharacterProps(c);this.session.selection.setTextSelection(a,
Object.assign(Object.assign({},d),{offset:e+g.length,length:0}));this.textHyperlinkActive&&" "===g&&this.hyperlinkPart.markUrl(h,e)}else if(b.kind===k.TextEditEventKind.Command)switch(b.command){case k.TextEditCommandKind.Tab:h.getTextRange(d.offset,d.length).getParagraphs().forEach((a)=>{const c=a.getParagraphProps().indent;a.setAllParagraphProps({indent:b.modifiers.shiftKey?Math.max(0,c-1):c+1})});break;case k.TextEditCommandKind.Delete:d.offset<h.length&&(h.setText("",d.offset,0<d.length?d.length:
1),this.session.selection.setTextSelection(a,Object.assign(Object.assign({},d),{offset:d.offset,length:0})));3>h.length&&h.getTextRange(0,d.offset).markUrls(!0);break;case k.TextEditCommandKind.Backspace:var n=d.length;g=d.offset;(b.modifiers.os===k.OsKind.Windows?b.modifiers.ctrlKey:b.modifiers.altKey)&&0===n&&(g=h.getWordBoundaryToLeft(g),n=d.length+(d.offset-g));if(0<n)h.setText("",g,n),this.session.selection.setTextSelection(a,{id:d.id,offset:g,caretPosition:k.CaretPosition.End,length:0,isFocused:!0});
else{n=h.getTextRange(g,0).getParagraphs()[0];const b=n.getParagraphProps(),c=0===g||"\n"===h.getTextRange(g-1,1).getText();c&&b.listType===M.Bullet?n.setAllParagraphProps({listType:M.None}):c&&0<b.indent?n.setAllParagraphProps({indent:b.indent-1}):0<g&&(h.setText("",g-1,1),this.session.selection.setTextSelection(a,{id:d.id,offset:g-1,caretPosition:k.CaretPosition.End,length:0,isFocused:!0}))}break;case k.TextEditCommandKind.Enter:h.setText("\n",d.offset,d.length);this.textHyperlinkActive&&this.hyperlinkPart.markUrl(h,
d.offset);this.session.selection.setTextSelection(a,Object.assign(Object.assign({},d),{offset:d.offset+1,length:0}));break;default:v.Utils.assertNever(b.command)}})})});this.updateTextState2(h,u.Typing)},(a)=>{const b=this.uiRoot.getState();g&&b.stylePresetState.activeStyleId===this.getTopOverviewTextStyle(a)&&this.session.document.setDocumentTitle(a.lookup.text(d.id).getText())},()=>{e=!0;window.setTimeout(()=>this.longRunningExecutor.close("text edit"),1E3)});return!0});a.onNavigation((a)=>{this.session.document.read((b)=>
{const c=b.lookup.resolve(a.pathElementRef);null!=c&&(c.is(q.zoom)&&c.target.is(q.simpleObject)?this.uiRoot.setState({parentZoomAreaLayoutBox:c.target.layoutBox}):this.uiRoot.setState({parentZoomAreaLayoutBox:null}),this.updateTextState2(b,u.SelectionChange))})});a.onNetworkStatusChange((a)=>{this.uiRoot.setState({isNetworkOffline:a===k.NetworkStatus.Offline});this.uiRoot.getState().visible&&this.fontFamilyPart.updateFontList()})}processMessage(a){switch(a){case J.TextEditorMessage.canEditBrandKit:this.uiRoot.setState({brandKitCTA:z.BrandKitCTA.canEditTeam});
break;case J.TextEditorMessage.canNotEditBrandKit:this.uiRoot.setState({brandKitCTA:z.BrandKitCTA.canNotEditTeam});break;default:v.Utils.assertNever(a)}}getTopOverviewTextStyle(a){const b=a.overview.contentChildren.map((a)=>a.is(f.base.ObjectKind.text)?a.textStyle:null);return["title","subtitle","subtitle_2","body","body_2"].find((a)=>-1!==b.indexOf(a))}updateTextState(a){this.session.document.read((b)=>{this.updateTextState2(b,a)})}updateTextState2(a,b){let c=!1;var e=this.common.getReadonlySelectionFlattenVisuals(a),
d=e.filter(N(f.base.ObjectKind.text)),n=d.filter((a)=>!a.locked);if(0<e.length&&n.length===e.length){c=!0;const h=[];let g=0;d.forEach((a)=>{h.some((b)=>b===a.background||null!=b&&null!=a.background&&b.r===a.background.r&&b.g===a.background.g&&b.b===a.background.b&&b.a===a.background.a)||h.push(a.background);null!=a.background&&(g=Math.max(g,Math.min(a.backgroundCornerRadius/this.common.exactRadiusMultiplier(a),1)))});e=this.session.selection.getTextSelectionInfo();n=new Set(d.map((a)=>{a=a.presetSelector;
return null==a?null:(a.rawTypeName||"*")+"."+(a.className||"*")}));const G=this.common.getAllCharacterProps(d,e),f=this.uiRoot.getState(),l=b===u.DocumentChange&&this.common.deepPartialEquals(f.lastCharacterProps,G)?f.activeCharacterProps:G,k=v.Utils.flatten(d.map((a)=>this.getTextSize(f,a,G))),m=k[0],p=k.some((a)=>a!==k[0]);this.fontFamilyPart.updateFontId(d);this.paragraphPart.updateAlignments(d,e);this.paragraphPart.updateListTypes(d,e);this.stylePresetPart.updateStyleId(d);d={activeFontHasNormal:d[0].font&&
d[0].font.hasNormal,activeFontHasBold:d[0].font&&d[0].font.hasBold,activeFontHasItalic:d[0].font&&d[0].font.hasItalic,activeFontHasBoldItalic:d[0].font&&d[0].font.hasBoldItalic,activeTextSize:m,isActiveTextSizeMixed:p,activeCharacterProps:l,lastCharacterProps:G,backgroundColorPicker:{solidFill:{fillKind:r.FillKind.solid,color:1<=h.length?h[0]:null},current:1<=h.length&&null==h[0]?r.FillKind.clear:r.FillKind.solid,canPickClearFill:!0,hasAlpha:!0},backgroundCornerRadius:g,activePresetSelector:1===n.size?
n.values().next().value:null,selectedTextIds:d.map((a)=>a.id)};this.common.deepPartialEquals(d,this.uiRoot.getState())||this.uiRoot.setState(d);b!==u.DocumentChange&&this.uiRoot.getState().visible||this.fontFamilyPart.updateFontFamiliesInDocument(a)}else this.uiRoot.setState({selectedTextIds:d.map((a)=>a.id)});c!==this.uiRoot.getState().visible&&this.uiRoot.setState({visible:c})}createMenu(a,b){0===a.selectedTextIds.length&&b.createMenuItem({kind:k.MenuItemKind.context,id:"ctx-text-editing-insert-text",
weight:128,title:l.I18n.ts("Insert text",{context:"Insert text block from context menu"}),onClick:(a,b)=>{this.common.runCommand(a,"insert text",(c)=>{this.insertNewText(a,c,{text:l.I18n.ts("Click to edit text"),characterPropss:null},!0,b)})}});b.createTopMenuItem(k.TopMenuId.First,{kind:k.MenuItemKind.largeButton,icon:k.IconSmallId.Text,id:"topmenu-insert-item-text",title:l.I18n.ts("Text"),tooltip:l.I18n.ts("Add text"),weight:2,categoryWeight:0,defaultSelected:!0,onClick:(a)=>{p.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"TEXT"});
p.avro.Avro.createDefaultLogger().logInsertTextbox({text_type:null});this.common.runCommand(a,"insert text",(b)=>{this.insertNewText(a,b,{text:l.I18n.ts("Click to edit text"),characterPropss:null},!0,null)})}})}createTextSizeChangers(a,b){b.createPropertyBarItem((b)=>b.repeatButton({id:"text-editor-decrease-text-size",groupWeight:2,weight:2,tooltip:l.I18n.ts("Decrease font size"),icon:k.IconSmallId.DecreaseTextSize,onDown:(a)=>{p.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANY"});
null!=this.longRunningCtx&&this.longRunningCtx.isActive()||(this.longRunningCtx=this.session.document.beginLongRunningCommand(a,{name:"decreaseTextSize"},()=>{}));this.longRunningCtx.isActive()&&this.longRunningCtx.execute(a,(a)=>{this.logTextSizeChange(a,"DECREASE_TEXT_SIZE")})},onRepeat:(b)=>{var c;(null===(c=this.longRunningCtx)||void 0===c?0:c.isActive())&&this.longRunningCtx.execute(b,(c)=>{const d=Math.ceil(a.activeTextSize)-1;1<=d&&(this.setTextSizeInTransaction(b,c,"DECREASE_TEXT_SIZE",d),
this.uiRoot.setState({activeTextSize:d}))})},onUp:()=>{var a;(null===(a=this.longRunningCtx)||void 0===a?0:a.isActive())&&this.longRunningCtx.end()}}));b.createPropertyBarItem((b)=>{if(null!=a.textSizeDropdownText)var c=a.textSizeDropdownText;else a.isActiveTextSizeMixed?c="\u2014":(c=Number.isInteger(a.activeTextSize)?0:2,c=a.activeTextSize.toFixed(c));return b.editableDropdownMenu({id:"text-editor-set-text-size",groupWeight:2,weight:3,minTextWidthPx:23,autofocus:!0,selectOnFocus:!0,tooltip:l.I18n.ts("Set font size"),
title:c,items:X.map((a)=>({id:`text-editor-set-text-size-${a}`,onClick:(b)=>{this.setTextSize(b,"SELECTED_TEXT_SIZE_PRESET",a)},enabled:!0,title:`${a}`})),onOpen:()=>{this.session.document.read((b)=>{this.getSelectedTextReaders(b).forEach((b)=>{p.avro.Avro.createDefaultLogger().logOpenTextSizeDropdown({parent_type:P[this.getTextContainingLayoutBox(a,b).kind]})})})},onValueChange:(a,b)=>{this.uiRoot.setState({textSizeDropdownText:b})},onEnter:(b)=>{let c=parseFloat(a.textSizeDropdownText);Number.isNaN(c)||
(c=Math.max(1,c),c=parseFloat(c.toFixed(2)),this.uiRoot.popup.closePopup("text-editor-set-text-size"),this.setTextSize(b,"INPUT_TEXT_SIZE",c));this.uiRoot.setState({textSizeDropdownText:null})},onFocusLost:(a)=>{this.uiRoot.setState({textSizeDropdownText:null});this.session.selection.setTextSelection(a,Object.assign(Object.assign({},this.session.selection.getTextSelectionInfo()),{isFocused:!0}))}})});b.createPropertyBarItem((b)=>b.repeatButton({id:"text-editor-increase-text-size",groupWeight:2,weight:4,
tooltip:l.I18n.ts("Increase font size"),icon:k.IconSmallId.IncreaseTextSize,onDown:(a)=>{p.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANY"});null!=this.longRunningCtx&&this.longRunningCtx.isActive()||(this.longRunningCtx=this.session.document.beginLongRunningCommand(a,{name:"increaseTextSize"},()=>{}));this.longRunningCtx.isActive()&&this.longRunningCtx.execute(a,(a)=>{this.logTextSizeChange(a,"INCREASE_TEXT_SIZE")})},onRepeat:(b)=>{var c;(null===(c=this.longRunningCtx)||
void 0===c?0:c.isActive())&&this.longRunningCtx.execute(b,(c)=>{const d=Math.floor(a.activeTextSize)+1;this.setTextSizeInTransaction(b,c,"INCREASE_TEXT_SIZE",d);this.uiRoot.setState({activeTextSize:d})})},onUp:()=>{var a;(null===(a=this.longRunningCtx)||void 0===a?0:a.isActive())&&this.longRunningCtx.end()}}))}getTextContainingLayoutBox(a,b){return null!=a.parentZoomAreaLayoutBox?{layoutBox:a.parentZoomAreaLayoutBox,kind:q.zoomArea}:b.parent.kind===q.cover||b.parent.kind===q.surface||b.parent.kind===
q.visual?b.parent.parent.kind===q.planetTopic?(a=b.parent.parent,{layoutBox:a.parent.zoomLayoutBox.withReferenceFrame(a.referenceFrame),kind:q.planetTopic}):b.parent.parent.kind===q.stackTopic?(a=b.parent.parent,{layoutBox:a.parent.zoomLayoutBox.withReferenceFrame(a.pageChildren[0].referenceFrame),kind:q.stackTopic}):v.Utils.assertNever(b.parent.parent,"kind shouldn't be anything but PlanetTopic or StackTopic"):{layoutBox:b.parent.zoomLayoutBox,kind:q.overview}}getDefaultPointSize(a,b){return this.getTextContainingLayoutBox(a,
b).layoutBox.size.height*O}getTextSize(a,b,c){const e=this.getDefaultPointSize(a,b);return c[0].characterProps.map((a)=>parseFloat((a.fontSize*b.pointSize/e).toFixed(2)))}getSelectedTextReaders(a){const b=this.uiRoot.getState(),c=this.session.selection.getTextSelectionInfo();return(null!=c?[c.id]:b.selectedTextIds).map((b)=>a.lookup.text(b))}setTextSize(a,b,c){this.session.document.executeApiCommand(a,{name:"setTextSize",run:(e)=>{this.logTextSizeChange(e,b);this.setTextSizeInTransaction(a,e,b,c);
this.uiRoot.setState({activeTextSize:c})}})}setTextSizeInTransaction(a,b,c,e){const d=this.uiRoot.getState(),f=this.session.selection.getTextSelectionInfo();let h=(null!=f?[f.id]:d.selectedTextIds).map((a)=>b.lookup.text(a));const g=null==f||0===f.offset&&f.length===h[0].length;for(const f of h)this.common.preserveTopLeft(f,()=>{const h=this.getTextSize(d,f,d.activeCharacterProps),k=f.textBox.size.width;if(g)this.common.setCharacterPropsInTransaction(a,b,()=>({fontSize:24}),!0),f.pointSize=this.getDefaultPointSize(d,
f)/24*e;else{const c=this.getDefaultPointSize(d,f);f.pointSize.toFixed(2)!==c.toFixed(2)&&(f.pointSize=c,this.common.setCharacterPropsInTransaction(a,b,()=>({fontSize:h[0]}),!0))}0!==f.wrapWidth&&(f.wrapWidth=Math.max(1,k-(f.textBox.size.width-f.wrapWidth)));this.logChangedTextSize(d,f,c,h[0],e)});g||this.common.setCharacterPropsInTransaction(a,b,()=>({fontSize:e}))}createFontStyleChangers(a,b,c){const {activeFontHasBold:e,activeFontHasItalic:d,activeFontHasBoldItalic:k}=a;let h={};this.common.getActiveLastCharacterProps().fontWeight!==
f.base.FontWeight.Bold||e||k||(h=Object.assign(Object.assign({},h),{fontWeight:f.base.FontWeight.Normal}));this.common.getActiveLastCharacterProps().fontStyle!==f.base.FontStyle.Italic||d||k||(h=Object.assign(Object.assign({},h),{fontStyle:f.base.FontStyle.Normal}));const g=Object.assign(Object.assign({},this.common.getActiveLastCharacterProps()),h),l=(a)=>({fontWeight:a.fontWeight===f.base.FontWeight.Bold?f.base.FontWeight.Normal:f.base.FontWeight.Bold}),m=(a)=>({fontStyle:a.fontStyle===f.base.FontStyle.Italic?
f.base.FontStyle.Normal:f.base.FontStyle.Italic}),q=c.createAction({shortcut:b.shortcuts.bold,enabled:null!=g&&this.common.validProps(a,l(g)),onExecute:(a)=>{p.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANY"});this.common.setCharacterProps(a,"bold",(a)=>l(a))}}),r=c.createAction({shortcut:b.shortcuts.italic,enabled:null!=g&&this.common.validProps(a,m(g)),onExecute:(a)=>{p.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANY"});this.common.setCharacterProps(a,
"italic",(a)=>m(a))}});c.createPropertyBarItem((a)=>a.toggle({id:"text-editor-bold",groupWeight:3,weight:4,pushed:null!=g&&g.fontWeight===f.base.FontWeight.Bold,action:q}));c.createPropertyBarItem((a)=>a.toggle({id:"text-editor-italic",groupWeight:3,weight:5,pushed:null!=g&&g.fontStyle===f.base.FontStyle.Italic,action:r}))}createColorChangers(a,b){b.createPropertyBarItem((b)=>{const c=null!=this.common.getActiveLastCharacterProps()?Object.assign(Object.assign({},this.common.getActiveLastCharacterProps().color),
{a:1}):{r:0,g:0,b:0,a:1};return b.popupButton((b)=>({id:"text-editor-text-color",groupWeight:4,weight:6,tooltipText:l.I18n.ts("Text color"),content:{icon:k.IconSmallId.TextForeground,fills:{solidFill:{fillKind:r.FillKind.solid,color:c},linearFill:null,radialFill:null,canPickClearFill:!0,hasAlpha:!1,current:r.FillKind.solid}},hideArrow:!0,popupHeader:[b.sectionHeader({content:l.I18n.ts("Text color")})],onOpen:()=>this.common.logCTAOpened("PRESENT_COLOR_PICKER_TEXT"),popupContent:[...z.createBrandKitColorCTA(b,
a.brandKitCTA,"PRESENT_COLOR_PICKER_TEXT"),b.colorPicker({id:"text-editor-text-color-picker",showThemeColors:!0,expanded:!0,customColors:null==a.textColorGrid?[]:[a.textColorGrid],fills:{solidFill:{fillKind:r.FillKind.solid,color:c},current:r.FillKind.solid,hasAlpha:!1},onChange:(a,b)=>{this.longRunningExecutor.update("text-font-color",a,b,(b,c)=>{this.common.setCharacterPropsInTransaction(a,b,()=>({color:c.newFill.color}))},(a)=>{this.common.getSelectionFlattenVisuals(a).forEach((a)=>{a.is(f.base.ObjectKind.simpleObject)&&
this.common.logStyleChange(a)})})}})]}))});const c={id:"text-editor-background-color",showThemeColors:!0,expanded:!0,fills:a.backgroundColorPicker,customColors:null==a.textColorGrid?[]:[a.textColorGrid],onChange:(a,b)=>{const c=b.source;this.longRunningExecutor.update("text-background-color",a,b,(a,b)=>{this.common.getSelectionFlattenVisuals(a).forEach((a)=>{if(a.is(f.base.ObjectKind.text)){const c=b.newFill;switch(c.fillKind){case r.FillKind.clear:a.background=null;break;case r.FillKind.solid:a.background=
c.color;break;default:throw Error(c);}}this.uiRoot.setState({backgroundColorPicker:b.fills})})},(a)=>{this.common.getSelectionFlattenVisuals(a).forEach((a)=>{a.is(f.base.ObjectKind.simpleObject)&&(this.common.logStyleChange(a),c!==r.ColorPickerChangeSource.opacitySlider&&c!==r.ColorPickerChangeSource.opacityNumericField||this.logTextOpacityChanges(a,c))})})}};b.createPropertyBarItem((b)=>b.popupButton((b)=>({id:"text-editor-background-color-popup",content:{icon:k.IconSmallId.FillColor,fills:Object.assign(Object.assign({},
a.backgroundColorPicker),{radialFill:null,linearFill:null})},groupWeight:4,weight:7,tooltipText:l.I18n.ts("Fill color"),popupHeader:[b.sectionHeader({content:l.I18n.ts("Fill color")})],hideArrow:!0,onOpen:()=>this.common.logCTAOpened("PRESENT_COLOR_PICKER_TEXT_BACKGROUND"),popupContent:[...z.createBrandKitColorCTA(b,a.brandKitCTA,"PRESENT_COLOR_PICKER_TEXT_BACKGROUND"),b.colorPicker(c),...null==a.backgroundColorPicker.solidFill.color?[]:[b.separator(),b.numericSlider({dataLookup:"text-background-corner-radius",
title:l.I18n.ts("Corner Radius"),onChange:(a,b)=>{const c=b.source;this.longRunningExecutor.update("text-background-corner-radius",a,b,(a,b)=>{const c=this.common.getSelectionFlattenVisuals(a).map((a)=>a.is(f.base.ObjectKind.text)?this.common.exactRadiusMultiplier(a):null).filter((a)=>null!=a).reduceRight((a,b)=>Math.min(a,b));this.common.getSelectionFlattenVisuals(a).forEach((a)=>{a.is(f.base.ObjectKind.text)&&(a.backgroundCornerRadius=b.value*c)});this.uiRoot.setState({backgroundCornerRadius:b.value})},
(a)=>{this.logCornerRadiusChange(a,c,b)})},value:this.uiRoot.getState().backgroundCornerRadius})]]})))}logTextEdit(a,b){a&&p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"TEXT",modify_action:"REPLACE",topic_relationship:b,object_id:b.id})}logCornerRadiusChange(a,b,c){const e=b===r.SliderChangeSource.slider?"CHANGE_CORNER_RADIUS_SLIDER":"CHANGE_CORNER_RADIUS_INPUT_VALUE";this.common.getSelectionFlattenVisuals(a).forEach((a)=>{a.is(f.base.ObjectKind.text)&&(this.common.logStyleChange(a),
p.avro.Avro.createDefaultLogger().logModifyCornerRadiusSetting({corner_radius_nr:c.value,object_type:"TEXT"}),p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"TEXT",modify_action:e,topic_relationship:a,object_id:a.id}))})}logTextOpacityChanges(a,b){b=b===r.ColorPickerChangeSource.opacitySlider?"CHANGE_OPACITY_SLIDER":"CHANGE_OPACITY_INPUT_VALUE";p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,modify_action:b,topic_relationship:a,object_id:a.id})}logTextSizeChange(a,
b){this.common.getSelectionFlattenVisuals(a).forEach((a)=>{p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"TEXT",modify_action:b,topic_relationship:a,object_id:a.id})})}logChangedTextSize(a,b,c,e,d){p.avro.Avro.createDefaultLogger().logChangedTextSize({object_id:b.id,previous_text_size:e,new_text_size:d,text_size_change_trigger:{SELECTED_TEXT_SIZE_PRESET:"SELECT_PRESET",INPUT_TEXT_SIZE:"INPUT_VALUE",INCREASE_TEXT_SIZE:"INCREASE_TEXT_SIZE",DECREASE_TEXT_SIZE:"DECREASE_TEXT_SIZE"}[c],
parent_type:P[this.getTextContainingLayoutBox(a,b).kind]})}preservePlaceholderText(a,b,c){a=a.toDecorator(a.lookup.text(b));null!=a&&a.isPlaceholder&&(b=R.Geometry.distance(a.glyphBox.topLeft,a.glyphBox.topRight),a.set(x.TextEditorPlugin.getOriginalPlaceholderInfo(),{originalWrapWidth:a.wrapWidth,textWithStyle:a.getTextWithStyle(),wrapWidthSet:b}),0===a.wrapWidth&&(a.wrapWidth=b),a.isPlaceholder=!1,a.clearText());c=c(a);if(null!=a&&"\n"===a.getText()&&(b=a.get(x.TextEditorPlugin.getOriginalPlaceholderInfo()),
null!=b)){const c=a.getCharacterProps()[0];a.setTextWithStyle(b.textWithStyle);a.setAllCharacterProps(c);a.wrapWidth===b.wrapWidthSet&&(a.wrapWidth=b.originalWrapWidth);a.isPlaceholder=!0}return c}scaleText(a,b,c){a.position=b.center;b=b.size.width/c.zoomLayoutBox.size.width*1.5;a.scale(b);return b}insertNewText(a,b,c,e,d,l){let h=this.session.insertTarget.getSimpleObjectParent(b);const g=b.toDecorator(h.add.text());var m=this.session.coverEdit.getMode(b);let n=1;m.kind===k.CoverEditModeKind.Advanced?
(m=m.topic.layoutBox.withReferenceFrame(h.zoomLayoutBox.referenceFrame),n=this.scaleText(g,m,h)):m.kind===k.CoverEditModeKind.InsideAdvanced&&m.topicOrOverview.is(f.base.ObjectKind.topic)&&(m=m.topicOrOverview.layoutBox.withReferenceFrame(h.zoomLayoutBox.referenceFrame),n=this.scaleText(g,m,h));g.isPlaceholder=e;this.ensureFontToSupportCurrentLanguageHack(b,g,(a)=>{this.fillText({textEditor:a,textWithStyle:c,pointSize:l,newlyCreated:!0,sizeRatio:n});e&&(a.position={x:a.position.x-a.textBox.size.width,
y:a.position.y-a.textBox.size.height})});b=this.session.positionFinder.findLayoutBox(h,1,1,d?d.stageX:null,d?d.stageY:null);b=c.characterPropss?g.layoutBox.move(g.layoutBox.center,b.center):b;g.fitInto(b);this.session.selection.setSelection(a,[g]);p.avro.Avro.createDefaultLogger().logNewObject({object_type:g,topic_relationship:g,parent_type:g,object_id:g.id})}fillText({textEditor:a,textWithStyle:b,pointSize:c,newlyCreated:e=!1,offset:d=0,length:f=a.getText().length,sizeRatio:h=1}){var g;void 0===
d&&(d=0);void 0===f&&(f=a.getText().length);const k=a.glyphBox.size.height,l=a.glyphBox.size.width;a.setText(b.text,d,f);a.markUrls(!1);null!=b.characterPropss&&0<b.characterPropss.length&&b.characterPropss.length===b.text.length&&a.getTextRange(d,b.text.length).setCharacterProps(b.characterPropss);b=null!==(g=this.uiRoot.getState().parentZoomAreaLayoutBox)&&void 0!==g?g:a.parent.zoomLayoutBox;g=Math.max(b.size.height*h,k);h=Math.max(b.size.width*h,l);e&&(a.pointSize=null!=c&&0!==c?c:g*O);a.glyphBox.size.width>
.8*h&&(a.wrapWidth=.8*h)}ensureFontToSupportCurrentLanguageHack(a,b,c){c(b);F.EditorCommander.createCounterpartUpdater(a).updateCounterpartTexts(b.id,F.UpdateOrigin.current);b.isPlaceholder&&(a=this.getFirstNonLatinLanguageInString(b.getText()),null!=a&&(l.I18n.getLanguage()===l.I18n.LANGUAGE_KOREAN&&a===this.CHARACTERS_KOREAN||l.I18n.getLanguage()===l.I18n.LANGUAGE_JAPANESE&&(a===this.CHARACTERS_JAPANESE||a===this.CHARACTERS_CJK))&&b.updateFontToSupportCurrentLanguage())}getFirstNonLatinLanguageInString(a){const b=
a.length;for(let c=0;c<b;c++){const b=a.charCodeAt(c);if(12593<=b&&12643>=b||44032<=b&&55197>=b||-1!==this.standAloneKoreanChars.indexOf(b))return this.CHARACTERS_KOREAN;if(12288<=b&&12351>=b||12352<=b&&12447>=b||12448<=b&&12543>=b||65280<=b&&65519>=b)return this.CHARACTERS_JAPANESE;if(19968<=b&&40879>=b)return this.CHARACTERS_CJK}return null}createUpdatePresetMenuItem(a,b){null!=a.activePresetSelector&&b.createMenuItem({id:"context-menu-update-preset",kind:k.MenuItemKind.context,title:l.I18n.ts("Update style preset")+
(y.isActive("js-developer-features")?" (DEV: "+a.activePresetSelector+")":""),weight:69,onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"update style preset",run:(a)=>{this.session.selection.getSelectionInfo(a).allObjects.forEach((a)=>{a.is(q.text)&&a.updatePresetStyle()})}})}})}updateTextColorGrid(a){a=F.EditorCommander.createColorMixCommander().schemeFromPrezi(a.styleSheet);null!=a&&(a=a.colorScheme,null!=a&&null!=a.primaryTextColor&&null!=a.secondaryTextColor&&this.uiRoot.setState({textColorGrid:{id:"scheme-text-colors",
title:l.I18n.ts("SCHEME TEXT COLORS"),weight:0,colors:[a.primaryTextColor.getRGBData(),a.secondaryTextColor.getRGBData()]}}))}};m={};Object.defineProperty(m,"__esModule",{value:!0});m.lazyModule={createPlugin(){return new x.TextEditorPlugin}};return m});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_text_editor",["require","prezi.geometry","prezi_brand_kit_cta","prezi_cet_model","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_font_provider","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_service_fontcatalogue","prezi_shared_ui","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_text_editor.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_brand_kit_cta"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_font_provider"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_service_fontcatalogue"),require("prezi_shared_ui"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_text_editor"]=__factory(this["prezi.geometry"],this["prezi_brand_kit_cta"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_font_provider"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_service_fontcatalogue"],this["prezi_shared_ui"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);