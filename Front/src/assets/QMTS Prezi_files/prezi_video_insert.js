;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_video_insert";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_i18n":dependencies[2],"prezi_logger":dependencies[3],"prezi_plugin_api":dependencies[4],"prezi_plugin_meta":dependencies[5],"prezi_utils":dependencies[6]}};})());};})(arguments);var moduleImpl=(function(){return module(function(f){var m=f.dependencies.prezi_utils,k=f.dependencies.prezi_cet_model_editor,e=f.dependencies.prezi_i18n,h=f.dependencies.prezi_logger,c=f.dependencies.prezi_plugin_api,l=f.dependencies.prezi_plugin_meta,n=f.dependencies.prezi_featureswitcher,g={};Object.defineProperty(g,"__esModule",{value:!0});var p=k.base.ObjectKind,q=k.base.VideoAssetKind;const r={v:"",aa:!1,u:!1,networkStatus:c.NetworkStatus.Online,activePathElementId:null,j:null};g.i=class{constructor(){this.logger=h.LoggerModule.getLoggerManager().createLogger("VideoInsertPlugin")}init(a){a.onLicenseChange((d)=>
{this.logger.info({object:"videoSidebarOnLicenseChange",action:"change",trigger:"change",payload:{videoUpload:d.featureSet.videoUpload}});this.f.setState({aa:d.featureSet.videoUpload})});a.onFileDrop({allowVideo:!0},(d,a)=>{a=this.session.document.progressiveAssetManager.uploadVideo(a.data.file);this.w(d,a.token,"file_drop")});a.onURLDrop((d,a)=>this.session.document.progressiveAssetManager.isYoutubeUrl(a.data.url.toString())?(this.$(d,a.data.url.toString()),!0):!1);a.onNetworkStatusChange((a)=>{this.f.setState({networkStatus:a})});
a.onSelectionChange((a)=>{var d;let b=null;if(1===a.allObjects.length){const d=a.allObjects[0];d.kind===p.video&&this.session.document.read((a)=>{var b;a=a.lookup.resolve(d);return null!=a&&a.letterboxYoutubeThumbnail&&(null===(b=a.videoAsset)||void 0===b?void 0:b.videoAssetKind)===q.youtube})&&(b=d)}(null===(d=this.f.getState().j)||void 0===d?void 0:d.id)!==(null===b||void 0===b?void 0:b.id)&&this.f.setState({j:b})});this.f=a.declareUI(r,(a,f)=>{f.createSidebar(g.i.o,(b)=>({root:{title:e.I18n.ts("Video"),
content:[...n.isActive("js-hide-library-sidebar-button")?[]:this.ba(b),b.sectionHeader({content:e.I18n.ts("Upload your file")}),b.button(c.ButtonSize.Large,c.ButtonAlign.Start,(b)=>[a.aa?b.upload({color:c.ButtonColor.Gray,id:"video-upload",content:{text:e.I18n.ts("Upload video")},fileFilter:{allowVideo:!0},onFileSelected:(a,{file:b,source:d})=>{h.avro.Avro.createDefaultLogger().logInsertVideo({video_source:d});b=this.session.document.progressiveAssetManager.uploadVideo(b);this.w(a,b.token,"upload_file_selector")}}):
b.button({id:"video-upload",color:c.ButtonColor.Gray,content:{text:e.I18n.ts("Upload video")},onClick:()=>{this.f.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertVideo)}}),b.button({id:"upload-info",color:c.ButtonColor.Ghost,content:{icon:c.IconSmallId.Info},onClick:()=>{const a=e.I18n.ts("https://prezi.com/business/kb/create-your-prezi/adding-video/");window.open(a,"_blank_info")},tooltipText:e.I18n.ts("Supported video formats")})]),b.separator(),b.sectionHeader({content:e.I18n.ts("Embed Youtube")}),
b.inputField({id:"youtube-url",placeholderText:"http://",value:a.v,onEnter:(a)=>{this.$(a,this.f.getState().v)},onValueChange:(a,b)=>{this.f.setState({v:b})},bottomText:e.I18n.ts("Powered by YouTube")}),b.button(c.ButtonSize.Small,c.ButtonAlign.End,(b)=>[b.button({id:"youtube-upload",color:c.ButtonColor.Gray,content:{text:e.I18n.ts("Insert")},onClick:(b)=>{this.$(b,a.v)}})]),b.separator(),b.label(e.I18n.ts("YouTube videos will not be available while presenting offline."))],footer:[b.label(e.I18n.ts("Any media you insert must comply with Prezi Terms of Use.")),
b.button(c.ButtonSize.Small,c.ButtonAlign.Start,(a)=>[a.button({id:"video-terms-of-use",color:c.ButtonColor.Ghost,content:{text:e.I18n.ts("Prezi Terms of Use")},onClick:()=>{const a=e.I18n.ts("https://prezi.com/terms-of-use/");window.open(a,"_blank_terms")}})])]},onCloseButtonClicked:()=>{h.avro.Avro.createDefaultLogger().logCloseVideoSidebar()},onOpen:()=>{this.f.setState({u:!0})},onClose:()=>{this.f.setState({u:!1})}}));f.createTopMenuItem(c.TopMenuId.Media,{kind:c.MenuItemKind.largeButton,id:"topmenu-insert-item-video",
title:e.I18n.ts("Video"),icon:c.IconSmallId.Video,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"VIDEO"});a.u?this.f.sidebar.close(g.i.o):this.f.sidebar.open(g.i.o)},weight:2,categoryWeight:0});null!=a.j&&f.createMenuItem({kind:c.MenuItemKind.context,title:e.I18n.ts("Remove letterbox"),id:"context-menu-remove-letterbox",weight:85,onClick:(b)=>{this.session.document.executeApiCommand(b,{name:"remove letterbox",run:(b)=>{b=b.lookup.resolve(a.j);null!=b&&(b.letterboxYoutubeThumbnail=
!1)}});this.f.setState({j:null})}})})}ba(a){return"Online"===this.f.getState().networkStatus?[a.sectionHeader({content:e.I18n.ts("My Library")}),a.button(c.ButtonSize.Large,c.ButtonAlign.Start,(a)=>[a.button({id:"open-my-library-button",color:c.ButtonColor.Blue,content:{text:e.I18n.ts("Add from my library")},onClick:()=>{this.pluginAccess.send(l.favorites,l.createOpenFavoritesFromAnotherSidebarMessage("video","insert"))}})]),a.separator()]:[]}$(a,d){h.avro.Avro.createDefaultLogger().logInsertVideo({video_source:"URL"});
d=this.session.document.progressiveAssetManager.createYoutubeAsset(d);null!=d&&this.w(a,d,"click_on_insert")}w(a,d,c){this.session.document.executeApiCommand(a,{name:"video insert",run:(b)=>{var c=this.session.insertTarget.getSimpleObjectParent(b),e=this.session.positionFinder.getCameraLayoutBox().scale(.5);c=c.add.video(d);c.fitInto(e);this.session.selection.setSelection(a,[c]);b=this.ca(b);const f=this.f.getState().activePathElementId;null!=b&&(e=b.children.findIndex((a)=>a.id===f),b.add.zoom(-1<
e?e+1:b.children.length,c))}},{trigger:c})}processMessage(a){switch(a.kind){case l.VideoInsertSidebarMessageKind.open:this.da();break;case l.VideoInsertSidebarMessageKind.setActivePathElement:this.f.setState({activePathElementId:a.activePathElementId});break;default:m.Utils.assertNever(a)}}da(){this.f.getState().u||(h.avro.Avro.createDefaultLogger().logShowVideoInsertOptions(),this.f.sidebar.open(g.i.o))}ca(a){const c=this.session.insertTarget.getSimpleObjectParent(a).id;return a.structuredPath.pathElementsInOrder.find((a)=>
(a.is(k.base.ObjectKind.visitOverview)||a.is(k.base.ObjectKind.visitPlanet)||a.is(k.base.ObjectKind.visitPage))&&a.target.id===c)}unload(){}};g.i.o="video-sidebar";f={};Object.defineProperty(f,"__esModule",{value:!0});f.lazyModule={createPlugin(){return new g.i}};return f});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_video_insert",["require","prezi_cet_model_editor","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_video_insert.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"));}else{this["prezi_video_insert"]=__factory(this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"]);}}).call(this);