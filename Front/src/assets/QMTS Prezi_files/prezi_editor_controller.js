;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_editor_controller";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.geometry":dependencies[1],"prezi_app_utils":dependencies[2],"prezi_bacon":dependencies[3],"prezi_brand_kit_cta":dependencies[4],"prezi_canvas_listener":dependencies[5],"prezi_cet":dependencies[6],"prezi_cet_model":dependencies[7],"prezi_cet_model_editor":dependencies[8],"prezi_cet_renderer":dependencies[9],"prezi_editor_commander":dependencies[10],"prezi_editor_error":dependencies[11],"prezi_editor_store_common":dependencies[12],"prezi_editor_store_focus":dependencies[13],"prezi_editor_store_mode":dependencies[14],"prezi_editor_store_object":dependencies[15],"prezi_externalserviceprovider":dependencies[16],"prezi_featureswitcher":dependencies[17],"prezi_i18n":dependencies[18],"prezi_logger":dependencies[19],"prezi_nativeapitypes":dependencies[20],"prezi_playback":dependencies[21],"prezi_plugin_api":dependencies[22],"prezi_plugin_meta":dependencies[23],"prezi_replacer":dependencies[24],"prezi_select":dependencies[25],"prezi_service_browsernotification":dependencies[26],"prezi_service_data":dependencies[27],"prezi_service_media":dependencies[28],"prezi_templateservice":dependencies[29],"prezi_textmodel":dependencies[30],"prezi_type_collector":dependencies[31],"prezi_typescript_compiler":dependencies[32],"prezi_uaparser":dependencies[33],"prezi_utils":dependencies[34],"prezi_widgets":dependencies[35],"prezi_about_box":dependencies[36],"prezi_alignment_tools":dependencies[37],"prezi_ar_convert":dependencies[38],"prezi_ar_video_template_tools":dependencies[39],"prezi_asset_hyperlink":dependencies[40],"prezi_assets":dependencies[41],"prezi_bracket_frame":dependencies[42],"prezi_brand_colors":dependencies[43],"prezi_chart_insert":dependencies[44],"prezi_classic_import":dependencies[45],"prezi_classic_to_next_onboarding":dependencies[46],"prezi_dashed_line":dependencies[47],"prezi_debug":dependencies[48],"prezi_depth_of_field":dependencies[49],"prezi_download_presentation":dependencies[50],"prezi_editor_mode":dependencies[51],"prezi_engagement_tools_helper":dependencies[52],"prezi_equation_editor":dependencies[53],"prezi_export_to_pdf":dependencies[54],"prezi_extended_selection":dependencies[55],"prezi_favorites":dependencies[56],"prezi_file_picker_integrations":dependencies[57],"prezi_font_admin":dependencies[58],"prezi_font_preview":dependencies[59],"prezi_font_selector":dependencies[60],"prezi_frame_insert":dependencies[61],"prezi_grouping":dependencies[62],"prezi_hamburger_menu_improvements":dependencies[63],"prezi_interaction_mode":dependencies[64],"prezi_layout":dependencies[65],"prezi_local_service_mocks":dependencies[66],"prezi_lock_objects":dependencies[67],"prezi_marker_editor":dependencies[68],"prezi_narrative_editor":dependencies[69],"prezi_navigation":dependencies[70],"prezi_parallax_background":dependencies[71],"prezi_path_audio":dependencies[72],"prezi_path_editing":dependencies[73],"prezi_path_generation_strategy":dependencies[74],"prezi_photo_editor":dependencies[75],"prezi_ppt_edit":dependencies[76],"prezi_ppt_insert":dependencies[77],"prezi_prezi_video_onboarding":dependencies[78],"prezi_qr_code_insert":dependencies[79],"prezi_search_replace":dependencies[80],"prezi_select_similar":dependencies[81],"prezi_shape_and_arc_editor":dependencies[82],"prezi_snippet_editing_layout_options":dependencies[83],"prezi_solid_color":dependencies[84],"prezi_storyblocks":dependencies[85],"prezi_storyblocks_admin":dependencies[86],"prezi_style":dependencies[87],"prezi_syntax_highlight":dependencies[88],"prezi_template_from_storyblocks":dependencies[89],"prezi_test_navigationbar":dependencies[90],"prezi_test_propertybar":dependencies[91],"prezi_test_sidebar":dependencies[92],"prezi_text_editor":dependencies[93],"prezi_topic_grouping_onboarding":dependencies[94],"prezi_topic_shape":dependencies[95],"prezi_turn_into_topic":dependencies[96],"prezi_video_background":dependencies[97],"prezi_video_insert":dependencies[98],"prezi_video_template_from_figma":dependencies[99],"prezi_view_to_dashboard_test":dependencies[100],"prezi_visual_types":dependencies[101],"prezi_z_order_object":dependencies[102]}};})());};})(arguments);var moduleImpl=(function(){return module(function(r){function Fb(a){switch(a){case "(":return")";case ")":return"(";default:return a}}function ua(a){a=a.replace(Gb,function(a,b,c){return ua(c)+b}).replace(Hb,"$2$1");let b="",c=a.length;for(;c--;)b+=a.charAt(c);return b}function va(a){switch(a){case g.ControlPointPosition.TOP_RIGHT:return 1;case g.ControlPointPosition.BOTTOM_RIGHT:return 2;case g.ControlPointPosition.BOTTOM_LEFT:return 3}return 0}function qb(a,b){for(;0>a;)a+=360;for(;360<=a;)a-=360;return Math.round(a/(360/b))}var Ib=
null,F=r.dependencies["prezi.engine.dom"],M=r.dependencies["prezi.geometry"],w=r.dependencies.prezi_cet_model,rb=r.dependencies.prezi_editor_error,Q=r.dependencies.prezi_editor_store_focus,t=r.dependencies.prezi_editor_store_mode,n=r.dependencies.prezi_editor_store_object,u=r.dependencies.prezi_plugin_meta,Fa=r.dependencies.prezi_service_browsernotification,Ga=r.dependencies.prezi_service_data,Jb=r.dependencies.prezi_type_collector,Kb=r.dependencies.prezi_typescript_compiler,R=r.dependencies.prezi_uaparser,
D=r.dependencies.prezi_utils,wa=r.dependencies.prezi_widgets,Lb=r.dependencies.prezi_about_box,Mb=r.dependencies.prezi_alignment_tools,Nb=r.dependencies.prezi_ar_convert,Ob=r.dependencies.prezi_ar_video_template_tools,Pb=r.dependencies.prezi_asset_hyperlink,Qb=r.dependencies.prezi_assets,Rb=r.dependencies.prezi_bracket_frame,Sb=r.dependencies.prezi_brand_colors,Tb=r.dependencies.prezi_chart_insert,Ub=r.dependencies.prezi_classic_import,Vb=r.dependencies.prezi_classic_to_next_onboarding,Wb=r.dependencies.prezi_dashed_line,
Xb=r.dependencies.prezi_debug,Yb=r.dependencies.prezi_depth_of_field,Zb=r.dependencies.prezi_download_presentation,$b=r.dependencies.prezi_editor_mode,ac=r.dependencies.prezi_engagement_tools_helper,bc=r.dependencies.prezi_equation_editor,cc=r.dependencies.prezi_export_to_pdf,dc=r.dependencies.prezi_extended_selection,ec=r.dependencies.prezi_favorites,fc=r.dependencies.prezi_file_picker_integrations,gc=r.dependencies.prezi_font_admin,hc=r.dependencies.prezi_font_preview,ic=r.dependencies.prezi_font_selector,
jc=r.dependencies.prezi_frame_insert,kc=r.dependencies.prezi_grouping,lc=r.dependencies.prezi_hamburger_menu_improvements,mc=r.dependencies.prezi_interaction_mode,nc=r.dependencies.prezi_layout,oc=r.dependencies.prezi_local_service_mocks,pc=r.dependencies.prezi_lock_objects,qc=r.dependencies.prezi_marker_editor,rc=r.dependencies.prezi_narrative_editor,sc=r.dependencies.prezi_navigation,tc=r.dependencies.prezi_parallax_background,uc=r.dependencies.prezi_path_audio,sb=r.dependencies.prezi_path_editing,
vc=r.dependencies.prezi_path_generation_strategy,wc=r.dependencies.prezi_photo_editor,xc=r.dependencies.prezi_ppt_edit,yc=r.dependencies.prezi_ppt_insert,zc=r.dependencies.prezi_prezi_video_onboarding,Ac=r.dependencies.prezi_qr_code_insert,Bc=r.dependencies.prezi_search_replace,Cc=r.dependencies.prezi_select_similar,Dc=r.dependencies.prezi_shape_and_arc_editor,Ec=r.dependencies.prezi_snippet_editing_layout_options,Fc=r.dependencies.prezi_solid_color,Gc=r.dependencies.prezi_storyblocks,Hc=r.dependencies.prezi_storyblocks_admin,
tb=r.dependencies.prezi_style,Ic=r.dependencies.prezi_syntax_highlight,Jc=r.dependencies.prezi_template_from_storyblocks,ub=r.dependencies.prezi_test_navigationbar,vb=r.dependencies.prezi_test_propertybar,wb=r.dependencies.prezi_test_sidebar,Kc=r.dependencies.prezi_text_editor,Lc=r.dependencies.prezi_topic_grouping_onboarding,Mc=r.dependencies.prezi_topic_shape,Nc=r.dependencies.prezi_turn_into_topic,Oc=r.dependencies.prezi_video_background,Pc=r.dependencies.prezi_video_insert,Qc=r.dependencies.prezi_video_template_from_figma,
Rc=r.dependencies.prezi_view_to_dashboard_test,Sc=r.dependencies.prezi_visual_types,Tc=r.dependencies.prezi_z_order_object,A=r.dependencies.prezi_app_utils,k=r.dependencies.prezi_bacon,h=r.dependencies.prezi_canvas_listener,l=r.dependencies.prezi_cet,p=r.dependencies.prezi_cet_model_editor,Z=r.dependencies.prezi_cet_renderer,g=r.dependencies.prezi_editor_commander,ba=r.dependencies.prezi_playback,q=r.dependencies.prezi_select,G=r.dependencies.prezi_featureswitcher,E=r.dependencies.prezi_logger,z=
r.dependencies.prezi_plugin_api,Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.$f=class{constructor(a,b){this.xc=a;this.re=b;this.logger=E.LoggerModule.getLoggerManager().createLogger("BasicEditControllerImpl");this.Ub=A.AppUtilsModule.getLogHelperUtils();this.Od=k.Bacon.newBus()}save(a=()=>{}){this.re.save().take(1).onValue(a)}forceSaveAndGetStorageProperties(a=()=>{}){this.re.forceSaveAndGetStorageProperties().take(1).onValue(a)}undo(a,b=()=>{}){this.Ub.undoRedo(this.logger,"undo",I.UndoRedoRequestTrigger[a]);
E.avro.Avro.createDefaultLogger().logUndo();if(this.xc().isUndoable())try{z.invalidateAsyncUserActionTokens(),this.xc().executeUndo(),this.Od.push(I.UndoRedoAction.UNDO)}catch(c){if(!l.Cet.getErrorInfo(c).isCannotStartTransactionError)throw c;}b()}redo(a,b=()=>{}){this.Ub.undoRedo(this.logger,"redo",I.UndoRedoRequestTrigger[a]);E.avro.Avro.createDefaultLogger().logRedo();if(this.xc().isRedoable())try{this.xc().executeRedo(),this.Od.push(I.UndoRedoAction.REDO)}catch(c){if(!l.Cet.getErrorInfo(c).isCannotStartTransactionError)throw c;
}b()}getUndoRedoStream(){return this.Od.toEventStream()}};var T={};Object.defineProperty(T,"__esModule",{value:!0});T.Pa=class{static getExtensionFromMimeType(a){return(a=T.Pa.Cg[a])?"."+a:""}static Lb(a){return a?"application/vnd.ms-powerpoint"===a||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===a?"powerpoint":0===a.indexOf("image/")?"image":"application/pdf"===a?"pdf":"video/mp4"===a?"video":"unknown":"unknown"}};T.Pa.Cg={"image/jpeg":"jpg","image/png":"png","image/gif":"gif",
"application/pdf":"pdf","video/mp4":"mp4","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx"};var v={};Object.defineProperty(v,"__esModule",{value:!0});v.Ya="text";v.Lc="text/plain";v.Zd="image/";v.ae="video/mp4";v.kc="application/json";v.$d="application/pdf";v.lc="PreziDoc";v.Pc="TextRange";v.Rd=104857600;(function(a){a[a.ee=0]="Proximity";a[a.Center=1]="Center";a[a.Xd=2]="LastClickPosition"})(v.Ra||(v.Ra={}));(function(a){a[a.None=0]="None";a[a.Wd=1]="KeepWorldSize";
a[a.ce=2]="ParentRelativeSize"})(v.hb||(v.hb={}));(function(a){a[a.None=0]="None";a[a.be=1]="Panning";a[a.Click=2]="Click"})(v.Ka||(v.Ka={}));var ea={};Object.defineProperty(ea,"__esModule",{value:!0});ea.yb=class{static Jh(a){var b=new Date;if(0!==a.indexOf("data:"))return null;var c=a.substr(5).split(",",2);if(2!==c.length)return null;var d=c[0].split(";");a=d[0];var e;0<d.length&&(e=d[d.length-1]);c=c[1];e="base64"===e?atob(c):decodeURIComponent(c);c=new ArrayBuffer(e.length);c=new Uint8Array(c);
for(d=0;d<e.length;d+=1)c[d]=e.charCodeAt(d);e=ea.yb.gg;a.match(ea.yb.Bg)&&(e=a);a=new Blob([c],{type:e});a.name="droppeddata"+T.Pa.getExtensionFromMimeType(e);a.lastModifiedDate=b;return a}};ea.yb.Bg=/^(\w+)\/(.*)$/;ea.yb.gg="text/plain";var Ia={};Object.defineProperty(Ia,"__esModule",{value:!0});Ia.hg=class{constructor(a,b,c){this.Vb=a;this.applicationController=b;this.Ha=c;this.Yi=[(a,b)=>this.Hi(a,b),(a,b,c)=>this.Ji(a,b,c),(a,b,c)=>this.Mi(a,b,c),(a,b,c)=>this.Ki(a,b,c),(a,b)=>this.Li(a,b)];
this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.DropTarget");this.Na=k.Bacon.newBus()}getErrorStream(){return this.Na}handle(a,b,c){this.Yi.some((d)=>d(a,b,c))}yi(a){const b=a.types;for(let c=0;c<a.types.length;++c)if(b[c].startsWith("prezi-data"))return a.getData(b[c]);return""}dk(a,b){const c=[];for(let b=0;b<a.length;b++){const d=a[b];c.push({type:d.type,size:d.size})}if(1===c.length)this.logger.info({action:"insert",object:T.Pa.Lb(c[0].type),trigger:"dragdrop",
payload:{file_size:c[0].size,file_type:c[0].type,drag_source:"system",user_intent_id:b,data_transfer_method:"file"}});else for(this.logger.info({action:"insert",object:"multiple",trigger:"dragdrop",payload:{num_files:c.length,drag_source:"system",user_intent_id:b,data_transfer_method:"file"}}),a=0;a<c.length;++a)this.logger.info({action:"insert_multiple_details",object:T.Pa.Lb(c[a].type),trigger:"dragdrop",payload:{file_size:c[a].size,file_type:c[a].type,drag_source:"system",user_intent_id:b,data_transfer_method:"file"}})}Hi(a,
b){try{const c=JSON.parse(this.yi(a));if(this.Ha.isPlaceholderDrag())this.Ha.onDrop(b,c);else this.applicationController.listItemDrop({stageX:b.x,stageY:b.y,data:c,targetTopic:null});return!0}catch(c){}return!1}Li(a,b){a=a.getData("text");return null!=a&&0<a.length?this.applicationController.styledTextDrop({stageX:b.x,stageY:b.y,targetTopic:null,data:{text:a,characterPropss:null,pointSize:null}}):!1}Mi(a,b,c){a=a.getData("text/uri-list");return null!=a?this.Le(a.split("\n")[0],b,c):!1}Ki(a,b,c){var d=
/img[^<]*src=('|")([^'"]*)/;a=a.getData("text/html");return null!=a&&(d=d.exec(a))?this.Le(d[2],b,c):!1}Ji(a,b,c){let d=!1;if(a.files&&a.files.length){this.dk(a.files,c);for(let e=0;e<a.files.length;e++){const f=a.files[e];f.size<v.Rd?this.Vb.md({file:f,stageX:b.x+42*e,stageY:b.y+42*e,userIntentId:c})&&(d=!0):this.Na.push({errorCase:rb.EditorErrorCase.DROPPED_CONTENT_TOO_LARGE})}}return d}Le(a,b,c){if(null==a||""===a)return!1;if(/^(?:(?:data:([^;]*);base64,)?)((?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==))$/.exec(a))return a=
ea.yb.Jh(a),this.logger.info({action:"insert",object:T.Pa.Lb(a.type),trigger:"dragdrop",payload:{file_size:a.size,file_type:a.type,drag_source:"system",user_intent_id:c,data_transfer_method:"data_url"}}),this.Vb.md({file:a,stageX:b.x,stageY:b.y,userIntentId:c});{let d=null;try{d=new URL(a)}catch(e){}return null!=d&&this.Vb.Ej({url:d,stageX:b.x,stageY:b.y,userIntentId:c})}}};var Ja={};Object.defineProperty(Ja,"__esModule",{value:!0});Ja.kg=class{constructor(a,b,c,d){this.Ha=d;this.Ke=k.Bacon.newBus();
this.Oj=b;this.ad=new Ia.hg(a,c,d)}addDropTargetElement(a){void 0!==$(a).droppable&&$(a).droppable({accept:".image-sidebar-content",over:(b,d)=>{d.draggable.data("current-droppable",$(a))},out:(a,b)=>{b.draggable.removeData("current-droppable")},drop:(a,b)=>{b.draggable.removeData("current-droppable")}});const b=(b)=>{const c=$(a).offset();var e=c.top;const f=b.originalEvent.clientY;b=Math.round(b.originalEvent.clientX-c.left-Math.floor($(a).width()/2));e=Math.round(f-e-Math.floor($(a).height()/2));
return{x:b,y:e}};$(a).on({dragenter:(a)=>{a.originalEvent.dataTransfer.dropEffect="copy";a.preventDefault();const c=a.originalEvent.dataTransfer.types;let e=!1;const f=new Set;for(let a=0;a<c.length;a++){var m=c[a].slice(11);0<m.length&&(m=parseInt(m,10),m&wa.PreziDataMimeParam.showPlaceholder&&(e=!0),m&wa.PreziDataMimeParam.snapTargetRegularPlanet&&f.add(g.SnapTargetKind.RegularPlanet),m&wa.PreziDataMimeParam.snapTargetSlideOnOverview&&f.add(g.SnapTargetKind.SlideOnOverview),m&wa.PreziDataMimeParam.snapTargetSlideOnPlanet&&
f.add(g.SnapTargetKind.SlideOnPlanet))}if(e||0<f.size)this.Ha.onDragStart(b(a),null,e,f)},dragleave:(a)=>{a.originalEvent.dataTransfer.dropEffect="copy";a.preventDefault();if(this.Ha.isPlaceholderDrag())this.Ha.onDragLeave(b(a))},dragover:(a)=>{a.originalEvent.dataTransfer.dropEffect="copy";a.preventDefault();if(this.Ha.isPlaceholderDrag())this.Ha.onDragOver(b(a),!1,!0)},drop:(a)=>{this.Ke.push(a);"true"!==a.originalEvent.dataTransfer.getData("ReactDnd")&&(a.preventDefault(),a.stopPropagation())}});
this.Ke.filterWithStream(this.Oj).onValue((a)=>{const c=a.originalEvent&&a.originalEvent.dataTransfer;if(c&&c.getData){a=b(a);var e=E.LoggerModule.getLoggerManager().generateUserIntentId();this.ad.handle(c,a,e)}})}integration_test_drop(a,b){this.ad.handle(a,b,E.LoggerModule.getLoggerManager().generateUserIntentId())}getErrorStream(){return this.ad.getErrorStream()}excludeDropTargetElement(a){a.addEventListener("dragover",(a)=>{a.dataTransfer.dropEffect="none";a.preventDefault()})}};var ia={};Object.defineProperty(ia,
"__esModule",{value:!0});ia.jc=class{constructor(a){this.logger=a}gk(a,b){const c=[];for(let b=0;b<a.length;++b){const d=a[b];c.push({size:d.file.size,type:d.file.type})}if(1===c.length)this.logger.info({action:"insert",object:T.Pa.Lb(c[0].type),trigger:"paste",payload:{file_size:c[0].size,file_type:c[0].type,paste_from:"system_clipboard",user_intent_id:b}});else for(this.logger.info({action:"insert",object:"multiple",trigger:"paste",payload:{num_files:c.length,paste_from:"system_clipboard",user_intent_id:b}}),
a=0;a<c.length;++a)this.logger.info({action:"insert_multiple_details",object:T.Pa.Lb(c[a].type),trigger:"paste",payload:{file_size:c[a].size,file_type:c[a].type,paste_from:"system_clipboard",user_intent_id:b}})}hk(a){a=ia.jc.Ze(a);const b={paste_from:"prezi_clipboard",num_objects:a.length};let c;1===a.length?(c=this.Ye(a[0]),"topic"===c&&(b.type=a[0])):c="multiple";this.logger.info({action:"insert",object:c,trigger:"paste",payload:b})}Ye(a){if(0===a.indexOf("Z_")){if(/FRAME$/.test(a))return"topic";
a=a.substr(2)}return a.toLowerCase()}static Ze(a){const b=[];a=a.getZObjects();for(let c=0;c<a.length();++c){const d=a.get(c).getObjectType();b.push(F.ZObjectType[d])}return b}ck(a){this.logger.info({action:"copy_to_clipboard",object:"plain_text",trigger:"copy",payload:{text_length:a?a.length:0}})}qf(a){a=ia.jc.Ze(a);const b={num_objects:a.length};let c;1===a.length?(c=this.Ye(a[0]),"topic"===c&&(b.type=a[0])):c="multiple";this.logger.info({action:"copy_to_clipboard",object:c,trigger:"copy",payload:b})}};
var yb={Lk:function(a){{let c=0,d=0;for(let e=0;e<a.length&&300>e;e++){var b=a.charCodeAt(e);1424<=b&&1791>=b?c+=1:d+=1}b=c>d}a=b?ua(a).replace(/[\(\)]/g,Fb).replace(/[0-9a-zA-Z][0-9a-zA-Z \.\-,]*[0-9a-zA-Z]/g,ua).replace(/[\u0660-\u0669\u06F0-\u06F9]+/g,ua).split("\n").reverse().join("\n"):a;return xb.test(a)?a.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(xb," "):a}};Object.defineProperty(yb,"__esModule",{value:!0});const xb=new RegExp(/[\u0000-\u0009\u000B-\u001F]/g),Gb=/([\0-\u02FF\u0370-\u1AAF\u1B00-\u1DBF\u1E00-\u20CF\u2100-\uD7FF\uE000-\uFE1F\uFE30-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])([\u0300-\u036F\u1AB0-\u1AFF\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]+)/g,
Hb=/([\uD800-\uDBFF])([\uDC00-\uDFFF])/g;var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});Ka.Sg=class{constructor(){}df(a){a=this.di(a);return this.oh(a)}oh(a){let b=0;for(let c=0;c<a.length;++c)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b}di(a){if(!a)return"null";let b=a.text;if(X.$a.Vj(b))return b;if(a.files)for(var c=0;c<a.files.length;++c)b+="-"+this.Se(a.files[c]);if(a.items)for(b+="-",c=0;c<a.items.length;++c)b+="-"+this.ak(a.items[c]);return b}Se(a){return a?[a.lastModified?a.lastModified.toString():
"null",a.name,a.size,a.type].join(":"):"null"}ak(a){return a?[a.kind,a.type,this.Se(a.getAsFile())].join(":"):"null"}};var S={},Uc=this&&S.ib||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,m){function f(a){try{x(d.next(a))}catch(B){m(B)}}function C(a){try{x(d["throw"](a))}catch(B){m(B)}}function x(a){a.done?c(a.value):e(a.value).then(f,C)}x((d=d.apply(a,b||[])).next())})};Object.defineProperty(S,"__esModule",{value:!0});S.Ea=
class{constructor(){}static Zc(a,b){return Uc(this,void 0,void 0,function*(){const c=S.Ea.ze(b);null!=c.pa.type&&(c.pa.doc=F.DOM.IPreziCopy().copyPrezi(yield p.CetModelEditor.loadAndConvertPreziXmlAsync(a,c.zf.doc)));return c.pa})}static ze(a){const b={pa:new S.Ea,zf:null};try{const c=JSON.parse(a);b.zf=c;if(c.type&&(c.type===v.lc||c.type===v.Pc)){const a=c.bounds;null!=a&&(b.pa.bounds=S.Ea.yf(a));const e=c.parentBounds;null!=e&&(b.pa.xk=S.Ea.yf(e));b.pa.parentId=c.parent;b.pa.Ld=c.startSelection;
b.pa.pointSize=c.pointSize;b.pa.fd=c.endSelection;b.pa.type=c.type;const f=c.viewport;null!=f&&(b.pa.viewport=S.Ea.cl(f));b.pa.singlePageCopied=c.singlePageCopied;b.pa.yk=c.parentIsPage}}catch(c){}return b}static Zj(a){return S.Ea.ze(a).pa.isValid()}isValid(){return null!=this.type}getType(){return this.type}getBounds(){return this.bounds}getParentId(){return this.parentId}static yf(a){return M.Geometry.obbFromData(a.centerX,a.centerY,a.width,a.height,a.degrees)}static cl(a){return M.Geometry.rectangleFromData(a)}getViewport(){return this.viewport}};
var X={},La=this&&X.ib||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,m){function f(a){try{x(d.next(a))}catch(B){m(B)}}function C(a){try{x(d["throw"](a))}catch(B){m(B)}}function x(a){a.done?c(a.value):e(a.value).then(f,C)}x((d=d.apply(a,b||[])).next())})};Object.defineProperty(X,"__esModule",{value:!0});var Vc=p.base.modelColorToCharacterColor;X.$a=class{constructor(a,b,c,d,e,f){this.scene=a;this.Ff=b;this.applicationController=
c;this.Fc=d;this.Vb=e;this.Bb=f;this.oc=k.Bacon.newBus();this.Yb=k.Bacon.newBus();this.ec=k.Bacon.newBus();this.Md=k.Bacon.newBus();this.Af=k.Bacon.newBus();this.ne=k.Bacon.newBus();this.Be=k.Bacon.newBus();this.yh=k.Bacon.newBus();this.Pd=k.Bacon.newBus();this.oe=k.Bacon.newBus();this.pe=k.Bacon.newBus();this.we=k.Bacon.newBus();this.Na=k.Bacon.newBus();this.Sk();this.vj();a=this.jh(this.Cf);this.Fj=k.Bacon.mergeAll([this.ef(a,this.Md.toProperty(!0)),this.ff(a,this.Md.toProperty(!0),!0)]);k.Bacon.mergeAll([this.ef(a,
this.ec.toProperty(!0)),this.kj(a,this.ec.toProperty(!0))]).onValue((a)=>{this.applicationController.styledTextDrop({targetTopic:null,stageX:a.stageX,stageY:a.stageY,data:{text:a.text,characterPropss:a.characterPropss,pointSize:a.pointSize}});this.oc.push(z.PasteEventType.preziContent)});this.jj(a);this.ij(a);this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.SmartPaster");this.rb=new ia.jc(this.logger);this.te=new Ka.Sg;this.fc={left:0,right:0,top:0,bottom:0}}Rc(a){this.Yb.plug(a)}kh(a){this.ec.plug(a)}lh(a){this.Md.plug(a)}addPanningStream(a){this.Af.plug(a)}addCameraNavStream(a){this.ne.plug(a)}addCurrentTopicStream(a){this.Be.plug(a)}addCoverEditModeStream(a){this.yh.plug(a)}ih(a){this.we.plug(a)}addCanvasMouseInteractionStream(a){const b=
a.filter((a)=>a.type===h.MouseInteractionType.Click).map((a)=>a.event.stagePos);this.oe.plug(b);a=a.filter((a)=>a.type===h.MouseInteractionType.ContextMenu).map((a)=>a.event.stagePos);this.pe.plug(a)}addViewportUICoverStream(a){a.onValue((a)=>{this.fc=a})}getErrorStream(){return this.Na}getUnsupportedPastedDocumentErrorStream(){return this.Pd}setCamera(a){this.camera=a}ef(a,b){return a.filter((a)=>a.cb===O.TEXT).filterWithStream(b).map((a)=>{const b=yb.Lk(a.Ga.text);this.logger.info({action:"insert",
object:"plain_text",trigger:"paste",payload:{text_length:b.length}});E.avro.Avro.createDefaultLogger().logPasteObject({object_type:"TEXT"});this.Ja=a=this.zb(this.Ja,a.fb);return{text:b,characterPropss:null,stageX:a?a.x:null,stageY:a?a.y:null,pointSize:null}})}kj(a,b){b=this.ff(a,b,!1);return k.Bacon.combineWith(({fb:a},{characterPropss:b,text:e,pointSize:f})=>{this.Ja=a=this.zb(this.Ja,a);return{text:e,characterPropss:b,stageX:a?a.x:null,stageY:a?a.y:null,pointSize:f}},a,b).sampledBy(b).filterWithStream(this.ec.toProperty(!0))}jj(a){a.filter((a)=>
a.cb===O.Kc).flatMap((a)=>{const b=a.Ga,d=E.LoggerModule.getLoggerManager().generateUserIntentId();this.Ja=a=this.zb(this.Ja,a.fb);const e=[];let f=!1;for(var m=0;m<b.files.length;m++){var y=b.files[m];this.Oe(y)||(e.push({file:y,userIntentId:d,stageX:a.x,stageY:a.y}),f=!0)}if(b.items)for(m=0;m<b.items.length;m++)y=b.items[m].getAsFile(),null!=y&&(f&&"file"===b.items[m].kind||this.Oe(y)||e.push({file:y,userIntentId:d,stageX:a.x,stageY:a.y}));0<e.length&&this.rb.gk(e,d);return k.Bacon.fromArray(e)}).onValue((a)=>
{E.avro.Avro.createDefaultLogger().logPasteObject({object_type:this.si(a.file.type)});this.Vb.md(a);this.oc.push(z.PasteEventType.file)})}Oe(a){return a.size>=v.Rd?(this.Na.push({errorCase:rb.EditorErrorCase.PASTED_CONTENT_TOO_LARGE}),!0):!1}si(a){return a?0===a.indexOf("image/")?"IMAGE":"application/pdf"===a?"PDF":"video/mp4"===a?"VIDEO":null:null}Wj(a){if(1!==a.getZObjects().length())return!1;a=a.getZObjects().get(0);return!w.CetModel.textKludge.isZObjectDataText(a)||a.getIsPlaceholder()?!1:!0}jh(a){const b=
k.Bacon.newBus();a.onValue((a)=>La(this,void 0,void 0,function*(){let c,e;a.Ga.text&&(c=yield S.Ea.Zc(this.Bb,a.Ga.text),c.isValid()&&c.getType()===v.lc&&(e=this.Wj(c.doc)?O.mc:O.PREZI),c.isValid()&&c.getType()===v.Pc&&(e=O.fe));const f=a.Ga;null!=e||!f.text||this.Pj(f.text)||this.hf(f.text)||(e=O.TEXT);if(null==e){if(f.files)for(var m=0;m<f.files.length;m++)if(f.files[m].type.match(X.$a.Yd.join("|"))){e=O.Kc;break}if(f.items)for(m=0;m<f.items.length;m++)if(f.items[m].type.match(X.$a.Yd.join("|"))){e=
O.Kc;break}}null==e&&f.text&&!this.hf(f.text)&&(e=O.TEXT);b.push({Ga:a.Ga,Kd:a.Kd,fb:a.fb,cb:e,Ec:c,xb:a.Ga.xb})}));return b}Pj(a){a=300<a.length?a.slice(a.length-300):a;return/.*[.][a-zA-Z]*$/.test(a)}hf(a){return 0===a.indexOf("data:")}getLogObjectType(a){switch(a){case F.ZObjectType.Z_LINE:return"LINE";case F.ZObjectType.Z_ARROW:return"ARROW";case F.ZObjectType.Z_BRACKET_FRAME:case F.ZObjectType.Z_CIRCLE_FRAME:case F.ZObjectType.Z_INVISIBLE_FRAME:case F.ZObjectType.Z_RECTANGLE_FRAME:case F.ZObjectType.Z_TOPIC_CONTAINER:return"TOPIC";
case F.ZObjectType.Z_IMAGE:return"IMAGE";case F.ZObjectType.Z_VIDEO:return"VIDEO";case F.ZObjectType.Z_RICH_TEXT:case F.ZObjectType.Z_TEXT:return"TEXT";case F.ZObjectType.Z_PDF:return"PDF";case F.ZObjectType.Z_SHAPE:return"SHAPE";case F.ZObjectType.Z_CHART_PDF:return"CHART";case F.ZObjectType.Z_ZOOM_AREA:return"ZOOMAREA";default:return null}}ij(a){const b=a.filter((a)=>a.cb===O.PREZI);a=a.filter((a)=>a.cb===O.mc).filterWithStream(this.ec.toProperty(!0));b.merge(a).onValue((a)=>La(this,void 0,void 0,
function*(){const b=yield S.Ea.Zc(this.Bb,a.Ga.text),c=b.doc;this.rb.hk(c);var f=c.getZObjects();1<f.length()?(f=f.get(0),f="TOPIC"===this.getLogObjectType(f.getObjectType())?"TOPIC":"MULTIPLE",E.avro.Avro.createDefaultLogger().logPasteObject({object_type:f})):(f=f.get(0),E.avro.Avro.createDefaultLogger().logPasteObject({object_type:this.getLogObjectType(f.getObjectType())}));f=b.getBounds();var m=this.qh({x:f.getCenterX(),y:f.getCenterY()});this.camera&&!this.Zb&&(m=p.CetModelEditor.createPositionFinder(this.scene,
this.camera).findPosition(f.getWidth(),f.getHeight()).localToWorld.getTranslation(),m=this.camera.getTransform().transformPoint(m));this.Ja=m=this.zb(m,a.fb);const y=this.rh(f,a.Kd);let C=null;this.Zb&&!this.Ab&&(C=b.getParentId());const x=this.ph(y);m=this.jk(m,x);this.Tb=v.Ka.None;this.pc=!1;this.Fc.insert({doc:c,originalWorldBounds:f,stageX:m.x,stageY:m.y,worldWidth:y.width,worldHeight:y.height,suggestedParent:C,originalParent:this.Zb?b.getParentId():null,originalParentIsPage:b.yk,originalParentWorldBounds:b.xk,
viewportInWorld:b.getViewport(),singlePageCopied:b.singlePageCopied},"clipboard",E.LoggerModule.getLoggerManager().generateUserIntentId());this.oc.push(z.PasteEventType.preziContent)}))}ff(a,b,c){return a.filter((a)=>a.cb===O.fe||c&&a.cb===O.mc).filterWithStream(b).map((a)=>{var b,c=F.DOM.createLocalSession(a.Ec.doc,()=>{}).getPrezi().getZObjects().get(0);if(!w.CetModel.textKludge.isIZObjectText(c))return null;E.avro.Avro.createDefaultLogger().logPasteObject({object_type:"TEXT"});var d=a.cb===O.mc,
y=w.CetModel.textKludge.getTextModelFromIZObject(c);c=d?0:a.Ec.Ld;var C=d?y.getLength():a.Ec.fd;d=this.Ff.create(y,this.Ff.createDefaultBaseStyle());d=d.replaceText(C,d.getLength(),"");d=d.replaceText(0,c,"");this.Ja=c=this.zb(this.Ja,a.fb);y=[];for(C=0;C<d.getLength();C++){const a=d.getCharacterStylesAt(C);y.push({fontWeight:a.getFontWeight(),fontStyle:a.getFontStyle(),fontSize:a.getFontSize(),color:Vc(a.getColor()),url:null===(b=a.getUrlText())||void 0===b?void 0:b.value})}return{text:d.getRawText(),
characterPropss:a.xb?null:y,stageX:c?c.x:null,stageY:c?c.y:null,pointSize:a.Ec.pointSize}}).filter((a)=>null!=a)}zb(a,b){let c;switch(b){case v.Ra.ee:(c=this.Ja||a)?(a=X.$a.Rg,c={x:c.x+a,y:c.y+a}):c=this.me();break;case v.Ra.Center:c=this.me();break;case v.Ra.Xd:c=this.nf}return c}rh(a,b){let c=null,d=null;switch(b){case v.hb.Wd:c=a.getWidth();d=a.getHeight();break;case v.hb.ce:this.camera&&this.Zf&&(b=this.camera.viewportInWorld().getWidth()/this.Zf.getWidth(),c=a.getWidth()*b,d=a.getHeight()*b)}return{width:c,
height:d}}Sk(){this.Fd();this.we.onValue((a)=>{this.pf=this.te.df(a);this.Fd();this.Zb=!0;this.Zf=this.camera?this.camera.viewportInWorld():null});this.Cf=k.Bacon.newBus();this.Pd=k.Bacon.newBus();this.Yb.onValue((a)=>La(this,void 0,void 0,function*(){var b=this.te.df(a);this.pf!==b&&(this.Fd(),this.pf=b);b={Ga:a,Kd:this.zi(),fb:this.xi()};const c=yield S.Ea.Zc(this.Bb,b.Ga.text);let d=!0;c.isValid()&&c.getType()===v.lc&&!p.CetModelEditor.createLegacyInserter().canPaste(this.scene,c.doc)&&(this.logger.warn({action:"paste",
object:"cannot-paste",trigger:"unknown-in-context"}),d=!1);d?this.Cf.push(b):this.Pd.push(null)}))}zi(){return this.Zb?this.Ab?v.hb.ce:v.hb.Wd:v.hb.None}xi(){switch(this.Tb){case v.Ka.None:return this.Ab&&this.pc?v.Ra.Center:v.Ra.ee;case v.Ka.Click:return v.Ra.Xd;case v.Ka.be:return v.Ra.Center;default:return null}}Fd(){this.pc=this.Ab=this.Zb=!1;this.Tb=v.Ka.None;this.Ja=null}vj(){this.Af.onValue((a)=>{a===l.PanningEvent.PanningStarted&&(this.Tb=v.Ka.be)});this.ne.onValue(()=>{this.pc=this.Ab=!0});
this.Be.onValue(()=>{this.pc=this.Ab=!0});this.oe.onValue((a)=>{this.nf=a;this.Tb=v.Ka.Click});this.pe.onValue((a)=>{this.nf=a;this.Tb=v.Ka.Click})}static Vj(a){return S.Ea.Zj(a)}qh(a){return this.camera?this.camera.getTransform().transformPoint(a):null}ph(a){return this.camera?(a=M.Geometry.rectangleFromData({x:0,y:0,width:a.width,height:a.height}),a=this.camera.getTransform().transformRectangle(a),{width:a.getWidth(),height:a.getHeight()}):null}me(){return this.camera?this.camera.getViewport().getCenter():
null}jk(a,b){const c={x:0,y:0};if(!this.camera)return c;const d=this.camera.getViewport();var e=a.x-b.width/2;e=d.getLeft()+this.fc.left-e;const f=a.x+b.width/2-d.getRight()-this.fc.right;0<e&&f<=-e?c.x=e:0<f&&e<=-f&&(c.x=-f);e=a.y-b.height/2;e=d.getTop()+this.fc.top-e;b=a.y+b.height/2-d.getBottom()-this.fc.bottom;0<e&&b<=-e?c.y=e:0<b&&e<=-b&&(c.y=-b);return{x:a.x+c.x,y:a.y+c.y}}};X.$a.Rg=10;X.$a.Yd=[v.Zd,v.ae,v.$d];var O;(function(a){a[a.PREZI=0]="PREZI";a[a.mc=1]="PREZI_OR_TEXT_RANGE";a[a.TEXT=
2]="TEXT";a[a.Kc=3]="FILE";a[a.fe=4]="TEXT_RANGE"})(O||(O={}));var ja={};Object.defineProperty(ja,"__esModule",{value:!0});ja.nc=class{constructor(a,b){this.Uk=a;this.qe=b;this.rd=-1!==navigator.userAgent.toLowerCase().indexOf("msie")||-1!==navigator.userAgent.toLowerCase().indexOf("trident");const c=-1!==navigator.appVersion.search("Safari")&&-1===navigator.appVersion.search("Chrome")&&-1===navigator.appVersion.search("CrMo")&&-1===navigator.appVersion.search("CriOS");this.Nb=$(document.body).append($('<div id="ie-clipboard-contenteditable" style="position:absolute;bottom:0;left:0;width:10px;height:10px;display:block;font-size:1px;z-index:-1;color:transparent;background:transparent;overflow:hidden;border:none;padding:0;resize:none;outline:none;-webkit-user-select:text;user-select:text;" contenteditable="true" tabindex="-1"></div>'));
this.bb=$('<input id="hidden-input" readonly style="position:absolute;bottom:0;left:0;width:10px;height:10px;display:block;font-size:1px;z-index:-1;color:transparent;background:transparent;overflow:hidden;border:none;padding:0;resize:none;outline:none;-webkit-user-select:text;user-select:text;" type="text" value="" tabindex="-1" autocomplete="off"/>');$(document.body).append(this.bb);this.rd&&document.addEventListener("beforepaste",()=>{this.bb.is(":focus")&&this.Ue()},!0);this.bb.on("input",()=>
{this.bb.val();c?(this.bb.focus(),setTimeout(()=>this.lb(),0)):this.lb()});k.Bacon.fromEvent(document,"mouseup").filterWithStream(this.Uk.toProperty(!0)).onValue(()=>this.lb());k.Bacon.fromEvent(document,"beforecopy").onValue(ja.nc.Ne);k.Bacon.fromEvent(document,"beforepaste").onValue(ja.nc.Ne);k.Bacon.fromEvent(document,"keydown").filter((a)=>a.shiftKey).onValue(()=>this.Rf=!0);k.Bacon.fromEvent(document,"keyup").onValue(()=>this.Rf=!1)}static Ne(a){a.preventDefault&&a.preventDefault();return a.returnValue=
!1}lb(){this.bb.val();this.bb.focus().select()}Ue(){this.Nb.focus();const a=document.createRange();a.selectNodeContents(this.Nb.get(0));const b=window.getSelection();b.removeAllRanges();b.addRange(a)}dj(){const a=window.clipboardData.getData(v.Ya);this.Nb.empty();const b=k.Bacon.newBus();setTimeout(()=>{b.push({text:a});this.Nb.empty();this.lb()},0);return b}Xk(a){var b,c;return(a=a.clipboardData)?k.Bacon.once({text:a.getData(v.kc)||a.getData(v.Lc)||a.getData(v.Ya),files:0<(null===(b=a.files)||void 0===
b?void 0:b.length)?Array.from(a.files):[],items:0<(null===(c=a.items)||void 0===c?void 0:c.length)?Array.from(a.items):[],xb:this.Rf}):k.Bacon.never()}cj(a){window.clipboardData.setData(v.Ya,a);this.Ue();setTimeout(()=>{this.lb();this.Nb.empty()},0)}static Wk(a,b,c){(a=a.clipboardData)&&a.setData(c,b)}copy(a,b,c=v.Ya){const d=a.originalEvent;this.rd?this.cj(b):(ja.nc.Wk(d,b,c),this.lb(),a.preventDefault())}li(){return k.Bacon.fromEvent(document,"copy").merge(k.Bacon.fromEvent(document,"cut")).filterWithStream(this.qe.toProperty(!0))}wi(){return k.Bacon.fromEvent(document,
"paste").filterWithStream(this.qe.toProperty(!0)).flatMap((a)=>{if(this.rd)return this.dj();a.preventDefault();return this.Xk(a.originalEvent)})}};var Ma={};Object.defineProperty(Ma,"__esModule",{value:!0});Ma.bg=class{constructor(a,b,c,d,e,f,m,y,C,x){this.ka=b;this.Fc=c;this.gb=e;this.w=f;this.sh=C;this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.ClipboardImpl");this.rb=new ia.jc(this.logger);this.Yk=k.Bacon.newBus();this.Ce=k.Bacon.newBus();this.Ca=k.Bacon.newBus();
this.Xc=k.Bacon.newBus();this.ue=k.Bacon.newBus();this.ma=k.Bacon.newBus();this.Qe=k.Bacon.newBus();this.Re=k.Bacon.newBus();this.Xf=k.Bacon.newBus();this.la=new X.$a(this.ka,a.getRenderingTextFactory(),m,c,d,x);this.jf=k.Bacon.newBus();this.Na=k.Bacon.newBus();this.cc=new ja.nc(this.Xc.map((a)=>-1===[Q.ComponentFocusModeKind.ui,Q.ComponentFocusModeKind.uiInput,Q.ComponentFocusModeKind.textEditor].indexOf(a)).skipDuplicates(),this.Xc.map((a)=>a!==Q.ComponentFocusModeKind.ui&&a!==Q.ComponentFocusModeKind.uiInput).skipDuplicates());
this.gj();a=this.jf.toProperty();this.la.Rc(this.cc.wi().filterWithStream(a));this.la.Rc(this.ri().filterWithStream(a));this.la.Rc(this.Bi().filterWithStream(a));this.la.lh(this.$e());this.la.kh(this.$e().map((a)=>!a));this.tc=new Ja.kg(d,a,m,y);this.la.Fj.onValue((a)=>{m.styledTextDrop({stageX:null,stageY:null,data:a,targetTopic:null});m.afterPaste(z.PasteEventType.preziContent)});this.la.oc.onValue((a)=>m.afterPaste(a));this.Na.plug(this.tc.getErrorStream());this.Na.plug(this.la.getErrorStream())}addIsEditModeSteam(a){this.jf.plug(a)}integration_test_drop(a,
b){this.tc.integration_test_drop(a,b)}Tj(a){return 1===a.length&&p.CetModelEditor.isOverview(a[0],this.ka)}gj(){var a=this.Qe.map(()=>null);a=this.cc.li().merge(a);var b=this.ma.map((a)=>!a||!a.isEditing()).toProperty(!0),c=this.ma.map((a)=>a&&a.isEditing()).toProperty(!1);b=k.Bacon.combineWith((a,b)=>({selection:a.allEntityIds,event:b}),this.Ca,a).sampledBy(a.filterWithStream(b)).filter((a)=>!this.Tj(a.selection));a=k.Bacon.combineWith3((a,b,c)=>{const d=c.allEntityIds[0];var e=this.ka.getEntityById(d),
f=p.CetModelEditor.createTextHelper();a=f.getSelectedText(e);c=f.getSelectionStartOffset(e);e=f.getSelectionEndOffset(e);f=this.w.read((a)=>a.lookup.text(d).pointSize);return{id:d,$b:a,event:b,Ld:c,fd:e,pointSize:f}},this.ma.filterWithStream(c),a,this.Ca.filter((a)=>0!==a.allEntityIds.length)).sampledBy(a.filterWithStream(c));const d=l.Cet.createHierarchyQuery(this.ka);c=b.filter((a)=>a.selection&&0<a.selection.length).map(({selection:a,event:b})=>{var c=a.map((a)=>this.ka.getEntityById(a)).filter((a)=>
null!=a).map((a)=>null!=a.get(w.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD)?a.getId():a.isDef(w.CetModel.ID.FLY_TO_OBJECT_EP)?a.get(w.CetModel.ID.HAS_TARGET.TARGET):null).filter((a)=>null!=a);if(0===c.length)return null;var e=1===c.length&&p.CetModelEditor.isPage(c[0],this.ka),f=this.Fc.copyObjects(c);this.rb.qf(f);c=F.DOM.saveXml(f);f=[...w.CetModel.pdomIterable(f.getZObjects())].map((a)=>a.getId());const x=l.Cet.createTopicChildrenQuery(this.ka),g=l.Cet.createHierarchyQuery(this.ka).getLowestCommonAncestor(f),
h=l.Cet.createHierarchyQuery(this.ka).getLowestCommonAncestor(((a)=>a.map((a)=>x.isVisibleOutside(a)?d.getParentOrOverview(this.ka.getEntityById(a)):a))(f));e=JSON.stringify({type:v.lc,doc:c,bounds:this.getWorldBounds(f),parent:g,parentBounds:null!=g?this.getWorldBounds([h]):null,viewport:this.sh.getMarginCorrectedViewportInWorld().getData(),singlePageCopied:e,parentIsPage:null!=g&&p.CetModelEditor.isPage(g,this.ka)});return{event:b,vb:e,ids:a}}).filter((a)=>null!=a);c.onValue((a)=>{if(a.event){this.cc.copy(a.event,
a.vb);const b=a.ids,c=1===b.length?this.ka.getEntityById(b[0]):"MULTIPLE",d=1===b.length?b[0]:null;"cut"===a.event.type?(this.Ce.push({entityIds:b,trigger:"CUT"}),E.avro.Avro.createDefaultLogger().logCutObject({object_id:d,object_type:c})):E.avro.Avro.createDefaultLogger().logCopyObject({object_id:d,object_type:c});this.Qb=null}else this.Qb=a.vb});this.la.ih(c.map((a)=>({text:a.vb})));a.filter((a)=>""!==a.$b).map((a)=>{this.rb.ck(a.$b);var b=this.Fc.copyObjects([a.id]);this.rb.qf(b);b=F.DOM.saveXml(b);
const c=l.Cet.createHierarchyQuery(this.ka).getParentId(this.ka.getEntityById(a.id));b=JSON.stringify({type:v.Pc,doc:b,parent:c,startSelection:a.Ld,endSelection:a.fd,pointSize:a.pointSize});return{event:a.event,vb:b,$b:a.$b}}).filter((a)=>null!=a).onValue((a)=>{a.event?(this.cc.copy(a.event,a.$b,v.Ya),this.cc.copy(a.event,a.vb,v.kc),"cut"===a.event.type&&this.gb.deleteText(I.DeleteAction.CHARACTER_FORWARD),this.Qb=null):this.Qb=a.vb;this.ue.push(Q.ComponentFocusActionKind.enterTextEditor)})}getWorldBounds(a){let b=
l.Cet.world(this.ka.getEntityById(a[0])).getWorldBounds();for(let c=1;c<a.length;c++)b=b.union(l.Cet.world(this.ka.getEntityById(a[c])).getWorldBounds());return this.dl(b)}dl(a){return{centerX:a.getCenterX(),centerY:a.getCenterY(),width:a.getWidth(),height:a.getHeight(),degrees:a.getRotationDegrees()}}addSelectionStream(a){this.Ca.plug(a)}addComponentFocusStream(a){this.Xc.plug(a)}getComponentFocusActionStream(){return this.ue}addTextStateStream(a){this.ma.plug(a)}addTextOnlyPasteEventStream(a){this.Yk.plug(a)}getErrorStream(){return this.Na}getUnsupportedPastedDocumentErrorStream(){return this.la.getUnsupportedPastedDocumentErrorStream()}getDeleteActionStream(){return this.Ce}addDropTargetElement(a){this.tc.addDropTargetElement(a)}excludeDropTargetElement(a){this.tc.excludeDropTargetElement(a)}addPanningStream(a){this.la.addPanningStream(a)}addCameraNavStream(a){this.la.addCameraNavStream(a)}addCurrentTopicStream(a){this.la.addCurrentTopicStream(a)}addCoverEditModeStream(a){this.la.addCoverEditModeStream(a)}addCanvasMouseInteractionStream(a){this.la.addCanvasMouseInteractionStream(a)}addViewportUICoverStream(a){this.la.addViewportUICoverStream(a)}addFakeCopyActionStream(a){this.Qe.plug(a)}addFakePasteActionStream(a){this.Re.plug(a)}addTriggerPasteActionStream(a){this.Xf.plug(a)}setCamera(a){this.la.setCamera(a)}ri(){return this.Re.flatMap(([a,
b])=>{a=null!=a?a:!1;return null!=b?k.Bacon.once({text:b,files:null,items:null,xb:a}):this.Qb?k.Bacon.once({text:this.Qb,files:null,items:null,xb:a}):k.Bacon.never()})}Bi(){return this.Xf.map(([a,b])=>({text:a,files:b,items:[],xb:!1}))}$e(){return this.ma.map((a)=>a?a.isEditing()||a.isSingleSelection()&&this.isPlaceholderText(a.getSingleEntityId()):!1).toProperty()}isPlaceholderText(a){return p.CetModelEditor.createTextHelper().isPlaceholder(this.ka.getEntityById(a))}};var xa={},zb=this&&xa.ib||function(a,
b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,m){function f(a){try{x(d.next(a))}catch(B){m(B)}}function g(a){try{x(d["throw"](a))}catch(B){m(B)}}function x(a){a.done?c(a.value):e(a.value).then(f,g)}x((d=d.apply(a,b||[])).next())})};Object.defineProperty(xa,"__esModule",{value:!0});xa.cg=class{constructor(a){this.Yb=k.Bacon.newBus();this.Vc=a;null!=this.Vc&&this.Vc.addTriggerPasteActionStream(this.Yb)}triggerCut(){return this.hd("cut")}triggerCopy(){return this.hd("copy")}triggerPaste(){return zb(this,
void 0,void 0,function*(){return null==this.Vc||null==navigator||null==navigator.clipboard||null==navigator.clipboard.read?Promise.resolve(this.hd("paste")):navigator.clipboard.read().then((a)=>zb(this,void 0,void 0,function*(){let b="",c=[];for(let e of a){""===b&&(-1<e.types.indexOf(v.kc)?b=yield(yield e.getType(v.kc)).text():-1<e.types.indexOf(v.Lc)?b=yield(yield e.getType(v.Lc)).text():-1<e.types.indexOf(v.Ya)&&(b=yield(yield e.getType(v.Ya)).text()));for(let a of e.types)if(a.startsWith(v.Zd)||
a===v.ae||a===v.$d){var d=yield e.getType(a);d=D.Utils.createFile(d,"",a);c.push(d)}}this.Yb.push([b,c]);return!0})).catch(()=>!1)})}hd(a){try{if(document.queryCommandSupported(a))return document.execCommand(a)}catch(b){}return!1}};var Na={};Object.defineProperty(Na,"__esModule",{value:!0});Na.Gg=class{constructor(a){this.applicationController=a}md(a){return this.applicationController.fileDrop(a.file.type,{stageX:a.stageX,stageY:a.stageY,data:{file:a.file,source:"DRAG"},targetTopic:null})}Ej(a){return this.applicationController.urlDrop({stageX:a.stageX,
stageY:a.stageY,data:{url:a.url},targetTopic:null})}};var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});Oa.dg=class{constructor(a,b,c,d){this.se=c;this.Bb=d;this.Tc=k.Bacon.newBus();a(this.Tc);this.Sc=k.Bacon.newBus();b(this.Sc)}disableEdit(){this.Sc.push(!1);this.Tc.push({newMode:A.EditorMode.playback,trigger:"ConnectivityController",shouldGoFullscreen:!1,shouldSeekPathToStart:!1,showTopmenu:!0,linkClickedFlow:!1,presenterNotesFlow:!1})}enableEdit(){this.Sc.push(!0);this.Tc.push({newMode:A.EditorMode.edit,
trigger:"ConnectivityController"})}setCetSessionMode(a){this.se.setSessionMode(a)}loadPrezi(a){this.se.getPreziLoader().loadPrezi(this.Bb,a)}};var Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});Pa.og=class{constructor(a){this.cd=k.Bacon.newBus();this.Je=k.Bacon.newBus();this.pd=k.Bacon.newBus();a.onValue((a)=>{this.currentTopicId=a});this.wd=!1}isPlaceholderDrag(){return this.wd}getDragStream(){return this.Je.throttle(33).filterWithStream(this.pd.toProperty(!1)).merge(this.cd)}onDragStart(a,
b,c,d){this.wd=!0;this.cd.push({kind:g.ActionKind.Start,startKind:g.DragActionStartKind.PlaceholderMove,target:{kind:g.ActionTargetKind.multiple,entityIds:[]},entitiesToTransformInSync:[],currentTopicId:this.currentTopicId,mouseStagePosition:a,originalMouseStagePosition:a,size:b,showPlaceholder:c,allowedSnapTargetKinds:d});this.pd.push(!0)}onDragLeave(){this.finish({kind:g.ActionKind.Finish,finishKind:g.DragPlaceholderActionFinishKind.cancelled})}onDrop(a,b){this.finish({kind:g.ActionKind.Finish,
finishKind:g.DragPlaceholderActionFinishKind.drop,dropData:b,mouseStagePosition:a})}onDragOver(a,b,c){this.Je.push({kind:g.ActionKind.Step,stagePosition:a,isCenterResizeKeyPressed:!1,isSnapDisableKeyPressed:!b,isTopicNestingDisableKeyPressed:!c})}finish(a){this.cd.push(a);this.pd.push(!1);this.wd=!1}};var oa={};Object.defineProperty(oa,"__esModule",{value:!0});oa.Ic=class{constructor(a,b,c,d,e,f){this.scene=a;this.f=b;this.ba=c;this.u=d;this.rc=e;this.dd=f;if(null==this.f)throw Error("editorStore cannot be null");
if(null==this.ba)throw Error("selectionController cannot be null");if(null==this.u)throw Error("runner cannot be null");if(null==this.rc)throw Error("coverCommander cannot be null");this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.CoverControllerImpl");b.getCurrentTopicStream().onValue((a)=>this.currentTopicId=a);this.Yc=k.Bacon.newBus();b.addCoverEditModeStream(this.Yc);b.getCoverEditModeStream().onValue((a)=>this.coverEditMode=a);b.getSelectionStream().onValue((a)=>
this.selectedEntityIds=a.allEntityIds)}setPlayback(a){this.playback=a}isSame(a,b,c){if(null==a||a.kind!==c)return!1;switch(a.kind){case t.CoverEditModeKind.advanced:case t.CoverEditModeKind.titleEditOnly:return a.topicId===b;case t.CoverEditModeKind.insideAdvanced:return a.topicOrOverviewId===b;default:D.Utils.assertNever(a)}}startCoverEditing(a,b,c=[],d=t.CoverEditModeKind.advanced){if(!this.isSame(this.coverEditMode,a,d)){var e=l.Cet.createHierarchyQuery(this.scene).getParentOrOverview(this.scene.getEntityById(a));
this.currentTopicId!==e&&d!==t.CoverEditModeKind.insideAdvanced?e===this.scene.getPreziW().getOverview().getId()?this.playback.flyToOverview():this.playback.flyToObject(e):d===t.CoverEditModeKind.insideAdvanced&&(this.currentTopicId!==a&&this.playback.flyToObject(a),this.dd.Te([a],a,40));this.Yc.push(d===t.CoverEditModeKind.titleEditOnly?{kind:t.CoverEditModeKind.titleEditOnly,topicId:a}:d===t.CoverEditModeKind.advanced?{kind:t.CoverEditModeKind.advanced,topicId:a}:{kind:t.CoverEditModeKind.insideAdvanced,
topicOrOverviewId:a});c=c.slice();if(0===c.length&&d!==t.CoverEditModeKind.insideAdvanced&&(e=this.u.scene.getEntityById(a),null!=e)){const a=p.CetModelEditor.createTopicQuery(this.u.scene).getTopicKind(e.getId());if(a===p.TopicKind.Page||a===p.TopicKind.Stack||a===p.TopicKind.Planet)e=l.Cet.createTopicChildrenQuery(this.u.scene).getChildrenIds(e.getId(),l.TopicChildBehavior.Cover),1===e.length&&(c=e.slice(0,1))}this.ai(c);A.AppUtilsModule.getLogHelperUtils().startCoverEditing(this.logger,a,b);E.LoggerModule.setEditingMode(d===
t.CoverEditModeKind.advanced?"COVER":d===t.CoverEditModeKind.insideAdvanced?"ADVANCED":"DEFAULT")}}stopCoverEditing(a,b=!0){null!=this.coverEditMode&&(this.Yc.push(null),this.gi(b),A.AppUtilsModule.getLogHelperUtils().stopCoverEditing(this.logger,a),E.LoggerModule.setEditingMode("DEFAULT"))}ai(a){this.ba.select({selectedGroupIds:[],selectedEntityIds:a,type:n.SelectActionType.replace})}gi(a){const b=l.Cet.createTopicChildrenQuery(this.u.scene);a=a?this.selectedEntityIds.filter((a)=>!b.isVisibleOutside(a)):
[];this.ba.select({selectedGroupIds:[],selectedEntityIds:a,type:n.SelectActionType.replace})}checkCoverSelectionInvariants(a,b){let c=null,d=l.Cet.createTopicChildrenQuery(this.u.scene);a.forEach((a)=>{const e=d.hasBehavior(a,l.TopicChildBehavior.Cover),m=d.hasBehavior(a,l.TopicChildBehavior.Visual),y=d.hasBehavior(a,l.TopicChildBehavior.Surface),g=d.hasBehavior(a,l.TopicChildBehavior.Content),x=d.hasBehavior(a,l.TopicChildBehavior.Master),h=d.getChildReferer(a);if(null==b)e?c="Cover object "+a+" is selected when not in any cover edit mode!":
m?c="Visual object "+a+" is selected when not in any advanced topic edit mode!":y&&(c="Surface object "+a+" is selected when not in any advanced topic edit mode!");else switch(b.kind){case t.CoverEditModeKind.insideAdvanced:p.CetModelEditor.isOverview(b.topicOrOverviewId,this.u.scene)?e?c="Cover object "+a+" is selected in overview advenced editing mode":m?c="Visual object "+a+" is selected in overview advenced editing mode":y?c="Surface object "+a+" is selected in overview advenced editing mode":
g&&null!=h?c="Content object "+a+" of a topic is selected!":x&&(c="Master object "+a+" is selected in overview advenced editing mode"):e?c="Cover object "+a+" is selected when not in an outside cover edit mode!":m&&b.topicOrOverviewId!==h?c="Visual object "+a+" is selected when not in parent's topic edit mode!":y&&b.topicOrOverviewId!==h?c="Surface object "+a+" is selected when not in parent's topic edit mode!":g&&b.topicOrOverviewId!==h&&b.topicOrOverviewId!==a?c="Content object "+a+" of a different topic is selected!":
null!=x&&b.topicOrOverviewId!==h&&b.topicOrOverviewId!==a&&(c="Master object "+a+" of a different topic is selected!");break;case t.CoverEditModeKind.advanced:case t.CoverEditModeKind.titleEditOnly:e&&b.topicId!==h?c="Cover object "+a+" is selected when not in parent's topic edit mode!":m&&b.topicId!==h?c="Visual object "+a+" is selected when not in parent's topic edit mode!":y&&b.topicId!==h?c="Surface object "+a+" is selected when not in parent's topic edit mode!":g&&b.topicId!==a?c="Content object "+
a+" is selected when in an outside topic cover edit mode!":x&&(c="Master object "+a+" is selected when in an outside topic cover edit mode!");break;default:D.Utils.assertNever(b)}});return c}fixCoverSelection(){const a=l.Cet.createTopicChildrenQuery(this.u.scene);var b=this.selectedEntityIds&&this.selectedEntityIds.length?this.selectedEntityIds.reduce((b,d)=>{d=a.getBehaviorReferer(d,l.TopicChildBehavior.Cover);return""===b||b===d?d:null},""):null;null==b||this.isSame(this.coverEditMode,b,this.coverEditMode.kind)?
null==b&&null!=this.coverEditMode&&this.stopCoverEditing("FIXER",!1):this.startCoverEditing(b,"FIXER",this.selectedEntityIds);this.selectedEntityIds&&this.selectedEntityIds.length&&(b=this.selectedEntityIds.filter((b)=>!a.hasBehavior(b,l.TopicChildBehavior.Cover)&&!a.hasBehavior(b,l.TopicChildBehavior.Visual)&&!a.hasBehavior(b,l.TopicChildBehavior.Surface)),b.length<this.selectedEntityIds.length&&this.ba.select({selectedGroupIds:[],selectedEntityIds:b,type:n.SelectActionType.replace}))}convertToTopicVisual(a){const b=
p.CetModelEditor.createTopicQuery(this.scene);a=a.filter((a)=>!b.isTopic(this.scene.getEntityById(a)));this.u.executeApiCommand(this.rc.convertToTopicVisualCmd(a))}convertToCoverItem(a){this.u.executeApiCommand(this.rc.convertToCoverItemCmd(a));null==this.coverEditMode&&this.ba.select({selectedGroupIds:[],selectedEntityIds:[],source:n.SelectActionSource.CANVAS,type:n.SelectActionType.replace})}convertToContentItem(a){null!=this.coverEditMode&&this.ba.select({selectedGroupIds:[],selectedEntityIds:[],
source:n.SelectActionSource.CANVAS,type:n.SelectActionType.replace});this.u.executeApiCommand(this.rc.convertToContentItemCmd(a))}isObjectCoverEditable(a){a=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a);return a===p.TopicKind.Planet||a===p.TopicKind.Stack}isObjectInsideTopicEditable(a){a=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a);return a===p.TopicKind.Planet||a===p.TopicKind.Overview}shouldCoTransformContent(a){if(null==a)return!1;switch(a.kind){case t.CoverEditModeKind.advanced:return!0;
case t.CoverEditModeKind.insideAdvanced:case t.CoverEditModeKind.titleEditOnly:return!1;default:return D.Utils.assertNever(a)}}};var J={};Object.defineProperty(J,"__esModule",{value:!0});J.ia=class{constructor(a){this.ca=a}start(a,b){this.execute(a,b)}step(a,b){this.execute(a,b)}finish(a,b){this.execute(a,b)}$c(){return{kind:g.ActionKind.Finish}}};var Qa={};Object.defineProperty(Qa,"__esModule",{value:!0});Qa.jg=class extends J.ia{constructor(a,b){super(a);this.objectStore=b}getName(){return"DragArcTool"}execute(a,
b){b=b.execute((b)=>this.ca.action.arc(b,a,this.state));this.objectStore.setCanvasHoveredEntityIds(null==b.snapDestinationId?null:[b.snapDestinationId]);this.state=b.state}};var ka={};Object.defineProperty(ka,"__esModule",{value:!0});ka.hc=class extends J.ia{constructor(a,b,c,d,e,f){super(a);this.objectStore=b;this.ba=c;this.camera=d;this.scene=e;this.pluginAccess=f;this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.DragTool");this.mb=p.CetModelEditor.createGroupQuery();
b.getSelectionStream().onValue((a)=>this.selection=a.allEntityIds)}getName(){return"DragMoveAction"}execute(a,b){a.kind===g.ActionKind.Finish&&null!=this.De&&(this.De(),this.De=null);let c=a;if(a.kind===g.ActionKind.Start){var d=a.target.entityIds;1===d.length&&(d=d[0],0>this.selection.indexOf(d)&&(d=this.mb.getGroupIdFromEntityId(this.scene,d),null!=d&&(d=this.mb.getGroupMembers(this.scene,d).map((a)=>a.getId()),c=Object.assign(Object.assign({},a),{target:{kind:g.ActionTargetKind.multiple,entityIds:d}}))))}a=
b.execute((a)=>{const b=this.ca.action.dragMove(a,c,this.kb);this.kb=Object.assign({_DragMoveState_:void 0},b.dragState);return G.isActive("js-disable-topic-eater")?{dragState:this.kb,draggedTopicIds:[],nestingTargetTopicId:null,nestingFromTopicId:null,nestingDirection:g.TopicNestingDirection.None}:this.ca.action.topicNestingDragMove(a,c,this.kb)});this.zk(a,c)}zk(a,b){this.kb=Object.assign({_DragMoveState_:void 0},a.dragState);a.nestingDirection!==g.TopicNestingDirection.None&&b.kind===g.ActionKind.Finish&&
null!=a.nestingTargetTopicId&&(this.objectStore.setCanvasHoveredEntityIds([]),this.ba.select({selectedGroupIds:[],selectedEntityIds:a.nestingDirection===g.TopicNestingDirection.In?[a.nestingTargetTopicId]:[],type:n.SelectActionType.replace}),a.nestingDirection===g.TopicNestingDirection.In?this.pluginAccess.send(u.topicNestingOnboarding,{kind:"requestNestInGrouping",groupedIntoId:a.nestingTargetTopicId}):a.nestingDirection===g.TopicNestingDirection.Out?this.pluginAccess.send(u.topicNestingOnboarding,
{kind:"requestNestOutGrouping",groupedOutFromId:a.nestingFromTopicId}):D.Utils.assertNever(a.nestingDirection))}};ka.hc.bh="TopicHoverEntityFade";var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0});var Ab=p.base.ShapeStyle,Bb=p.base.ObjectKind,Wc=p.base.FillKind,Xc=p.base.AnchorPoint;Ra.pg=class extends ka.hc{constructor(a,b,c,d,e,f,m){super(a,b,c,d,e,m);this.applicationController=f}getName(){return"DragPlaceholderMoveAction"}$c(){return{kind:g.ActionKind.Finish,finishKind:g.DragPlaceholderActionFinishKind.cancelled}}execute(a,
b){let c=a;a.kind===g.ActionKind.Start&&(this.Dd=b.execute((b)=>this.Ih(b,a)),c=Object.assign(Object.assign({},a),{target:{kind:g.ActionTargetKind.multiple,entityIds:[this.Dd]}}));super.execute(c,b);c.kind===g.ActionKind.Finish&&(null!=this.Dd&&(b.rollback(),this.Dd=null),c.finishKind===g.DragPlaceholderActionFinishKind.drop&&null!=this.kb&&this.applicationController.listItemDrop({stageX:c.mouseStagePosition.x,stageY:c.mouseStagePosition.y,data:c.dropData,targetTopic:this.kb.proximitySnapParent}))}Ih(a,
b){var c=b.size;null==c&&(c={width:100,height:100});if(a.overview.id===b.currentTopicId)var d=a.overview.add.shape("rectangle",Ab.Poly1);else if(d=a.lookup.object(b.currentTopicId),d.kind===Bb.planetTopic||d.kind===Bb.page)d=d.add.shape("rectangle",Ab.Poly1);else throw Error("DragMoveCommander.createDragPlaceholder: invalid parent: "+d.kind);d.height=d.width*c.height/c.width;const e=p.CetModelEditor.createCameraControl(this.camera).getScreenLayoutBox();c=e.withSize(c).move(Xc.center,e.referenceFrame.point(b.mouseStagePosition));
d.fitInto(c);c=b.showPlaceholder?.2:0;d.border={thickness:1,color:{r:239,g:207,b:28,a:b.showPlaceholder?1:0}};d.fill={fillKind:Wc.solid,color:{r:239,g:207,b:28,a:c}};a=a.toDecorator(d);a.set(l.Cet.getNotCalculatedIntoOverviewCompKey(),!0);a.set(g.EditorCommander.getSnapDescriptionKey(),{allowedSnapTargetKinds:b.allowedSnapTargetKinds});return d.id}};var Sa={};Object.defineProperty(Sa,"__esModule",{value:!0});Sa.rg=class extends J.ia{constructor(a){super(a)}getName(){return"DragArcTool"}execute(a,
b){this.state=b.execute((b)=>this.ca.action.topicZoomAreaMove(b,a,this.state)).dragTopicZoomAreaState}};var Ta={};Object.defineProperty(Ta,"__esModule",{value:!0});Ta.Kg=class extends J.ia{getName(){return"NonProportionalResizeTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.nonProportionalResize(b,a,this.state)).state}};var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});Ua.Mg=class extends J.ia{getName(){return"NudgeTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.nudge(b,
a,this.state)).nudgeState}};var Va={};Object.defineProperty(Va,"__esModule",{value:!0});Va.Og=class extends J.ia{getName(){return"NudgeTopicZoomAreaTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.nudgeTopicZoomArea(b,a,this.state)).nudgeTopicZoomAreaState}};var Wa={};Object.defineProperty(Wa,"__esModule",{value:!0});Wa.Lg=class extends J.ia{getName(){return"NudgeOverviewTopicZoomAreaTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.nudgeOverviewZoomArea(b,a,this.state)).nudgeOverviewZoomAreaState}};
var P={};Object.defineProperty(P,"__esModule",{value:!0});P.Nc=class extends J.ia{constructor(a,b,c){super(a);this.name=b;this.Rh=c;this.state=null}getName(){return this.name}execute(a,b){this.state=b.execute((b)=>this.Rh(b,a,this.state)).resizeState}};P.Zg=class extends P.Nc{constructor(a){super(a,"ResizeTool",(a,c,d)=>this.ca.action.resize(a,c,d))}};P.Yg=class extends P.Nc{constructor(a){super(a,"ResizeSingleTextTool",(a,c,d)=>this.ca.action.resizeSingleText(a,c,d))}};P.sg=class extends P.Nc{constructor(a,
b){super(a,"DrawInsertTool",(a,b,e)=>this.ca.action.drawInsert(a,b,e));this.applicationController=b}execute(a,b){if(a.kind===g.ActionKind.Start){const c=b.execute((b)=>this.applicationController.createDrawedObject(b,a.originalMouseStagePosition,z.DrawInsertIntent.draw));a=Object.assign(Object.assign({},a),{target:{kind:g.ActionTargetKind.single,entityId:c}})}super.execute(a,b);a.kind===g.ActionKind.Finish&&this.applicationController.finishDrawObject()}};var Xa={};Object.defineProperty(Xa,"__esModule",
{value:!0});Xa.$g=class extends J.ia{constructor(a){super(a);this.state=null}getName(){return"RotateTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.rotate(b,a,this.state)).rotateState}};var Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});Ya.fh=class extends J.ia{constructor(){super(...arguments);this.state=null}getName(){return"ResizeTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.topicZoomAreaResize(b,a,this.state)).resizeTopicZoomAreaState}};var pa={};Object.defineProperty(pa,
"__esModule",{value:!0});pa.mg=class extends J.ia{constructor(a){super(a)}getName(){return"DragMaskTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.maskImageMove(b,a,this.state)).state}};pa.lg=class extends J.ia{constructor(a){super(a)}getName(){return"DragMaskTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.maskAreaMove(b,a,this.state)).state}};var fa={};Object.defineProperty(fa,"__esModule",{value:!0});fa.Fg=class extends J.ia{constructor(a){super(a);this.state=null}getName(){return"MaskResizeTool"}execute(a,
b){this.state=b.execute((b)=>this.ca.action.maskResizeImage(b,a,this.state)).state}};fa.Eg=class extends J.ia{constructor(a){super(a);this.state=null}getName(){return"MaskResizeTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.maskResizeArea(b,a,this.state)).state}};fa.Dg=class extends J.ia{constructor(a){super(a);this.state=null}getName(){return"MaskResizeTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.maskNonProportionalResizeArea(b,a,this.state)).state}};var qa={};Object.defineProperty(qa,
"__esModule",{value:!0});qa.ng=class extends J.ia{constructor(a){super(a)}getName(){return"DragOverviewTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.overviewMove(b,a,this.state)).dragOverviewMoveState}};qa.Xg=class extends J.ia{constructor(a){super(a)}getName(){return"ResizeOverviewTool"}execute(a,b){this.state=b.execute((b)=>this.ca.action.overviewResize(b,a,this.state)).dragOverviewResizeState}};var U={};Object.defineProperty(U,"__esModule",{value:!0});U.he=class{constructor(a,b,c){this.w=
a;this.tb=b;this.ea=c;this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.Tool");this.reset()}reset(){this.Da=this.Fa=null}process(a){switch(a.kind){case g.ActionKind.Start:this.start(this.Ae(a),a);break;case g.ActionKind.Step:this.step(a);break;case g.ActionKind.Finish:this.finish(a);break;default:D.Utils.assertNever(a)}}start(a,b){null!=this.Da&&this.finish(this.Da.$c());this.ea.clearSelection();this.le=!1;this.Fa=this.w.beginAsyncApiCommand({name:a.getName()},(a)=>
{this.le=!0;if(a.reason===l.FinishEventKind.BeginOtherTransaction){if(null!=this.Da&&null!=this.Fa)try{this.Da.finish(this.Da.$c(),this.Fa)}finally{this.reset()}}else a.reason===l.FinishEventKind.AbortTransaction&&this.reset();return!0});this.Da=a;this.cf(()=>this.Da.start(b,this.Fa));switch(b.target.kind){case g.ActionTargetKind.single:this.tb.setCanvasEditedEntities([b.target.entityId]);break;case g.ActionTargetKind.multiple:this.tb.setCanvasEditedEntities(b.target.entityIds);break;case g.ActionTargetKind.implicit:break;
default:D.Utils.assertNever(b.target)}}step(a){null!=this.Da&&null!=this.Fa&&this.cf(()=>this.Da.step(a,this.Fa))}finish(a){if(null!=this.Da&&null!=this.Fa)try{this.Da.finish(a,this.Fa)}finally{try{this.le||this.Fa.end()}finally{this.reset()}}this.tb.setCanvasEditedEntities([])}cf(a){try{a()}catch(b){try{this.Fa.end()}catch(c){}this.reset();throw b;}}};U.Ng=class extends U.he{Ae(a){switch(a.startKind){case g.NudgeActionStartKind.object:return new Ua.Mg(this.w);case g.NudgeActionStartKind.topicZoomArea:return new Va.Og(this.w);
case g.NudgeActionStartKind.overviewZoomArea:return new Wa.Lg(this.w);default:D.Utils.assertNever(a)}}};U.qg=class extends U.he{constructor(a,b,c,d,e,f,m){super(a,b,d);this.ba=c;this.camera=e;this.applicationController=f;this.pluginAccess=m}Ae(a){switch(a.startKind){case g.DragActionStartKind.ObjectMove:return new ka.hc(this.w,this.tb,this.ba,this.camera,this.w.scene,this.pluginAccess);case g.DragActionStartKind.PlaceholderMove:return new Ra.pg(this.w,this.tb,this.ba,this.camera,this.w.scene,this.applicationController,
this.pluginAccess);case g.DragActionStartKind.TopicZoomAreaMove:return new Sa.rg(this.w);case g.DragActionStartKind.ArcMove:return new Qa.jg(this.w,this.tb);case g.DragActionStartKind.NonProportionalResize:return new Ta.Kg(this.w);case g.DragActionStartKind.Resize:return 1===a.target.entityIds.length&&this.w.executeApiCommand({name:"isSingleText",run:(b)=>b.lookup.base(a.target.entityIds[0]).is(p.base.ObjectKind.text)})?new P.Yg(this.w):new P.Zg(this.w);case g.DragActionStartKind.TopicZoomAreaResize:return new Ya.fh(this.w);
case g.DragActionStartKind.Rotate:return new Xa.$g(this.w);case g.DragActionStartKind.MaskImageMove:return new pa.mg(this.w);case g.DragActionStartKind.MaskAreaMove:return new pa.lg(this.w);case g.DragActionStartKind.MaskImageResize:return new fa.Fg(this.w);case g.DragActionStartKind.MaskAreaResize:return new fa.Eg(this.w);case g.DragActionStartKind.MaskAreaNonProportionalResize:return new fa.Dg(this.w);case g.DragActionStartKind.OverviewMove:return new qa.ng(this.w);case g.DragActionStartKind.OverviewResize:return new qa.Xg(this.w);
case g.DragActionStartKind.DrawInsert:return new P.sg(this.w,this.applicationController);default:D.Utils.assertNever(a)}}};var V={};Object.defineProperty(V,"__esModule",{value:!0});V.Qa=class{static td(a){return R.PreziUAParser.isMac()?a.metaKey:a.altKey}static za(a){return R.PreziUAParser.isMac()?a.metaKey:a.altKey&&a.ctrlKey}static Kj(a){return R.PreziUAParser.isMac()?a.altKey:a.ctrlKey}};var ra={};Object.defineProperty(ra,"__esModule",{value:!0});ra.Hg=class{constructor(a,b,c,d,e,f,m){this.camera=
f;this.scene=m;f=b.filter((a)=>a.kind===A.EditorMode.edit).slidingWindow(2,2).map((a)=>{const b=a[0];a=a[1];return b.editingKind!==t.EditingKind.drawInsert&&a.editingKind===t.EditingKind.drawInsert?{cursor:n.MouseCursorShapes.CROSSHAIR}:b.editingKind===t.EditingKind.drawInsert&&a.editingKind!==t.EditingKind.drawInsert?{cursor:n.MouseCursorShapes.DEFAULT}:null}).filter((a)=>null!=a);b=b.map((a)=>a.kind===A.EditorMode.edit&&a.editingKind!==t.EditingKind.drawInsert).toProperty(!1);a=a.filterWithStream(b);
m=a.filter((a)=>a.i.type===h.MouseInteractionType.MouseDown||a.i.type===h.MouseInteractionType.MouseUp||a.i.type===h.MouseInteractionType.MouseDownRight||a.i.type===h.MouseInteractionType.MouseUpRight).map((a)=>a.i.type===h.MouseInteractionType.MouseDown||a.i.type===h.MouseInteractionType.MouseDownRight).toProperty(!1);e=e.map((a)=>({Fe:a.kind,Sh:a.kind===g.ActionKind.Start?a.startKind:null,Sa:a.kind===g.ActionKind.Start&&a.startKind===g.DragActionStartKind.Rotate?a.draggedControlPointPosition:null,
target:a.kind===g.ActionKind.Start?a.target:null})).scan({za:!1,Sa:null,target:null,Pb:null},(a,b)=>a.za&&b.Fe!==g.ActionKind.Finish?{za:!0,Sa:a.Sa,target:a.target,Pb:a.Pb}:b.Fe===g.ActionKind.Start&&b.Sh===g.DragActionStartKind.Rotate?{za:!0,Sa:b.Sa,target:b.target,Pb:b.target.kind===g.ActionTargetKind.multiple&&1<b.target.entityIds.length?l.Cet.transform(this.scene.getEntityById(b.target.entityIds[0])).getLocalToWorld().getRotationDeg():null}:{za:!1,Sa:null,target:null,Pb:null});c=k.Bacon.combineWith5((a,
b,c,d,e)=>({aa:a,ud:b,Rj:c,Hf:e}),a,d,m,c.toProperty(!0),e).filterWithStream(b).filter(({aa:a,Hf:b})=>a.i.type!==h.MouseInteractionType.DragMove||b.za&&null!=b.Sa).map(({aa:a,ud:b,Rj:c,Hf:d})=>this.mi(a,b,c,d)).toEventStream();this.tf=k.Bacon.mergeAll([c,f])}Mb(a,b,c=null){if(a.type===q.ControlPointType.resize||a.type===q.ControlPointType.resizeMaskImage||a.type===q.ControlPointType.resizeMaskArea||a.type===q.ControlPointType.topicZoomAreaResize||a.type===q.ControlPointType.overviewResize)return this.La([n.MouseCursorShapes.TOPLEFT_BOTTOMRIGHT_RESIZE,
n.MouseCursorShapes.TOPRIGHT_BOTTOMLEFT_RESIZE,n.MouseCursorShapes.TOPLEFT_BOTTOMRIGHT_RESIZE,n.MouseCursorShapes.TOPRIGHT_BOTTOMLEFT_RESIZE],va(a.position),b);if(a.type===q.ControlPointType.rotate){let d=n.getRotateCursorShapes();return this.La(d,va(a.position)*d.length/4%d.length,b,c)}return a.type===q.ControlPointType.widthResize||a.type===q.ControlPointType.widthResizeMaskArea?this.La([n.MouseCursorShapes.COL_RESIZE,n.MouseCursorShapes.ROW_RESIZE,n.MouseCursorShapes.COL_RESIZE,n.MouseCursorShapes.ROW_RESIZE],
0,b):a.type===q.ControlPointType.heightResize||a.type===q.ControlPointType.heightResizeMaskArea?this.La([n.MouseCursorShapes.ROW_RESIZE,n.MouseCursorShapes.COL_RESIZE,n.MouseCursorShapes.ROW_RESIZE,n.MouseCursorShapes.COL_RESIZE],0,b):a.type===q.ControlPointType.line?n.MouseCursorShapes.MOVE:n.MouseCursorShapes.DEFAULT}La(a,b,c,d=null){if(1<c.length&&null!=d)return c=this.scene.getEntityById(c[0]),d=l.Cet.transform(c).getLocalToWorld().getRotationDeg()-d,d+=this.camera.getTransform().getRotationDeg(),
a[(b+qb(d,a.length))%a.length];if(1!==c.length)return a[b];d=this.scene.getEntityById(c[0]);d=l.Cet.transform(d).getLocalToWorld().getRotationDeg()+this.camera.getTransform().getRotationDeg();return a[(b+qb(d,a.length))%a.length]}mi(a,b,c,d){if(b)return c?{cursor:n.MouseCursorShapes.GRABBING}:{cursor:n.MouseCursorShapes.GRAB};if(d.za&&(d.target.kind===g.ActionTargetKind.multiple||d.target.kind===g.ActionTargetKind.single))return{cursor:this.Mb({type:q.ControlPointType.rotate,position:d.Sa},d.target.kind===
g.ActionTargetKind.multiple?d.target.entityIds:[d.target.entityId],d.Pb)};b=this.scene.getEntityById(a.fa);if(null!=b){if(l.Cet.hasShapedText(b)&&null!=a.textSelectionState&&a.textSelectionState.isEditing())return{cursor:n.MouseCursorShapes.TEXT};if(p.CetModelEditor.isClickableNextLogo(b.getId(),this.scene))return{cursor:n.MouseCursorShapes.POINTER};c=b.get(q.SelectionModule.getDecoratorKey());if(null!=c){if(c.interactionType===q.InteractionType.controlPoint)return{cursor:this.Mb(b.get(q.SelectionModule.getControlPointKey()),
a.selection.selectionInfo.allEntityIds)};if(c.interactionType===q.InteractionType.clickable)return{cursor:n.MouseCursorShapes.POINTER}}}return{cursor:n.MouseCursorShapes.DEFAULT}}};ra.Ig=class{constructor(a,b,c,d,e,f){this.camera=e;this.scene=f;this.ta=null;c=c.map((a)=>V.Qa.za(a)).merge(a.map((a)=>V.Qa.za(a.i.event))).toProperty(!1);a=a.filterWithStream(b.map((a)=>a.kind===A.EditorMode.edit).toProperty(!1));this.tf=k.Bacon.combineWith3((a,b)=>({aa:a,kk:b}),a,c,d.toProperty(!0)).filterWithStream(this.camera.getPanningStream().map((a)=>
a===l.PanningEvent.PanningFinished).toProperty(!0)).filterWithStream(this.camera.getZoomingStream().map((a)=>a===l.ZoomingEvent.NoZoom).toProperty(!0)).map(({aa:a,kk:b})=>{var c=a.i;return c.type===h.MouseInteractionType.DragMove||c.type===h.MouseInteractionType.DragEnd?this.ni(a):this.oi(a,b)}).toEventStream()}Mb(a,b,c){if(a.type===q.ControlPointType.resize||a.type===q.ControlPointType.resizeMaskImage||a.type===q.ControlPointType.resizeMaskArea||a.type===q.ControlPointType.topicZoomAreaResize||a.type===
q.ControlPointType.overviewResize)if(b){if(a.type===q.ControlPointType.resize)return this.La([n.MouseCursorShapes.TOPLEFT_ROTATE,n.MouseCursorShapes.TOPRIGHT_ROTATE,n.MouseCursorShapes.BOTTOMRIGHT_ROTATE,n.MouseCursorShapes.BOTTOMLEFT_ROTATE],va(a.position),c)}else return this.La([n.MouseCursorShapes.TOPLEFT_BOTTOMRIGHT_RESIZE,n.MouseCursorShapes.TOPRIGHT_BOTTOMLEFT_RESIZE,n.MouseCursorShapes.TOPLEFT_BOTTOMRIGHT_RESIZE,n.MouseCursorShapes.TOPRIGHT_BOTTOMLEFT_RESIZE],va(a.position),c);else{if(a.type===
q.ControlPointType.widthResize||a.type===q.ControlPointType.widthResizeMaskArea)return this.La([n.MouseCursorShapes.COL_RESIZE,n.MouseCursorShapes.ROW_RESIZE,n.MouseCursorShapes.COL_RESIZE,n.MouseCursorShapes.ROW_RESIZE],0,c);if(a.type===q.ControlPointType.heightResize||a.type===q.ControlPointType.heightResizeMaskArea)return this.La([n.MouseCursorShapes.ROW_RESIZE,n.MouseCursorShapes.COL_RESIZE,n.MouseCursorShapes.ROW_RESIZE,n.MouseCursorShapes.COL_RESIZE],0,c);if(a.type===q.ControlPointType.line)return n.MouseCursorShapes.MOVE}return n.MouseCursorShapes.DEFAULT}La(a,
b,c){if(1!==c.length)return a[b];c=this.scene.getEntityById(c[0]);{for(c=l.Cet.transform(c).getLocalToWorld().getRotationRad()+this.camera.getTransform().getRotationRad();0>c;)c+=2*Math.PI;for(;c>2*Math.PI;)c-=2*Math.PI;const a=Math.PI/4;c=c<a||7*a<=c?0:a<=c&&c<3*a?1:3*a<=c&&c<5*a?2:3}return a[(b+c)%4]}ni(a){null==this.ta&&(this.ta=a.fa,this.jb=a.Fb,this.xh=a.ve);if(null==this.ta){var b=a.selection.selectionInfo.allEntityIds.some((a)=>p.CetModelEditor.isLocked(a,this.scene));b={cursor:a.selection.zc&&
!b?n.MouseCursorShapes.MOVE:n.MouseCursorShapes.DEFAULT}}else null!=this.jb&&this.jb.interactionType===q.InteractionType.controlPoint?b={cursor:this.Mb(this.xh,V.Qa.za(a.i.baseEvent),a.selection.selectionInfo.allEntityIds)}:null==this.jb||this.jb.interactionType!==q.InteractionType.border&&this.jb.interactionType!==q.InteractionType.topicZoomAreaBorder&&this.jb.interactionType!==q.InteractionType.maskDrag?null!=a.textSelectionState&&a.textSelectionState.isEditing()?b={cursor:n.MouseCursorShapes.TEXT}:
(b=p.CetModelEditor.isLocked(this.ta,this.scene),b=a.i.type===h.MouseInteractionType.DragEnd?a.selection.selectionInfo.allEntityIds.find((a)=>a===this.ta)&&!b?{cursor:n.MouseCursorShapes.MOVE}:{cursor:n.MouseCursorShapes.DEFAULT}:b?{cursor:n.MouseCursorShapes.DEFAULT}:{cursor:n.MouseCursorShapes.MOVE}):b={cursor:n.MouseCursorShapes.MOVE};a.i.type===h.MouseInteractionType.DragEnd&&(this.ta=null);return b}oi(a,b){const c=this.scene.getEntityById(a.fa);if(null!=c){if(l.Cet.hasShapedText(c)&&null!=a.textSelectionState&&
a.textSelectionState.isEditing())return{cursor:n.MouseCursorShapes.TEXT};if(p.CetModelEditor.isClickableNextLogo(c.getId(),this.scene))return{cursor:n.MouseCursorShapes.POINTER}}if(null==c)return a.selection.zc&&a.selection.selectionInfo.allEntityIds.every((a)=>!p.CetModelEditor.isLocked(a,this.scene))?{cursor:n.MouseCursorShapes.MOVE}:{cursor:n.MouseCursorShapes.DEFAULT};const d=c.get(q.SelectionModule.getDecoratorKey());if(null!=d&&d.interactionType===q.InteractionType.controlPoint)return{cursor:this.Mb(c.get(q.SelectionModule.getControlPointKey()),
b,a.selection.selectionInfo.allEntityIds)};if(null!=d){if(d.interactionType===q.InteractionType.border||d.interactionType===q.InteractionType.topicZoomAreaBorder||d.interactionType===q.InteractionType.maskDrag)return{cursor:n.MouseCursorShapes.MOVE};if(d.interactionType===q.InteractionType.clickable)return{cursor:n.MouseCursorShapes.POINTER}}return a.selection.selectionInfo.allEntityIds.some((a)=>a===c.getId())&&!p.CetModelEditor.isLocked(c.getId(),this.scene)?{cursor:n.MouseCursorShapes.MOVE}:{cursor:n.MouseCursorShapes.DEFAULT}}};
var Za={};Object.defineProperty(Za,"__esModule",{value:!0});Za.Qg=class{constructor(a,b,c,d,e,f){this.Zk=f;b=b.map((b)=>b.allEntityIds.filter((b)=>{b=a.getEntityById(b);return null!=b&&(p.CetModelEditor.isOverview(b.getId(),a)||l.Cet.hasPdomComponent(b)&&l.Cet.hasZOrder(b))}));e=e.filter((a)=>a.keyCode===h.Key.UP_ARROW||a.keyCode===h.Key.DOWN_ARROW||a.keyCode===h.Key.LEFT_ARROW||a.keyCode===h.Key.RIGHT_ARROW).slidingWindow(2,1);f=e.filter((a)=>1===a.length&&a[0].type===h.KeyboardEventType.KEYDOWN||
a[0].type===h.KeyboardEventType.KEYUP&&a[1].type===h.KeyboardEventType.KEYDOWN).map((a)=>a[a.length-1]);const m=(b,c)=>{if(null==c)return!1;switch(c.kind){case t.CoverEditModeKind.advanced:return 1===b.length&&c.topicId===b[0];case t.CoverEditModeKind.insideAdvanced:return 1===b.length&&c.topicOrOverviewId===b[0]&&!p.CetModelEditor.isOverview(c.topicOrOverviewId,a);case t.CoverEditModeKind.titleEditOnly:return!1;default:return D.Utils.assertNever(c)}},y=(b,c)=>1===b.length&&(G.isActive("js-unique-differentiation")&&
b[0]===a.getPreziW().getOverview().getId()||null!=c&&c.kind===t.CoverEditModeKind.insideAdvanced&&c.topicOrOverviewId===b[0]&&p.CetModelEditor.isOverview(c.topicOrOverviewId,a));c=k.Bacon.combineWith4((a,b,c,d)=>({bk:a,selection:b,coverEditMode:c,$j:d}),f,b,c,d).sampledBy(f).map(({bk:b,selection:c,coverEditMode:d,$j:e})=>{const f=this.hi(c,a);return m(c,d)?e?{kind:g.ActionKind.Start,startKind:g.NudgeActionStartKind.topicZoomArea,direction:this.ld(b),target:{kind:g.ActionTargetKind.single,entityId:c[0]},
isFast:b.shiftKey,coTransformContent:this.Zk.shouldCoTransformContent(d)}:null:y(c,d)?e||G.isActive("js-unique-differentiation")?{kind:g.ActionKind.Start,startKind:g.NudgeActionStartKind.overviewZoomArea,direction:this.ld(b),target:{kind:g.ActionTargetKind.implicit},isFast:b.shiftKey}:null:0<c.length&&!c.some((b)=>p.CetModelEditor.isLocked(b,a))?{kind:g.ActionKind.Start,startKind:g.NudgeActionStartKind.object,direction:this.ld(b),target:{kind:g.ActionTargetKind.multiple,entityIds:f},isFast:b.shiftKey}:
null}).filter((a)=>null!=a).toEventStream();d=e.filter((a)=>2===a.length&&a[0].type===h.KeyboardEventType.KEYDOWN&&a[1].type===h.KeyboardEventType.KEYDOWN).map((a)=>({kind:g.ActionKind.Step,snapEnabled:!V.Qa.td(a[1]),isFast:a[1].shiftKey})).toEventStream();e=e.filter((a)=>a[a.length-1].type===h.KeyboardEventType.KEYUP).map(()=>({kind:g.ActionKind.Finish})).toEventStream();this.qk=k.Bacon.mergeAll([c,d,e]);this.fk(c);this.ek(c)}hi(a,b){let c=[],d=p.CetModelEditor.createEntityQuery(b);a.forEach((e)=>
{e=b.getEntityById(e);if(e.isDef(w.CetModel.ID.CONNECTOR)){let f=d.getConnectorTail(e);this.Sf(f,c,a,b)&&c.push(f);e=d.getConnectorHead(e);this.Sf(e,c,a,b)&&c.push(e)}});return a.concat(c)}Sf(a,b,c,d){return null!=a&&-1===b.indexOf(a)&&-1===c.indexOf(a)&&!p.CetModelEditor.isLocked(a,d)}ld(a){switch(a.keyCode){case h.Key.UP_ARROW:return g.NudgeDirection.Up;case h.Key.DOWN_ARROW:return g.NudgeDirection.Down;case h.Key.LEFT_ARROW:return g.NudgeDirection.Left;case h.Key.RIGHT_ARROW:return g.NudgeDirection.Right;
default:return null}}fk(a){this.logUseKeyboardShortcut(!1,a)}ek(a){this.logUseKeyboardShortcut(!0,a)}logUseKeyboardShortcut(a,b){b.filter((b)=>b.isFast===a).debounce(1E3).onValue(()=>{E.avro.Avro.createDefaultLogger().logUseKeyboardShortcut({shortcut_type:a?"MOVE_SELECTION":"NUDGE_SELECTION"})})}};var $a={};Object.defineProperty($a,"__esModule",{value:!0});var Y;(function(a){a.dragMove="dragMove";a.dragEnd="dragEnd";a.mouseOnEdge="mouseOnEdge"})(Y||(Y={}));$a.ah=class{constructor(a,b,c,d,e,f,m,g,
h,x,l,k){this.pk=a;this.Wc=b;this.Ta=c;this.Hb=d;this.Qh=e;this.Gd=f;this.Jd=m;this.sb=g;this.f=h;this.ba=x;this.camera=l;this.scene=k;this.mb=p.CetModelEditor.createGroupQuery();this.Aj()}getAreaSelectionStream(){return this.nh}getHighlightEntitiesOnDragSelectActionStream(){return this.bj}getFlyToSelectionStream(){return this.vc}sf(a){return{Ad:a.event.stagePos,Hc:a.baseEvent.stagePos,type:this.pi(a.type)}}Ah(){return this.pk.filter((a)=>(a.type===h.MouseInteractionType.DragMove||a.type===h.MouseInteractionType.DragEnd)&&
a.baseEvent.shiftKey).filterWithStream(this.f.getModeStream().map((a)=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.normal)).filterWithStream(this.camera.getPanningStream().map((a)=>a===l.PanningEvent.PanningFinished).toProperty(!0)).filterWithStream(this.camera.getZoomingStream().map((a)=>a===l.ZoomingEvent.NoZoom).toProperty(!0)).map((a)=>this.sf(a))}zh(){const a=k.Bacon.combineWith((a,b)=>({event:a.i,Sb:a.selection.zc,ta:a.fa,Rb:null!=a.ve,ra:b}),this.Wc,this.f.getIsPanModeEnabledStream().toProperty(!1)).sampledBy(this.Wc).filter((a)=>
a.event.type===h.MouseInteractionType.MouseDown||a.event.type===h.MouseInteractionType.DragMove||a.event.type===h.MouseInteractionType.DragEnd).scan(null,(a,b)=>null==a||b.event.type===h.MouseInteractionType.MouseDown?{event:b.event,ta:b.ta,ra:b.ra,Sb:b.Sb,Rb:b.Rb}:{event:b.event,ta:a.ta,Sb:a.Sb,ra:a.ra,Rb:a.Rb}).filter((a)=>null!=a&&null!==a.event&&(a.event.type===h.MouseInteractionType.DragMove||a.event.type===h.MouseInteractionType.DragEnd)&&(a.event.baseEvent.shiftKey&&!a.Rb||null==a.ta&&!a.Sb)&&
!a.ra).filterWithStream(this.camera.getZoomingStream().map((a)=>a===l.ZoomingEvent.NoZoom).toProperty(!0)).filterWithStream(this.f.getModeStream().map((a)=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.normal)).map((a)=>this.sf(a.event)),b=a.map((a)=>a.type===Y.dragMove).toProperty(!1);return k.Bacon.combineWith((a,b)=>({Ad:a.Ad,Hc:{x:a.Hc.x-b.o.x,y:a.Hc.y-b.o.y},type:a.type}),a,this.sb.filterWithStream(b))}pi(a){switch(a){case h.MouseInteractionType.DragMove:return Y.dragMove;case h.MouseInteractionType.DragEnd:return Y.Uh;
default:throw Error("Mouse interaction type is not allowed: "+a);}}Bh(){var a=(G.isActive("js-unique-differentiation")?this.zh():this.Ah()).map((a)=>({rect:this.Pk(a.Hc,a.Ad),type:a.type}));this.nh=a.map((a)=>a.type===Y.dragMove?a.rect:null);a=k.Bacon.combineWith4((a,c,d,e)=>({entityIds:this.ti(a.rect,c,d,e.allEntityIds),type:a.type}),a,this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream(),this.f.getSelectionStream()).sampledBy(a).toEventStream();this.bj=a.map((a)=>({entityIds:a.type===Y.dragMove?
a.entityIds:[]}));a=a.filter((a)=>a.type===Y.Uh).map((a)=>{a=a.entityIds;var b=this.f.getSelection();const d=b.allEntityIds.some((a)=>p.CetModelEditor.isLocked(a,this.scene));b=q.SelectionModule.getEditedGroupId(this.scene,b);if(null==b){var {groupIds:e,entities:f}=q.SelectionModule.getGroupsWithEntities(this.scene,a);return{type:d?n.SelectActionType.replace:n.SelectActionType.add,selectedGroupIds:e,selectedEntityIds:f.map((a)=>a.getId())}}if(q.SelectionModule.getContainerGroupId(this.scene,a)===
b)return{type:n.SelectActionType.add,selectedGroupIds:[],selectedEntityIds:a};var {groupIds:m,entities:g}=q.SelectionModule.getGroupsWithEntities(this.scene,a);return{type:n.SelectActionType.replace,selectedGroupIds:[...m,b],selectedEntityIds:g.map((a)=>a.getId())}});a.onValue(()=>{E.avro.Avro.createDefaultLogger().logUseKeyboardShortcut({shortcut_type:"DRAW_A_RECTANGLE_TO_SELECT_MULTIPLE_OBJECTS"})});return a}Aj(){var a=this.Ta.filter((a)=>a.kind===g.ActionKind.Start&&a.startKind===g.DragActionStartKind.ObjectMove).map((a)=>
a),b=this.Hb.filter((a)=>null!=a.entity&&a.entity.isDef(w.CetModel.ID.Z_ZOOM_AREA)).map(()=>null);const c=k.Bacon.mergeAll([this.Qh,b]);b=this.Nh();a=this.Ch(this.Wc).merge(this.Hh(a)).merge(this.Bh()).merge(this.Oh(this.Hb)).merge(b).merge(c.map(()=>({selectedGroupIds:[],selectedEntityIds:[],type:n.SelectActionType.replace})));a.onValue((a)=>{this.ba.select(a)});G.isActive("js-unique-differentiation")?this.vc=k.Bacon.mergeAll([b,a.filter((a)=>-1!==a.selectedEntityIds.indexOf(this.scene.getPreziW().getOverview().getEntity().getId()))]).map((a)=>
a.selectedEntityIds):this.vc=k.Bacon.never()}Nj(a,b,c){if(1===b.length&&null==this.scene.getEntityById(b[0])||1!==b.length||!w.CetModel.textKludge.isEntityText(this.scene.getEntityById(b[0]))||null==a||null==this.scene.getEntityById(a)||!w.CetModel.textKludge.isEntityText(this.scene.getEntityById(a)))return!1;c=null!=c&&c.isEditing();a=-1!==b.indexOf(a);return c&&a}Qj(a){a=a.getWrapper(w.CetModel.ID.Z_OBJECT.W);return a.is(w.CetModel.ID.Z_IMAGE)&&a.getIsPlaceholder()}je(a){switch(a){case t.EditingKind.normal:case t.EditingKind.imageMask:return!0;
case t.EditingKind.drawInsert:return!1;default:D.Utils.assertNever(a)}}Ch(a){a=(G.isActive("js-unique-differentiation")?a.filter((a)=>a.fa||a.selection.zc?a.i.type===h.MouseInteractionType.Click:a.i.type===h.MouseInteractionType.MouseDown):a.filter((a)=>a.i.type===h.MouseInteractionType.Click)).filterWithStream(this.f.getModeStream().map((a)=>a.kind===A.EditorMode.edit&&this.je(a.editingKind)));return k.Bacon.combineWith((a,c)=>({event:a,vk:c}),a,this.f.getOpenedPopupIdStream()).sampledBy(a).toEventStream().map(({event:a,
vk:c})=>{if("contextMenuPopup"===c)return null;var b=this.scene.getEntityById(a.fa),e=a.selection.selectionInfo,f=e.allEntityIds;if(null!=b){var m=b.get(q.SelectionModule.getDecoratorKey()),g=p.CetModelEditor.createTopicQuery(this.scene);if(null!=m&&m.interactionType===q.InteractionType.clickable&&(g.isTopic(this.scene.getEntityById(m.ownerIds[0]))||p.CetModelEditor.isOverview(m.ownerIds[0],this.scene)))b=this.scene.getEntityById(m.ownerIds[0]);else if(!W.Za.pb(a.fa,a.currentTopicId,a.coverEditMode,
f,this.scene)||this.Nj(a.fa,f,a.textSelectionState))return null}a.i.event.shiftKey&&E.avro.Avro.createDefaultLogger().logUseKeyboardShortcut({shortcut_type:"SELECT_MULTIPLE_OBJECTS"});if(null!=b){f=this.mb.getGroupIdFromEntity(this.scene,b);if(0===e.nonGroupedEntityIds.length&&1===e.groupIds.length&&e.groupIds[0]===f)return{type:n.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[b.getId()]};c=q.SelectionModule.getEditedGroupId(this.scene,e);m=null!=f&&c===f;a=this.getSelectAction(a.i.event,
e.allEntityIds,b);e={selectedGroupIds:[],selectedEntityIds:[b.getId()]};g={selectedGroupIds:[f],selectedEntityIds:[]};if("erase"===a)return{type:n.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[]};if("keep"===a)return null;if(a!==n.SelectActionType.toggle&&a!==n.SelectActionType.add||null==c||m)return null==f||m||this.Qj(b)&&a===n.SelectActionType.replace?Object.assign({type:a},e):Object.assign({type:a},g);b=null==f?e:g;return{type:n.SelectActionType.replace,selectedGroupIds:b.selectedGroupIds.concat(c),
selectedEntityIds:b.selectedEntityIds}}return!(null===c&&0<f.length)||G.isActive("js-unique-differentiation")&&a.i.event.shiftKey?null:{type:n.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[]}}).filter((a)=>null!=a)}getSelectAction(a,b,c){const d=b.some((a)=>p.CetModelEditor.isLocked(a,this.scene)),e=p.CetModelEditor.isLocked(c.getId(),this.scene);return a.shiftKey?e&&d&&null!=b.find((a)=>a===c.getId())?"erase":e?0<b.length?"keep":n.SelectActionType.add:d?n.SelectActionType.replace:
n.SelectActionType.toggle:a.ctrlKey?e?0<b.length?"keep":n.SelectActionType.add:d?n.SelectActionType.replace:n.SelectActionType.add:n.SelectActionType.replace}Hh(a){return k.Bacon.combineWith4((a,c,d,e)=>({Ie:a,selection:c.allEntityIds,currentTopic:d,coverEditMode:e}),a,this.f.getSelectionStream(),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream()).sampledBy(a).filter(({Ie:a,currentTopic:c,coverEditMode:d,selection:e})=>a.target.entityIds.every((a)=>W.Za.pb(a,c,d,e,this.scene))).map(({Ie:a,
selection:c})=>0<c.length&&a.target.entityIds.every((a)=>-1===c.indexOf(a))?{type:n.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[]}:null).filter((a)=>null!=a)}Nh(){const a=this.f.getTextSelectionStateStream().map((a)=>null==a||!a.isEditing()),b=this.Jd.filter((a)=>-1!==a.actions.indexOf(h.ShortcutAction.SELECT_ALL)).filterWithStream(this.f.getModeStream().map((a)=>a.kind===A.EditorMode.edit&&this.je(a.editingKind))).filterWithStream(a).doAction((a)=>a.event.preventDefault());return k.Bacon.combineWith((a,
b)=>({currentTopic:a,coverEditMode:b}),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream()).sampledBy(b.mergeAny(this.Gd.filterWithStream(a))).map(({currentTopic:a,coverEditMode:b})=>{const c=l.Cet.createTopicChildrenQuery(this.scene);let d;if(null==b)d=c.getChildrenIds(a,l.TopicChildBehavior.Content);else switch(b.kind){case t.CoverEditModeKind.insideAdvanced:d=c.getChildrenIdsVisibleInside(b.topicOrOverviewId);break;case t.CoverEditModeKind.titleEditOnly:case t.CoverEditModeKind.advanced:d=
c.getChildrenIdsVisibleOutside(b.topicId);break;default:D.Utils.assertNever(b)}d=d.filter((c)=>W.Za.pb(c,a,b,[],this.scene)&&!p.CetModelEditor.isLocked(c,this.scene));const {groupIds:m,entities:g}=q.SelectionModule.getGroupsWithEntities(this.scene,[...d]);return{selectedGroupIds:m,selectedEntityIds:g.map((a)=>a.getId()),type:n.SelectActionType.replace}})}Oh(a){return a.filter((a)=>null!=a.entity&&l.Cet.hasCurvedLine(a.entity)).map((a)=>{var b=l.Cet.createHierarchyQuery(this.scene).getParentOrOverview(a.entity);
b=l.Cet.createHierarchyQuery(this.scene).getChildrenIdsWithOverviewFallback(b);const d=l.Cet.getStyleClass(a.entity);return{selectedGroupIds:[],selectedEntityIds:b.filter((a)=>{a=this.scene.getEntityById(a);return null!=d&&d===l.Cet.getStyleClass(a)}),type:n.SelectActionType.replace}})}Pk(a,b){a=M.Geometry.rectangleFromData({x:a.x,y:a.y,width:0,height:0});b=M.Geometry.rectangleFromData({x:b.x,y:b.y,width:0,height:0});return a.union(b)}ti(a,b,c,d){const e=M.Geometry.obbFromRect(a.getData()).transform(this.camera.getTransform().invert()),
f=l.Cet.createTopicChildrenQuery(this.scene),m=l.Cet.createScreenBoundsCalculator(this.scene,this.camera);return this.Ia().getEntitiesByWorldArea(e).apply(this.Ia().strategies().entitiesInArea(this.scene,null!=c)).filter((a)=>!a.is(p.HitTag.LOCKED)).filter((a)=>W.Za.pb(a.getEntityId(),b,c,d,this.scene)).filter((a)=>this.bi(a.getData().entity,e,f,m)).filter((a)=>!a.is(p.HitTag.Z_TOPIC_CONTAINER)||0===f.getChildrenIdsVisibleOutside(a.getEntityId()).length).entities().map((a)=>a.getId())}bi(a,b,c,d){if(a.isDef(w.CetModel.ID.Z_TOPIC_CONTAINER))return c=
c.getChildrenIdsVisibleOutside(a.getId()),d.getUnionWorldBoundsParentAligned(a,c).getObb().intersects(b);c=l.Cet.transform(a).getLocalToWorld();a=d.getLocalBoundsForHittest(a);return M.Geometry.obbFromRect(a.getData()).transform(c).intersects(b)}Ia(){return this.scene.getPrezi().get(p.CetModelEditor.getStageQueryKey())}};var ab={};Object.defineProperty(ab,"__esModule",{value:!0});ab.eg=class{constructor(a,b,c){this.Ee=a;this.ye=b;this.scene=c;this.xe=this.Dh()}al(a,b){a.select({selectedGroupIds:[],
selectedEntityIds:[],type:n.SelectActionType.replace});b.stopCoverEditing("FLY-IN")}Dh(){var a=this.Ee.debounce(1).map(()=>({wa:null,selection:[]}));a=this.ye.debounce(500).merge(a).map(()=>({wa:null,selection:[]}));const b=(a)=>{const b=this.scene.getEntityById(a.wa),c=l.Cet.createTopicChildrenQuery(this.scene);return!(1===a.selection.length&&c.isVisibleOutside(a.wa)&&a.selection[0]===c.getChildReferer(a.wa)&&w.CetModel.textKludge.isEntityText(b))};return this.ye.filter((a)=>b(a)).merge(a).sampledBy(this.Ee).filter((a)=>
null!=a.wa)}Ai(a){return this.xe.map((b)=>{b=a.getEntityById(b.wa);return a.getEntityById(l.Cet.createHierarchyQuery(a).getParentId(b))})}};var W={};Object.defineProperty(W,"__esModule",{value:!0});var K=p.base.AnchorPoint,ha;(function(a){a[a.Sd=0]="FlyToEntity";a[a.Oc=1]="SelectEntity"})(ha||(ha={}));var H;(function(a){a.drag="drag";a.finish="finish"})(H||(H={}));W.Za=class{constructor(a,b,c,d,e,f,m,y,C,x,q,r,u,v,w,z){this.ha=a;this.scene=b;this.camera=c;this.f=d;this.ba=e;this.xa=m;this.Ua=y;this.Jd=
C;this.nb=r;this.va=u;this.pluginAccess=w;this.applicationController=z;this.mb=p.CetModelEditor.createGroupQuery();this.We=(a)=>{switch(a.position){case g.ControlPointPosition.TOP_LEFT:return K.topLeft;case g.ControlPointPosition.TOP_RIGHT:return K.topRight;case g.ControlPointPosition.BOTTOM_LEFT:return K.bottomLeft;case g.ControlPointPosition.BOTTOM_RIGHT:return K.bottomRight;default:throw D.Utils.assert(!1,"invalid controlpoint position");}};this.Xe=(a)=>{switch(a.position){case g.ControlPointPosition.MIDDLE_LEFT:return K.centerLeft;
case g.ControlPointPosition.MIDDLE_RIGHT:return K.centerRight;case g.ControlPointPosition.MIDDLE_TOP:return K.topCenter;case g.ControlPointPosition.MIDDLE_BOTTOM:return K.bottomCenter;default:return this.We(a)}};this.Ca=this.f.getSelectionStream();this.Gi();this.Xi(x);this.rk=new Za.Qg(this.scene,this.Ca,d.getCoverEditModeStream(),this.f.getIsTopicZoomAreaEditEnabledStream(),this.Ua,this.xa);a=this.rf(this.ha,this.f.getSelectionStream(),this.f.getTextSelectionStateStream(),this.f.getCurrentTopicStream(),
this.f.getCoverEditModeStream());b=this.Eh(a);b.onValue((a)=>{a.action===ha.Oc&&this.ba.select({type:n.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[a.entity.getId()]})});this.vd=k.Bacon.combineWith3((a,b,c)=>({Uj:a===l.PanningEvent.PanningStarted,ga:b,ra:c}),this.camera.getPanningStream().toProperty(null),this.ha.toProperty(null),this.f.getIsPanModeEnabledStream().toProperty(!1)).map((a)=>a.ra||a.Uj&&null!=a.ga&&(a.ga.type===h.MouseInteractionType.DragMove||a.ga.type===h.MouseInteractionType.DragMoveRight)).skipDuplicates().toProperty(!1);
this.Ib=k.Bacon.newBus();this.Ib.plug(b.filter((a)=>a.action===ha.Sd).map((a)=>a.entity));this.Hb=this.Gh(a);this.hj(a);this.Cd=k.Bacon.newBus();this.sb=this.Mh(this.ha,this.f.getCurrentTopicStream());this.lj(v);this.Vi(this.sb,this.Xb);this.wj(a);this.mj(a,this.f.getModeStream());v=k.Bacon.combineWith((a,b)=>({flyTo:a,selection:b}),this.Ib,this.Ca).sampledBy(this.Ib).filter(({flyTo:a,selection:b})=>-1===b.allEntityIds.indexOf(a.getId())).map(()=>null);v=k.Bacon.mergeAll([v,this.Ua.filter((a)=>a.keyCode===
h.Key.ESC).filterWithStream(this.f.getModeStream().map((a)=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.normal)).map(()=>null)]);b=this.sb.filterWithStream(this.Xb.map((a)=>null==a).toProperty(!1));this.Hd=new $a.ah(this.ha,a,this.Ta,this.Hb,v,q,C,b,this.f,this.ba,this.camera,this.scene);C=this.rf(this.ha,this.f.getSelectionStream(),this.f.getTextSelectionStateStream(),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream(),!0);this.Ni(C,this.f.getRecalculateEntityUnderMouseActionStream(),
this.f.getOpenedPopupIdStream());this.Ii(C,this.f.getRecalculateEntityUnderMouseActionStream(),this.f.getOpenedPopupIdStream());this.mk=G.isActive("js-unique-differentiation")?new ra.Hg(C,this.f.getModeStream(),this.f.getRecalculateEntityUnderMouseActionStream(),this.vd,this.Ta,this.camera,this.scene):new ra.Ig(C,this.f.getModeStream(),y,this.f.getRecalculateEntityUnderMouseActionStream(),this.camera,this.scene);this.Jk=this.Ta.filter((a)=>a.kind!==g.ActionKind.Step).map((a)=>a.kind===g.ActionKind.Start&&
(a.startKind===g.DragActionStartKind.Resize||a.startKind===g.DragActionStartKind.NonProportionalResize)).skipDuplicates();this.Jb=this.Kh(this.Ta,this.f.getTextSelectionStateStream());this.He=new U.qg(u,this.f,this.ba,f,this.camera,z,w);this.Ta.onValue((a)=>this.He.process(a));this.xf=new U.Ng(u,this.f,f);this.rk.qk.onValue((a)=>this.xf.process(a));this.Pi(a);this.Oi(a,w);this.f.addPanModeFromKeyboardEventBus(this.Ua.filter((a)=>null!=a&&a.keyCode===h.Key.SPACE&&(a.type===h.KeyboardEventType.KEYUP||
a.type===h.KeyboardEventType.KEYDOWN)).map((a)=>a.type===h.KeyboardEventType.KEYDOWN))}getAreaSelectionStream(){return this.Hd.getAreaSelectionStream()}getHighlightEntitiesOnDragSelectActionStream(){return this.Hd.getHighlightEntitiesOnDragSelectActionStream()}getDoubleClickedEntityStream(){return this.Hb}getResizeControlPointStream(){return this.Jk}getFocusStream(){return this.Jb}getMouseCursorStateStream(){return this.mk.tf}getFlyToEntityActionStream(){return this.Ib}getOutputInteractionStream(){return this.wk}getFlyToSelectionStream(){return this.Hd.getFlyToSelectionStream()}getDrawInsertMouseHoverEventStream(){return this.Xh}reset(){this.He.reset();
this.xf.reset()}mj(a,b){a=k.Bacon.combineWith((a,b)=>({aa:a,mode:b}),a,b).filterWithStream(b.map((a)=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.drawInsert));b=b.slidingWindow(2,2).filter((a)=>a[0].kind===A.EditorMode.edit&&a[0].editingKind===t.EditingKind.drawInsert&&(a[1].kind!==A.EditorMode.edit||a[1].editingKind!==t.EditingKind.drawInsert)).map(()=>({isDrawInsertHoverMode:!1}));const c=a.filter((a)=>a.aa.i.type===h.MouseInteractionType.HoverMove||a.aa.i.type===h.MouseInteractionType.DragMoveRight).map((a)=>
({isDrawInsertHoverMode:!0,size:a.mode.defaultSize,stagePos:a.aa.i.event.stagePos}));this.Xh=k.Bacon.mergeAll([c,b,this.Xb.map(()=>({isDrawInsertHoverMode:!1}))]).skipDuplicates().toProperty({isDrawInsertHoverMode:!1});a.filter((a)=>a.aa.i.type===h.MouseInteractionType.Click).onValue((a)=>{this.va.executeApiCommand({name:"Draw insert frame",run:(b)=>this.applicationController.createDrawedObject(b,a.aa.i.event.stagePos,z.DrawInsertIntent.click)});this.applicationController.finishDrawObject()})}Mh(a,
b){if(!G.isActive("js-unique-differentiation")||G.isActive("js-for-test-disable-pan-when-drag-on-edge"))return k.Bacon.never();a=k.Bacon.combineWith3((a,b,c)=>({aa:a,currentTopicId:b,ra:c}),a,b,this.f.getIsPanModeEnabledStream().toProperty(!1)).sampledBy(a).filter((a)=>a.aa.type===h.MouseInteractionType.DragMove||a.aa.type===h.MouseInteractionType.DragEnd).scan(null,(a,b)=>null==a||a.aa.type===h.MouseInteractionType.DragEnd?{aa:b.aa,currentTopicId:b.currentTopicId,ra:b.ra}:{aa:b.aa,currentTopicId:b.currentTopicId,
ra:a.ra}).toEventStream().filter((a)=>null!=a&&!a.ra).map((a)=>{if(a.aa.type===h.MouseInteractionType.DragEnd)return{kind:H.finish,o:{x:0,y:0}};if(a.currentTopicId!==this.scene.getPreziW().getOverview().getEntity().getId())return{kind:H.drag,o:{x:0,y:0},sa:a.aa.event.stagePos};let b=0,c=0;const d=this.camera.getMarginCorrectedStageArea();a.aa.event.stagePos.x<d.getLeft()+50&&(b=-3);a.aa.event.stagePos.x>d.getRight()-50&&(b=3);a.aa.event.stagePos.y<d.getTop()+50&&(c=-3);a.aa.event.stagePos.y>d.getBottom()-
50&&(c=3);return{kind:H.drag,o:{x:b,y:c},sa:a.aa.event.stagePos}});let c=k.Bacon.newVoidBus(),d;a.map((a)=>null!=a&&!(0===a.o.x&&0===a.o.y)).skipDuplicates().slidingWindow(2,2).onValue((a)=>{!a[0]&&a[1]?d=window.setInterval(()=>c.push(),8):clearInterval(d)});return k.Bacon.combineWith((a,b)=>({Aa:a,Dc:b}),a,this.Cd.toProperty({leftLimitReached:!1,rightLimitReached:!1,upLimitReached:!1,downLimitReached:!1})).sampledBy(a.merge(c)).scan(null,(a,b)=>null===a||a.kind===H.finish?b.Aa.kind===H.drag?{kind:H.drag,
o:{x:b.Aa.o.x,y:b.Aa.o.y},sa:b.Aa.sa}:{kind:H.finish,o:{x:0,y:0}}:b.Aa.kind===H.drag?{kind:H.drag,o:{x:b.Dc.leftLimitReached&&0>b.Aa.o.x||b.Dc.rightLimitReached&&0<b.Aa.o.x?a.o.x:a.o.x+b.Aa.o.x,y:b.Dc.upLimitReached&&0>b.Aa.o.y||b.Dc.downLimitReached&&0<b.Aa.o.y?a.o.y:a.o.y+b.Aa.o.y},sa:a.sa}:{kind:H.finish,o:{x:0,y:0}}).filter((a)=>null!=a).skipDuplicates((a,b)=>a.kind===H.finish&&b.kind===H.finish)}Vi(a,b){let c=null;a.filterWithStream(b.map((a)=>null==a||this.ie(a)).toProperty(!1)).skipDuplicates((a,
b)=>{const c=a.o.x===b.o.x&&a.o.y===b.o.y;return a.kind===H.drag&&b.kind===H.drag?c&&a.sa.x===b.sa.x&&a.sa.y===b.sa.y:a.kind===b.kind&&c}).onValue((a)=>{switch(a.kind){case H.drag:if(0===a.o.x&&0===a.o.y)break;null==c&&(c=ba.createPanner(a.sa,this.scene.getPreziW().getOverview().getEntity().getId(),this.camera,this.scene,!0));a=c.panMove(this.lk(a.sa,{x:a.sa.x+a.o.x,y:a.sa.y+a.o.y}));this.Cd.push(a);break;case H.finish:null===c||void 0===c?void 0:c.panEnd();c=null;this.Cd.push({leftLimitReached:!1,
rightLimitReached:!1,upLimitReached:!1,downLimitReached:!1});break;default:D.Utils.assertNever(a)}})}lk(a,b){return{x:-(b.x-a.x)+a.x,y:-(b.y-a.y)+a.y}}Oi(a,b){a.filter((a)=>a.i.type===h.MouseInteractionType.Click).onValue((a)=>{a=a.fa;null!=a&&(this.isLogo(a)&&G.isActive("js-gm-watermark-paywall-on-click-and-present")&&b.send(u.style,{kind:u.StyleMessageKind.simple,value:u.StyleMessageValue.clickLogo}),this.kf(a)&&this.scene.getEntityById(a).get(q.SelectionModule.getDecoratorKey()).interactionType===
q.InteractionType.clickable&&b.send(u.style,{kind:u.StyleMessageKind.simple,value:u.StyleMessageValue.openWatermarkSidebar}))})}Pi(a){const b=(a)=>{a=this.scene.getEntityById(a);if(null==a)return!1;a=a.get(q.SelectionModule.getDecoratorKey());return null!=a&&a.interactionType===q.InteractionType.clickable?(a=this.scene.getEntityById(a.ownerIds[0]),null!=a&&a.isDef(w.CetModel.ID.Z_IMAGE)):!1};a=a.filter((a)=>a.i.type===h.MouseInteractionType.Click&&b(a.fa));var c=this.f.getModeStream().filter((a)=>
a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.imageMask);a=c.sampledBy(a).map((a)=>({editingKind:t.EditingKind.imageMask,target:a.target===t.MaskEditTarget.mask?t.MaskEditTarget.image:t.MaskEditTarget.mask,isFixedAspect:a.isFixedAspect,maskedImageId:a.maskedImageId}));var d=this.Ta.filter((a)=>a.kind===g.ActionKind.Start&&(a.startKind===g.DragActionStartKind.MaskAreaMove||a.startKind===g.DragActionStartKind.MaskImageMove)).map((a)=>a.startKind===g.DragActionStartKind.MaskAreaMove?t.MaskEditTarget.mask:
t.MaskEditTarget.image);c=k.Bacon.combineWith((a,b)=>({mask:a,target:b}),c,d).sampledBy(d).map((a)=>Object.assign(Object.assign({},a.mask),{target:a.target}));const e=(a)=>{switch(a){case t.MaskEditTarget.image:return{image_masking_mode:"MASKING"};case t.MaskEditTarget.mask:return{image_masking_mode:"CROPPING"};default:D.Utils.assertNever(a)}};this.f.getModeStream().slidingWindow(2,2).onValue((a)=>{a[0].kind===A.EditorMode.edit&&a[1].kind===A.EditorMode.edit&&a[0].editingKind===t.EditingKind.imageMask&&
a[1].editingKind===t.EditingKind.imageMask&&a[0].target!==a[1].target&&E.avro.Avro.createDefaultLogger().logSwitchMaskingAndCropping(e(a[1].target))});d=this.f.getModeStream().sampledBy(this.Ua.filter((a)=>"Enter"===a.key)).map((a)=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.imageMask?{kind:A.EditorMode.edit,editingKind:t.EditingKind.normal}:null).filter((a)=>null!=a);d.onValue(()=>{this.ba.select({selectedGroupIds:[],selectedEntityIds:[],type:n.SelectActionType.replace})});this.f.addChangeEditingKindStream(k.Bacon.mergeAll([a,
c,d]))}isClick(a){return a===h.MouseInteractionType.Click||a===h.MouseInteractionType.DoubleClick||a===h.MouseInteractionType.TripleClick}Mj(a,b,c){const d=l.Cet.createTopicChildrenQuery(this.scene),e=p.CetModelEditor.createTopicQuery(this.scene);b=l.Cet.createHierarchyQuery(this.scene).getParentId(a)!==b&&e.getTopicKind(b)!==p.TopicKind.Page;a=null!=a&&d.isVisibleOutside(a.getId());return b&&a&&null==c}mf(a){a=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a.getId());return a===p.TopicKind.Planet||
a===p.TopicKind.Stack}hj(a){const b=h.MouseInteractionType.Click;var c=a.filter((a)=>a.i.type===b||a.i.type===h.MouseInteractionType.DoubleClick),d=c.filter((a)=>a.i.type===b);c=c.filter((a)=>a.i.type===h.MouseInteractionType.DoubleClick);d=d.map((a)=>{const b=this.nb.getEntityForClickInEditMode(this.Ia(),this.camera,this.scene,a.i.event.stagePos,a.selection.selectionInfo.allEntityIds,a.i.type,null);return this.Mj(b,a.currentTopicId,a.coverEditMode)?{wa:b.getId(),selection:a.selection.selectionInfo.allEntityIds}:
{wa:null,selection:a.selection.selectionInfo.allEntityIds}}).filter((a)=>null!=a.wa);const e=new ab.eg(c,d,this.scene);e.xe.onValue(()=>e.al(this.ba,this.xa));this.Ib.plug(e.Ai(this.scene));d.onValue((a)=>{const b=this.scene.getEntityById(a.wa);this.xa.startCoverEditing(l.Cet.createHierarchyQuery(this.scene).getParentId(b),"CLICK-COVER-ITEM",[a.wa],t.CoverEditModeKind.titleEditOnly)});const f=l.Cet.createTopicChildrenQuery(this.scene);k.Bacon.combineWith((a,b)=>({selection:a.allEntityIds,coverEditMode:b}),
this.Ca,this.f.getCoverEditModeStream()).sampledBy(this.Ca).toEventStream().filter(({selection:a,coverEditMode:b})=>null==b?!1:a.some((a)=>b.kind!==t.CoverEditModeKind.insideAdvanced?!f.isVisibleOutside(a)&&a!==b.topicId:!f.isVisibleInside(a)&&a!==b.topicOrOverviewId)).onValue(()=>this.xa.stopCoverEditing("SELECT"));a.filter((a)=>null!=a.coverEditMode&&a.i.type===h.MouseInteractionType.Click).filter((a)=>{const b=l.Cet.createScreenBoundsCalculator(this.scene,this.camera);switch(a.coverEditMode.kind){case t.CoverEditModeKind.titleEditOnly:return a=
this.scene.getEntityById(a.fa),null==a||!this.Ia().queryableInTitleEditOnlyMode(a);case t.CoverEditModeKind.insideAdvanced:return null==a.fa;case t.CoverEditModeKind.advanced:return null==a.fa&&!b.getScreenAABBForEntities([a.coverEditMode.topicId],{topic:l.TopicBoundsOptions.zoomArea}).pointIsInside(a.i.event.stagePos);default:return D.Utils.assertNever(a.coverEditMode)}}).onValue((a)=>{this.xa.stopCoverEditing("CLICK");if(0<a.selection.selectionInfo.allEntityIds.length){a=l.Cet.createHierarchyQuery(this.scene).getParentId(this.scene.getEntityById(a.selection.selectionInfo.allEntityIds[0]));
const b=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a);p.TopicKind.Planet!==b&&p.TopicKind.Stack!==b||this.ba.select({selectedGroupIds:[],selectedEntityIds:[a],type:n.SelectActionType.replace})}})}wj(a){var b=a.filterWithStream(this.Sj.map((a)=>!a)).filter((a)=>a.i.type!==h.MouseInteractionType.Click);const c=b.filter((a)=>a.i.type===h.MouseInteractionType.HoverMove).map((a)=>a.i),d=b.filter((a)=>a.i.type===h.MouseInteractionType.Scroll&&!0!==(a.i.baseEvent||{shiftKey:!1}).shiftKey).map((a)=>
a.i);b=b.filter((a)=>a.i.type===h.MouseInteractionType.DragMove||a.i.type===h.MouseInteractionType.DragMoveRight||a.i.type===h.MouseInteractionType.DragEnd||a.i.type===h.MouseInteractionType.DragEndRight);b=k.Bacon.combineWith3((a,b,c)=>({mouse:a,ob:b,mode:c}),b,this.vd,this.f.getModeStream()).sampledBy(b).scan(null,(a,b)=>{const c=null===a||void 0===a?void 0:a.mouse.i.type;return null==c||c===h.MouseInteractionType.DragEnd||c===h.MouseInteractionType.DragEndRight?{mouse:b.mouse,ob:b.ob,mode:b.mode}:
{mouse:b.mouse,ob:a.ob,mode:a.mode}}).filter((a)=>{if(null==a)return!1;var b=a.mouse.i.type;if(G.isActive("js-unique-differentiation"))return a.mode.kind===A.EditorMode.edit&&a.mode.editingKind===t.EditingKind.drawInsert?!1:b===h.MouseInteractionType.DragMoveRight||b===h.MouseInteractionType.DragEndRight||a.ob&&(b===h.MouseInteractionType.DragMove||b===h.MouseInteractionType.DragEnd);{let c=null;(b=b===h.MouseInteractionType.DragMove||b===h.MouseInteractionType.DragEnd)&&(c=this.nb.getEntityUnderPointInEditMode(this.Ia(),
this.camera,this.scene,a.mouse.i.baseEvent.stagePos,!0,null!=a.mouse.selection?a.mouse.selection.selectionInfo.allEntityIds[0]:null));return(null==c&&!a.mouse.i.baseEvent.shiftKey||a.ob)&&b}}).map((a)=>a.mouse.i);a=a.filter((a)=>a.i.type===h.MouseInteractionType.Click&&this.isLogo(a.fa)).map((a)=>a.i);this.wk=k.Bacon.mergeAll([d,b,c,a])}isLogo(a){a=this.scene.getEntityById(a);return null!=a&&(a.isDef(w.CetModel.ID.LOGO)||a.isDef(w.CetModel.ID.NEXT_LOGO_V1))}kf(a){a=this.scene.getEntityById(a);if(null==
a)return!1;a=a.get(q.SelectionModule.getDecoratorKey());return null!=a&&1===a.ownerIds.length&&this.isLogo(a.ownerIds[0])}Vh(a){return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.OverviewMove,mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.baseEvent.stagePos,target:{kind:g.ActionTargetKind.implicit}}}Ge(a,b,c){if(0<a.length){const d=this.uc(a.map((a)=>this.scene.getEntityById(a)),b).map((a)=>a.getId());return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.ObjectMove,
mouseStagePosition:c.event.stagePos,originalMouseStagePosition:c.baseEvent.stagePos,target:{kind:g.ActionTargetKind.multiple,entityIds:a.slice()},entitiesToTransformInSync:d,currentTopicId:b}}return null}Wh(a,b,c){return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.TopicZoomAreaMove,mouseStagePosition:c.event.stagePos,originalMouseStagePosition:c.baseEvent.stagePos,target:{kind:g.ActionTargetKind.single,entityId:a},coTransformContent:this.xa.shouldCoTransformContent(b)}}Th(a,b,c,d,e,f){if(b.type===
q.ControlPointType.resize||b.type===q.ControlPointType.topicZoomAreaResize||b.type===q.ControlPointType.overviewResize)if(!V.Qa.za(e.baseEvent)||G.isActive("js-unique-differentiation")){let m;switch(b.position){case g.ControlPointPosition.TOP_LEFT:m=K.topLeft;break;case g.ControlPointPosition.TOP_RIGHT:m=K.topRight;break;case g.ControlPointPosition.BOTTOM_LEFT:m=K.bottomLeft;break;case g.ControlPointPosition.BOTTOM_RIGHT:m=K.bottomRight;break;default:throw D.Utils.assert(!1,"invalid controlpoint position");
}if(b.type===q.ControlPointType.resize)return b=this.uc(a.ownerIds.map((a)=>this.scene.getEntityById(a)),d).map((a)=>a.getId()),{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.Resize,resizeAnchor:m,isCenterResize:f,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.multiple,entityIds:a.ownerIds},entitiesToTransformInSync:b};if(b.type===q.ControlPointType.topicZoomAreaResize)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.TopicZoomAreaResize,
resizeAnchor:m,isCenterResize:f,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.single,entityId:a.ownerIds[0]},coTransformContent:this.xa.shouldCoTransformContent(c)};if(b.type===q.ControlPointType.overviewResize)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.OverviewResize,resizeAnchor:m,isCenterResize:f,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.implicit}}}else{if(b.type===
q.ControlPointType.resize)return f=this.uc(a.ownerIds.map((a)=>this.scene.getEntityById(a)),d).map((a)=>a.getId()),{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.Rotate,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.multiple,entityIds:a.ownerIds},entitiesToTransformInSync:f,draggedControlPointPosition:b.position}}else{if(b.type===q.ControlPointType.rotate)return f=this.uc(a.ownerIds.map((a)=>this.scene.getEntityById(a)),
d).map((a)=>a.getId()),{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.Rotate,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.multiple,entityIds:a.ownerIds},entitiesToTransformInSync:f,draggedControlPointPosition:b.position};if(1===a.ownerIds.length&&(b.type===q.ControlPointType.heightResize||b.type===q.ControlPointType.widthResize))return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.NonProportionalResize,isCenterResize:f,
mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.single,entityId:a.ownerIds[0]},isWidthResize:b.type===q.ControlPointType.widthResize};if(1===a.ownerIds.length&&b.type===q.ControlPointType.line){switch(b.position){case g.ControlPointPosition.MIDDLE_CENTER:b=K.center;break;case g.ControlPointPosition.MIDDLE_LEFT:b=K.centerLeft;break;case g.ControlPointPosition.MIDDLE_RIGHT:b=K.centerRight;break;default:throw D.Utils.assert(!1,"invalid controlpoint position");
}return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.ArcMove,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetKind.single,entityId:a.ownerIds[0]},dragArcAnchor:b}}}return null}lj(a){var b=this.ha.slidingWindow(2,2),c=this.Ua.map((a)=>V.Qa.Kj(a)).skipDuplicates().toProperty(!1);const d=this.Ua.map((a)=>V.Qa.td(a)).merge(this.ha.map((a)=>V.Qa.td(a.event))).skipDuplicates().toProperty(!1);var e=k.Bacon.combineWithA((a,b,c,d,e,f,
m,g)=>({Wb:a,selection:b.allEntityIds,textSelectionState:c,currentTopicId:d,coverEditMode:e,mode:f,isCenterResize:m,ud:g}),[b,this.f.getSelectionStream(),this.f.getTextSelectionStateStream(),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream(),this.f.getModeStream(),c,this.vd]).sampledBy(b);b=e.filter(({mode:a})=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.drawInsert).filter(({Wb:a})=>{const [b,c]=a;return b.type!==h.MouseInteractionType.DragMove&&c.type===h.MouseInteractionType.DragMove}).map((a)=>
{a=a.Wb[1];return{kind:g.ActionKind.Start,mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.baseEvent.stagePos,startKind:g.DragActionStartKind.DrawInsert,target:{kind:g.ActionTargetKind.implicit}}});const f=e.filter(({mode:a})=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.imageMask).filter(({Wb:a})=>{const [b,c]=a;return b.type!==h.MouseInteractionType.DragMove&&c.type===h.MouseInteractionType.DragMove}).map(({Wb:a,coverEditMode:b,mode:c})=>{a=a[1];b=this.nb.getEntityForDragStartInEditMode(this.Ia(),
this.camera,this.scene,a.baseEvent.stagePos,null==b,null);const d=null!=b?b.get(q.SelectionModule.getDecoratorKey()):null;if(null!=d)if(d.interactionType===q.InteractionType.controlPoint){c=b.get(q.SelectionModule.getControlPointKey());if(null!=c&&c.type===q.ControlPointType.resizeMaskImage)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskImageResize,resizeAnchor:this.We(b.get(q.SelectionModule.getControlPointKey())),mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,
target:{kind:g.ActionTargetKind.single,entityId:d.ownerIds[0]}};if(null!=c&&c.type===q.ControlPointType.resizeMaskArea)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskAreaResize,resizeAnchor:this.Xe(b.get(q.SelectionModule.getControlPointKey())),mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetKind.single,entityId:d.ownerIds[0]}};if(null!=c&&(c.type===q.ControlPointType.heightResizeMaskArea||c.type===q.ControlPointType.widthResizeMaskArea))return{kind:g.ActionKind.Start,
startKind:g.DragActionStartKind.MaskAreaNonProportionalResize,resizeAnchor:this.Xe(b.get(q.SelectionModule.getControlPointKey())),mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetKind.single,entityId:d.ownerIds[0]},isWidthResize:c.type===q.ControlPointType.widthResizeMaskArea}}else if(d.interactionType===q.InteractionType.maskDrag||d.interactionType===q.InteractionType.border||d.interactionType===q.InteractionType.clickable)return(d.interactionType===
q.InteractionType.clickable?c.target===t.MaskEditTarget.image?t.MaskEditTarget.mask:t.MaskEditTarget.image:c.target)===t.MaskEditTarget.image?{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskImageMove,mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetKind.single,entityId:d.ownerIds[0]}}:{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskAreaMove,mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,
target:{kind:g.ActionTargetKind.single,entityId:d.ownerIds[0]}};return null}).filter((a)=>null!=a).toEventStream();e=e.filter(({mode:a,ud:b})=>a.kind===A.EditorMode.edit&&a.editingKind===t.EditingKind.normal&&!b).map(({Wb:a,selection:b,textSelectionState:c,currentTopicId:d,coverEditMode:e,isCenterResize:f})=>{const [m,g]=a;if(m.type!==h.MouseInteractionType.DragMove&&g.type===h.MouseInteractionType.DragMove){a=null!=c&&c.isEditing()?b[0]:null;a=this.nb.getEntityForDragStartInEditMode(this.Ia(),this.camera,
this.scene,g.baseEvent.stagePos,null==e,a);var y=null!=a?a.get(q.SelectionModule.getDecoratorKey()):null;if(null!=y)switch(y.interactionType){case q.InteractionType.border:if(g.baseEvent.shiftKey)break;if(1===y.ownerIds.length&&p.CetModelEditor.isOverview(y.ownerIds[0],this.scene))return this.Vh(g);b=this.Pe(y.ownerIds.map((a)=>this.scene.getEntityById(a))).map((a)=>a.getId());return this.Ge(b,d,g);case q.InteractionType.topicZoomAreaBorder:return g.baseEvent.shiftKey?null:this.Wh(y.ownerIds[0],e,
g);case q.InteractionType.controlPoint:if(G.isActive("js-unique-differentiation")||!g.baseEvent.shiftKey)return this.Th(y,a.get(q.SelectionModule.getControlPointKey()),e,d,g,f);break;case q.InteractionType.locked:case q.InteractionType.clickable:case q.InteractionType.maskDrag:case q.InteractionType.none:break;default:D.Utils.assertNever(y.interactionType)}else if(!g.baseEvent.shiftKey){f=this.lf(b,g.baseEvent.stagePos,d);y=l.Cet.createHierarchyQuery(this.scene).getParentId(a);const m=this.Kb(e);
null==e||f||null==a||m===a.getId()||y===m&&e.kind!==t.CoverEditModeKind.titleEditOnly||(e=this.scene.getEntityById(y),p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(y)!==p.TopicKind.None&&(a=e),this.xa.stopCoverEditing("DRAG"));b=this.Kk(a,b,c,f).filter((a)=>!p.CetModelEditor.isLocked(a.getId(),this.scene)).map((a)=>a.getId());return this.Ge(b,d,g)}}return null}).filter((a)=>null!=a).toEventStream();const m=this.ha.filter((a)=>a.type===h.MouseInteractionType.DragEnd).map(()=>({kind:g.ActionKind.Finish}));
this.Xb=k.Bacon.mergeAll([b.map((a)=>a.startKind),e.map((a)=>a.startKind),f.map((a)=>a.startKind),m.map(()=>null)]).toProperty(null);const y=this.ha.filter((a)=>a.type===h.MouseInteractionType.DragMove);var n=k.Bacon.mergeAll([c.toEventStream(),d.toEventStream()]).filterWithStream(this.ha.map((a)=>a.type===h.MouseInteractionType.DragMove).toProperty(!1));n=k.Bacon.mergeAll([y,n.map(()=>null),this.sb.filter((a)=>a.kind===H.drag)]).filterWithStream(this.Xb.map((a)=>null!=a));c=k.Bacon.combineWith5((a,
b,c,d,e)=>({stagePosition:a.event.stagePos,isCenterResizeKeyPressed:b,isSnapDisableKeyPressed:c,isTopicNestingDisableKeyPressed:c,sk:d,uk:e}),y,c,d,this.sb.toProperty({kind:H.finish,o:{x:0,y:0}}),this.Xb).sampledBy(n).map((a)=>{const b=this.ie(a.uk)?a.sk.o:{x:0,y:0};return{kind:g.ActionKind.Step,stagePosition:{x:a.stagePosition.x+b.x,y:a.stagePosition.y+b.y},isCenterResizeKeyPressed:a.isCenterResizeKeyPressed,isSnapDisableKeyPressed:a.isSnapDisableKeyPressed,isTopicNestingDisableKeyPressed:a.isTopicNestingDisableKeyPressed}}).toEventStream();
this.Sj=k.Bacon.mergeAll([b.map(()=>"entityDrag"),e.map(()=>"entityDrag"),f.map(()=>"entityDrag"),this.ha.filter((a)=>a.type!==h.MouseInteractionType.DragMove).map((a)=>a.type===h.MouseInteractionType.DragEnd?"dragEnd":"noEntityDrag")]).scan("noEntityDrag",(a,b)=>"entityDrag"===a&&"noEntityDrag"===b?"entityDrag":"entityDrag"===a&&"dragEnd"===b?"dragEnd":"noEntityDrag"===a&&"dragEnd"===b?"noEntityDrag":b).map((a)=>"noEntityDrag"!==a).toProperty(!1);this.Ta=k.Bacon.mergeAll([b,e,c,m,f,a])}ie(a){switch(a){case g.DragActionStartKind.ArcMove:case g.DragActionStartKind.MaskAreaMove:case g.DragActionStartKind.MaskAreaNonProportionalResize:case g.DragActionStartKind.MaskAreaResize:case g.DragActionStartKind.MaskImageMove:case g.DragActionStartKind.MaskImageResize:case g.DragActionStartKind.OverviewMove:case g.DragActionStartKind.OverviewResize:case g.DragActionStartKind.PlaceholderMove:case g.DragActionStartKind.TopicZoomAreaMove:case g.DragActionStartKind.TopicZoomAreaResize:case g.DragActionStartKind.Rotate:return!1;
case g.DragActionStartKind.NonProportionalResize:case g.DragActionStartKind.ObjectMove:case g.DragActionStartKind.Resize:case g.DragActionStartKind.DrawInsert:return!0;default:D.Utils.assertNever(a)}}rf(a,b,c,d,e,f=!1){b=b.filter((a)=>null!=a);const m=(a,b,c,d,e)=>{const f=a.allEntityIds,m=e.event.stagePos;var g=e.event.onCanvas;const y=null!=b&&b.isEditing()?f[0]:null;g=e.type===h.MouseInteractionType.HoverMove?this.nb.getEntityForHoverInEditMode(this.Ia(),this.camera,this.scene,m,f,g,b):this.nb.getEntityForClickInEditMode(this.Ia(),
this.camera,this.scene,m,f,e.type,y);return{i:e,fa:null===g||void 0===g?void 0:g.getId(),Fb:null===g||void 0===g?void 0:g.get(q.SelectionModule.getDecoratorKey()),ve:null===g||void 0===g?void 0:g.get(q.SelectionModule.getControlPointKey()),selection:{selectionInfo:a,zc:this.lf(f,m,c)},textSelectionState:b,currentTopicId:c,coverEditMode:d}},g=k.Bacon.combineWith5(m,b,c,d,e,a).sampledBy(a);return f?g.merge(k.Bacon.combineWith5(m,b,c,d,e,a.map((a)=>Object.assign(Object.assign({},a),{type:h.MouseInteractionType.HoverMove}))).sampledBy(b.toEventStream().map(()=>
!0).merge(e.toEventStream().map(()=>!0)).merge(d.toEventStream().map(()=>!0)).merge(c.toEventStream().map(()=>!0)))).toEventStream():g.toEventStream()}Kk(a,b,c,d){let e;if(null!=a){e=[a];const f=-1<b.indexOf(a.getId());c=null!=c&&c.isEditing();f&&!c?e=b.map((a)=>this.scene.getEntityById(a)).filter((a)=>null!=a):c&&(f||d)?e=[]:f||(e=[this.scene.getEntityById(a.getId())])}else e=d?b.map((a)=>this.scene.getEntityById(a)).filter((a)=>null!=a):[];return this.Pe(e.filter((a)=>null!=a))}Tf(a,b){const c=
l.Cet.createHierarchyQuery(this.scene);return l.Cet.createTopicChildrenQuery(this.scene).isVisibleOutside(b.getId())&&c.getParentOrOverview(a)!==c.getParentOrOverview(b)}Pe(a){const b=a.map((a)=>a.getId()),c=p.CetModelEditor.createEntityQuery(this.scene),d=l.Cet.createHierarchyQuery(this.scene),e=[];for(let g=0;g<a.length;++g)if(!p.CetModelEditor.isLocked(a[g].getId(),this.scene)&&a[g].isDef(w.CetModel.ID.CONNECTOR)){var f=c.getConnectorTail(a[g]),m=this.scene.getEntityById(f);null!=f&&-1===b.indexOf(f)&&
(this.Tf(a[g],m)?e.push(this.scene.getEntityById(d.getParentId(m))):e.push(m));f=c.getConnectorHead(a[g]);m=this.scene.getEntityById(f);null!=f&&-1===b.indexOf(f)&&(this.Tf(a[g],m)?e.push(this.scene.getEntityById(d.getParentId(m))):e.push(m))}return a.concat(e)}uc(a,b){const c=l.Cet.createTopicChildrenQuery(this.scene),d=l.Cet.createHierarchyQuery(this.scene),e=d.getAncestorEntities(b).concat(b);var f=a.filter((a)=>c.hasBehavior(a.getId(),l.TopicChildBehavior.Visual)&&0<=e.indexOf(c.getBehaviorReferer(a.getId(),
l.TopicChildBehavior.Visual)));a=a.filter((a)=>c.hasBehavior(a.getId(),l.TopicChildBehavior.Surface)&&0<=e.indexOf(c.getBehaviorReferer(a.getId(),l.TopicChildBehavior.Surface)));f=[...f,...a];f=0<f.length?c.getChildReferer(f[0].getId()):null;return null!=f&&(a=this.scene.getEntityById(f),d.getParentOrOverview(a)!==b)?c.getChildrenIds(f,l.TopicChildBehavior.Cover).map((a)=>this.scene.getEntityById(a)):[]}Kb(a){if(null==a)return null;switch(a.kind){case t.CoverEditModeKind.advanced:case t.CoverEditModeKind.titleEditOnly:return a.topicId;
case t.CoverEditModeKind.insideAdvanced:return a.topicOrOverviewId;default:D.Utils.assertNever(a)}}Gi(){const a=this.Ca.map((a)=>a.allEntityIds.filter((a)=>{a=this.va.scene.getEntityById(a);return null!=a&&l.Cet.hasPdomComponent(a)&&l.Cet.hasZOrder(a)})),b=this.Ua.map((a)=>"keyup"===a.type&&(a.keyCode===h.Key.BACKSPACE||a.keyCode===h.Key.DELETE)).filter((a)=>a);k.Bacon.combineWith4((a,b,e,f)=>({entityIds:a,event:b,currentTopicId:e,coverEditMode:f}),a,this.Ua,this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream()).sampledBy(b).filter(({entityIds:a})=>
0<a.length&&!a.some((a)=>p.CetModelEditor.isLocked(a,this.scene))).onValue(({entityIds:a,event:b,currentTopicId:e,coverEditMode:f})=>{1===a.length&&null!=f&&this.Kb(f)===a[0]||null==f&&e===a[0]?this.ba.select({selectedGroupIds:[],selectedEntityIds:[],type:n.SelectActionType.replace}):this.va.executeApiCommand(this.va.action.deleteObjectCmd(a,b.keyCode===h.Key.BACKSPACE?"KEY_BACKSPACE":"KEY_DEL"))})}lf(a,b,c){var d=a.filter((a)=>{const b=this.scene.getEntityById(a);return null!=b&&null!=b.get(w.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD)&&
a!==c});if(0===d.length)return!1;b=this.camera.screenPointToWorld(b);a=l.Cet.createScreenBoundsCalculator(this.scene,this.camera);if(1<d.length)return a.getWorldBBForEntitiesScreenAxisAligned(d).containsPoint(b);{const c=this.scene.getEntityById(d[0]);if(this.mf(c))return a.getWorldBoundsForInteraction(c.getId()).getObb().containsPoint(b);d=l.Cet.transform(c).getWorldToLocal();a=a.getLocalBoundsForHittest(c);b=d.transformPoint(b);return a.pointIsInside(b)}}Gf(a,b){const c=()=>{const b=this.scene.getEntityById(a).get(q.SelectionModule.getDecoratorKey());
return null!=b&&b.interactionType===q.InteractionType.border};return null!=a&&1===b.length&&c()?b[0]:a}Gh(a){return a.filter((a)=>a.i.type===h.MouseInteractionType.DoubleClick).map((a)=>{const b=this.Gf(a.fa,a.selection.selectionInfo.allEntityIds);return{currentTopicId:a.currentTopicId,entity:this.scene.getEntityById(b)}})}Eh(a){return a.filter((a)=>a.i.type===h.MouseInteractionType.DoubleClick&&!p.CetModelEditor.isPage(a.currentTopicId,this.scene)).map((a)=>{const b=this.Gf(a.fa,a.selection.selectionInfo.allEntityIds);
return Object.assign(Object.assign({},a),{Eb:this.scene.getEntityById(b)})}).filter((a)=>{a=a.Eb;return null==a||null!=a.get(q.SelectionModule.getDecoratorKey())?!1:!0}).map((a)=>{const b=this.mb.getGroupIdFromEntity(this.scene,a.Eb);var d=a.selection.selectionInfo.nonGroupedEntityIds;d=1===d.length&&d[0]===a.Eb.getId();return Object.assign(Object.assign({},a),{action:null==b||d?ha.Sd:ha.Oc})}).filter((a)=>{if(a.action===ha.Oc)return!0;const b=a.Eb;var d=0<a.selection.selectionInfo.allEntityIds.length;
if(null!=a.coverEditMode&&a.coverEditMode.kind===t.CoverEditModeKind.titleEditOnly)return!1;if(null!=a.coverEditMode&&!d)if(d=l.Cet.createTopicChildrenQuery(this.scene),null!=b.getId()){if(-1<d.getChildrenIds(this.Kb(a.coverEditMode),l.TopicChildBehavior.Cover).indexOf(b.getId()))return!0}else return!1;return null!=b&&!w.CetModel.textKludge.isEntityText(b)&&b.getDef()!==w.CetModel.ID.Z_ARROW&&b.getDef()!==w.CetModel.ID.Z_LINE}).map((a)=>({action:a.action,entity:a.Eb}))}Ni(a,b,c){const d=(a)=>a===
h.MouseInteractionType.HoverMove||this.isClick(a);k.Bacon.combineWith3((a,b,c)=>({event:a,Ed:c}),a.filter((a)=>d(a.i.type)),b.toProperty(!0),c).toEventStream().map(({event:a,Ed:b})=>{if("contextMenuPopup"===b)return null;b=a.fa;if(null!=b&&(this.isLogo(b)||this.kf(b)))return b;var c=this.Kb(a.coverEditMode);let d=null;var e=this.scene.getEntityById(b);null==e||a.i.type!==h.MouseInteractionType.HoverMove||p.CetModelEditor.isLocked(e.getId(),this.scene)||(e=a.selection.selectionInfo.allEntityIds,d=
W.Za.pb(b,a.currentTopicId,a.coverEditMode,e,this.scene)&&b!==c?b:null,null==d&&(d=this.vi(b,a.coverEditMode,this.scene),null==d&&G.isActive("js-unique-differentiation")&&null!==a.Fb&&0<a.Fb.ownerIds.length&&a.Fb.ownerIds[0]===this.scene.getPreziW().getOverview().getId()&&(d=a.Fb.ownerIds[0])),c=1===e.length?this.scene.getEntityById(e[0]):null,null!=c&&this.mf(c)&&null==d&&W.Za.pb(b,a.currentTopicId,{kind:t.CoverEditModeKind.titleEditOnly,topicId:e[0]},e,this.scene)&&(d=b));return d}).skipDuplicates().onValue((a)=>
{this.f.setCanvasHoveredEntityIds(null==a?[]:[a]);this.pluginAccess.send(u.pathEditing,{kind:"hover",canvasElementId:a})})}Ii(a,b,c){let d=null,e=!1;k.Bacon.combineWith3((a,b,c)=>({event:a,Ed:c}),a,b.toProperty(!0),c).toEventStream().map(({event:a,Ed:b})=>{if("contextMenuPopup"===b)return{};b=a.selection.selectionInfo.allEntityIds;return 1!==b.length?{}:{event:a,hh:b[0]}}).onValue(({event:a,hh:b})=>{d!==b&&(l.Cet.sendEvent(this.scene,d,{kind:Z.DrawComponentMouseEventWithoutPositionKind.Deactivate}),
l.Cet.sendEvent(this.scene,b,{kind:Z.DrawComponentMouseEventWithoutPositionKind.Activate}),d=b,e=!1);if(null!=b){var c=b===a.fa;if(c){const c=this.camera.screenPointToWorld(a.i.event.stagePos);l.Cet.sendEvent(this.scene,b,{kind:Z.DrawComponentMouseEventKindWithPosition.Move,worldX:c.x,worldY:c.y,isEntering:!e,isClick:a.i.type===h.MouseInteractionType.Click})}else e&&l.Cet.sendEvent(this.scene,b,{kind:Z.DrawComponentMouseEventWithoutPositionKind.Leave});e=c}})}static pb(a,b,c,d,e){const f=e.getEntityById(a),
g=l.Cet.createHierarchyQuery(e),h=l.Cet.createTopicChildrenQuery(e);if(null==f||!l.Cet.hasPdomComponent(f)||a===b&&p.CetModelEditor.isPlanetOrStack(a,e)||p.CetModelEditor.isPage(f.getId(),e))return!1;if(g.getParentOrOverview(f)===b&&h.hasBehavior(f.getId(),l.TopicChildBehavior.Content))return!0;b=null!=c&&c.kind===t.CoverEditModeKind.titleEditOnly?c.topicId:1===d.length?d[0]:null;return h.getBehaviorReferer(f.getId(),l.TopicChildBehavior.Cover)===b&&w.CetModel.textKludge.isEntityText(f)?!0:null!=
c&&c.kind===t.CoverEditModeKind.advanced?h.getChildReferer(a)===c.topicId&&h.isVisibleOutside(a):null!=c&&c.kind===t.CoverEditModeKind.insideAdvanced?h.getChildReferer(a)===c.topicOrOverviewId&&h.isVisibleInside(a):!1}vi(a,b,c){a=c.getEntityById(a);if(null==b)return null;switch(b.kind){case t.CoverEditModeKind.advanced:case t.CoverEditModeKind.insideAdvanced:a=a.get(q.SelectionModule.getDecoratorKey());b=this.Kb(b);if(null!=a&&a.interactionType===q.InteractionType.clickable&&-1!==a.ownerIds.indexOf(b))return b;
break;case t.CoverEditModeKind.titleEditOnly:break;default:D.Utils.assertNever(b)}return null}Ia(){return this.scene.getPrezi().get(p.CetModelEditor.getStageQueryKey())}Kh(a,b){a=a.filter((a)=>a.kind!==g.ActionKind.Step).map((a)=>a.kind!==g.ActionKind.Finish);return k.Bacon.combineWith((a,b)=>a?Q.ComponentFocusActionKind.enterCanvas:null!=b&&b.isSingleSelection()?Q.ComponentFocusActionKind.enterTextEditor:Q.ComponentFocusActionKind.exitAll,a,b).sampledBy(a)}Xi(a){this.Jd.filter((a)=>{a=a.actions;
return-1!==a.indexOf(h.ShortcutAction.UNDO)||-1!==a.indexOf(h.ShortcutAction.REDO)}).onValue((b)=>{b.event.preventDefault();-1!==b.actions.indexOf(h.ShortcutAction.UNDO)?a.undo(I.UndoRedoRequestTrigger.keyboard):a.redo(I.UndoRedoRequestTrigger.keyboard)});const b=k.Bacon.newBus();this.f.addChangeEditingKindStream(b);a.getUndoRedoStream().onValue(()=>{this.xa.fixCoverSelection();b.push({kind:A.EditorMode.edit,editingKind:t.EditingKind.normal})})}};var ya={},Cb=this&&ya.ib||function(a,b,c,d){function e(a){return a instanceof
c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{h(d.next(a))}catch(B){g(B)}}function m(a){try{h(d["throw"](a))}catch(B){g(B)}}function h(a){a.done?c(a.value):e(a.value).then(f,m)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(ya,"__esModule",{value:!0});ya.xg=class{static pj(a){return Cb(this,void 0,void 0,function*(){if(G.isActive("js-load-external-plugin-from-localhost")){var b=yield(yield fetch("http://localhost:9080/plugin_config.json")).json(),
c=yield Promise.all(b.sourceFiles.map((a)=>new Promise((b)=>Cb(this,void 0,void 0,function*(){const c=yield(yield fetch(`http://localhost:9080/${a}`)).text();b({path:`/${a}`,content:c})})))),d=yield Jb.TypeCollector.loadAllLibs();c=yield Kb.TypescriptCompiler.compile(d,c);d=window.btoa(c.mapping.replace(/"..\//g,'"http://localhost:9080/'));var e=yield eval(`${c.compiled};
			new Promise(resolve => {
    			require(["index"], module =>resolve(module));
			});
		//# sourceMappingURL=data:application/json;base64,${d}
		`);yield a.registerPlugin({pluginDescriptionKind:z.PluginDescriptionKind.regular,name:b.name,supportsOffline:z.SupportsOffline.none,supportsPlaybackMode:!1,shortcuts:{}},()=>Promise.resolve({createPlugin(){return new e.MainPlugin}}))}})}};var la={},bb=this&&la.ib||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{h(d.next(a))}catch(B){g(B)}}function m(a){try{h(d["throw"](a))}catch(B){g(B)}}function h(a){a.done?
c(a.value):e(a.value).then(f,m)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(la,"__esModule",{value:!0});la.Mc=class{static yj(a){return bb(this,void 0,void 0,function*(){G.isActive("js-plugin-e2e-run")||(yield Promise.all([a.registerReadonlyPlugin(u.downloadPresentation,Zb),a.registerReadonlyPlugin(u.exportToPdf,cc),a.registerReadonlyPlugin(u.engagementToolsHelper,ac)]))})}static init(a){return bb(this,void 0,void 0,function*(){G.isActive("js-plugin-e2e-run")?yield Promise.all([a.registerPlugin(u.testPropertybar,
vb),a.registerPlugin(u.testSidebar,wb),a.registerPlugin(u.testNavigationbar,ub),a.registerPlugin(u.pathEditing,sb),a.registerPlugin(u.style,tb)]):yield Promise.all([a.registerPlugin(u.aboutBox,Lb),a.registerPlugin(u.pathAudio,uc),a.registerPlugin(u.arConvert,Nb),a.registerPlugin(u.viewToDashboardTest,Rc),a.registerPlugin(u.brandColors,Sb),a.registerPlugin(u.chartInsert,Tb),a.registerPlugin(u.classicImport,Ub),a.registerPlugin(u.dashedLine,Wb),a.registerPlugin(u.debug,Xb),a.registerPlugin(u.depthOfField,
Yb),a.registerPlugin(u.favorites,ec),a.registerPlugin(u.classicToNextOnboarding,Vb),a.registerPlugin(u.fontAdmin,gc),a.registerPlugin(u.fontPreview,hc),a.registerPlugin(u.fontSelector,ic),a.registerPlugin(u.grouping,kc),a.registerPlugin(u.bracketFrame,Rb),a.registerPlugin(u.assets,Qb),a.registerPlugin(u.markerEditor,qc),a.registerPlugin(u.narrativeEditor,rc),a.registerPlugin(u.layout,nc),a.registerPlugin(u.pathGenerationStrategy,vc),a.registerPlugin(u.photoEditor,wc),a.registerPlugin(u.alignmentTools,
Mb),a.registerPlugin(u.pptInsert,yc),a.registerPlugin(u.pptEdit,xc),a.registerPlugin(u.searchReplace,Bc),a.registerPlugin(u.selectSimilar,Cc),a.registerPlugin(u.extendedSelection,dc),a.registerPlugin(u.equationEditor,bc),a.registerPlugin(u.shapeAndArcEditor,Dc),a.registerPlugin(u.solidColor,Fc),a.registerPlugin(u.style,tb),a.registerPlugin(u.storyblocks,Gc),a.registerPlugin(u.storyblocksAdmin,Hc),a.registerPlugin(u.syntaxHighlight,Ic),a.registerPlugin(u.testNavigationbar,ub),a.registerPlugin(u.testPropertybar,
vb),a.registerPlugin(u.testSidebar,wb),a.registerPlugin(u.textEditor,Kc),a.registerPlugin(u.topicNestingOnboarding,Lc),a.registerPlugin(u.preziVideoOnboarding,zc),a.registerPlugin(u.topicShape,Mc),a.registerPlugin(u.snippetEditingLayout,Ec),a.registerPlugin(u.videoBackground,Oc),a.registerPlugin(u.videoInsert,Pc),a.registerPlugin(u.visualTypes,Sc),a.registerPlugin(u.qrCodeInsert,Ac),a.registerPlugin(u.zOrderObject,Tc),a.registerPlugin(u.arVideoTemplateTools,Ob),a.registerPlugin(u.templateFromStoryblocks,
Jc),a.registerPlugin(u.videoTemplateFromFigma,Qc),a.registerPlugin(u.pathEditing,sb),a.registerPlugin(u.navigation,sc),a.registerPlugin(u.turnIntoTopic,Nc),a.registerPlugin(u.editorMode,$b),a.registerPlugin(u.filePickerIntegrations,fc),a.registerPlugin(u.hyperlink,Pb),a.registerPlugin(u.parallaxBackground,tc),a.registerPlugin(u.interatcionMode,mc),a.registerPlugin(u.lockObjects,pc),a.registerPlugin(u.hamburgerMenuImprovements,lc),a.registerPlugin(u.frameInsert,jc)])})}static oj(a){return bb(this,
void 0,void 0,function*(){return ya.xg.pj(a)})}};var sa={};Object.defineProperty(sa,"__esModule",{value:!0});sa.Jc=class{constructor(a,b){this.Vf=a;this.scene=b}Te(a,b,c=0){const d=this.Vf.getCamera();var e=l.Cet.createBoundsCalculator(this.scene),f=d.getTargetTransform().invert();f=M.Geometry.obbFromRect(d.getMarginCorrectedStageArea().getData()).transform(f);const g=M.Geometry.transform2dFromRad({x:0,y:0},1,f.getRotationRadians());a=e.getUnionWorldBoundsAlignedToReference(g,a,l.TextBoundsOptions.TextBox).getObb();
e=c/d.getStageArea().getWidth();c/=d.getStageArea().getHeight();c=f.union(a.inflateXY(a.getWidth()*e,a.getHeight()*c));if(c.equalsWithin(f,Math.pow(2,-30)))new Promise((a)=>a());else{f=M.Geometry.transform2dFromRad({x:-c.getCenterX(),y:-c.getCenterY()},1,0).concat(M.Geometry.transform2dFromRad({x:0,y:0},1,c.getRotationRadians())).concat(M.Geometry.transform2dFromRad({x:c.getCenterX(),y:c.getCenterY()},1,0));const a=this.Vf.flyToRectangle(c.setRotation(0).getBounds(),f,1,b,d.getMarginCorrectedStageArea());
new Promise((b)=>a.onEnd(()=>b()))}}};var za={},Db=this&&za.ib||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{m(d.next(a))}catch(B){g(B)}}function h(a){try{m(d["throw"](a))}catch(B){g(B)}}function m(a){a.done?c(a.value):e(a.value).then(f,h)}m((d=d.apply(a,b||[])).next())})};Object.defineProperty(za,"__esModule",{value:!0});za.tg=class{constructor(a,b,c,d,e,f,g,h,l,p,n,q,r,t,u,v){this.Me=c;this.ke=d;this.f=
e;this.$k=q;this.va=r;this.Nk=t;this.Ha=u;this.eb=v;d=new sa.Jc(a,c);this.Cc=new W.Za(b,c,a.getCamera(),e,f,g,new oa.Ic(c,e,f,this.va,this.va.cover,d),h,l,p,n,ba.PlaybackModule.createInteractionQuery(),this.va,u.getDragStream(),v.pluginAccess,v.applicationController);e.addComponentFocusStream(this.Cc.getFocusStream());e.addHighlightEntitiesOnDragSelectActionStream(this.Cc.getHighlightEntitiesOnDragSelectActionStream());this.ci=k.Bacon.newBus()}xj(){return Db(this,void 0,void 0,function*(){return new Promise((a)=>
{let b=null,c=null;this.f.getUserHasEditRightsStream().onValue((d)=>Db(this,void 0,void 0,function*(){null==c&&null==b&&G.isActive("js-use-local-mocks")&&(yield oc()).registerMocks(this.eb);d&&null==c&&(c=Promise.all([la.Mc.init(this.eb.applicationController),la.Mc.oj(this.eb.applicationController)]));null==b&&(b=la.Mc.yj(this.eb.applicationController));null!=c&&null!=b&&Promise.all([c,b]).then(()=>a())}))})})}resetPlugins(){this.eb.applicationController.resetPlugins();return this.xj()}getOutputInteractionStream(){return this.Cc.getOutputInteractionStream()}getScene(){return this.Me}getZObjectEditor(){return this.va}getApplicationController(){return this.eb.applicationController}getAnimationScene(){return this.ke}getUpdatableAnimationScene_KILLME(){return this.ke}reset(a){a&&
this.Me.reset(!1)}getObjectEditor(){return this.Cc}addAnimationTopicStateChangeStream(a){this.$k.plug(a)}getErrorValueStream(){return this.ci}getCurrentSelectionDecorators(){return this.Nk.getCurrentDecorators()}getDragPlaceholderController(){return this.Ha}getPluginAccess(){return this.eb.pluginAccess}};var cb={};Object.defineProperty(cb,"__esModule",{value:!0});cb.ag=class{constructor(a,b,c,d,e,f,g,h,l){this.bc=a;this.playback=b;this.ac=c;this.Yh=d;this.Ma=e;this.Zh=f;this.store=g;this.dd=h;this.vc=
l;this.store.getModeStream().slidingWindow(2,1).onValue((a)=>this.Qi(a));this.zj();this.Tk()}Qi(a){switch(a[a.length-1].kind){case A.EditorMode.view:case A.EditorMode.playback:this.setScene(this.ac,this.ac);a[0].kind===A.EditorMode.info?this.playback.resumeFromInfo():this.playback.resume();break;case A.EditorMode.animationPreview:this.setScene(this.ac,this.ac);break;case A.EditorMode.edit:this.setScene(this.Yh,this.Ma)}}setScene(a,b){this.bc.getMainStage().setScene(a,b)}zj(){const a=this.store.getModeStream().map((a)=>
{switch(a.kind){case A.EditorMode.view:case A.EditorMode.playback:case A.EditorMode.animationPreview:return this.ac;case A.EditorMode.edit:return this.Ma;default:return this.Ma}});this.playback.setSceneStream(a);this.playback.setEntityChangeStream(this.bc.getBaseScene().getImmediateChangeStream(l.ChangeEventKind.Entity))}Tk(){const a=k.Bacon.combineWith((a,b)=>{if(null==b)return{currentTopicId:a,Db:null};switch(b.kind){case t.CoverEditModeKind.advanced:case t.CoverEditModeKind.titleEditOnly:return{currentTopicId:a,
Db:b.topicId};case t.CoverEditModeKind.insideAdvanced:return{currentTopicId:a,Db:b.topicOrOverviewId};default:D.Utils.assertNever(b)}},this.store.getCurrentTopicStream(),this.store.getCoverEditModeStream()),b=G.isActive("js-unique-differentiation")?this.vc:this.store.getSelectionStream().map((a)=>a.allEntityIds);a.combineAndSample(({currentTopicId:a,Db:b},e)=>({currentTopicId:a,Db:b,selectedIds:e}),b).sampledBy(this.bc.getEndOfFrameStream()).skipDuplicates().onValue(({currentTopicId:a,Db:b,selectedIds:e})=>
this.ji(a,b,e))}ji(a,b,c){if(!G.isActive("js-for-test-no-fly-to-selection")){var d=c.filter((a)=>{a=this.Ma.getEntityById(a);return null!=a&&null!=l.Cet.world(a)});null!=d&&0!==d.length&&(b=this.Ik(d,a,b),c=this.Zh.getCurrentSelectionDecorators().filter((a)=>{a=this.Ma.getEntityById(a);if(null==a)return!1;a=a.get(q.SelectionModule.getDecoratorKey());return null==a?!1:a.ownerIds.some((a)=>-1!==d.indexOf(a))}),b=b.concat(c),this.dd.Te(b,a))}}Ik(a,b,c){let d=[];const e=l.Cet.createTopicChildrenQuery(this.Ma),
f=p.CetModelEditor.createTopicQuery(this.Ma);1===a.length&&null===c&&a[0]===b?(a=a[0],d=G.isActive("js-unique-differentiation")&&a===this.Ma.getPreziW().getOverview().getId()?[a]:[a,...e.getChildrenIds(a,l.TopicChildBehavior.Content)]):a.forEach((a)=>{const b=this.Ma.getEntityById(a);f.isTopic(b)?d=[...d,...e.getChildrenIds(b.getId(),l.TopicChildBehavior.Cover),...e.getChildrenIds(b.getId(),l.TopicChildBehavior.Visual),...e.getChildrenIds(b.getId(),l.TopicChildBehavior.Surface)]:null!=c&&(e.hasBehavior(a,
l.TopicChildBehavior.Visual)||e.hasBehavior(a,l.TopicChildBehavior.Surface))&&e.getChildReferer(a)===c?(d.push(a),-1===d.indexOf(c)&&d.push(c)):d.push(a)});return d}};var db={};Object.defineProperty(db,"__esModule",{value:!0});db.yg=class{constructor(a,b,c){this.scene=a;this.mainStage=b;this.playback=c;this.logger=E.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.FlyToEntityActionExecutor");this.Ub=A.AppUtilsModule.getLogHelperUtils()}execute(a){if(null==a)this.mainStage.flyToOverview(),
this.Ub.canvasZoom(this.logger,A.ZoomToObjectLogTrigger.DOUBLECLICK,{actionIndex:this.playback.getCurrentActionIndex(),stepIndex:this.playback.getCurrentStepIndex(),totalStepNumber:this.playback.getStepCount()});else{if(p.CetModelEditor.isPlanetOrStack(a.getId(),this.scene)){const b=p.CetModelEditor.getPagesOfChapter(a.getId(),this.scene);a=0<b.length?this.scene.getEntityById(b[0]):a}null==a||p.CetModelEditor.isLogo(a.getId(),this.scene)||(this.playback.flyToObject(a.getId()),this.Ub.zoomToObject(p.CetModelEditor.createLogHelper(this.scene),
this.logger,A.ZoomToObjectLogTrigger.DOUBLECLICK,a,this.scene,{stepIndex:this.playback.getCurrentStepIndex(),actionIndex:this.playback.getCurrentActionIndex(),totalStepNumber:this.playback.getStepCount()}))}}};var eb={};Object.defineProperty(eb,"__esModule",{value:!0});eb.ug=class{constructor(a,b,c,d,e,f,g){this.bc=a;this.playback=b;this.na=c;this.th=d;this.f=e;this.va=g;b=new sa.Jc(a.getMainStage(),this.na.getScene());new cb.ag(a,this.playback,this.playback.getScene(),this.na.getUpdatableAnimationScene_KILLME().getParentScene(),
this.na.getUpdatableAnimationScene_KILLME(),this.na,this.f,b,this.na.getObjectEditor().getFlyToSelectionStream());this.xa=new oa.Ic(this.na.getScene(),this.f,f,this.va,this.va.cover,b);this.f.getCurrentTopicStream().onValue((a)=>this.currentTopic=a);this.Dj();const h=new db.yg(this.na.getScene(),this.bc.getMainStage(),this.playback);this.na.getObjectEditor().getFlyToEntityActionStream().onValue((a)=>h.execute(a))}Mk(){const a=this.na.getScene(),b=p.CetModelEditor.isOverview(this.currentTopic,a);return l.Cet.createEditorPath(a).hasCustomStartPoint()&&
b}Dj(){this.uh=this.th.getKeyboardStream().filter((a)=>R.PreziUAParser.isMac()&&a.metaKey&&"keydown"===a.type&&a.keyCode===h.Key.P||!R.PreziUAParser.isMac()&&a.ctrlKey&&"keydown"===a.type&&a.keyCode===h.Key.P||!R.PreziUAParser.isMac()&&"keydown"===a.type&&a.keyCode===h.Key.F5?(a.preventDefault(),!0):!1).map((a)=>({newMode:A.EditorMode.playback,trigger:a.keyCode===h.Key.P?"ctrl+p":"F5",shouldGoFullscreen:!0,shouldSeekPathToStart:this.Mk(),showTopmenu:!0,linkClickedFlow:!1,presenterNotesFlow:!1}));
this.nk=this.na.getObjectEditor().getMouseCursorStateStream().merge(this.playback.getMouseCursorStateStream()).skipDuplicates((a,b)=>a.cursor===b.cursor)}getChangeModeActionStream(){return this.uh.merge(this.playback.getChangeModeActionStream().filterWithStream(this.f.getBoolModeStream(A.EditorMode.playback)))}getResizeControlPointStream(){return this.na.getObjectEditor().getResizeControlPointStream()}getMouseCursorStateStream(){return this.nk}reset(a){this.na.reset(a);this.na.getUpdatableAnimationScene_KILLME().update();
this.playback.reset(a);this.na.getObjectEditor().reset()}setupInvariantChecks(a){return this.f.getStateStream().sampledBy(a).map((a)=>(a=this.xa.checkCoverSelectionInvariants(a.selectionInfo.allEntityIds,a.coverEditMode))?a:null).skipDuplicates()}};var Aa={};Object.defineProperty(Aa,"__esModule",{value:!0});Aa.Vd=class{constructor(a,b){a.onValue((a)=>this.topicId=a);b.onValue((a)=>this.coverEditMode=a)}getCurrentParentId(){return this.od(this.coverEditMode)?this.coverEditMode.topicId:this.topicId}getCurrentKind(){return this.od(this.coverEditMode)?
p.InsertHierarchyDestinationKind.COVER:p.InsertHierarchyDestinationKind.CHILD}shouldInsertIntoCover(){return this.od(this.coverEditMode)}od(a){if(null==a)return!1;switch(this.coverEditMode.kind){case t.CoverEditModeKind.advanced:return!0;case t.CoverEditModeKind.titleEditOnly:case t.CoverEditModeKind.insideAdvanced:return!1;default:return D.Utils.assertNever(this.coverEditMode)}}};var fb={};Object.defineProperty(fb,"__esModule",{value:!0});fb.Tg=class{constructor(a,b,c,d,e,f){this.gl=a;this.u=d;this.Df=
e;this.nd=f;b.onValue((a)=>{this.currentTopicId=a});c.onValue((a)=>{this.currentSelection=a.allEntityIds})}insert(a,b,c){const d=this.Xj(a.doc.getZObjects()),e=this.currentTopicId===this.u.scene.getPreziW().getOverview().getId();if(this.nd.shouldInsertIntoCover()&&d)return null;const f=Object.assign(Object.assign({},a),{targetParentId:this.nd.getCurrentParentId(),positionRelativeToId:this.currentTopicId,currentSelection:this.currentSelection,insertAsContent:!this.nd.shouldInsertIntoCover()});this.u.executeApiCommand(this.Df.insertCmd(f),
{trigger:c,userIntentId:b});e&&!this.Vk(a)&&d&&setTimeout(()=>this.gl.flyToOverview(),0)}copyObjects(a){return this.Df.copyObjects(a)}Vk(a){let b=!1,c=!1;for(let d=0;d<a.doc.getZObjects().length();++d){const e=a.doc.getZObjects().get(d);null!=e.getIsPage&&e.getIsPage()&&(b=!0);null!=e.getIsChapter&&e.getIsChapter()&&(c=!0)}return b&&!c}Xj(a){for(a=a.iterator();a.hasNext();){var b=a.next();if(b.getObjectType()===F.ZObjectType.Z_TOPIC_CONTAINER&&(b=b.getTopic().getObjectType(),b===F.TopicType.PLANET_CHAPTER||
b===F.TopicType.STACK_CHAPTER))return!0}return!1}};var gb={};Object.defineProperty(gb,"__esModule",{value:!0});var aa=p.base.VisualLayoutRole,Ba=p.base.CoverLayoutRole,Ca=p.base.ContentLayoutRole,hb=p.base.SurfaceLayoutRole,N=p.base.ObjectKind;gb.Ug=class{constructor(a){this.u=a}setLayoutRole(a,b){null==b?this.u.executeApiCommand(this.ua(a,null)):b.isDef(w.CetModel.ID.VISUAL_ANCHOR)?this.u.executeApiCommand(this.ua(a,aa.visualAnchor)):b.isDef(w.CetModel.ID.SLIDE_ANCHOR_16_9)?this.u.executeApiCommand(this.ua(a,
aa.slideAnchor_16_9)):b.isDef(w.CetModel.ID.SLIDE_ANCHOR_4_3)?this.u.executeApiCommand(this.ua(a,aa.slideAnchor_4_3)):b.isDef(w.CetModel.ID.SLIDE_DECORATOR)?this.u.executeApiCommand(this.ua(a,aa.slideDecorator)):b.isDef(w.CetModel.ID.CONTENT_AREA)?this.u.executeApiCommand(this.ua(a,aa.contentArea)):b.isDef(w.CetModel.ID.TOPIC_SHAPE)?this.u.executeApiCommand(this.ua(a,aa.topicShape)):b.isDef(w.CetModel.ID.SURFACE_TOPIC_SHAPE)?this.u.executeApiCommand(this.ua(a,hb.surfaceTopicShape)):b.isDef(w.CetModel.ID.COVER_TITLE)?
this.u.executeApiCommand(this.ua(a,Ba.coverTitle)):b.isDef(w.CetModel.ID.COVER_ICON)?this.u.executeApiCommand(this.ua(a,Ba.coverIcon)):b.isDef(w.CetModel.ID.CONTENT_TITLE)?this.u.executeApiCommand(this.ua(a,Ca.contentTitle)):b.isDef(w.CetModel.ID.CONTENT_ICON)&&this.u.executeApiCommand(this.ua(a,Ca.contentIcon))}setPaletteColor(a,b){this.u.executeApiCommand(this.Rk(a,b))}Rk(a,b){return{name:"setPaletteColor",run:(c)=>{c=c.lookup.simpleObject(a);if(c.kind===N.image||c.kind===N.pdf||c.kind===N.swf){var d=
g.EditorCommander.createColorMixCommander().getShapefilterStyle(b);if(null!=b)if(null!=d)c.filterStyle=d;else throw`Unkown palette color type: ${b}`;else c.filterStyle=null}else if(c.kind===N.shape)if(d=g.EditorCommander.createColorMixCommander().getShapeStyle(b),null!=b)if(null!=d)c.shapeStyle=d;else throw`Unkown palette color type: ${b}`;else c.shapeStyle=null;else if(c.kind===N.arrow||c.kind===N.line)if(d=g.EditorCommander.createColorMixCommander().getArcStyle(b),null!=b)if(null!=d)c.arcStyle=
d;else throw`Unkown palette color type: ${b}`;else c.arcStyle=null}}}ua(a,b){return{name:"setLayoutRole",run:(c)=>{c=c.lookup.simpleObject(a).parent;switch(c.kind){case N.cover:null==b&&(b=Ba.none);if(D.isFromEnum(b,Ba))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.coverLayoutRole=b);else throw Error(`Trying to set cover layout role on a non cover object: ${a}`);break;case N.visual:null==b&&(b=aa.none);if(D.isFromEnum(b,aa))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.visualLayoutRole=
b);else throw Error(`Trying to set visual layout role on a non visual object: ${a}`);break;case N.planetTopic:null==b&&(b=Ca.none);if(D.isFromEnum(b,Ca))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.contentLayoutRole=b);else throw Error(`Trying to set content layout role on a non content object: ${a}`);break;case N.surface:null==b&&(b=hb.none);if(D.isFromEnum(b,hb))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.surfaceLayoutRole=b);else throw Error(`Trying to set content layout role on a non surface object: ${a}`);
break;case N.page:case N.master:case N.overview:throw Error(`Trying to set content layout role on a non content object: ${a}`);default:D.Utils.assertNever(c)}}}}};var ca={};Object.defineProperty(ca,"__esModule",{value:!0});ca.gc=class{constructor(a,b){this.entityId=a;this.kind=b}getEntityId(){return this.entityId}};ca.Vg=class{createImageProps(a){return new ca.gc(a,n.PropsKind.Image)}createPdfProps(a){return new ca.gc(a,n.PropsKind.Pdf)}createChartPdfProps(a){return new ca.gc(a,n.PropsKind.ChartPdf)}createOverviewProps(a){return new ca.gc(a,
n.PropsKind.Overview)}};var Da={},ma=this&&Da.ib||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{m(d.next(a))}catch(B){g(B)}}function h(a){try{m(d["throw"](a))}catch(B){g(B)}}function m(a){a.done?c(a.value):e(a.value).then(f,h)}m((d=d.apply(a,b||[])).next())})};Object.defineProperty(Da,"__esModule",{value:!0});Da.Wg=class{constructor(a){this.Qd=a;this.onPushNotificationPermissionDenied=()=>{this.Qd.setBoolean(Ga.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED,
!0)};this.onPushNotificationPermissionGranted=()=>{this.Qd.setBoolean(Ga.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED,!1)};this.tk=()=>ma(this,void 0,void 0,function*(){if("denied"===(yield Fa.BrowserNotificaionModule.getBrowserNotificationServiceInstance()).getPermission())this.onPushNotificationPermissionDenied()})}shouldShowNativePushNotificationPermission(){return ma(this,void 0,void 0,function*(){return G.isActive("abtest-act-browser-notifications-builtin-permission-dialog")&&
this.Uf()})}shouldShowPushNotificationPermissionDialog(){return ma(this,void 0,void 0,function*(){return G.isActive("abtest-act-browser-notifications-custom-permission-dialog")&&this.Uf()})}requestPushNotificationPermission(){return ma(this,void 0,void 0,function*(){(yield Fa.BrowserNotificaionModule.getBrowserNotificationServiceInstance()).requestPermission(this.onPushNotificationPermissionGranted,this.tk)})}Jj(){return this.Qd.getBoolean(Ga.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED)}aj(){return ma(this,
void 0,void 0,function*(){return"default"===(yield Fa.BrowserNotificaionModule.getBrowserNotificationServiceInstance()).getPermission()})}Uf(){return ma(this,void 0,void 0,function*(){return!this.Jj()&&this.aj()})}};var ib={};Object.defineProperty(ib,"__esModule",{value:!0});ib.fg=class{constructor(a){this.ub=a}select(a,b){var c=this.ub.getCurrentPosition();if(null==c)return null;var d=b.getPreziW().getEntity().getComponent(w.CetModel.ID.PREZI.PATH);if(c.getStep()>d.length()-1)return!0;c=d.getAt(c.getStep());
d=b.getEntityById(c).getWrapper(w.CetModel.ID.PATH_STEP.W);return d.is(w.CetModel.ID.FLY_TO_OBJECT)?d.getTarget()!==this.ub.getCurrentTargetId():d.is(w.CetModel.ID.FLY_TO_OVERVIEW)?b.getPreziW().getOverview().getId()!==this.ub.getCurrentTargetId():a.getId()===c}getTriggerKeys(){return[w.CetModel.getRemovedEntityCompKey(),w.CetModel.ID.PATH_STEP.ACTIONS,w.CetModel.ID.EDITOR_PATH_V1.STEPS,w.CetModel.ID.EDITOR_PATH_V2.STEPS]}process(a,b){a=this.ub.getCurrentPosition();b=l.Cet.createPlaybackPath(b).getClosestValidPathPosition(a,
this.ub.getCurrentTargetId());b.getStep()===a.getStep()&&b.getAction()===a.getAction()||this.ub.seekTo(b)}getName(){return"CurrentPathPositionGuardSystem"}changesPdomComponents(){return!1}};var jb={};Object.defineProperty(jb,"__esModule",{value:!0});jb.wg=class{constructor(){}getName(){return"EditorVisibility"}process(a){a.hasComponent(p.CetModelEditor.getEditVisibilityKey())||a.set(p.CetModelEditor.getEditVisibilityKey(),{isEnabled:!0,alpha:1})}select(a){return a.hasComponent(Z.CetRendererModule.getDrawComponentKey())}reset(){}init(a){a.getTweener().createVisibilityAnimationHelper("EditAppearVisibility");
a.getTweener().createVisibilityAnimationHelper("DragPreviewVisibility");a.getTweener().createVisibilityAnimationHelper(ka.hc.bh)}changesPdomComponents(){return!1}};var kb={};Object.defineProperty(kb,"__esModule",{value:!0});kb.gh=class{constructor(a){this.wh=a}getName(){return"VideoInitSystem"}process(a){l.Cet.setFocusBehavior(a,this.wh.createNoFocusBehaviorComponent())}select(a){return a.getDef()===w.CetModel.ID.Z_VIDEO}changesPdomComponents(){return!1}};var lb={};Object.defineProperty(lb,"__esModule",
{value:!0});lb.vg=class{createEditmode(a,b,c,d,e,f,m,n,r,t,u,v,w,z,D,E,F,I,H,J,O){var y=b.getSceneBuilder(),C=b.getMainStage().getCamera(),x=y.getSystemFactory(),B=q.SelectionModule.createSelection(f);const K=B.createSelectionSystem(C,b.getDomLayerManager(),b.getMainStage(),b.getMainStage());var L=new jb.wg,M=f.getCurrentTopicNavigationStream();M=k.Bacon.combineWith((a,b)=>null==a||b.kind===A.EditorMode.edit?a:{newCurrentTopic:a.newCurrentTopic,navigationType:l.NavigationActionAnimationType.Focus},
M,f.getModeStream()).sampledBy(M).toProperty(null);const Q=ba.PlaybackModule.createTopicVisibilitySystem(M,f.getModeStream().map((a)=>a.kind).toProperty(null),!0,b.getMainStage(),b.getDomLayerManager());M=k.Bacon.newBus();const S=ba.PlaybackModule.createLogoSystem(f.getLogoStream(),f.getCanvasHoverStream(),b.getCetUI().getSizeProperty(),b.getMainStage()),N=x.createWorldGeometrySystem(),P=x.createBoundCalculationSystem(),R=x.createOverviewFrameSystem(C);var T=p.CetModelEditor.createEditorConnectorFixerSystem(x);
const X=p.CetModelEditor.createHideDegenerateConnectorsFixerSystem(x),V=x.createQuadTreeSystem(b.getMainStage().getRenderer().getQuadTreeUpdater());var W=[Q,S].filter((a)=>null!=a),U=[P,N,X],Y=[x.createShaperSystem(ba.PlaybackModule.createStageQuerySystem(b.getMainStage(),f.getCoverEditModeStream(),f.getCurrentTopicStream(),p.ApplicationMode.Edit,p.CetModelEditor.getStageQueryKey())),x.createShaperSystem(ba.PlaybackModule.createStageQuerySystem(b.getMainStage(),f.getCoverEditModeStream(),f.getCurrentTopicStream(),
p.ApplicationMode.View,ba.PlaybackModule.getStageQueryKey())),x.createThumbnailOnlyVideoSystem(),x.createInitializerSystem(new kb.gh(b.createComponentFactory())),P,N,V,G.isActive("js-disable-spellcheck-for-test")?null:B.createTextHighlightSystem(C,b.getMainStage())].filter((a)=>null!=a);let aa=[P,N,R,T,P,N,R];T=[R,T,P,N,R,V,x.createZTextInitSystem(),x.createImageInitSystem(b.getMainStage().getRenderer().getAssetManager(),b.getDomLayerManager(),b.getMediaAssetPatcher(),b.getAssetThumbnailAnnouncer(),
b.getAssetManager()),x.createInitializerSystem(x.createInvisibleFrameSystem(()=>Z.CetRendererModule.createInvisibleFrameRenderer())),X,x.createShaperSystem(new ib.fg(b.getMainStage().getPathNavigator())),p.CetModelEditor.createFranklinPathFixerSystem(x)].filter((a)=>null!=a);v=[B.createSnapSystem(x,C,b.getDomLayerManager()),B.createTopicNestingSystem(C,b.getDomLayerManager()),K,Q,S,B.createCustomStartingPointSystem(b.getDomLayerManager(),C,v,b.getMainStage()),P,N,R,V,x.createInitializerSystem(L)].filter((a)=>
null!=a);v={initList:W,inflateList:U,updateList:Y,updateOnceList:T,preRenderList:v,geometryUpdateList:aa};v=y.createChildScene("edit",b.getBaseScene(),v);L=x.createShaperSystem(ba.PlaybackModule.createVisibilityAggregator([p.CetModelEditor.getEditVisibilityKey()],(a,b,c)=>l.Cet.updateVisibility(a).setAlpha(b).setEnabled(c)));W=x.createShaperSystem(ba.PlaybackModule.createVisibilityAggregator([],(a,b,c)=>l.Cet.updateCommentVisibility(a).setEnabled(c).setAlpha(b)));C=b.getMainStage().getRenderer().createChannel("edit-animation",
!0);U=x.createWorldGeometrySystem();B=[L,W];U=[U];Y=[x.createWorldGeometrySystem(),x.createQuadTreeSystem(b.getMainStage().getRenderer().getQuadTreeUpdater())];x=[L,W,b.getMainStage().getRenderer().getInvalidator()?x.createRenderingInvalidatorSystem(C,b.getMainStage().getRenderer().getInvalidator()):null].filter((a)=>null!=a);y=y.createAnimScene("edit-animation",v,{initList:B,inflateList:U,updateList:Y,preRenderList:x});b.getMainStage().registerScene(C,y);v.setAnimationScene(y);x=b.createIdleStream(b.getBaseScene().getImmediateChangeStream(l.ChangeEventKind.Entity));
v.setIdleChangeStream(x);x=p.CetModelEditor.createPositionFinder(v,b.getMainStage().getCamera());C=new Aa.Vd(f.getCurrentTopicStream(),f.getCoverEditModeStream());B=p.CetModelEditor.createCameraControl(b.getMainStage().getCamera());L=b.getMainStage().getRenderer().getAssetManager();H.onDocumentLoaded(b,this.pluginMetaDataFromNativeMetadata(a),v,x,C,m,f,O,n,b.getMainStage(),F,b.getMediaAssetPatcher(),u,b.getAssetThumbnailAnnouncer(),w,D,E,L,b.fontsLoadedStateHolder,b.getMainStage(),I,c.filter((a)=>
a.type===h.MouseInteractionType.HoverMove).map((a)=>a.event.stagePos),this.Fh(b.getBaseScene().getImmediateChangeStream(null),v.isInTransactionStream(),b),b,J);a=g.EditorCommander.createZObjectEditor(b,v,C,u,b.getMediaAssetPatcher(),b.getAssetThumbnailAnnouncer(),B,H.applicationController.behaviorExtensions,F,H.getEditorSession());z=this.createDragPlaceholderController(z);b=new za.tg(b.getMainStage(),c,v,y,f,m,n,d,e,r,t,M,a,K,z,H);K.addAreaSelectionStream(b.getObjectEditor().getAreaSelectionStream());
K.addTextStateStream(f.getTextSelectionStateStream());K.addDrawInsertMouseHoverEventStream(b.getObjectEditor().getDrawInsertMouseHoverEventStream());return b}createEditorBehavior(a,b,c,d,e,f,g){return new eb.ug(a,c,b,d,e,f,g)}createPreziDocEditController(a,b,c,d,e,f){return new fb.Tg(a,b,c,e,f,new Aa.Vd(b,d))}createConnectivityController(a,b,c,d){return new Oa.dg(a,b,c,d)}createDragPlaceholderController(a){return new Pa.og(a)}getChildIndexFromPathId(a,b,c){a=p.CetModelEditor.createTopicQuery(c).getChildTopics(a);
if(null==b)return a.length-1;b=p.CetModelEditor.createEditorPathQuery(c).getStepTargetId(b);return a.map((a)=>{if(p.CetModelEditor.isPlanetOrStack(a,c)&&!p.CetModelEditor.isPlanet(a,c)){const b=p.CetModelEditor.getPagesOfChapter(a,c);0<b.length&&(a=b[0])}return a}).indexOf(b)}createBasicEditController(a,b){return new Ha.$f(a,b)}createClipboard(a,b,c,d,e,f,g,h,l,k){f=new Na.Gg(g);return new Ma.bg(a,b,c,f,d,e,g,h,l,k)}createClipboardTrigger(a=null){return new xa.cg(a)}createPreziLayoutController(a){return new gb.Ug(a)}createPropertyEditor(){return new ca.Vg}createPushNotificationController(a){return new Da.Wg(a)}pluginMetaDataFromNativeMetadata(a){return{preziOid:null!=
a.oid?a.oid:a.desktopId,copyright:a.copyright,title:a.title,logoType:a.logo_type,ownerId:a.owner_id,showcaseProhibited:a.showcase_prohibited}}Fh(a,b,c){const d=k.Bacon.newBus();let e=[],f=!1;b.onValue((a)=>{f=a;!f&&0<e.length&&(d.push(e),e=[])});a.onValue((a)=>{f?e=e.concat(a):d.push(a)});return c.createIdleStream(d)}};var mb={};Object.defineProperty(mb,"__esModule",{value:!0});mb.Pg=class{constructor(){this.bd=null}createCoverController(a,b,c,d,e,f){f=new sa.Jc(f,a);return new oa.Ic(a,b,c,d,e,f)}getDragDisabledKey(){null==
this.bd&&(this.bd=w.CetModel.createValueComponentKey("drag_enabled",!1,!1));return this.bd}};var Eb={ii:function(a,b){if(null==a||null==b||0===a.length||a.length!==b.length||a===b)return null;for(let c=0;c<a.length&&c<b.length;c++)if(a[c]!==b[c])return b[c];return null}};Object.defineProperty(Eb,"__esModule",{value:!0});var na={};Object.defineProperty(na,"__esModule",{value:!0});na.ic=class{constructor(a){this.Gb=a;this.sd=this.qd=!1;this.Ac=null;this.ed=!0;this.xd=k.Bacon.newBus();this.Bf=k.Bacon.newBus();
this.Ob=k.Bacon.newBus();this.Jb=k.Bacon.newBus()}sj(){const a=$(this.da);a.focusin(()=>{this.Jb.push(!0)});a.focusout(()=>{this.Jb.push(!1)});a.on("paste",(a)=>{this.Bf.push(a.originalEvent)});a.keypress((a)=>{this.sd=!0;this.xd.push(a)});a.keydown((a)=>{this.xd.push(a)});a.keyup(()=>{this.sd=!1});a.on("input",()=>{if(!this.sd&&this.ed){const a=Eb.ii(this.Ac,this.da.value);null!=a&&this.Ob.push({eventType:"osxlongpress",text:a})}this.Ac=this.da.value});a[0].addEventListener("compositionstart",(a)=>
{this.Ob.push({eventType:"compositionstart",text:a.data});this.Ac=this.da.value;this.ed=!1});a[0].addEventListener("compositionupdate",(a)=>{""!==a.data&&this.Ob.push({eventType:"compositionupdate",text:a.data})});a[0].addEventListener("compositionend",(a)=>{""!==a.data&&this.Ob.push({eventType:"compositionend",text:a.data})})}Ef(){null!=this.da&&this.da.parentElement.removeChild(this.da);this.da=null;null!=this.qa&&(this.qa.style.display="none")}Yf(a){if(null!=this.qa){let b=this.Gb.getWidth()/2+
a.x;a=this.Gb.getHeight()/2+a.y;b=Math.max(0,Math.min(b,this.Gb.getWidth()-20));a=Math.max(0,Math.min(a,this.Gb.getHeight()-20));this.qa.style.left=b+"px";this.qa.style.top=a+"px"}}Lh(a){this.Ac="";this.ed=!0;this.Ef();if(null==this.qa||null==this.qa.parentElement)this.qa=this.Gb.createElement("ime-input-container"),this.qa.style.pointerEvents="none",this.qa.style.position="absolute",this.qa.style.opacity="0",this.qa.style.height="0px";this.Yf(a);this.qa.style.display="";this.da=document.createElement("input");
this.da.setAttribute("tabindex","0");this.da.setAttribute("id",na.ic.Ud);this.da.style.width="10px";this.da.style.height="0";this.da.style.overflow="hidden";this.da.style.margin="0";this.da.style.padding="0";this.da.autocomplete="off";this.qa.appendChild(this.da);this.sj()}wc(){this.qd||(this.qd=!0,setTimeout(()=>{this.qd=!1;null!=this.da&&this.da.focus()},10))}getPasteEventAction(){return this.Bf}getFocusInOutStream(){return this.Jb}};na.ic.Ud="IME_Input";var Ea={};Object.defineProperty(Ea,"__esModule",
{value:!0});Ea.Td=class{constructor(a,b,c,d,e,f){this.yd=a;this.ej=b;this.ma=c;this.scene=d;this.Va=e;this.gb=f;this.If=k.Bacon.newBus();this.uj()}Ij(a){if("keypress"!==a.type||a.keyCode===h.Key.ENTER)return!1;let b;null!==a.charCode?b=a.charCode:null!==a.which?b=a.which:null!==a.keyCode&&(b=a.keyCode);return 32>b||a.metaKey!==a.ctrlKey&&!a.altKey&&!a.shiftKey?!1:!0}static Hj(a){switch(a.event.keyCode){case h.Key.MAC_META_LEFT:case h.Key.MAC_META_RIGHT:case h.Key.WIN_META_RIGHT:case h.Key.SHIFT:case h.Key.ALT:case h.Key.CTRL:return!1}return!0}Yj(a){return a.event.metaKey&&
(a.event.keyCode===h.Key.Z||a.event.keyCode===h.Key.Y)}Lj(a){return(a.event.metaKey||a.event.ctrlKey)&&(a.event.keyCode===h.Key.C||a.event.keyCode===h.Key.X)}uj(){this.ej.onValue((a)=>this.gb.gf(a));this.yd.filter(this.Ij).onValue((a)=>{this.gb.gf({text:String.fromCharCode(a.charCode),eventType:"keypress"})});var a=k.Bacon.combineWith((a,b)=>({state:a,event:b}),this.ma.filter((a)=>null!=a&&a.isSingleSelection()),this.yd.filter((a)=>"keydown"===a.type)).sampledBy(this.yd.filter((a)=>"keydown"===a.type)).filter(Ea.Td.Hj).filter((a)=>
!this.Yj(a));a.filter((a)=>!a.state.isEditing()).onValue((a)=>this.$i(a));var b=a.filter((a)=>a.state.isEditing()).filter((a)=>!this.Lj(a));b.onValue((a)=>this.Zi(a));a=b.map((a)=>({entityId:a.state.getEntityIds()[0],yc:!0}));b=b.debounce(300).map((a)=>({entityId:a.state.getEntityIds()[0],yc:!1}));a.merge(b).skipDuplicates((a,b)=>a.yc===b.yc).onValue((a)=>{this.scene.requestNoDomBatchUpdate((b)=>{b=b.getEntityById(a.entityId);null!=b&&b.set(q.SelectionModule.getEnableBlinkingCaretKey(),!a.yc)})})}$i(a){a=
a.event;a.keyCode===h.Key.ENTER?this.gb.fi():a.keyCode===h.Key.BACKSPACE||a.keyCode===h.Key.DELETE?this.gb.deleteText(I.DeleteAction.CHARACTER_BACKWARD):a.keyCode===h.Key.ESC&&this.If.push({selectedGroupIds:[],selectedEntityIds:[],type:n.SelectActionType.replace})}Zi(a){var b=a.event;a=a.state.getEntityIds()[0];const c=this.scene.getEntityById(a);null!=c&&(b=b.metaKey&&b.shiftKey?this.Va.Fk(b,c):b.ctrlKey&&b.shiftKey?this.Va.Dk(b,c):b.altKey&&b.shiftKey?this.Va.Bk(b,c):b.metaKey?this.Va.Ek(b,c):b.altKey?
this.Va.Ak(b,c):b.ctrlKey?this.Va.Ck(b,c):b.shiftKey?this.Va.Hk(b,c):this.Va.Gk(b,c),this.gb.mh(a,b))}};var nb={};Object.defineProperty(nb,"__esModule",{value:!0});nb.Ag=class{constructor(a,b){this.helper=a;this.j=b}Hk(a,b){const c=l.Cet.shapedText(b),d=c.getLength(),e=this.helper.getCaretOffset(b),f=this.helper.getSelectionStartOffset(b),g=this.helper.getSelectionEndOffset(b);let k=e,n=null,p=null,q=null;switch(a.keyCode){case h.Key.UP_ARROW:k=this.j.Bc(b,e,!0);null!==f&&null!==g?(n=e===f?k:f,p=
e===g?k:g):(n=k,p=e);break;case h.Key.DOWN_ARROW:k=this.j.Bc(b,e,!1);null!==f&&null!==g?(n=e===f?k:f,p=e===g?k:g):(n=e,p=k);break;case h.Key.LEFT_ARROW:null!==f&&null!==g?(n=e===f?f-1:f,p=e===g?g-1:g):0<=e-1&&(n=e-1,p=e);k=Math.max(e-1,0);break;case h.Key.RIGHT_ARROW:null!==f&&null!==g?(n=e===f?f+1:f,p=e===g?g+1:g):(n=e,p=e+1);k=Math.min(e+1,d);break;case h.Key.HOME:a=this.j.Kf(c,b);n=a.Ba.start;p=a.Ba.end;k=a.caretOffset;break;case h.Key.END:a=this.j.Lf(c,b);n=a.Ba.start;p=a.Ba.end;k=a.caretOffset;
break;case h.Key.TAB:q=Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Tab},this.ab(a));break;default:n=this.helper.getSelectionStartOffset(b),p=this.helper.getSelectionEndOffset(b)}return{caretOffset:k,selectionStartOffset:n,selectionEndOffset:p,command:q,Xa:!1}}Ak(a,b){let c=l.Cet.shapedText(b),d=this.helper.getCaretOffset(b),e=d,f=null,g=null,k=null;switch(a.keyCode){case h.Key.LEFT_ARROW:e=c.getWordBoundaryToLeft(d,!0);break;case h.Key.RIGHT_ARROW:e=c.getWordBoundaryToRight(d);
break;case h.Key.UP_ARROW:e=c.getParagraphBoundaryToLeft(d);break;case h.Key.DOWN_ARROW:e=c.getParagraphBoundaryToRight(d);break;case h.Key.BACKSPACE:k=Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Backspace},this.ab(a));break;default:f=this.helper.getSelectionStartOffset(b),g=this.helper.getSelectionEndOffset(b)}return{caretOffset:e,selectionStartOffset:f,selectionEndOffset:g,command:k,Xa:!1}}Ck(a,b){let c=l.Cet.shapedText(b),d=this.helper.getCaretOffset(b),e=d,f=
this.helper.getSelectionStartOffset(b);b=this.helper.getSelectionEndOffset(b);let g=null;switch(a.keyCode){case h.Key.A:R.PreziUAParser.getOsKind()!==R.OsKind.Mac&&(f=0,e=b=c.getLength());break;case h.Key.HOME:b=f=null;e=0;break;case h.Key.END:b=f=null;e=c.getLength();break;case h.Key.LEFT_ARROW:b=f=null;e=c.getWordBoundaryToLeft(d,!0);break;case h.Key.RIGHT_ARROW:b=f=null;e=c.getWordBoundaryToRight(d);break;case h.Key.UP_ARROW:b=f=null;e=c.getParagraphBoundaryToLeft(d);break;case h.Key.DOWN_ARROW:b=
f=null;e=c.getParagraphBoundaryToRight(d);break;case h.Key.BACKSPACE:g=Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Backspace},this.ab(a))}return{caretOffset:e,selectionStartOffset:f,selectionEndOffset:b,command:g,Xa:!1}}ab(a){return{modifiers:{altKey:a.altKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey,shiftKey:a.shiftKey,os:R.PreziUAParser.getOsKind()}}}Ek(a,b){const c=l.Cet.shapedText(b),d=this.helper.getCaretOffset(b);let e=d,f=this.helper.getSelectionStartOffset(b);b=
this.helper.getSelectionEndOffset(b);switch(a.keyCode){case h.Key.A:f=0;e=b=c.getLength();break;case h.Key.UP_ARROW:b=f=null;e=0;break;case h.Key.DOWN_ARROW:b=f=null;e=c.getLength();break;case h.Key.LEFT_ARROW:b=f=null;e=this.j.qb(c,d,!0);break;case h.Key.RIGHT_ARROW:b=f=null,e=this.j.qb(c,d,!1)}return{caretOffset:e,selectionStartOffset:f,selectionEndOffset:b,Xa:!1,command:null}}Fk(a,b){let c=l.Cet.shapedText(b);switch(a.keyCode){case h.Key.UP_ARROW:a=this.j.Qf(c,b);break;case h.Key.DOWN_ARROW:a=
this.j.Jf(c,b);break;case h.Key.LEFT_ARROW:a=this.j.Kf(c,b);break;case h.Key.RIGHT_ARROW:a=this.j.Lf(c,b);break;default:a=this.j.jd(b)}return{caretOffset:a.caretOffset,selectionStartOffset:a.Ba.start,selectionEndOffset:a.Ba.end,Xa:!1,command:null}}Dk(a,b){let c=l.Cet.shapedText(b);switch(a.keyCode){case h.Key.LEFT_ARROW:a=this.j.Pf(c,b);break;case h.Key.RIGHT_ARROW:a=this.j.Nf(c,b);break;case h.Key.UP_ARROW:a=this.j.Of(c,b);break;case h.Key.DOWN_ARROW:a=this.j.Mf(c,b);break;case h.Key.HOME:a=this.j.Qf(c,
b);break;case h.Key.END:a=this.j.Jf(c,b);break;default:a=this.j.jd(b)}return{caretOffset:a.caretOffset,selectionStartOffset:a.Ba.start,selectionEndOffset:a.Ba.end,Xa:!1,command:null}}Bk(a,b){let c=l.Cet.shapedText(b);switch(a.keyCode){case h.Key.LEFT_ARROW:a=this.j.Pf(c,b);break;case h.Key.RIGHT_ARROW:a=this.j.Nf(c,b);break;case h.Key.UP_ARROW:a=this.j.Of(c,b);break;case h.Key.DOWN_ARROW:a=this.j.Mf(c,b);break;default:a=this.j.jd(b)}return{caretOffset:a.caretOffset,selectionStartOffset:a.Ba.start,
selectionEndOffset:a.Ba.end,Xa:!1,command:null}}Gk(a,b){let c=l.Cet.shapedText(b);const d=this.helper.getSelection(b);let e=this.helper.getCaretOffset(b),f=e,g=null,k=null,n=null,p=!1;switch(a.keyCode){case h.Key.UP_ARROW:f=this.j.Fi(b);break;case h.Key.DOWN_ARROW:f=this.j.Ci(b);break;case h.Key.RIGHT_ARROW:f=this.j.Ei(b);break;case h.Key.LEFT_ARROW:f=this.j.Di(b);break;case h.Key.ENTER:n=Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Enter},this.ab(a));break;case h.Key.DELETE:n=
Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Delete},this.ab(a));break;case h.Key.BACKSPACE:n=Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Backspace},this.ab(a));break;case h.Key.ESC:p=!0;f=c.getLength();break;case h.Key.HOME:f=this.j.qb(c,e,!0);break;case h.Key.END:f=this.j.qb(c,e,!1);break;case h.Key.TAB:n=Object.assign({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Tab},this.ab(a));break;default:g=null!=d?d.start:
null,k=null!=d?d.end:null}return{caretOffset:f,selectionStartOffset:g,selectionEndOffset:k,Xa:p,command:n}}};var ob={};Object.defineProperty(ob,"__esModule",{value:!0});ob.Jg=class{constructor(a,b,c,d,e,f){this.ha=a;this.ma=b;this.wb=c;this.camera=d;this.scene=e;this.dc=f;this.tj();this.fj();this.nj()}nj(){let a=this.zd.filter((a)=>{a=this.camera.screenPointToWorld(a.event.stagePos);a=this.wb.getEntityIdUnderPoint(a);a=this.scene.getEntityById(a);return null!=a?(a=a.get(q.SelectionModule.getDecoratorKey()),
null!=a&&a.interactionType!==q.InteractionType.none):!1}).map(()=>null);this.ma.sampledBy(a).filter((a)=>null!=a&&a.isSingleSelection()&&a.isEditing()).onValue(()=>{this.dc.qc()})}tj(){this.zd=this.ha.filter((a)=>a.type===h.MouseInteractionType.Click);this.uf=this.ha.filter((a)=>a.type===h.MouseInteractionType.DoubleClick);this.wf=this.ha.filter((a)=>a.type===h.MouseInteractionType.TripleClick);this.vf=this.ha.filter((a)=>a.type===h.MouseInteractionType.DragMove||a.type===h.MouseInteractionType.DragEnd)}fj(){this.Ri();
this.Si();this.Ui();this.Ti()}Ui(){const a=k.Bacon.combineWith((a,c)=>({ga:a,state:c}),this.wf,this.ma).sampledBy(this.wf).filter((a)=>null!=a.state&&a.state.isSingleSelection());this.kd(a).onValue((a)=>{this.dc.gd({ga:a.oa.ga,Oa:a.Oa,Uc:3,isEditing:a.oa.state.isEditing(),entityId:a.oa.state.getSingleEntityId()})})}Si(){const a=k.Bacon.combineWith((a,c)=>({ga:a,state:c}),this.uf,this.ma).sampledBy(this.uf).filter((a)=>null!=a.state&&a.state.isSingleSelection());this.kd(a).onValue((a)=>{this.dc.gd({ga:a.oa.ga,
Oa:a.Oa,Uc:2,isEditing:a.oa.state.isEditing(),entityId:a.oa.state.getSingleEntityId()})})}Ri(){const a=k.Bacon.combineWith((a,c)=>({ga:a,state:c}),this.zd,this.ma).sampledBy(this.zd).filter((a)=>null!=a.state&&a.state.isSingleSelection());this.kd(a).onValue((a)=>{this.dc.gd({ga:a.oa.ga,Oa:a.Oa,Uc:1,isEditing:a.oa.state.isEditing(),entityId:a.oa.state.getSingleEntityId()})})}Ti(){k.Bacon.combineWith((a,b)=>({ga:a,state:b}),this.vf,this.ma).sampledBy(this.vf).filter((a)=>null!=a.state&&a.state.isSingleSelection()&&
a.state.isEditing()).onValue((a)=>{const b=this.camera.screenPointToWorld(a.ga.baseEvent.stagePos),c=this.camera.screenPointToWorld(a.ga.event.stagePos);this.wb.getEntityIdUnderPoint(b,!0,a.state.getSingleEntityId())===a.state.getSingleEntityId()&&this.dc.ei({fl:b,el:c})})}kd(a){return a.map((a)=>({oa:a,Oa:this.camera.screenPointToWorld(a.ga.event.stagePos)})).filter((a)=>null!=a.oa.state&&a.oa.state.isSingleSelection()?(a.oa.state.isEditing()?this.wb.getEntityIdUnderPoint(a.Oa,!0,a.oa.state.getSingleEntityId()):
this.wb.getEntityIdUnderPoint(a.Oa))===a.oa.state.getSingleEntityId():!1)}};var ta={};Object.defineProperty(ta,"__esModule",{value:!0});var L;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT"})(L=ta.ig||(ta.ig={}));class Yc{constructor(a){this.helper=a}Ve(a,b,c){const d=l.Cet.transform(a).getWorldToLocal(),e=l.Cet.localBounds(a).getGraphicsBounds().getData();c=d.transformPoint(c);a=a.getWrapper(w.CetModel.ID.HAS_FONT.W);a=a.getDisplayBackground()?a.getBackgroundPadding():0;b=b.locateCaretOffset({x:c.x+
e.width/2-a,y:c.y+e.height/2-a});return b.endOfLine?b.offset-1:b.offset}Bc(a,b,c){a=l.Cet.shapedText(a);let d=a.getLineAt(b,!1);b=a.locatePosition(b,!1);c=c?b.y-1:b.y+(d.ascent-d.descent)+d.lineGap+1;0>c?c=0:c>a.getLayoutHeight()?c=a.getLength():(c=a.locateCaretOffset({x:b.x,y:c}),c=c.endOfLine?c.offset-1:c.offset);return c}qb(a,b,c){b=a.locatePosition(b,!1);if(!c&&1===a.getLineCount())return a.getLength();a=a.locateCaretOffset({x:c?0:a.getWrapWidth()-1,y:b.y+1});return a.endOfLine?a.offset-1:a.offset}Cb(a,
b,c=!1){return c&&this.helper.hasSelection(a)?b===L.LEFT?this.helper.getSelectionStartOffset(a):this.helper.getSelectionEndOffset(a):this.helper.getCaretOffset(a)}Mf(a,b){return this.Wa(a,b,L.RIGHT,(a,b)=>a.getParagraphBoundaryToRight(b))}Lf(a,b){return this.Wa(a,b,L.RIGHT,(a,b)=>this.qb(a,b,!1))}Nf(a,b){return this.Wa(a,b,L.RIGHT,(a,b)=>a.getWordBoundaryToRight(b))}Kf(a,b){return this.Wa(a,b,L.LEFT,(a,b)=>this.qb(a,b,!0))}Pf(a,b){return this.Wa(a,b,L.LEFT,(a,b)=>a.getWordBoundaryToLeft(b,!0))}Qf(a,
b){return this.Wa(a,b,L.LEFT,()=>0)}Jf(a,b){return this.Wa(a,b,L.RIGHT,(a)=>a.getLength())}Wa(a,b,c,d){c=this.Cb(b,c);const e=this.helper.getSelectionStartOffset(b);b=this.helper.getSelectionEndOffset(b);let f=e,g=b;a=d(a,c);null==e&&null==b?a<c?(f=a,g=c):(f=c,g=a):c===e?f=a:g=a;return{Ba:{start:f,end:g},caretOffset:a}}jd(a){return{Ba:{start:this.helper.getSelectionStartOffset(a),end:this.helper.getSelectionEndOffset(a)},caretOffset:this.helper.getCaretOffset(a)}}Of(a,b){return this.Wa(a,b,L.LEFT,
(a,b)=>a.getParagraphBoundaryToLeft(b))}Fi(a){const b=this.Cb(a,L.LEFT,this.helper.hasSelection(a));return this.Bc(a,b,!0)}Ci(a){const b=this.Cb(a,L.RIGHT,this.helper.hasSelection(a));return this.Bc(a,b,!1)}Di(a){const b=this.helper.hasSelection(a);a=this.Cb(a,L.LEFT,b);!b&&0<=a-1&&--a;return a}Ei(a){const b=this.helper.hasSelection(a);let c=this.Cb(a,L.RIGHT,b);!b&&c+1<=l.Cet.shapedText(a).getLength()&&++c;return c}}ta.dh=Yc;var da={};Object.defineProperty(da,"__esModule",{value:!0});da.ge=class{constructor(a,
b,c){this.ba=a;this.v=b;this.getScene=c;this.ma=k.Bacon.newBus();this.Wf=k.Bacon.newBus();this.helper=p.CetModelEditor.createTextHelper();this.Bd=null;this.v.addTextSelectionStateStream(this.ma)}clearSelection(){this.setTextSelection(null)}setTextSelection(a){null==a||null==a.id?(a=this.v.getTextSelectionState(),null!=a&&a.isSingleSelection()&&this.vh(a.getSingleEntityId()),this.v.getTextSelectionState().isEditing()&&this.Id(this.v.getTextSelectionState().setEditing(!1))):p.CetModelEditor.isLocked(a.id,
this.getScene())||(this.ba.select({selectedGroupIds:[],selectedEntityIds:[a.id],type:n.SelectActionType.replace}),this.v.getTextSelectionState().isEditing()!==a.isFocused&&this.Id(this.v.getTextSelectionState().setEditing(a.isFocused)),this.Gc(a.id,a.caretPosition===z.CaretPosition.Start?a.offset:a.offset+a.length,a.offset,a.offset+a.length,a.isFocused),a.isFocused&&null!=this.Bd&&this.Bd())}getTextSelectionInfo(){var a=this.v.getTextSelectionState();if(null==a||!a.isSingleSelection())return null;
a=this.getScene().getEntityById(a.getEntityIds()[0]);const b=this.helper.getTextSelectionFocused(a);if(null==b)return null;const c=this.helper.getSelection(a),d=this.helper.getCaretOffset(a);var e=a.get(w.CetModel.ID.POSSIBLY_PLACEHOLDER.IS_PLACEHOLDER)?0:l.Cet.shapedText(a).getLength();let f;null!=c&&null!=c.start&&null!=c.end?(f=c.start,e=c.end):null!=d?e=f=d:f=0;e-=f;return{id:a.getId(),offset:f,length:e,caretPosition:null!=c&&c.start===d?z.CaretPosition.Start:z.CaretPosition.End,isFocused:b}}vh(a){this.Gc(a,
null,null,null,null)}Gc(a,b,c,d,e){this.getScene().executeNoDomBatchUpdate((f)=>{f=f.getEntityById(a);if(null!=f&&(0===d-c&&(c=d=null),this.helper.getCaretOffset(f)!==b||this.helper.getSelectionStartOffset(f)!==c||this.helper.getSelectionEndOffset(f)!==d||this.helper.getTextSelectionFocused(f)!==e)){this.helper.setCaretOffset(f,b);this.helper.setSelection(f,this.getScene(),c,d);this.helper.setTextSelectionFocused(f,e);var g=l.Cet.shapedText(f);if(null!=b&&b<=g.getLength()){const a=g.getText().getRawText(),
c=Math.max(b-1,0);g=c<a.length&&"\n"===a[c]?g.getCharacterStylesAt(Math.max(c+1,0)):g.getCharacterStylesAt(Math.max(c,0));f.set(Z.CetRendererModule.getInEditFontSizeComponentKey(),g.getFontSize())}else f.discardOwnComponent(Z.CetRendererModule.getInEditFontSizeComponentKey());null!=b?f.set(Z.CetRendererModule.getHidePlaceHolderTextKey(),!0):f.discardOwnComponent(Z.CetRendererModule.getHidePlaceHolderTextKey())}})}Id(a){this.ma.push(a)}getTextEditEvents(){return this.Wf}Nd(a){this.Wf.push(a)}ik(){const a=
this.getTextSelectionInfo();null!=a&&a.isFocused&&this.setTextSelection(Object.assign(Object.assign({},a),{isFocused:!1}))}Qk(a){this.Bd=a}};da.Qc=class{constructor(a,b,c,d,e,f,g,h,k,l,n,q){this.Ca=a;this.v=b;this.ea=c;this.ha=d;this.ki=e;this.u=f;this.Ph=g;this.wb=h;this.camera=k;this.Gd=n;this.$h=q;this.sc=-1;this.scene=f.scene;this.helper=p.CetModelEditor.createTextHelper();this.j=new ta.dh(this.helper);this.ya=new na.ic(l);this.rj();this.ea.Qk(()=>this.ya.wc())}qc(){this.ea.clearSelection()}Wi(a){if(!D.Utils.arrayEquals(a,
this.v.getTextSelectionState().getEntityIds())){this.qc();var b=[];a=this.scene.getEntityList().getEntitiesById(a);for(let c of a)if(null!=c&&w.CetModel.textKludge.isEntityText(c))b.push(c.getId());else{b=[];break}1!==b.length?this.ya.Ef():(this.ya.Lh(this.bf(b[0])),this.ya.wc());this.ea.Id(this.v.getTextSelectionState().setEntityIds(b))}}getPasteEventAction(){return this.ya.getPasteEventAction()}getSelectAction(){return this.Gj.If}getFocusInOutStream(){return this.ya.getFocusInOutStream()}ei(a){if(this.v.getTextSelectionState().isEditing()){var b=
this.v.getTextSelectionState().getSingleEntityId(),c=this.scene.getEntityById(b);if(null!=c){var d=l.Cet.transform(c).getWorldToLocal(),e=l.Cet.localBounds(c).getGraphicsBounds().getData(),f=d.transformPoint(a.fl);a=d.transformPoint(a.el);d=l.Cet.shapedText(c);c=c.getWrapper(w.CetModel.ID.HAS_FONT.W);c=c.getDisplayBackground()?c.getBackgroundPadding():0;f=d.locateCaretOffset({x:f.x+e.width/2-c,y:f.y+e.height/2-c}).offset;e=d.locateCaretOffset({x:a.x+e.width/2-c,y:a.y+e.height/2-c}).offset;f===e?f=
a=null:f>e?a=e:(a=f,f=e);this.ea.Gc(b,e,a,f,!0)}}}gd(a){const b=a.entityId;var c=this.scene.getEntityById(b);if(null!=c){var d=l.Cet.shapedText(c),e;if(this.helper.isPlaceholder(c)){var f=e=null;var g=0}else{const b=this.j.Ve(c,d,a.Oa);if(a.isEditing)switch(a.Uc){case 1:a.ga.event.shiftKey?(a=this.helper.getCaretOffset(c),f=b,this.helper.hasSelection(c)?(c=this.helper.getSelection(c),e=a===c.start?c.end:c.start):e=a,g=b):a.ga.event.ctrlKey?(f=d.getWordBoundaryToLeft(b,!1),g=e=d.getWordBoundaryToRight(b)):
g=f=e=b;break;case 2:f=d.getWordBoundaryToLeft(b,!1);g=e=d.getWordBoundaryToRight(b);break;case 3:f=d.getParagraphBoundaryToLeft(b),g=e=d.getParagraphBoundaryToRight(b)}else f=e=null,g=b}this.ea.setTextSelection({id:b,offset:null!=f?f:g,length:null!=e?e-f:0,caretPosition:null!=f&&null!=e&&f===g?z.CaretPosition.Start:z.CaretPosition.End,isFocused:!0})}}selectRightClickedWord_forSpellCheck(a){const b=this.v.getTextSelectionState().getSingleEntityId();var c=this.scene.getEntityById(b);if(null!=c){var d=
l.Cet.shapedText(c);if(this.helper.isPlaceholder(c))c=d=null,a=0;else if(a=this.j.Ve(c,d,a),this.v.getTextSelectionState().isEditing()){if(this.helper.hasSelection(c)&&(c=this.helper.getSelection(c),null!=c&&c.start<=a&&c.end>=a))return;c=this.helper.getSpecialTokens(d.getRawText());const b=this.helper.findSpecialToken(c,a,a);null!=b?(c=b.pos,a=d=b.end):(c=d.getWordBoundaryToLeft(a,!1),a=d=d.getWordBoundaryToRight(a))}else c=d=null;this.ea.setTextSelection({id:b,offset:null!=c?c:a,length:null!=d?
d-c:0,caretPosition:null!=c&&null!=d&&c===a?z.CaretPosition.Start:z.CaretPosition.End,isFocused:!0})}}fi(){if(this.v.getTextSelectionState().isSingleSelection()){var a=this.v.getTextSelectionState().getSingleEntityId(),b=this.scene.getEntityById(a);if(null!=b){var c=l.Cet.shapedText(b),d=0;this.helper.isPlaceholder(b)||""===c.getRawText()||(d=c.getRawText().length);this.ea.setTextSelection({id:a,offset:d,length:0,caretPosition:z.CaretPosition.End,isFocused:!0})}}}mh(a,b){if(null!=b.command)this.ea.Nd(b.command);
else if(b.Xa)this.qc();else{var c=this.scene.getEntityById(a);if(null!=c){c=l.Cet.shapedText(c).getLength();let d=null,e=null;b.selectionStartOffset!==b.selectionEndOffset&&(d=Math.max(b.selectionStartOffset,0),e=Math.min(b.selectionEndOffset,c));this.ea.Gc(a,b.caretOffset,d,e,!0)}}}gf(a){var b=this.v.getTextSelectionState();if(null!=b&&b.isSingleSelection()){let c=this.ea.getTextSelectionInfo();null==c&&(this.ea.setTextSelection({id:b.getEntityIds()[0],offset:Infinity,length:0,caretPosition:z.CaretPosition.End,
isFocused:!0}),c=this.ea.getTextSelectionInfo());b="compositionupdate"===a.eventType||"compositionend"===a.eventType||"osxlongpress"===a.eventType;const d=this.bl(c&&c.id,a);b&&this.ea.setTextSelection({id:c.id,offset:d,length:c.length+(c.offset-d),caretPosition:z.CaretPosition.End,isFocused:!0});this.ea.Nd({kind:z.TextEditEventKind.Insert,text:a.text})}}deleteText(){if(this.v.getTextSelectionState().isSingleSelection()){var a=this.v.getTextSelectionState().getSingleEntityId();this.v.getTextSelectionState().isEditing()?
this.ea.Nd({kind:z.TextEditEventKind.Command,command:z.TextEditCommandKind.Backspace,modifiers:{altKey:!1,shiftKey:!1,ctrlKey:!1,metaKey:!1,os:R.PreziUAParser.getOsKind()}}):this.u.executeApiCommand(this.Ph.deleteObjectCmd([a],"KEY_BACKSPACE"))}}getSelectedTextFromEntity_forSpellCheck(a,b=!1){return this.helper.getSelectedText(a,b)}rj(){this.Ca.onValue((a)=>{this.Wi(a.allEntityIds)});this.Cj();this.qj();this.Bj();this.Gj=new Ea.Td(this.ya.xd,this.ya.Ob,this.v.getTextSelectionStateStream(),this.scene,
new nb.Ag(this.helper,this.j),this);new ob.Jg(this.ha,this.v.getTextSelectionStateStream(),this.wb,this.camera,this.scene,this)}Bj(){this.Gd.onValue(()=>{if(this.v.getTextSelectionState().isSingleSelection()){var a=this.scene.getEntityById(this.v.getTextSelectionState().getSingleEntityId());if(a){let b=l.Cet.shapedText(a);this.ea.setTextSelection({id:a.getId(),offset:0,length:b.getLength(),caretPosition:z.CaretPosition.End,isFocused:!0})}}})}qj(){let a;const b=this.$h.map((a)=>a===A.EditorMode.edit).toProperty(!0);
this.ki.throttle(0).filterWithStream(b).onValue((b)=>{b===Q.ComponentFocusModeKind.canvas&&this.qc();b===Q.ComponentFocusModeKind.ui&&this.ea.ik();b===Q.ComponentFocusModeKind.textEditor&&this.ya.wc();b===Q.ComponentFocusModeKind.none&&this.v.getTextSelectionState().isEditing()&&(clearTimeout(a),a=setTimeout(()=>{this.ya.wc()},0))})}bf(a){a=this.scene.getEntityById(a).getComponent(Z.CetRendererModule.getWorldGeometryComponentKey());if(null==a)return{x:0,y:0};a=a.getWorldBounds().getVertices();a=M.Geometry.interpolatePoint(a[0],
a[1],.5);return this.camera.getTransform().transformPoint(a)}Cj(){this.scene.getIdleChangeStream(l.ChangeEventKind.Entity).toProperty([]).onValue((a)=>{if(this.v.getTextSelectionState().isSingleSelection()){var b=this.v.getTextSelectionState().getSingleEntityId();a.some((a)=>{let c=a.entities?a.entities:[a.entity];return a.type===w.ChangeType.ModifyComponent&&a.componentKey===w.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD&&c.some((a)=>null!=a&&a.getId()===b)})&&this.ya.Yf(this.bf(b))}})}af(a){a=this.scene.getEntityById(a);
return this.helper.hasSelection(a)?this.helper.getSelectionStartOffset(a):this.helper.isPlaceholder(a)?0:this.helper.getCaretOffset(a)}bl(a,b){"compositionstart"===b.eventType&&null!=a?this.sc=a=this.af(a):"compositionend"===b.eventType?(a=this.sc,this.sc=-1):a="osxlongpress"===b.eventType&&null!=a?this.af(a)-1:this.sc;return a}getSelection_forSpellCheck(a){return this.helper.hasSelection(a)?this.helper.getSelection(a):null}};da.Qc.zg="#"+na.ic.Ud;var pb={};Object.defineProperty(pb,"__esModule",{value:!0});
pb.eh=class{createTextSelectionController(a,b,c){return new da.ge(a,b,c)}createTextEditorController(a,b,c,d,e,f,g,h,k,l,n,p,q){if(!(d instanceof da.ge))throw Error("textSelectionController should be TextSelectionControllerImpl");return new da.Qc(a,b,d,c,e,f,g,h,k,l,n,q)}getImeInputSelector(){return da.Qc.zg}};var I={};Object.defineProperty(I,"__esModule",{value:!0});(function(a){a[a.UNDO=0]="UNDO";a[a.REDO=1]="REDO"})(I.UndoRedoAction||(I.UndoRedoAction={}));(function(a){a[a.COPY=0]="COPY";a[a.PASTE=
1]="PASTE";a[a.CUT=2]="CUT"})(I.CopyPasteType||(I.CopyPasteType={}));(function(a){a[a.button=0]="button";a[a.keyboard=1]="keyboard"})(I.UndoRedoRequestTrigger||(I.UndoRedoRequestTrigger={}));(function(a){a[a.CHARACTER_FORWARD=0]="CHARACTER_FORWARD";a[a.CHARACTER_BACKWARD=1]="CHARACTER_BACKWARD"})(I.DeleteAction||(I.DeleteAction={}));I.EditorControllerModule=new lb.vg;I.TextEditorModule=new pb.eh;I.ObjectEditorModule=new mb.Pg;return Ib=I});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_editor_controller",["require","prezi.engine.dom","prezi.geometry","prezi_app_utils","prezi_bacon","prezi_brand_kit_cta","prezi_canvas_listener","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_cet_renderer","prezi_editor_commander","prezi_editor_error","prezi_editor_store_common","prezi_editor_store_focus","prezi_editor_store_mode","prezi_editor_store_object","prezi_externalserviceprovider","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_nativeapitypes","prezi_playback","prezi_plugin_api","prezi_plugin_meta","prezi_replacer","prezi_select","prezi_service_browsernotification","prezi_service_data","prezi_service_media","prezi_templateservice","prezi_textmodel","prezi_type_collector","prezi_typescript_compiler","prezi_uaparser","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_editor_controller.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1).concat([function(){return new Promise(function(resolve,reject){require(["prezi_about_box"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_alignment_tools"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ar_convert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ar_video_template_tools"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_asset_hyperlink"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_assets"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_bracket_frame"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_brand_colors"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_chart_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_classic_import"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_classic_to_next_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_dashed_line"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_debug"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_depth_of_field"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_download_presentation"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_editor_mode"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_engagement_tools_helper"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_equation_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_export_to_pdf"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_extended_selection"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_favorites"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_file_picker_integrations"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_font_admin"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_font_preview"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_font_selector"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_frame_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_grouping"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_hamburger_menu_improvements"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_interaction_mode"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_layout"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_local_service_mocks"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_lock_objects"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_marker_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_narrative_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_navigation"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_parallax_background"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_path_audio"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_path_editing"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_path_generation_strategy"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_photo_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ppt_edit"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ppt_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_prezi_video_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_qr_code_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_search_replace"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_select_similar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_shape_and_arc_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_snippet_editing_layout_options"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_solid_color"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_storyblocks"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_storyblocks_admin"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_style"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_syntax_highlight"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_template_from_storyblocks"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_test_navigationbar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_test_propertybar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_test_sidebar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_text_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_topic_grouping_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_topic_shape"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_turn_into_topic"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_video_background"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_video_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_video_template_from_figma"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_view_to_dashboard_test"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_visual_types"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_z_order_object"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});}]));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.geometry"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_brand_kit_cta"),require("prezi_canvas_listener"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_editor_commander"),require("prezi_editor_error"),require("prezi_editor_store_common"),require("prezi_editor_store_focus"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_nativeapitypes"),require("prezi_playback"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_replacer"),require("prezi_select"),require("prezi_service_browsernotification"),require("prezi_service_data"),require("prezi_service_media"),require("prezi_templateservice"),require("prezi_textmodel"),require("prezi_type_collector"),require("prezi_typescript_compiler"),require("prezi_uaparser"),require("prezi_utils"),require("prezi_widgets"),function(){return Promise.resolve(require("prezi_about_box").lazyModule);},function(){return Promise.resolve(require("prezi_alignment_tools").lazyModule);},function(){return Promise.resolve(require("prezi_ar_convert").lazyModule);},function(){return Promise.resolve(require("prezi_ar_video_template_tools").lazyModule);},function(){return Promise.resolve(require("prezi_asset_hyperlink").lazyModule);},function(){return Promise.resolve(require("prezi_assets").lazyModule);},function(){return Promise.resolve(require("prezi_bracket_frame").lazyModule);},function(){return Promise.resolve(require("prezi_brand_colors").lazyModule);},function(){return Promise.resolve(require("prezi_chart_insert").lazyModule);},function(){return Promise.resolve(require("prezi_classic_import").lazyModule);},function(){return Promise.resolve(require("prezi_classic_to_next_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_dashed_line").lazyModule);},function(){return Promise.resolve(require("prezi_debug").lazyModule);},function(){return Promise.resolve(require("prezi_depth_of_field").lazyModule);},function(){return Promise.resolve(require("prezi_download_presentation").lazyModule);},function(){return Promise.resolve(require("prezi_editor_mode").lazyModule);},function(){return Promise.resolve(require("prezi_engagement_tools_helper").lazyModule);},function(){return Promise.resolve(require("prezi_equation_editor").lazyModule);},function(){return Promise.resolve(require("prezi_export_to_pdf").lazyModule);},function(){return Promise.resolve(require("prezi_extended_selection").lazyModule);},function(){return Promise.resolve(require("prezi_favorites").lazyModule);},function(){return Promise.resolve(require("prezi_file_picker_integrations").lazyModule);},function(){return Promise.resolve(require("prezi_font_admin").lazyModule);},function(){return Promise.resolve(require("prezi_font_preview").lazyModule);},function(){return Promise.resolve(require("prezi_font_selector").lazyModule);},function(){return Promise.resolve(require("prezi_frame_insert").lazyModule);},function(){return Promise.resolve(require("prezi_grouping").lazyModule);},function(){return Promise.resolve(require("prezi_hamburger_menu_improvements").lazyModule);},function(){return Promise.resolve(require("prezi_interaction_mode").lazyModule);},function(){return Promise.resolve(require("prezi_layout").lazyModule);},function(){return Promise.resolve(require("prezi_local_service_mocks").lazyModule);},function(){return Promise.resolve(require("prezi_lock_objects").lazyModule);},function(){return Promise.resolve(require("prezi_marker_editor").lazyModule);},function(){return Promise.resolve(require("prezi_narrative_editor").lazyModule);},function(){return Promise.resolve(require("prezi_navigation").lazyModule);},function(){return Promise.resolve(require("prezi_parallax_background").lazyModule);},function(){return Promise.resolve(require("prezi_path_audio").lazyModule);},function(){return Promise.resolve(require("prezi_path_editing").lazyModule);},function(){return Promise.resolve(require("prezi_path_generation_strategy").lazyModule);},function(){return Promise.resolve(require("prezi_photo_editor").lazyModule);},function(){return Promise.resolve(require("prezi_ppt_edit").lazyModule);},function(){return Promise.resolve(require("prezi_ppt_insert").lazyModule);},function(){return Promise.resolve(require("prezi_prezi_video_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_qr_code_insert").lazyModule);},function(){return Promise.resolve(require("prezi_search_replace").lazyModule);},function(){return Promise.resolve(require("prezi_select_similar").lazyModule);},function(){return Promise.resolve(require("prezi_shape_and_arc_editor").lazyModule);},function(){return Promise.resolve(require("prezi_snippet_editing_layout_options").lazyModule);},function(){return Promise.resolve(require("prezi_solid_color").lazyModule);},function(){return Promise.resolve(require("prezi_storyblocks").lazyModule);},function(){return Promise.resolve(require("prezi_storyblocks_admin").lazyModule);},function(){return Promise.resolve(require("prezi_style").lazyModule);},function(){return Promise.resolve(require("prezi_syntax_highlight").lazyModule);},function(){return Promise.resolve(require("prezi_template_from_storyblocks").lazyModule);},function(){return Promise.resolve(require("prezi_test_navigationbar").lazyModule);},function(){return Promise.resolve(require("prezi_test_propertybar").lazyModule);},function(){return Promise.resolve(require("prezi_test_sidebar").lazyModule);},function(){return Promise.resolve(require("prezi_text_editor").lazyModule);},function(){return Promise.resolve(require("prezi_topic_grouping_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_topic_shape").lazyModule);},function(){return Promise.resolve(require("prezi_turn_into_topic").lazyModule);},function(){return Promise.resolve(require("prezi_video_background").lazyModule);},function(){return Promise.resolve(require("prezi_video_insert").lazyModule);},function(){return Promise.resolve(require("prezi_video_template_from_figma").lazyModule);},function(){return Promise.resolve(require("prezi_view_to_dashboard_test").lazyModule);},function(){return Promise.resolve(require("prezi_visual_types").lazyModule);},function(){return Promise.resolve(require("prezi_z_order_object").lazyModule);});}else{this["prezi_editor_controller"]=__factory(this["prezi.engine.dom"],this["prezi.geometry"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_brand_kit_cta"],this["prezi_canvas_listener"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_editor_commander"],this["prezi_editor_error"],this["prezi_editor_store_common"],this["prezi_editor_store_focus"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_nativeapitypes"],this["prezi_playback"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_replacer"],this["prezi_select"],this["prezi_service_browsernotification"],this["prezi_service_data"],this["prezi_service_media"],this["prezi_templateservice"],this["prezi_textmodel"],this["prezi_type_collector"],this["prezi_typescript_compiler"],this["prezi_uaparser"],this["prezi_utils"],this["prezi_widgets"],function(){return Promise.resolve(this["prezi_about_box"].lazyModule);},function(){return Promise.resolve(this["prezi_alignment_tools"].lazyModule);},function(){return Promise.resolve(this["prezi_ar_convert"].lazyModule);},function(){return Promise.resolve(this["prezi_ar_video_template_tools"].lazyModule);},function(){return Promise.resolve(this["prezi_asset_hyperlink"].lazyModule);},function(){return Promise.resolve(this["prezi_assets"].lazyModule);},function(){return Promise.resolve(this["prezi_bracket_frame"].lazyModule);},function(){return Promise.resolve(this["prezi_brand_colors"].lazyModule);},function(){return Promise.resolve(this["prezi_chart_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_classic_import"].lazyModule);},function(){return Promise.resolve(this["prezi_classic_to_next_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_dashed_line"].lazyModule);},function(){return Promise.resolve(this["prezi_debug"].lazyModule);},function(){return Promise.resolve(this["prezi_depth_of_field"].lazyModule);},function(){return Promise.resolve(this["prezi_download_presentation"].lazyModule);},function(){return Promise.resolve(this["prezi_editor_mode"].lazyModule);},function(){return Promise.resolve(this["prezi_engagement_tools_helper"].lazyModule);},function(){return Promise.resolve(this["prezi_equation_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_export_to_pdf"].lazyModule);},function(){return Promise.resolve(this["prezi_extended_selection"].lazyModule);},function(){return Promise.resolve(this["prezi_favorites"].lazyModule);},function(){return Promise.resolve(this["prezi_file_picker_integrations"].lazyModule);},function(){return Promise.resolve(this["prezi_font_admin"].lazyModule);},function(){return Promise.resolve(this["prezi_font_preview"].lazyModule);},function(){return Promise.resolve(this["prezi_font_selector"].lazyModule);},function(){return Promise.resolve(this["prezi_frame_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_grouping"].lazyModule);},function(){return Promise.resolve(this["prezi_hamburger_menu_improvements"].lazyModule);},function(){return Promise.resolve(this["prezi_interaction_mode"].lazyModule);},function(){return Promise.resolve(this["prezi_layout"].lazyModule);},function(){return Promise.resolve(this["prezi_local_service_mocks"].lazyModule);},function(){return Promise.resolve(this["prezi_lock_objects"].lazyModule);},function(){return Promise.resolve(this["prezi_marker_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_narrative_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_navigation"].lazyModule);},function(){return Promise.resolve(this["prezi_parallax_background"].lazyModule);},function(){return Promise.resolve(this["prezi_path_audio"].lazyModule);},function(){return Promise.resolve(this["prezi_path_editing"].lazyModule);},function(){return Promise.resolve(this["prezi_path_generation_strategy"].lazyModule);},function(){return Promise.resolve(this["prezi_photo_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_ppt_edit"].lazyModule);},function(){return Promise.resolve(this["prezi_ppt_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_prezi_video_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_qr_code_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_search_replace"].lazyModule);},function(){return Promise.resolve(this["prezi_select_similar"].lazyModule);},function(){return Promise.resolve(this["prezi_shape_and_arc_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_snippet_editing_layout_options"].lazyModule);},function(){return Promise.resolve(this["prezi_solid_color"].lazyModule);},function(){return Promise.resolve(this["prezi_storyblocks"].lazyModule);},function(){return Promise.resolve(this["prezi_storyblocks_admin"].lazyModule);},function(){return Promise.resolve(this["prezi_style"].lazyModule);},function(){return Promise.resolve(this["prezi_syntax_highlight"].lazyModule);},function(){return Promise.resolve(this["prezi_template_from_storyblocks"].lazyModule);},function(){return Promise.resolve(this["prezi_test_navigationbar"].lazyModule);},function(){return Promise.resolve(this["prezi_test_propertybar"].lazyModule);},function(){return Promise.resolve(this["prezi_test_sidebar"].lazyModule);},function(){return Promise.resolve(this["prezi_text_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_topic_grouping_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_topic_shape"].lazyModule);},function(){return Promise.resolve(this["prezi_turn_into_topic"].lazyModule);},function(){return Promise.resolve(this["prezi_video_background"].lazyModule);},function(){return Promise.resolve(this["prezi_video_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_video_template_from_figma"].lazyModule);},function(){return Promise.resolve(this["prezi_view_to_dashboard_test"].lazyModule);},function(){return Promise.resolve(this["prezi_visual_types"].lazyModule);},function(){return Promise.resolve(this["prezi_z_order_object"].lazyModule);});}}).call(this);