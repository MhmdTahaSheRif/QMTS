;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_turn_into_topic";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_featureswitcher":dependencies[2],"prezi_i18n":dependencies[3],"prezi_logger":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_plugin_meta":dependencies[6],"prezi_utils":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(c){var k=c.dependencies.prezi_i18n,m=c.dependencies.prezi_cet_model_editor,r=c.dependencies["prezi.geometry"],t=c.dependencies.prezi_plugin_api,g=c.dependencies.prezi_featureswitcher,l=c.dependencies.prezi_logger,u=c.dependencies.prezi_plugin_meta,q={};Object.defineProperty(q,"__esModule",{value:!0});var e=m.base.ObjectKind;q.v=class{constructor(){this.w=g.isActive("js-unique-differentiation")?[e.planetTopic,e.overview,e.page]:[e.planetTopic,e.overview];this.aa=[e.cover,e.visual,e.master,
e.surface]}init(a){this.f=a.declareUI({i:!1,currentTopicId:null,selectedIds:[],activePathElementId:null},(a,d)=>{a.i&&this.$(a,d)});a.onCurrentTopicChange((a)=>{this.f.setState({currentTopicId:a})});a.onSelectionChange((a)=>{this.session.document.read((d)=>{const v={allObjects:a.allObjects.map((a)=>d.lookup.resolve(a)),groups:a.groups.map((a)=>d.lookup.resolve(a)),nonGroupedObjects:a.nonGroupedObjects.map((a)=>d.lookup.resolve(a))};this.u(v)})});a.onDocumentChange(()=>{this.session.document.read((a)=>
{a=this.session.selection.getReadonlySelectionInfo(a);this.u(a)})})}processMessage(a){switch(a.kind){case u.TurnIntoTopicMessageKind.setActivePathElement:this.f.setState({activePathElementId:a.activePathElementId})}}u(a){this.f.setState({selectedIds:a.allObjects.map((a)=>a.id)});if(a.allObjects.some((a)=>a.is(m.base.ObjectKind.lockable)&&a.locked))this.f.setState({i:!1});else if(2>a.allObjects.length)this.f.setState({i:!1});else{var c=a.allObjects[0].parent,d=-1!==this.w.indexOf(c.kind)&&a.allObjects.every((a)=>
a.parent===c&&-1===this.aa.indexOf(a.kind));a=g.isActive("js-unique-differentiation")?d&&!a.allObjects.every((a)=>a.kind===e.zoomArea):d;this.f.setState({i:a})}}$(a,c){c.createPropertyBarItem((d)=>d.button(Object.assign(Object.assign({},g.isActive("js-unique-differentiation")?{groupWeight:10,weight:102,icon:t.IconSmallId.NewTopic,tooltip:k.I18n.ts("Turn into frame"),id:"multiselect-turn-into-zoom-area"}:{groupWeight:10,weight:102,tooltip:k.I18n.ts("Create a new topic from the selected items on your canvas"),
id:"multiselect-turn-into-topic",title:k.I18n.ts("Turn into topic")}),{onClick:(d)=>{g.isActive("js-unique-differentiation")?this.o(d,a.currentTopicId,a.selectedIds):this.j(d,a.currentTopicId,a.selectedIds);l.avro.Avro.createDefaultLogger().logTurnSelectionIntoFrame()}})));c.createMenuItem({kind:t.MenuItemKind.context,id:g.isActive("js-unique-differentiation")?"turn-into-zoom-area":"turn-into-topic",title:g.isActive("js-unique-differentiation")?k.I18n.ts("Turn into frame"):k.I18n.ts("Turn into topic"),
weight:67,onClick:g.isActive("js-unique-differentiation")?(d)=>this.o(d,a.currentTopicId,a.selectedIds):(d)=>this.j(d,a.currentTopicId,a.selectedIds),enabled:!0})}o(a,c,d){this.session.document.executeApiCommand(a,{name:"turn selected objects into zoom area",run:(e)=>{var f=e.lookup.simpleObjectParent(c),b=d.map((a)=>e.lookup.transformedObject(a));b=b[0].createLayoutGroupWith(b.slice(1)).layoutBox.aabb;f=f.add.zoomArea();var n=f.layoutBox.size.width/f.layoutBox.size.height,h=1.1*b.size.height;h=b.withSize({height:h,
width:h*n});const g=1.1*b.size.width;b=b.withSize({width:g,height:g/n});b=h.union(b);f.fitInto(b);this.session.selection.setSelection(a,[f]);l.avro.Avro.createDefaultLogger().logNewObject({object_type:f,topic_relationship:f,parent_type:f,object_id:f.id});e.animate(f).bounce();b=e.structuredPath.pathElementsInOrder.find((a)=>(a.is(m.base.ObjectKind.visitOverview)||a.is(m.base.ObjectKind.visitPlanet)||a.is(m.base.ObjectKind.visitPage))&&a.target.id===c);if(null!=b){const a=this.f.getState().activePathElementId;
n=b.children.findIndex((b)=>b.id===a);b.add.zoom(-1<n?n+1:b.children.length,f);l.avro.Avro.createDefaultLogger().logAddAnimation({animation_type:"ZOOM_AREA"})}return f.ref}})}j(a,c,d){const g=this.session.document.executeApiCommand(a,{name:"turn selected objects into topic",run:(f)=>{var b=f.lookup.topicParent(c);const g=b.zoomLayoutBox,h=b.add.planet();h.contentChildren.forEach((a)=>a.delete());const k=h.simpleChildren(m.base.ChildVisibilityKind.inside).reduce((a,b)=>b.isAbove(a)?b:a);b=d.map((a)=>
f.lookup.transformedObject(a)).sort((a,b)=>a.isAbove(b)?-1:1);var p=b.map((a)=>a.position).reduce((a,b)=>a.add(r.Geometry.fromPoint(b)),r.Geometry.fromCoordinates(0,0)).mul(1/b.length).toPoint();h.position=p;p=(a)=>{if(0!==a.length){a=a[0].createLayoutGroupWith(a.slice(1));var b=a.layoutBox.align(g.topLeft,g.topRight,h.zoomLayoutBox.topLeft,h.zoomLayoutBox.topRight);a.tryToSetParent(h);a.fitInto(b)}};var l=b.filter((a)=>a.is(e.topic));p(l);l=b.filter((a)=>!a.is(e.topic));p(l);b.forEach((a)=>{a.moveAbove(k)});
this.session.selection.setSelection(a,[h]);return h.ref}});this.session.document.executeApiCommand(a,{name:"turn selected objects into topic",run:(a)=>{const b=a.lookup.resolve(g);a.animate(b).bounce()}})}};c={};Object.defineProperty(c,"__esModule",{value:!0});c.lazyModule={createPlugin(){return new q.v}};return c});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_turn_into_topic",["require","prezi.geometry","prezi_cet_model_editor","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_turn_into_topic.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"));}else{this["prezi_turn_into_topic"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"]);}}).call(this);