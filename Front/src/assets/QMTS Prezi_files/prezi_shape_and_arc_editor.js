;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_shape_and_arc_editor";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_brand_kit_cta":dependencies[1],"prezi_cet_model_editor":dependencies[2],"prezi_editor_commander":dependencies[3],"prezi_featureswitcher":dependencies[4],"prezi_i18n":dependencies[5],"prezi_logger":dependencies[6],"prezi_plugin_api":dependencies[7],"prezi_plugin_meta":dependencies[8],"prezi_utils":dependencies[9],"prezi_widgets":dependencies[10]}};})());};})(arguments);var moduleImpl=(function(){return module(function(t){function M(b,a,c,r){a*=.5;let f="";const m={moveTo:(a,b)=>f+=`M ${a} ${b}`,lineTo:(a,b)=>f+=`L ${a} ${b}`,quadraticCurveTo:(a,b,c,e)=>f+=`Q ${a} ${b} ${c} ${e}`};var h=-Math.abs(b)/2;b=Math.abs(b)/2;m.moveTo(h+a,0-a);m.lineTo(b-7.2*a,0-a);var p=4*a,e=6*a,y=8*a,d=b-e,z=0-p;e=b-e;var v=0+p,k=b-y,g=0+p,n=b-(3.2*a+p),l=0+a;m.lineTo(b-y,0-p);m.quadraticCurveTo(d,z,b,0);m.quadraticCurveTo(e,v,k,g);m.lineTo(n,l);b=0+a;d=.4*a;z=-.4*a;p=-a;y=h+.6*a;e=0-a;m.lineTo(h+.6*a,0+a);m.quadraticCurveTo(h,
b,h,d);m.lineTo(h,z);m.quadraticCurveTo(h,p,y,e);f+="Z";return`<path
				fill="${c}"
				opacity="${r}"
				d="${f}"
			/>`}function O(b){switch(b){case n.ShapePresetKind.rectangle:return{kind:"rectangle",width:100/90*160,height:100};case n.ShapePresetKind.square:return{kind:"rectangle",width:100,height:100};case n.ShapePresetKind.circle:return{kind:"circle",width:100,height:100};case n.ShapePresetKind.triangle:return{kind:"triangle",width:100,height:100};default:throw Error(`invalid ShapePresetKind ${b}`);}}var C=t.dependencies.prezi_brand_kit_cta,E=t.dependencies.prezi_featureswitcher,w=t.dependencies.prezi_widgets,
J=t.dependencies["prezi.geometry"],d=t.dependencies.prezi_cet_model_editor,g=t.dependencies.prezi_i18n,q=t.dependencies.prezi_logger,k=t.dependencies.prezi_plugin_api,x=t.dependencies.prezi_editor_commander,K=t.dependencies.prezi_plugin_meta,B=t.dependencies.prezi_utils,n={};Object.defineProperty(n,"__esModule",{value:!0});(function(b){b[b.rectangle=0]="rectangle";b[b.square=1]="square";b[b.circle=2]="circle";b[b.triangle=3]="triangle"})(n.ShapePresetKind||(n.ShapePresetKind={}));n.attrs=function(b){return`${Object.keys(b).map((a)=>
`${a}="${b[a]}"`).join(" ")}`};var F={createArcPreset:function(b,a,c){if(null==a.fill||null==a.fill.color)return null;const r=a.fill.color,f=null!=a.fill.alpha?a.fill.alpha:1;let m=null!=a.arc&&0<=a.thickness?a.thickness:0;var h=120+m;a=(a,c,h,k,z)=>{var e={x:-a/2,y:-c/2,width:a,height:c};a=[e.x,e.y,e.width,e.height];c=e.width;var p=e.height;z=z?`<rect ${n.attrs(e)} fill="${x.toCssColor(x.getBgColor(r,f))}" />`:"";a:switch(e=x.toCssColor(r),b){case d.base.ObjectKind.line:{const a=.5*m;h=`<path
				stroke="${e}"
				stroke-width="${m}"
				stroke-opacity="${f}"
				stroke-linecap="round"
				stroke-linejoin="miter"
				d="${`M ${-Math.abs(h)/2+a} 0 L ${Math.abs(h)/2-a} 0`}"
			/>`}break a;case d.base.ObjectKind.arrow:h=M(h,m,e,f);break a;default:throw Error(`invalid arckkind ${b}`);}return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${a}"
					width="${c}" height="${p}">
					${z}
					<g ${k?'transform="rotate(-45)"':""}>
						${h}
					</g>
				</svg>`};h=a(h,h,120,!0,!0);a=a(H.width,H.height,H.width,!1,!1);return{presetKind:"arc",kind:b,style:c,thumbnail:B.Utils.svgToUrl(h),smallThumbnail:B.Utils.svgToUrl(a),hasLightColor:x.hasLightColor(r,f)}}};Object.defineProperty(F,"__esModule",{value:!0});const H={width:216,height:36};var G={createShapePreset:function(b,a,c){const [r,f,m,h]=null!=a.fill&&a.fill.fillKind===d.base.FillKind.solid?[a.fill.color,null!=a.fill.alpha?a.fill.alpha:1,a.fill.color,null!=a.fill.alpha?a.fill.alpha:1]:null!=
a.fill&&a.fill.fillKind===d.base.FillKind.linear?[a.fill.gradientStartColor,null!=a.fill.gradientStartAlpha?a.fill.gradientStartAlpha:1,a.fill.gradientEndColor,null!=a.fill.gradientEndAlpha?a.fill.gradientEndAlpha:1]:[null,1,null,1];if(null==r||null==m)return null;const p=null!=a.border&&0<=a.border.thickness?a.border.thickness:0,e=null!=a.border&&0<=a.border.thickness?a.border.color:null,y=null!=a.border&&null!=a.border.alpha?a.border.alpha:1,k=null!=e?e:r,z=null!=e?y:f,v=1.2*(100+p);var g=(a,c,
d,g,u)=>{const l={x:-(a/c)*v/2+d/2,y:-v/2,width:a/c*v+d,height:v};d=[l.x,l.y,l.width,l.height];var N=x.toCssColor(r),t=x.toCssColor(m),q;if(q=u)q=`<rect
				stroke="${x.toCssColor(e)}"
				stroke-width="${p}"
				stroke-opacity="${y}"
				stroke-linecap="round"
				stroke-linejoin="round"
				fill="${"url(#fill)"}"

				x="${-v/2}"
				y="${-v/2}"
				width="${v}"
				height="${v}"
			/>`;g=!u&&g?`<rect ${n.attrs(l)} fill="${x.toCssColor(x.getBgColor(k,z))}"/>`:"";if(u=!u)a:switch(u=x.toCssColor(e),b){case n.ShapePresetKind.rectangle:u=`<rect
				stroke="${u}"
				stroke-width="${p}"
				stroke-opacity="${y}"
				stroke-linecap="round"
				stroke-linejoin="round"
				fill="${"url(#fill)"}"

				x="${-50}"
				y="${-28.125}"
				width="${100}"
				height="${56.25}"
			/>`;break a;case n.ShapePresetKind.circle:u=`<circle
				stroke="${u}"
				stroke-width="${p}"
				stroke-opacity="${y}"
				stroke-linecap="round"
				stroke-linejoin="round"
				fill="${"url(#fill)"}"
				cx="0"
				cy="0"
				r="50"
			/>`;break a;case n.ShapePresetKind.triangle:u=`<polygon
				stroke="${u}"
				stroke-width="${p}"
				stroke-opacity="${y}"
				stroke-linecap="round"
				stroke-linejoin="round"
				fill="${"url(#fill)"}"
				points="0 -50 -50 50 50 50"
			/>`;break a;case n.ShapePresetKind.square:u=`<rect
				stroke="${u}"
				stroke-width="${p}"
				stroke-opacity="${y}"
				stroke-linecap="round"
				stroke-linejoin="round"
				fill="${"url(#fill)"}"

				x="${-50}"
				y="${-50}"
				width="${100}"
				height="${100}"
			/>`;break a;default:throw Error(`invalid ShapePresetKind ${b}`);}return`<svg xmlns="http://www.w3.org/2000/svg"
					viewBox="${d}"
					width="${a}" height="${c}">
				<defs>
					<linearGradient id="fill" gradientTransform="rotate(90)">
						<stop offset="0" stop-color="${N}" stop-opacity="${f}" />
						<stop offset="1" stop-color="${t}" stop-opacity="${h}" />
					</linearGradient>
					</defs>
					${q}
					${g}
					${u}
				</svg>`};a=g(v,v,0,!0,!1);const l=g(I.width,I.height,I.paddingRight,!1,!1);g=g(v,v,0,!1,!0);return Object.assign(Object.assign({},O(b)),{presetKind:"shape",style:c,fullThumbnail:B.Utils.svgToUrl(g),thumbnail:B.Utils.svgToUrl(a),smallThumbnail:B.Utils.svgToUrl(l),shapePresetKind:b,hasLightColor:x.hasLightColor(k,z)})}};Object.defineProperty(G,"__esModule",{value:!0});const I={width:96,height:48,paddingRight:0};var l={};Object.defineProperty(l,"__esModule",{value:!0});var P=d.base.getArrowHeadLength,
D=d.base.ObjectKind,L=d.base.readerIs,A;(function(b){b.none="none";b.shape="shape";b.arc="arc"})(A||(A={}));l.ShapeAndArcEditorPlugin=class{init(b){this.longRunningExecutor=x.createLongRunningExecutor(this.session);this.uiRoot=b.declareUI({shapePresets:[],arcPresets:[],chainLinkPresets:[],propertyBar:{type:A.none},activePresetSelector:null,currentTopicId:null,selectedSizes:new Map,networkStatus:k.NetworkStatus.Online,brandKitCTA:E.isActive("js-present-editor-brandkit-enabled")&&E.isActive("js-show-brand-kit-paywalls")?
C.BrandKitCTA.sul:C.BrandKitCTA.none},(a,b)=>{this.registerSidebar(b,{id:l.ShapeAndArcEditorPlugin.shapeSidebarId,presets:a.shapePresets,title:g.I18n.ts("Shape"),menu:{id:l.ShapeAndArcEditorPlugin.shapeMenuItemId,weight:50,iconId:k.IconSmallId.Shape,categoryWeight:0,defaultSelected:!0},log:{closeSidebar:(a)=>a.logCloseShapeSidebar(),openSidebar:(a)=>a.logShowShapeInsertOptions(),menuClick:(a)=>a.logClickTabMenuItem({tab_menu_item:"SHAPE"})}});this.registerSidebar(b,{id:l.ShapeAndArcEditorPlugin.arcSidebarId,
presets:a.arcPresets,title:g.I18n.ts("Line"),menu:{id:l.ShapeAndArcEditorPlugin.arcMenuItemId,weight:51,iconId:k.IconSmallId.ArrowsAndLines,categoryWeight:0,defaultSelected:!0},log:{closeSidebar:(a)=>a.logCloseLineArrowSidebar(),openSidebar:(a)=>a.logShowLineArrowInsertOptions(),menuClick:(a)=>a.logClickTabMenuItem({tab_menu_item:"ARROW_LINE"})}});this.createPropertyBarItems(a,b);this.createUpdatePresetMenuItem(a,b)});b.onStyleSheetChange(()=>{this.generateThumbnails(this.uiRoot)});b.onSelectionChange((a)=>
{0<a.allObjects.length||null!=this.uiRoot.getState().currentTopicId?this.session.document.read((a)=>{this.updateState(a)}):this.uiRoot.setState({propertyBar:{type:A.none},activePresetSelector:null})});b.onDocumentChange(()=>{this.session.document.read((a)=>{this.updateState(a)})});b.onCurrentTopicChange((a)=>{this.uiRoot.setState({currentTopicId:a});this.session.document.read((a)=>{this.updateState(a)})});b.onNetworkStatusChange((a)=>{this.uiRoot.setState({networkStatus:a})})}updateState(b){const a=
this.getEditedObjectsReadonly(b),c=a.filter(L(d.base.ObjectKind.shape)),r=a.filter(L(d.base.ObjectKind.arc)),f=new Set([...c,...r].map((a)=>{a=a.presetSelector;return null==a?null:(a.rawTypeName||"*")+"."+(a.className||"*")})),m=this.uiRoot.getState().currentTopicId,h=b.lookup.base(m);let p;p=h&&h.is(d.base.ObjectKind.topic)?h.zoomLayoutBox.asReferenceFrame:h&&h.is(d.base.ObjectKind.page)?h.referenceFrame:b.overview.referenceFrame;b=c.filter((a)=>"rectangle"===a.shapeKind).length===a.length&&0<a.length;
this.uiRoot.setState({activePresetSelector:1===f.size?f.values().next().value:null,currentTopicId:m,propertyBar:l.ShapeAndArcEditorPlugin.propertyBarOfSelectedObjects(a.length,c,r),cornerRadius:b?l.ShapeAndArcEditorPlugin.currentRadius(c):null,selectedSizes:new Map(a.map((a)=>{const b=a.layoutBox.withReferenceFrame(p).size;return[a.id,Math.min(b.height,b.width)/2]}))})}static propertyBarOfSelectedObjects(b,a,c){return a.length===b&&0<b?{type:A.shape,shapeKind:a[0].shapeKind,presetStyleClass:a[0].shapeStyle,
backgroundFills:a[0].fills,canDecreaseThickness:null!=a[0].border&&null!=a[0].border.thickness,borderColor:a[0].border.color}:c.length===b&&0<b?{type:A.arc,arcKind:c[0].kind,presetStyleClass:c[0].arcStyle,fills:c[0].fills}:{type:A.none}}static currentRadius(b){return b.map((a)=>a.cornerRadius).reduceRight((a,b)=>Math.max(a,b))}processMessage(b){switch(b){case "openShapeInsertSidebar":this.uiRoot.sidebar.open(l.ShapeAndArcEditorPlugin.shapeSidebarId);break;case "openArcInsertSidebar":this.uiRoot.sidebar.open(l.ShapeAndArcEditorPlugin.arcSidebarId);
break;case "canEditBrandKit":this.uiRoot.setState({brandKitCTA:C.BrandKitCTA.canEditTeam});break;case "canNotEditBrandKit":this.uiRoot.setState({brandKitCTA:C.BrandKitCTA.canNotEditTeam});break;default:B.Utils.assertNever(b)}}logCTAOpened(b){E.isActive("js-present-editor-brandkit-enabled")&&E.isActive("js-show-brand-kit-paywalls")&&q.avro.Avro.createDefaultLogger().logShownUpgradeToTeamCta({team_upgrade_trigger:b})}createPropertyBarItems(b,a){const c=b.propertyBar;if(c.type===A.shape){const r=b.shapePresets.filter((a)=>
a.kind===c.shapeKind&&a.shapePresetKind!==n.ShapePresetKind.square);a.createPropertyBarItem((a)=>a.popupButton((a)=>({id:"shape-editor-presets",tooltipText:g.I18n.ts("Style presets"),content:{icon:k.IconSmallId.StylePresets},groupWeight:1,weight:0,popupHeader:[a.sectionHeader({content:g.I18n.ts("Style presets")})],popupContent:[a.simpleList((a)=>({items:r.map((b)=>a.image({id:b.style,src:{url:b.fullThumbnail},dataLookup:b.style,onClick:(a)=>{this.executeShapeCommand(a,"set preset",(a)=>{q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,
modify_action:"OBJECT_PRESET",topic_relationship:a,object_id:a.id});a.shapeStyle=b.style})}})),itemLayout:k.ListItemLayout.fixed,itemType:k.ListItemType.small,showTitle:!1,progress:k.ListProgress.finished,flexGrow:1,activeId:c.presetStyleClass})),a.infoMessage(g.I18n.ts("Style presets generate automatically and change according to your color scheme."))]})));a.createPropertyBarItem((a)=>a.popupButton((a)=>({id:"shape-editor-background-color",groupWeight:1,weight:1,tooltipText:g.I18n.ts("Fill color"),
content:{icon:k.IconSmallId.FillColor,fills:Object.assign(Object.assign({},c.backgroundFills),{radialFill:null,canPickClearFill:!0})},popupHeader:[a.sectionHeader({content:g.I18n.ts("Fill color")})],hideArrow:!0,onOpen:()=>this.logCTAOpened("PRESENT_COLOR_PICKER_SHAPE"),popupContent:[...C.createBrandKitColorCTA(a,b.brandKitCTA,"PRESENT_COLOR_PICKER_SHAPE"),a.colorPicker({id:"shape-editor-background-color-picker",showThemeColors:!0,expanded:!0,fills:Object.assign({},c.backgroundFills),onChange:(a,
b)=>{const c=b.source;this.longRunningExecutor.update("shape-background-color",a,b,(a,b)=>{this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.shape)&&(a.fill=b.newFill)});this.updateState(a)},(a)=>{this.logShapeChanges(a);c!==w.ColorPickerChangeSource.opacitySlider&&c!==w.ColorPickerChangeSource.opacityNumericField||this.logShapeOpacityChanges(a,c)})}}),...null!=this.uiRoot.getState().cornerRadius?[a.separator(),a.numericSlider({dataLookup:"shape-editor-corner-radius",title:g.I18n.ts("Corner Radius"),
onChange:(a,b)=>{const c=b.source;this.longRunningExecutor.update("shape-background-corner-radius",a,b,(a,b)=>{const c=100*b.value;this.uiRoot.setState({cornerRadius:c});const h=this.uiRoot.getState().selectedSizes,f=Array.from(h.values()).reduceRight((a,b)=>Math.min(a,b));this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.shape)&&(a.cornerRadius=c*f/h.get(a.id))});this.updateState(a)},(a)=>{this.logShapeChanges(a);this.logCornerRadiusChange(a,c)})},value:this.uiRoot.getState().cornerRadius/
100})]:[]]})));a.createPropertyBarItem((a)=>a.submenu({id:"shape-editor-thickness",tooltip:g.I18n.ts("Border thickness"),groupWeight:1,weight:3,icon:k.IconSmallId.BorderWeight,items:[{id:"shape-editor-decrease-thickness",icon:k.IconSmallId.Minus,tooltip:g.I18n.ts("Decrease thickness"),enabled:c.canDecreaseThickness,onClick:(a)=>{this.executeShapeCommand(a,"thickness",(a)=>{let b=(null==a.border.thickness?-1:a.border.thickness)-this.getThicknessStepEditor(a);a.border=Object.assign(Object.assign({},
a.border),{thickness:0>b?null:b})})}},{id:"shape-editor-increase-thickness",icon:k.IconSmallId.Plus,tooltip:g.I18n.ts("Increase thickness"),onClick:(a)=>{this.executeShapeCommand(a,"thickness",(a)=>{var b=null==a.border.thickness?-1:a.border.thickness;b=0>b?0:b+this.getThicknessStepEditor(a);a.border=Object.assign(Object.assign({},a.border),{thickness:b})})}}]}));a.createPropertyBarItem((a)=>a.popupButton((a)=>({id:"shape-editor-border-color",groupWeight:1,weight:4,tooltipText:g.I18n.ts("Border color"),
hideArrow:!0,content:{icon:k.IconSmallId.BorderColor,fills:{hasAlpha:!0,current:w.FillKind.solid,radialFill:null,linearFill:null,solidFill:{fillKind:w.FillKind.solid,color:c.borderColor},canPickClearFill:!0}},popupHeader:[a.sectionHeader({content:g.I18n.ts("Border color")})],onOpen:()=>this.logCTAOpened("PRESENT_COLOR_PICKER_SHAPE_BORDER"),popupContent:[...C.createBrandKitColorCTA(a,b.brandKitCTA,"PRESENT_COLOR_PICKER_SHAPE_BORDER"),a.colorPicker({id:"shape-editor-border-color-picker",showThemeColors:!0,
expanded:!0,fills:{hasAlpha:!0,current:w.FillKind.solid,solidFill:{fillKind:w.FillKind.solid,color:c.borderColor}},onChange:(a,b)=>{const c=b.source;this.longRunningExecutor.update("shape-border-color",a,b,(a,b)=>{this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.shape)&&(a.border=Object.assign(Object.assign({},a.border),{color:b.newFill.color}))});this.updateState(a)},(a)=>{this.logShapeChanges(a);c!==w.ColorPickerChangeSource.opacitySlider&&c!==w.ColorPickerChangeSource.opacityNumericField||
this.logShapeOpacityChanges(a,c)})}})]})))}if(c.type===A.arc){const r=b.arcPresets.filter((a)=>a.kind===c.arcKind),f=(a,b)=>a.imageCheckbox({id:b.style,imgUrl:b.smallThumbnail,checked:c.presetStyleClass===b.style,hasLightColor:b.hasLightColor,onCheck:(a,c)=>{c&&this.executeArcCommand(a,"set preset",(a)=>{q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,modify_action:"STYLE_CHANGE",topic_relationship:a,object_id:a.id});a.arcStyle=b.style})}});a.createPropertyBarItem((a)=>a.popupButton((a)=>
({id:"arc-editor-presets",tooltipText:g.I18n.ts("Presets"),content:{icon:k.IconSmallId.StylePresets},groupWeight:1,weight:0,height:k.PopupHeight.Full,popupHeader:[a.sectionHeader({content:g.I18n.ts("Presets")})],popupContent:r.map((b)=>f(a,b))})));a.createPropertyBarItem((a)=>{let f;switch(c.arcKind){case D.arrow:f="PRESENT_COLOR_PICKER_ARROW";break;case D.line:f="PRESENT_COLOR_PICKER_LINE";break;default:B.Utils.assertNever(c.arcKind)}return a.popupButton((a)=>({id:"arc-editor-background-color",groupWeight:1,
weight:1,tooltipText:g.I18n.ts("Fill color"),hideArrow:!0,content:{icon:k.IconSmallId.FillColor,fills:Object.assign(Object.assign({},c.fills),{linearFill:null,radialFill:null,canPickClearFill:!0})},popupHeader:[a.sectionHeader({content:g.I18n.ts("Fill color")})],onOpen:()=>this.logCTAOpened(f),popupContent:[...C.createBrandKitColorCTA(a,b.brandKitCTA,f),a.colorPicker({id:"arc-editor-background-color-picker",showThemeColors:!0,expanded:!0,fills:c.fills,onChange:(a,b)=>{const c=b.source;this.longRunningExecutor.update("arc-line-color",
a,b,(a,b)=>{this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.arc)&&(a.fill=b.newFill.color)});this.updateState(a)},(a)=>{this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.arc)&&(this.logArcChange(a),c!==w.ColorPickerChangeSource.opacitySlider&&c!==w.ColorPickerChangeSource.opacityNumericField||this.logArcOpacityChange(a,c))})})}})]}))});a.createPropertyBarItem((a)=>a.submenu({id:"arc-editor-thickness",tooltip:g.I18n.ts("Thickness"),groupWeight:1,weight:3,icon:k.IconSmallId.BorderWeight,
items:[{id:"arc-editor-decrease-thickness",icon:k.IconSmallId.Minus,tooltip:g.I18n.ts("Decrease thickness"),onClick:(a)=>{this.executeArcCommand(a,"thickness",(a)=>{this.changeArcThickness(a,this.getDecreasedLineArrowThickness(a))})}},{id:"arc-editor-increase-thickness",icon:k.IconSmallId.Plus,tooltip:g.I18n.ts("Increase thickness"),onClick:(a)=>{this.executeArcCommand(a,"thickness",(a)=>{this.changeArcThickness(a,this.getIncreasedLineArrowThickness(a))})}}]}))}}logCornerRadiusChange(b,a){const c=
a===w.SliderChangeSource.slider?"CHANGE_CORNER_RADIUS_SLIDER":"CHANGE_CORNER_RADIUS_INPUT_VALUE";this.getEditedObjectsMutable(b).forEach((a)=>{q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,modify_action:c,topic_relationship:a,object_id:a.id})})}logShapeChanges(b){this.getEditedObjectsMutable(b).forEach((a)=>{q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"SHAPE",modify_action:"STYLE_CHANGE",topic_relationship:a,object_id:a.id})})}logShapeOpacityChanges(b,a){const c=
a===w.ColorPickerChangeSource.opacitySlider?"CHANGE_OPACITY_SLIDER":"CHANGE_OPACITY_INPUT_VALUE";this.getEditedObjectsMutable(b).forEach((a)=>{q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,modify_action:c,topic_relationship:a,object_id:a.id})})}createUpdatePresetMenuItem(b,a){null!=b.activePresetSelector&&a.createMenuItem({id:"context-menu-update-preset",kind:k.MenuItemKind.context,title:g.I18n.ts("Update style preset")+(E.isActive("js-developer-features")?" (DEV: "+b.activePresetSelector+
")":""),weight:69,onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"update style preset",run:(a)=>{this.getEditedObjectsMutable(a).forEach((a)=>{(a.is(d.base.ObjectKind.shape)||a.is(d.base.ObjectKind.arc))&&a.updatePresetStyle()})}})}})}changeArcThickness(b,a){this.logArcChange(b);b.thickness=a}logArcOpacityChange(b,a){a=a===w.ColorPickerChangeSource.opacitySlider?"CHANGE_OPACITY_SLIDER":"CHANGE_OPACITY_INPUT_VALUE";q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:b,modify_action:a,
topic_relationship:b,object_id:b.id})}logArcChange(b){const a=b.kind===D.arrow?"ARROW":"LINE";q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,modify_action:"STYLE_CHANGE",topic_relationship:b,object_id:b.id})}getIncreasedLineArrowThickness(b){const a=b.thickness+this.getThicknessStepEditor(b),c=b.kind===D.arrow?a*P():0;return J.Geometry.distance(b.start,b.end)>c?a:b.thickness}getDecreasedLineArrowThickness(b){const a=b.thickness-this.getThicknessStepEditor(b);return 0>a?b.thickness:
a}getThicknessStepEditor(b){var a=this.session.positionFinder.getCameraLayoutBox().referenceFrame.point({x:0,y:0});const c=this.session.positionFinder.getCameraLayoutBox().referenceFrame.point({x:0,y:1});a=a.withReferenceFrame(b.layoutBox.referenceFrame);b=c.withReferenceFrame(b.layoutBox.referenceFrame);return J.Geometry.distance(a,b)}executeShapeCommand(b,a,c){this.session.document.executeApiCommand(b,{name:a,run:(a)=>{this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.shape)&&
(q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"SHAPE",modify_action:"STYLE_CHANGE",topic_relationship:a,object_id:a.id}),c(a))});this.updateState(a)}})}executeArcCommand(b,a,c){this.session.document.executeApiCommand(b,{name:a,run:(a)=>{this.getEditedObjectsMutable(a).forEach((a)=>{a.is(d.base.ObjectKind.arc)&&c(a)});this.updateState(a)}})}registerSidebar(b,a){b.createSidebar(a.id,(b)=>({root:{title:a.title,content:[...E.isActive("js-hide-library-sidebar-button")?[]:this.createLibrarySection(b,
a.id),b.simpleList((b)=>({items:a.presets.map((a)=>b.droppableImage({src:{url:a.thumbnail},onDrop:(b,c)=>{this.session.document.executeApiCommand(b,{name:"drop",run:(f)=>{f=this.session.insertTarget.getSimpleObjectParent(f);if("shape"===a.presetKind){var e=f.add.shape(a.kind,a.style);e.width=a.width;e.height=a.height;e.fitInto(this.session.positionFinder.findLayoutBox(f,e.width,e.height,c.stageX,c.stageY));q.avro.Avro.createDefaultLogger().logNewObject({object_type:e,topic_relationship:e,parent_type:e,
object_id:e.id});q.avro.Avro.createDefaultLogger().logInsertShape({shape_source:null==c.stageX?"DOUBLE_CLICK":"DRAG_DROP"});this.session.selection.setSelection(b,[e])}else{switch(a.kind){case d.base.ObjectKind.arrow:e=f.add.arrow(a.style);break;case d.base.ObjectKind.line:e=f.add.line(a.style);break;default:B.Utils.assertNever(a)}const g=e.layoutBox.size.width;e.fitInto(this.session.positionFinder.findLayoutBox(f,g,g,c.stageX,c.stageY));q.avro.Avro.createDefaultLogger().logNewObject({object_type:e,
topic_relationship:e,parent_type:e,object_id:e.id});this.session.selection.setSelection(b,[e])}}})}})),itemLayout:k.ListItemLayout.fixed,itemType:k.ListItemType.large,flexGrow:1}))]},onOpen:()=>a.log.openSidebar(q.avro.Avro.createDefaultLogger()),onCloseButtonClicked:()=>a.log.closeSidebar(q.avro.Avro.createDefaultLogger())}));return b.createTopMenuItem(k.TopMenuId.Shapes,{kind:k.MenuItemKind.largeButton,enabled:!0,onClick:()=>{a.log.menuClick(q.avro.Avro.createDefaultLogger());this.uiRoot.sidebar.toggle(a.id)},
icon:a.menu.iconId,weight:a.menu.weight,id:a.menu.id,title:a.title,categoryWeight:a.menu.categoryWeight,defaultSelected:a.menu.defaultSelected})}createLibrarySection(b,a){return this.uiRoot.getState().networkStatus===k.NetworkStatus.Online?[b.sectionHeader({content:g.I18n.ts("My Library")}),b.button(k.ButtonSize.Large,k.ButtonAlign.Start,(b)=>[b.button({id:"open-my-library-button",color:k.ButtonColor.Blue,content:{text:g.I18n.ts("Add from my library")},onClick:()=>{this.pluginAccess.send(K.favorites,
K.createOpenFavoritesFromAnotherSidebarMessage(a===l.ShapeAndArcEditorPlugin.shapeSidebarId?"shapes":"arcs","insert"))}})]),b.separator()]:[]}generateThumbnails(b){let a=[],c=[],g=[];this.session.document.read((b)=>{var f=new Set([d.base.ShapeStyle.Poly1,d.base.ShapeStyle.Poly2,d.base.ShapeStyle.Poly3,d.base.ShapeStyle.Poly4,d.base.ShapeStyle.Poly5]);const k=new Set([d.base.ArcStyle.Line1,d.base.ArcStyle.Line2,d.base.ArcStyle.Line3,d.base.ArcStyle.Line4,d.base.ArcStyle.Line5]),r=new Set([d.base.ArcStyle.Chainlink,
d.base.ArcStyle.ChainlinkCamelCase]),e=[],l=(a,b,c)=>e.push({className:a,styledObjectKind:b,cb:c});for(let {className:e}of b.styleSheet.styleSheets){const b=e;f.has(b)&&l(e,d.base.ObjectKind.shape,(c)=>{a.push(G.createShapePreset(n.ShapePresetKind.rectangle,c,b),G.createShapePreset(n.ShapePresetKind.circle,c,b),G.createShapePreset(n.ShapePresetKind.square,c,b),G.createShapePreset(n.ShapePresetKind.triangle,c,b))});const h=e;k.has(h)&&(l(e,d.base.ObjectKind.line,(a)=>{c.push(F.createArcPreset(d.base.ObjectKind.line,
a,h))}),l(e,d.base.ObjectKind.arrow,(a)=>{c.push(F.createArcPreset(d.base.ObjectKind.arrow,a,h))}));r.has(h)&&(l(e,d.base.ObjectKind.line,(a)=>{g.push(F.createArcPreset(d.base.ObjectKind.line,a,h))}),l(e,d.base.ObjectKind.arrow,(a)=>{g.push(F.createArcPreset(d.base.ObjectKind.arrow,a,h))}))}f=e.map((a)=>({classNames:[a.className],styledObjectKind:a.styledObjectKind}));b=b.styleSheet.resolve(f);for(f=0;f<e.length;f++)e[f].cb(b[f])});b.setState({shapePresets:a.filter((a)=>null!=a),arcPresets:c.filter((a)=>
null!=a),chainLinkPresets:g.filter((a)=>null!=a)})}flatten(b){if(!b.every((a)=>a.is(D.topic)&&1===a.simpleChildren(d.base.ChildVisibilityKind.outsideAndInside).length))return b;let a=[];b.forEach((b)=>{b.is(D.topic)&&a.push(...b.simpleChildren(d.base.ChildVisibilityKind.outsideAndInside))});return a}getEditedObjectsReadonly(b){return this.getEditedObjects(b,(a)=>this.session.selection.getReadonlySelectionInfo(a))}getEditedObjectsMutable(b){return this.getEditedObjects(b,(a)=>this.session.selection.getSelectionInfo(a))}getEditedObjects(b,
a){let c=a(b).allObjects.filter((a)=>!a.is(d.base.ObjectKind.lockable)||!a.locked);a=this.uiRoot.getState().currentTopicId;if(0===c.length){if(null==a)return[];b=b.lookup.base(a);if(!b||!b.is(D.topic))return[];c=b.simpleChildren(d.base.ChildVisibilityKind.inside).filter((a)=>d.CetModelEditor.isTopicShapeObjectKILLME(a)).map((a)=>a)}c=this.flatten(c);[...c].forEach((a)=>{a.is(d.base.ObjectKind.topic)&&(c=c.filter((b)=>b!==a).concat(a.simpleChildren(d.base.ChildVisibilityKind.outside).filter((a)=>d.CetModelEditor.isTopicShapeObjectKILLME(a)).map((a)=>
a)))});return c}};l.ShapeAndArcEditorPlugin.shapeSidebarId="sidebar-shape-editor";l.ShapeAndArcEditorPlugin.arcSidebarId="sidebar-arc-editor";l.ShapeAndArcEditorPlugin.shapeMenuItemId="topmenu-insert-item-shape";l.ShapeAndArcEditorPlugin.arcMenuItemId="topmenu-insert-item-arrow-line";t={};Object.defineProperty(t,"__esModule",{value:!0});t.lazyModule={createPlugin(){return new l.ShapeAndArcEditorPlugin}};return t});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_shape_and_arc_editor",["require","prezi.geometry","prezi_brand_kit_cta","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_shape_and_arc_editor.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_brand_kit_cta"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_shape_and_arc_editor"]=__factory(this["prezi.geometry"],this["prezi_brand_kit_cta"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);