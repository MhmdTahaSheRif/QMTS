;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_path_editing";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_commenting":dependencies[1],"prezi_featureswitcher":dependencies[2],"prezi_i18n":dependencies[3],"prezi_logger":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_plugin_meta":dependencies[6],"prezi_thumbnail_render":dependencies[7],"prezi_utils":dependencies[8]}};})());};})(arguments);var moduleImpl=(function(){return module(function(t){var p=t.dependencies.prezi_featureswitcher,v=t.dependencies.prezi_plugin_meta,G=t.dependencies.prezi_thumbnail_render,u=t.dependencies.prezi_utils,h=t.dependencies.prezi_cet_model_editor,M=t.dependencies.prezi_commenting,g=t.dependencies.prezi_i18n,r=t.dependencies.prezi_logger,e=t.dependencies.prezi_plugin_api,H={};Object.defineProperty(H,"__esModule",{value:!0});H.RemoveAnimation=class{constructor(a){this.session=a}createUI(a){a.createMenuItem({id:"hamburger/removeAnimations",
kind:e.MenuItemKind.dropdown,enabled:!0,parent:e.MenuId.Hamburger,weight:13.1,title:g.I18n.ts("Remove all animations"),onClick:(a)=>{r.avro.Avro.createDefaultLogger().logClickHamburgerMenuItem({hamburger_menu_item:"REMOVE_ANIMATIONS"});this.removeAnimations(a)}})}removeAnimations(a){this.session.document.executeApiCommand(a,{name:"Remove all animations",run:(a)=>{a.structuredPath.pathElementsInOrder.forEach((a)=>{a.kind!==h.base.ObjectKind.fadeIn&&a.kind!==h.base.ObjectKind.fadeOut&&a.kind!==h.base.ObjectKind.zoom||
a.delete()});r.avro.Avro.createDefaultLogger().logRemovedAllAnimations()}})}};var E={},F=this&&E.__awaiter||function(a,b,c,f){function k(a){return a instanceof c?a:new c(function(c){c(a)})}return new (c||(c=Promise))(function(c,m){function y(a){try{e(f.next(a))}catch(x){m(x)}}function d(a){try{e(f["throw"](a))}catch(x){m(x)}}function e(a){a.done?c(a.value):k(a.value).then(y,d)}e((f=f.apply(a,b||[])).next())})};Object.defineProperty(E,"__esModule",{value:!0});var N=h.base.createPathLabelMapFromApi,
L=h.base.isKindDescendantOf,n=h.base.isRefInstanceOf,O=h.base.readerIs,d=h.base.ObjectKind;const J=G.ThumbnailSize._224;var w;(function(a){a.main="main";a.deck="deck";a.frame="frame";a.text="text"})(w||(w={}));var q;(function(a){a.fadeIn="fadeIn";a.fadeOut="fadeOut";a.zoomTo="zoomTo";a.zoomOut="zoomOut"})(q||(q={}));var A;(function(a){a[a.Add=0]="Add";a[a.Remove=1]="Remove"})(A||(A={}));var l;(function(a){a.planet="planet";a.stack="stack";a.zoomArea="zoom-area";a.page="page";a.zoomOut="zoom-out"})(l||
(l={}));E.PathEditingPlugin=class{constructor(){this.currentTopicRef=null;this.zoomToVideo=t.getResourceUrl("/Zoom-to.mp4");this.zoomOutVideo=t.getResourceUrl("/Zoom-out.mp4");this.ZoomAreaVideo=t.getResourceUrl("/Zoom-to-area.mp4");this.fadeInVideo=t.getResourceUrl("/Fade-in.mp4");this.fadeOutVideo=t.getResourceUrl("/Fade-out.mp4");this.zoomToImage=t.getResourceUrl("/Zoom-to.png");this.zoomOutImage=t.getResourceUrl("/Zoom-out.png");this.ZoomAreaImage=t.getResourceUrl("/Zoom-to-area.png");this.fadeInImage=
t.getResourceUrl("/Fade-in.png");this.fadeOutImage=t.getResourceUrl("/Fade-out.png");this.setHovered=(a,b)=>{if(Array.isArray(b))this.session.hoverDecoratorOnCanvas.setHovered(a,[]);else{const c=this.targetRefFromPathElementRef(b.pathElementRef).filter((a)=>n(a,d.transformedObject)||n(a,d.group));(0===c.length||this.session.document.read((a)=>a.lookup.resolve(c[0]).parent.id===this.uiRoot.getState().currentTopicId))&&this.session.hoverDecoratorOnCanvas.setHovered(a,c)}};this.fadeIcons=new Map([[d.fadeIn,
e.IconSmallId.FadeIn],[d.fadeOut,e.IconSmallId.FadeOut]]);this.fadeTitles=new Map([[d.fadeIn,g.I18n.ts("Fade in")],[d.fadeOut,g.I18n.ts("Fade out")]])}init(a){const b=this.session.document.read((a)=>0===a.overview.topicChildren.length);this.uiRoot=a.declareUI({animate:null,selectionInfo:null,targetRef:null,backToRef:null,listItemMap:null,timelineIds:null,canAddZoomToObjectAnimation:null,canAddFadeAnimation:null,pathElementIdToTargetId:null,targetIdMap:null,fadeTargetIdMap:null,currentVisitRef:null,
activePathElementRef:null,secondaryActivePathElementRef:null,aspectRatio:null,currentStartPointRef:null,startPointCtxAction:null,hoveredListItemId:null,currentTopicId:null,lastVisitedTopicId:null,networkStatus:null,topicless:b,lastAddButtonActionKind:b?l.zoomArea:l.planet,isTopicEdited:!1},(a,b)=>this.declareUI(a,b));a.onNetworkStatusChange((a)=>{this.uiRoot.setState({networkStatus:a})});a.onCurrentTopicChange((a)=>{const c=this.uiRoot.getState().currentTopicId,b=this.session.document.read((b)=>{if(null==
c)return!1;const f=b.lookup.base(c);b=b.lookup.base(a);return null!=f&&f.is(d.page)&&b.is(d.page)&&f.parent.id===b.parent.id});this.uiRoot.setState({lastVisitedTopicId:c,currentTopicId:a,activePathElementRef:b?this.uiRoot.getState().activePathElementRef:null});this.session.document.read((b)=>{var c;this.currentTopicRef=null===(c=b.lookup.simpleObjectParent(a))||void 0===c?void 0:c.ref;this.readStateFromDocument(b,!0);this.scrollToPathElementIfInTimeline(b,a)})});a.onDocumentChange(()=>{this.session.document.read((a)=>
{this.readStateFromDocument(a,!0)});this.setStateFromSelectionInfo()});a.onSelectionChange((a)=>{this.uiRoot.setState({selectionInfo:a});this.updateAnimationStateOnSelectionChange(a);this.setStateFromSelectionInfo()});a.onNavigation((a)=>{if(!p.isActive("js-for-test-prevent-timeline-selection-on-navigation")){const b=this.session.document.read((b)=>{b=b.lookup.pathElement(a.pathElementRef.id);return null==b?null:{ref:b.ref,kind:b.kind}});null!=b&&b.kind!==h.base.ObjectKind.fadeIn&&b.kind!==h.base.ObjectKind.fadeOut&&
this.uiRoot.setState({activePathElementRef:b.ref})}});M.CommentingModule.getCommentingController().then((a)=>{this.commentingController=a;this.session.document.read((a)=>{this.readStateFromDocument(a,!0)});this.commentingController.getCommentingUpdatedStream().onValue(()=>{Promise.resolve().then(()=>{this.session.document.read((a)=>{this.readStateFromDocument(a,!0)})})})});G.ThumbnailRenderModule.getThumbnailService().then((a)=>{this.thumbnailService=a;a.monitorPath({size:J,needHighQuality:!0,includePathElement:(a)=>
n(a,h.base.ObjectKind.visitOverview)||n(a,h.base.ObjectKind.visitPlanet)||n(a,h.base.ObjectKind.visitStack)||n(a,h.base.ObjectKind.visitPage)||n(a,h.base.ObjectKind.backToParent)||n(a,h.base.ObjectKind.zoom)}).getThumbnailStream().onValue((a)=>this.updateStateFromThumbnail(a.pathElementRef,a,!0))})}processMessage(a){var b,c;const f=this.uiRoot.getState(),k=null===(b=f.targetIdMap)||void 0===b?void 0:b.get(a.canvasElementId);a=null===(c=f.fadeTargetIdMap)||void 0===c?void 0:c.get(a.canvasElementId);
null!=k?this.uiRoot.setState({secondaryActivePathElementRef:k}):null!=a?this.uiRoot.setState({secondaryActivePathElementRef:a}):this.uiRoot.setState({secondaryActivePathElementRef:null})}scrollToPathElementIfInTimeline(a,b){for(const c of a.structuredPath.pathElementsInOrder)if(c.is(d.pathParent)&&c.target.id===b){this.uiRoot.scrollIntoView(c.id);break}}getCurrentVisit(a,b){b=b.filter(O(d.pathParent)).find((a)=>a.target.id===this.currentTopicRef.id);if(null==b)return a.structuredPath.editorPath;u.Utils.assert(!b.is(d.visitStack),
`Current topic is a stack! id: ${b.id}`);return b}setStateFromSelectionInfo(){var a,b,c,f,k,y,m,I;this.uiRoot.setState({isTopicEdited:!1});let e=this.uiRoot.getState();if(null!=e){const h=e.selectionInfo;if(null!=h){const g=h.allObjects.filter((a)=>{var b;return null!=(null===(b=e.targetIdMap)||void 0===b?void 0:b.get(a.id))});1<g.length?(this.uiRoot.setState({activePathElementRef:null}),this.pluginAccess.send(v.videoInsert,{kind:v.VideoInsertSidebarMessageKind.setActivePathElement,activePathElementId:null===
(a=this.getActivePathElementRef(e))||void 0===a?void 0:a.id}),this.pluginAccess.send(v.turnIntoTopic,{kind:v.TurnIntoTopicMessageKind.setActivePathElement,activePathElementId:null===(b=this.getActivePathElementRef(e))||void 0===b?void 0:b.id})):1!==g.length||null!=e.activePathElementRef&&(null===(c=e.pathElementIdToTargetId)||void 0===c?void 0:c.get(e.activePathElementRef.id))===g[0].id||(a=null===(k=null===(f=this.uiRoot.getState())||void 0===f?void 0:f.targetIdMap)||void 0===k?void 0:k.get(g[0].id),
this.uiRoot.setState({activePathElementRef:a}),this.pluginAccess.send(v.videoInsert,{kind:v.VideoInsertSidebarMessageKind.setActivePathElement,activePathElementId:null===(y=this.getActivePathElementRef(e))||void 0===y?void 0:y.id}),this.pluginAccess.send(v.turnIntoTopic,{kind:v.TurnIntoTopicMessageKind.setActivePathElement,activePathElementId:null===(m=this.getActivePathElementRef(e))||void 0===m?void 0:m.id}),this.uiRoot.scrollIntoView(a.id));if(1!==h.allObjects.length)f=null;else{const a=h.allObjects[0];
f=n(a,d.stackTopic)?this.session.document.read((b)=>{var c;const f=b.lookup.resolve(a);if(null==f)return null;const k=f.pageChildren[0];return null===(c=b.structuredPath.pathElementsInOrder.find((a)=>a.is(d.visitPage)&&a.target===k))||void 0===c?void 0:c.ref}):null===(I=e.targetIdMap)||void 0===I?void 0:I.get(h.allObjects[0].id);n(a,d.topic)&&this.uiRoot.setState({isTopicEdited:!0})}this.uiRoot.setState({startPointCtxAction:null==f?null:e.currentStartPointRef&&f.id===e.currentStartPointRef.id?{kind:A.Remove}:
{kind:A.Add,pathElementRef:f}})}}}updateAnimationStateOnSelectionChange(a){this.session.document.read((b)=>{const c={allObjects:a.allObjects.map((a)=>b.lookup.resolve(a)),groups:a.groups.map((a)=>b.lookup.resolve(a)),nonGroupedObjects:a.nonGroupedObjects.map((a)=>b.lookup.resolve(a))};this.uiRoot.setState({canAddZoomToObjectAnimation:this.canAddAnimation(c,q.zoomTo),canAddFadeAnimation:this.canAddAnimation(c,q.fadeIn)})})}scrollToAdded(a,b){b=b.id;this.readStateFromDocument(a,!0);this.scrollToPathElementIfInTimeline(a,
b)}declareUI(a,b){const c=a.targetRef;if(null!=a&&null!=this.currentTopicRef){b.createAction({shortcut:v.pathEditing.shortcuts.addTopic,enabled:!0,onExecute:(a)=>{const b=this.uiRoot.getState();var c=b.targetRef.kind===d.stackTopic;c=p.isActive("js-remember-add-buton-state")?c?l.page:b.lastAddButtonActionKind:this.insertMenuActionKind(b);return this.addActionHandler(c,a,b)}});(new H.RemoveAnimation(this.session)).createUI(b);var f=this.insertMenuActionKind(a);b.createTopMenuItem(e.TopMenuId.Insert,
{id:"topmenu-insert-item-topic",kind:e.MenuItemKind.largeButton,enabled:!0,weight:0,categoryWeight:7,title:this.getAddActionText(f,c),icon:e.IconSmallId.NewTopic,color:e.NamedColors.topicButton,onClick:(b)=>{r.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"TOPIC"});this.addActionHandler(f,b,a)}});this.createContextMenuItems(a,b);b.createLeftSidebar((b)=>({root:{header:this.createButtons(a,b),content:this.createList(a,b)}}));b.createSidebar("sidebar-animations",(b)=>({root:{title:g.I18n.ts("Animations"),
content:this.getAnimationLists(b,a),footer:null}}));if(a.canAddFadeAnimation||a.canAddZoomToObjectAnimation)b.createPropertyBarItem((b)=>this.createPropertyBarAnimationButton(a,b)),b.createMenuItem({kind:e.MenuItemKind.context,title:g.I18n.ts("Add animation"),id:"context-menu-add-animation",weight:65,onClick:()=>F(this,void 0,void 0,function*(){this.uiRoot.sidebar.toggle("sidebar-animations")})});b.createTopMenuItem(e.TopMenuId.Other,{kind:e.MenuItemKind.largeButton,id:"topmenu-insert-item-animation",
title:g.I18n.ts("Animation"),icon:e.IconSmallId.Animation,onClick:()=>{r.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"ANIMATION"});this.uiRoot.sidebar.toggle("sidebar-animations")},weight:1,categoryWeight:0});a.isTopicEdited&&p.isActive("js-on-canvas-property-bar")&&b.createPropertyBarItem((b)=>b.button({id:"zoom-in-property-bar-button",groupWeight:0,weight:0,icon:e.IconSmallId.ZoomIn,title:g.I18n.ts("Zoom in"),tooltip:g.I18n.ts("Zoom in"),onClick:(b)=>{const c=a.selectionInfo;
if(null!==c){const a=c.allObjects[0];null!==a&&(n(a,d.planetTopic)?this.session.document.read((c)=>{c=c.lookup.resolve(a);if(null==c)return null;this.session.navigation.flyTo(b,c)}):n(a,d.stackTopic)&&this.session.document.read((c)=>{c=c.lookup.resolve(a);if(null==c)return null;this.session.navigation.flyTo(b,c.pageChildren[0])}))}}}))}}getAnimationLists(a,b){let c=[];const f={id:"zoom-item-1",title:g.I18n.ts("Zoom area"),src:{url:this.ZoomAreaImage},onClick:(a)=>this.addZoomArea(a,b),hoverContent:{type:e.HoverContentType.video,
url:this.ZoomAreaVideo},dataLookup:"zoom-area-image"},k={id:"zoom-item-2",title:this.zoomOutName(b,!0),src:{url:this.zoomOutImage},onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert zoom out",run:(a)=>{this.addAnimation(this.uiRoot.getState(),a,q.zoomOut)}})},hoverContent:{type:e.HoverContentType.video,url:this.zoomOutVideo},dataLookup:"zoom-out-image"};b.canAddFadeAnimation&&(c.push(a.sectionHeader({content:g.I18n.ts("Fade animations")})),c.push(a.simpleList((a)=>({items:[a.image({id:"fade-item-1",
title:g.I18n.ts("Fade in"),src:{url:this.fadeInImage},onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert fade in animation",run:(a)=>this.addAnimation(b,a,q.fadeIn)})},hoverContent:{type:e.HoverContentType.video,url:this.fadeInVideo},dataLookup:"fade-in-image"}),a.image({id:"fade-item-2",title:g.I18n.ts("Fade out"),src:{url:this.fadeOutImage},onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert fade out animation",run:(a)=>this.addAnimation(b,a,q.fadeOut)})},hoverContent:{type:e.HoverContentType.video,
url:this.fadeOutVideo},dataLookup:"fade-out-image"})],itemLayout:e.ListItemLayout.fixed,itemType:e.ListItemType.large,showTitle:!0}))));c.push(a.sectionHeader({content:g.I18n.ts("Zoom animations")}));b.canAddZoomToObjectAnimation?c.push(a.simpleList((a)=>({items:p.isActive("js-unique-differentiation")?[a.image({id:"zoom-item-3",title:g.I18n.ts("Zoom to"),src:{url:this.zoomToImage},onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert zoom to",run:(a)=>{this.addAnimation(this.uiRoot.getState(),
a,q.zoomTo)}})},hoverContent:{type:e.HoverContentType.video,url:this.zoomToVideo},dataLookup:"zoom-to-image"}),a.image(k)]:[a.image(f),a.image(k),a.image({id:"zoom-item-3",title:g.I18n.ts("Zoom to"),src:{url:this.zoomToImage},onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert zoom to",run:(a)=>{this.addAnimation(this.uiRoot.getState(),a,q.zoomTo)}})},hoverContent:{type:e.HoverContentType.video,url:this.zoomToVideo},dataLookup:"zoom-to-image"})],itemLayout:e.ListItemLayout.fixed,
itemType:e.ListItemType.large,showTitle:!0}))):c.push(a.simpleList((a)=>({items:[...p.isActive("js-unique-differentiation")?[]:[a.image(f)],a.image(k)],itemLayout:e.ListItemLayout.fixed,itemType:e.ListItemType.large,showTitle:!0})));let d="";b.canAddFadeAnimation?b.canAddZoomToObjectAnimation||(d=g.I18n.ts("Select an object to use zoom-to animations.")):d=g.I18n.ts("Select an object to use zoom-to, fade-in and fade-out animations.");b.canAddFadeAnimation&&b.canAddZoomToObjectAnimation||c.push(a.infoMessage(d));
return c}getActiveListItemIds(a){var b;return null!==(b=null===a||void 0===a?void 0:a.timelineIds)&&void 0!==b?b:[]}createList(a,b){return[b.timelineList((b)=>{var c,k;return{id:"timeline-structure-list",activeId:null===(c=a.activePathElementRef)||void 0===c?void 0:c.id,secondaryActiveId:null===(k=a.secondaryActivePathElementRef)||void 0===k?void 0:k.id,items:this.getActiveListItemIds(a).map((c)=>this.createListItemFromPathItem(b,a.listItemMap.get(c),a.aspectRatio)),onReorderStart:(b)=>this.onReorderStart(a,
b),onReorderEnd:(b,c)=>this.onReorderEnd(a,b,c),animate:a.animate}})]}getActivePathElementRef(a){var b;const c=null===(b=a.activePathElementRef)||void 0===b?void 0:b.id;return 0<=this.getActiveListItemIds(a).indexOf(c)?a.activePathElementRef:null}createPropertyBarAnimationButton(a,b){return b.button({id:"path-editing-animation",groupWeight:10,weight:100,icon:e.IconSmallId.AddAnimation,tooltip:g.I18n.ts("Add animation"),onClick:()=>F(this,void 0,void 0,function*(){r.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANIMATION"});
this.uiRoot.sidebar.toggle("sidebar-animations")})})}canAddAnimation(a,b){if(a.allObjects.some((a)=>a.is(h.base.ObjectKind.lockable)&&a.locked))return!1;switch(b){case q.fadeIn:case q.fadeOut:return 0===a.allObjects.length||1===a.allObjects.length&&L(a.allObjects[0].kind,d.zoomArea)?!1:!0;case q.zoomTo:return 1===a.allObjects.length&&0===a.groups.length&&L(a.allObjects[0].kind,d.simpleObject);case q.zoomOut:return!0;default:u.Utils.assertNever(b)}}onReorderStart(a,b){const c=this.getActiveListItemIds(a),
f=a.listItemMap.get(c[b.fromIndex]),k=c.map((a,b)=>({itemId:a,index:b})).filter((b)=>n(a.listItemMap.get(b.itemId).pathElementRef,d.backToParent)).map((a)=>a.index);if(n(a.targetRef,d.stackTopic)){const d=[],e=[];let h=null;c.forEach((b,c)=>{b=a.listItemMap.get(b);b.kind===w.deck&&(h={pageIndex:d.length,itemInfos:[]},d.push(h));c={itemIndex:c,item:b,pageInfo:h};e.push(c);h.itemInfos.push(c)});const g=e[b.fromIndex].pageInfo;if(f.kind!==w.deck)return b=e.map((a,b)=>a.pageInfo===g&&a!==g.itemInfos[0]?
null:b).filter((a)=>null!=a),{forbiddenIndices:[...k,...b]};{var y=e.map((a,b)=>{b=a.pageInfo.pageIndex>g.pageIndex?b-g.itemInfos.length:b;return a.item.kind===w.deck||a.pageInfo===g?null:b}).filter((a)=>null!=a);const a=g.itemInfos.length;return{forbiddenIndices:[...k.map((b)=>b-a+1),...y],startIndex:b.fromIndex,count:a}}}return f.kind===w.text||(null===(y=a.listItemMap.get(c[0]))||void 0===y?void 0:y.kind)===w.main?{forbiddenIndices:[...k,0]}:{forbiddenIndices:k}}onReorderEnd(a,b,c){const f=this.getActiveListItemIds(a);
u.Utils.arrayEquals(f,this.getActiveListItemIds(this.uiRoot.getState()))&&this.session.document.executeApiCommand(b,{name:"left-sidebar-reorder",run:(b)=>{var k=b.lookup.resolve(a.targetRef),m=a.listItemMap.get(f[c.fromIndex]);m=b.lookup.resolve(m.pathElementRef);var e=m.is(d.visitOverview)||m.is(d.visitStack)||m.is(d.visitPlanet)||m.is(d.visitPage)?"THUMBNAIL":"ANIMATION";r.avro.Avro.createDefaultLogger().logDragObject({object_type:e,topic_relationship:"CONTENT",object_id:e.toLowerCase()});k.is(d.stackTopic)?
m.is(d.freePathChild)?(k=b.structuredPath.customStartPoint===m,e=m.copyTo(m.parent,m.index+c.toIndex-c.fromIndex+(c.toIndex>c.fromIndex?1:0)),m.delete(),k&&(b.structuredPath.customStartPoint=e)):m.is(d.visitPage)&&(k=c.toIndex>c.fromIndex?c.toIndex+c.count:c.toIndex,e=m.target,k===f.length-1?m.index=e.parent.pageChildren.length-1:(k=b.lookup.resolve(a.listItemMap.get(f[k]).pathElementRef),u.Utils.assert(k.is(d.visitPage),""),m.index=c.toIndex>c.fromIndex?k.target.index-1:k.target.index)):(u.Utils.assert(1===
c.count,""),m.is(d.visitStack)||m.is(d.visitPlanet)?m.index=c.toIndex-1:m.is(d.freePathChild)&&(k=b.structuredPath.customStartPoint===m,e=m.copyTo(m.parent,c.toIndex>m.index?c.toIndex:c.toIndex-1),m.delete(),k&&(b.structuredPath.customStartPoint=e)));this.readStateFromDocument(b,!1)}})}addTopic(a,b,c){const f=c.targetRef;f.kind!==d.stackTopic&&this.session.document.executeApiCommand(a,{name:`Add ${b}`,run:(k)=>{const e=k.lookup.resolve(f),m=k.lookup.resolve(c.currentVisitRef);if(null!=e&&null!=m){var g=
0;g=this.getActivePathElementRef(c);null!=g&&n(g,d.pathChild)?(g=k.lookup.resolve(g),g=m===g?0:g.index+1):g=m.children.length;var l=0,q=m.children;for(let a=0;a<g;a++)q[a].is(d.freePathChild)||l++;var B=b===h.base.ObjectKind.planetTopic?e.layout.add.planet(l):b===h.base.ObjectKind.stackTopic?e.layout.add.stack(l):u.Utils.assertNever(b);this.logAfterTopicOrPageInsert(B);m.children.find((a)=>(a.kind===d.visitPlanet||a.kind===d.visitStack)&&a.target===B).index=g;k.animate(B).dropIn();this.scrollToAdded(k,
B);this.session.selection.setSelection(a,[B])}}})}addZoomArea(a,b){this.session.document.executeApiCommand(a,{name:"Add zoom area",run:(c)=>{const f=c.lookup.resolve(b.currentVisitRef),k=f.target.add.zoomArea();r.avro.Avro.createDefaultLogger().logNewObject({object_type:k,topic_relationship:k,parent_type:k,object_id:k.id});k.fitInto(this.session.positionFinder.findLayoutBox(f.target,k.layoutBox.size.width,k.layoutBox.size.height,null,null));this.session.selection.setSelection(a,[k]);this.addAnimation(b,
c,q.zoomTo)}})}addZoomOut(a,b){this.session.document.executeApiCommand(a,{name:"Insert zoom out",run:(a)=>{this.addAnimation(b,a,q.zoomOut)}})}addPage(a,b){const c=b.targetRef;c.kind===d.stackTopic&&this.session.document.executeApiCommand(a,{name:"Add Page",run:(a)=>{var f=a.lookup.resolve(c);const d=a.lookup.resolve(b.currentVisitRef);if(null!=f&&null!=d)switch(d.kind){case h.base.ObjectKind.visitOverview:case h.base.ObjectKind.visitPlanet:u.Utils.fail(`currentVisit element should not be ${d.kind}`);
break;case h.base.ObjectKind.visitPage:f=f.add.page(d.index+1),this.logAfterTopicOrPageInsert(f),this.scrollToAdded(a,f)}}})}createContextMenuItems(a,b){const c=a.targetRef;c.kind===d.stackTopic?(null==a.selectionInfo||0===a.selectionInfo.allObjects.length)&&b.createMenuItem({kind:e.MenuItemKind.context,title:g.I18n.ts("Insert page"),id:"add-page-context-menu-button",weight:130,onClick:(b)=>this.addPage(b,a)}):null!=a.selectionInfo&&0!==a.selectionInfo.allObjects.length||c.kind===d.overview&&p.isActive("js-frame-only-editor")||
b.createMenuItem({kind:e.MenuItemKind.context,title:c.kind===d.overview?g.I18n.ts("Insert topic"):g.I18n.ts("Insert subtopic"),id:"context-menu-new-topic",weight:130,onClick:(b)=>this.addTopic(b,h.base.ObjectKind.planetTopic,a)});const f=a.startPointCtxAction;if(null!=f)switch(f.kind){case A.Add:b.createMenuItem({kind:e.MenuItemKind.context,title:g.I18n.ts("Set as starting point"),id:"context-menu-set-start-point",weight:80,onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"set custom start point",
run:(a)=>{const b=a.lookup.resolve(f.pathElementRef);null!=b&&(a.structuredPath.customStartPoint=b,r.avro.Avro.createDefaultLogger().logSetCustomStartingPoint({object_id:b.id,object_type:this.mapPathElementToLoggingObjectType(b)}))}})}});break;case A.Remove:b.createMenuItem({kind:e.MenuItemKind.context,title:g.I18n.ts("Remove starting point"),id:"context-menu-remove-start-point",weight:80,onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"remove custom start point",run:(a)=>{r.avro.Avro.createDefaultLogger().logRemoveCustomStartingPoint({object_id:a.structuredPath.customStartPoint.id,
object_type:this.mapPathElementToLoggingObjectType(a.structuredPath.customStartPoint)});a.structuredPath.customStartPoint=null}})}});break;default:u.Utils.assertNever(f)}}mapPathElementToLoggingObjectType(a){switch(a.kind){case h.base.ObjectKind.visitOverview:case h.base.ObjectKind.visitPage:return"THUMBNAIL";case h.base.ObjectKind.visitPlanet:case h.base.ObjectKind.visitStack:return"TOPIC";case h.base.ObjectKind.backToParent:case h.base.ObjectKind.fadeIn:case h.base.ObjectKind.fadeOut:case h.base.ObjectKind.zoom:return"ANIMATION";
default:u.Utils.assertNever(a)}}insertMenuActionKind(a){return p.isActive("js-unique-differentiation")?a.targetRef.kind===d.stackTopic?l.page:l.zoomArea:a.targetRef.kind===d.stackTopic?l.page:a.topicless?l.zoomArea:l.planet}addActionHandler(a,b,c){switch(a){case l.planet:return this.addTopic(b,h.base.ObjectKind.planetTopic,c);case l.stack:return this.addTopic(b,h.base.ObjectKind.stackTopic,c);case l.zoomArea:return this.addZoomArea(b,c);case l.page:return this.addPage(b,c);case l.zoomOut:return this.addZoomOut(b,
c);default:return u.Utils.assertNever(a)}}getAddActionText(a,b){b=b.kind===d.overview;switch(a){case l.planet:return b?g.I18n.ts("Topic"):g.I18n.ts("Subtopic");case l.stack:return b?g.I18n.ts("Stack topic"):g.I18n.ts("Stack subtopic");case l.zoomArea:return p.isActive("js-unique-differentiation")?g.I18n.ts("Frame"):g.I18n.ts("Zoom area");case l.page:return g.I18n.ts("Page");case l.zoomOut:throw Error("Not implemented");default:return u.Utils.assertNever(a)}}createAddButtonDropdownActions(a,b,c){const f=
(a)=>{switch(a){case l.planet:return{id:"add-planet",title:p.isActive("js-unique-differentiation")?g.I18n.ts("Planet"):g.I18n.ts("Planet topic"),icon:e.IconSmallId.PlanetTopic};case l.stack:return{id:"add-stack",title:p.isActive("js-unique-differentiation")?g.I18n.ts("Pages"):g.I18n.ts("Stack topic"),icon:e.IconSmallId.StackTopic};case l.zoomArea:return{id:"add-zoom-area",title:p.isActive("js-unique-differentiation")?g.I18n.ts("Frame"):g.I18n.ts("Zoom area"),icon:p.isActive("js-unique-differentiation")?
e.IconSmallId.NewTopic:e.IconSmallId.Fullscreen};case l.page:return{id:"add-page",title:g.I18n.ts("Page"),icon:e.IconSmallId.StackTopic};case l.zoomOut:return{id:"zoom-out",title:this.zoomOutName(b),icon:e.IconSmallId.ZoomOut};default:return u.Utils.assertNever(a)}},d=[a.header({content:p.isActive("js-unique-differentiation")?g.I18n.ts("Add topic"):g.I18n.ts("Topics")})];p.isActive("js-unique-differentiation")&&d.push(a.menuItem(Object.assign(Object.assign({},f(l.zoomArea)),{onClick:(a)=>{c||this.uiRoot.setState({lastAddButtonActionKind:l.zoomArea});
return this.addActionHandler(l.zoomArea,a,b)}})));d.push(a.menuItem(Object.assign(Object.assign({},f(l.planet)),{onClick:(a)=>{this.uiRoot.setState({lastAddButtonActionKind:l.planet});return this.addActionHandler(l.planet,a,b)}})),a.menuItem(Object.assign(Object.assign({},f(l.stack)),{onClick:(a)=>{this.uiRoot.setState({lastAddButtonActionKind:l.stack});return this.addActionHandler(l.stack,a,b)}})));const y=[];p.isActive("js-unique-differentiation")&&y.push(a.menuItem(Object.assign(Object.assign({},
f(l.zoomArea)),{onClick:(a)=>{c||this.uiRoot.setState({lastAddButtonActionKind:l.zoomArea});return this.addActionHandler(l.zoomArea,a,b)}})));y.push(a.menuItem(Object.assign(Object.assign({},f(l.page)),{onClick:(a)=>this.addActionHandler(l.page,a,b)})));const m=[a.separator(),a.header({content:p.isActive("js-unique-differentiation")?g.I18n.ts("Add Animation"):g.I18n.ts("Zooming Animations")})];p.isActive("js-unique-differentiation")||m.push(a.menuItem(Object.assign(Object.assign({},f(l.zoomArea)),
{onClick:(a)=>{c||this.uiRoot.setState({lastAddButtonActionKind:l.zoomArea});return this.addActionHandler(l.zoomArea,a,b)}})));m.push(a.menuItem(Object.assign(Object.assign({},f(l.zoomOut)),{onClick:(a)=>this.addActionHandler(l.zoomOut,a,b)})));return c?[...y,...m]:[...d,...m]}createAddButton(a,b){var c;const f=a.targetRef.kind===d.stackTopic;let k;k=p.isActive("js-remember-add-buton-state")?f?l.page:a.lastAddButtonActionKind:this.insertMenuActionKind(a);return p.isActive("js-frame-only-editor")&&
(null===(c=a.targetRef)||void 0===c?void 0:c.kind)===d.overview?(k=l.zoomArea,b.button({color:e.ButtonColor.Green,id:"add-button",content:{text:g.I18n.ts("Add frame"),icon:e.IconSmallId.NewTopic},onClick:(b)=>this.addActionHandler(k,b,a),flexibleWidth:!0})):b.comboMenuButton((b)=>({color:e.ButtonColor.Green,id:"add-button",content:{text:this.getAddActionText(k,a.targetRef),icon:p.isActive("js-unique-differentiation")?f?e.IconSmallId.StackTopic:e.IconSmallId.NewTopic:e.IconSmallId.Plus},onClick:(b)=>
this.addActionHandler(k,b,a),onOpen:()=>{var b;r.avro.Avro.createDefaultLogger().logShowTopicInsertOptions({topic_level:(null===(b=a.targetRef)||void 0===b?void 0:b.kind)===d.overview?"MAIN_TOPIC":"SUB_TOPIC",topic_sidebar_trigger:"SIDEBAR_BUTTON"})},actions:this.createAddButtonDropdownActions(b,a,f)}))}createNavigationButtons(a,b){return[b.button({color:e.ButtonColor.Ghost,id:"home-button",content:{icon:e.IconSmallId.Home},onClick:(a)=>{this.pluginAccess.send(v.navigation,{kind:"goToOverview",uat:a,
body:null})}}),null==a.backToRef?null:b.button({color:e.ButtonColor.Ghost,id:"back-button",content:{icon:e.IconSmallId.ZoomOut,text:g.I18n.ts("Go back")},onClick:(a)=>{this.pluginAccess.send(v.navigation,{kind:"goBack",uat:a,body:null})}})].filter((a)=>null!=a)}createButtons(a,b){var c;return[b.button(e.ButtonSize.Large,e.ButtonAlign.Start,(b)=>[this.createAddButton(a,b)]),...p.isActive("js-frame-only-editor")&&(null===(c=a.targetRef)||void 0===c?void 0:c.kind)===d.overview?[]:[b.separator(!0),b.button(e.ButtonSize.Small,
e.ButtonAlign.Start,(b)=>this.createNavigationButtons(a,b))]]}createListItemFromPathItem(a,b,c){const f=(a)=>{var b,f;const d=null!==(f=null!==(b=a.thumbnail.canvas)&&void 0!==b?b:a.thumbnail.fastCanvas)&&void 0!==f?f:a.thumbnail.prevCanvas,k=null!=a.thumbnail.fastCanvas;return{id:a.id,dataLookup:a.id,title:a.title,content:"0"===a.label?{icon:e.IconSmallId.Home}:{text:a.label},src:null!=d?{canvas:d}:{aspectRatio:c},onClick:(b)=>this.navigateTo(b,a.pathElementRef),onMouseEnter:(b)=>this.setHovered(b,
a),onMouseLeave:(a)=>this.setHovered(a,[]),onShowActions:()=>{r.avro.Avro.createDefaultLogger().logOpenObjectContextMenu({object_type:"THUMBNAIL",object_id:this.targetIdFromPathElementRefForLog(a.pathElementRef)})},requestImage:null==a.thumbnail.canvas?()=>{this.requestRenderPathElement(a.pathElementRef,k)}:null,actions:this.getItemActions(a),badges:a.kind!==w.main?a.badges.filter((a)=>a!==e.IconSmallId.Animation):a.badges,canStartReorder:a.canStartReorder}};var k=(b)=>a.deck(Object.assign(Object.assign({},
f(b)),{showDeck:b.showDeck}));switch(b.kind){case w.main:return a.main(Object.assign({},f(b)));case w.deck:return k(b);case w.frame:return a.frame(Object.assign({},f(b)));case w.text:return k=(a)=>{this.session.document.read((c)=>{c=c.lookup.resolve(b.pathElementRef);r.avro.Avro.createDefaultLogger().logPreviewAnimation({animation_type:c.kind===d.fadeIn?"FADE_IN":c.kind===d.fadeOut?"FADE_OUT":u.Utils.assertNever(c)});this.session.navigation.previewAnimation(a,c)})},a.text({id:b.id,dataLookup:b.id,
icon:b.icon,tooltipText:b.tooltipText,title:b.title,text:b.text,onClick:k,onMouseEnter:(a)=>this.setHovered(a,b),onMouseLeave:(a)=>this.setHovered(a,[]),onDeleteClick:(a)=>{this.session.document.executeApiCommand(a,{name:"delete path element",run:(a)=>{r.avro.Avro.createDefaultLogger().logDeleteObject({delete_type:"CONTEXT_DELETE",object_id:null,object_type:"ANIMATION",topic_relationship:"CONTENT"});a=a.lookup.resolve(b.pathElementRef);null!=a&&(a.is(d.fadeIn)||a.is(d.fadeOut))&&(a.delete(),r.avro.Avro.createDefaultLogger().logDeletedObject({delete_type:"CONTEXT_DELETE",
object_id:null,object_type:"ANIMATION",topic_relationship:"CONTENT"}))}})},timelineAction:{onClick:k,title:g.I18n.ts("Preview"),id:`preview-${b.id}`,icon:e.IconSmallId.Play},canStartReorder:b.canStartReorder});default:u.Utils.assertNever(b)}}audioButtonOnClick(a){this.pluginAccess.send(v.pathAudio,v.createOpenAudioSidebarFromLeftSidebar(a.id))}navigateTo(a,b){this.session.document.read((c)=>{var f,d;c=c.lookup.resolve(b);null!=c&&(this.session.selection.setSelection(a,[]),this.session.navigation.goToPathElement(a,
c),c.kind!==h.base.ObjectKind.visitStack&&c.kind!==h.base.ObjectKind.visitPlanet&&c.kind!==h.base.ObjectKind.visitPage||r.avro.Avro.createDefaultLogger().logOpenedTopic({object_type:c.parent.is(h.base.ObjectKind.visitOverview)?"TOPIC":"SUBTOPIC",object_id:c.target.id}),b.kind===h.base.ObjectKind.visitPage&&this.uiRoot.setState({currentVisitRef:b}),this.uiRoot.setState({activePathElementRef:c.ref}),this.pluginAccess.send(v.videoInsert,{kind:v.VideoInsertSidebarMessageKind.setActivePathElement,activePathElementId:null===
(f=this.getActivePathElementRef(this.uiRoot.getState()))||void 0===f?void 0:f.id}),this.pluginAccess.send(v.turnIntoTopic,{kind:v.TurnIntoTopicMessageKind.setActivePathElement,activePathElementId:null===(d=this.getActivePathElementRef(this.uiRoot.getState()))||void 0===d?void 0:d.id}),this.uiRoot.scrollIntoView(c.id))})}getThumbnailId(a){return a.id}createThumbnailForPathElement(a){var b,c=null===(b=this.thumbnailService)||void 0===b?void 0:b.getCachedCanvasForPathElement(a,J);b=null!=c?c.canvas:
null;const d=null==c||c.dirty?null:c.canvas;c=null!=c&&!c.dirty&&c.highQuality?c.canvas:null;return{id:this.getThumbnailId(a),pathElementRef:a.ref,prevCanvas:b,fastCanvas:d,canvas:c}}createBasePathItem(a){return{id:a.id,pathElementRef:a.ref}}createBaseImagePathItem(a,b,c){return Object.assign(Object.assign({},this.createBasePathItem(a)),{title:a.title,thumbnail:this.createThumbnailForPathElement(a),actions:{canAddAnimation:a.is(d.visitPlanet),canDuplicate:!c&&(a.is(d.visitPlanet)||a.is(d.visitStack)||
a.is(d.visitPage)),canAddAudio:a.is(d.visitOverview)||a.is(d.visitPlanet)||a.is(d.visitPage)||a.is(d.zoom)||a.is(d.backToParent),customStartPoint:{canSet:a.is(d.visitPlanet)||a.is(d.visitPage)||a.is(d.zoom)||a.is(d.backToParent),isSet:(null===b||void 0===b?void 0:b.id)===a.id},canDelete:a.is(d.visitPage)?1<a.target.parent.pageChildren.length:!a.is(d.backToParent)&&!a.is(d.visitOverview),canAddNarrative:!0},badges:this.getBadges(a,b)})}getBadges(a,b){const c=[];(null===b||void 0===b?void 0:b.id)===
a.id&&c.push(e.IconSmallId.CustomStartingpoint);a.is(d.visitStack)?a.children.some((a)=>a.children.some((a)=>a.is(d.freePathChild)))&&c.push(e.IconSmallId.Animation):a.is(d.visitPlanet)&&a.children.some((a)=>a.is(d.freePathChild))&&c.push(e.IconSmallId.Animation);(a.is(d.visitOverview)||a.is(d.visitPlanet)||a.is(d.visitPage)||a.is(d.zoom))&&null!=this.commentingController&&this.commentingController.hasUnresolvedCommentOnTargetEntityOrChild(a.target.id)&&c.push(e.IconSmallId.Comment);b=a.is(d.visitStack)?
a.children[0]:a;null!=b.narrative&&0<b.narrative.length&&c.push(e.IconSmallId.PresenterNotes);(a.is(d.visitOverview)||a.is(d.visitPlanet)||a.is(d.visitPage)||a.is(d.backToParent)||a.is(d.zoom))&&null!=a.audio&&c.push(e.IconSmallId.Audio);return c}createTextPathItem(a){return Object.assign(Object.assign({},this.createBasePathItem(a)),{kind:w.text,icon:this.fadeIcons.get(a.kind),title:null,tooltipText:this.fadeTitles.get(a.kind),text:a.title,canStartReorder:!0})}showAsText(a){return a.is(d.fadeIn)||
a.is(d.fadeOut)}readStateFromDocument(a,b){var c,f;if(null!=this.currentTopicRef){var k=a.structuredPath.pathElementsInOrder,e=new Set(a.structuredPath.viewPathElementsInOrder.map((a)=>a.id)),g=N(a);k=this.getCurrentVisit(a,k);var h=this.uiRoot.getState(),l=this.session.selection.getReadonlySelectionInfo(a),n=a.structuredPath.customStartPoint,r=(a)=>{if(a.is(d.backToParent))return Object.assign(Object.assign({kind:w.deck},this.createBaseImagePathItem(a,n,!1)),{label:g.get(a.id).outsideLabel,showDeck:!1,
canStartReorder:!1});if(a.is(d.visitPlanet)||a.is(d.visitStack))return Object.assign(Object.assign({kind:w.deck},this.createBaseImagePathItem(a,n,!1)),{label:g.get(a.id).outsideLabel,showDeck:a.is(d.visitPlanet)?0<a.target.topicChildren.length:0<a.target.pageChildren.length,canStartReorder:!0});if(a.is(d.visitPage))return Object.assign(Object.assign({kind:w.deck},this.createBaseImagePathItem(a,n,!1)),{label:g.get(a.id).outsideLabel,showDeck:!1,canStartReorder:!0});if(a.is(d.zoom))return Object.assign(Object.assign({kind:w.frame},
this.createBaseImagePathItem(a,n,!1)),{label:g.get(a.id).outsideLabel,canStartReorder:!0});u.Utils.assertNever(a)},x=k.is(d.visitPage)?k.parent:k,p=k.is(d.visitPage)?u.Utils.flatten(k.parent.children.map((a)=>[a,...a.children])):x.children;(x.is(d.visitPlanet)||x.is(d.visitStack))&&e.has(x.backToParent.id)&&(p=[...p,x.backToParent]);e=new Map;var t=new Map,A=new Map;for(const a of[x,...p])if(a.is(d.pathParent)||a.is(d.zoom)){var z=a.target.id;null!=z&&(e.has(z)||e.set(z,a.ref),A.set(a.id,z))}else a.is(d.fadeOut)||
a.is(d.fadeIn)?(z=a.groupTargets,a.targets.forEach((b)=>t.set(b.id,a.ref)),z.forEach((b)=>b.members.forEach((b)=>t.set(b.id,a.ref)))):a.is(d.backToParent)||u.Utils.assertNever(a);z=new Map;var C=Object.assign(Object.assign({kind:w.main},this.createBaseImagePathItem(x,n,!0)),{label:g.get(x.id).insideLabel,canStartReorder:!1});z.set(C.id,C);for(var D of p)C=this.showAsText(D)?this.createTextPathItem(D):r(D),z.set(C.id,C);D=x.is(d.visitStack)?[]:[x.id];a=a.aspectRatio;this.uiRoot.setState({animate:b,
targetRef:x.target.ref,backToRef:x.is(d.pathChild)?x.parent.target.ref:null,listItemMap:z,timelineIds:[...D,...p.map((a)=>a.id)],targetIdMap:e,fadeTargetIdMap:t,pathElementIdToTargetId:A,canAddZoomToObjectAnimation:this.canAddAnimation(l,q.zoomTo),canAddFadeAnimation:this.canAddAnimation(l,q.fadeIn),currentVisitRef:k.ref,activePathElementRef:null===h||void 0===h?void 0:h.activePathElementRef,aspectRatio:a,currentStartPointRef:null===n||void 0===n?void 0:n.ref,currentTopicId:(null===h||void 0===h?
void 0:h.currentTopicId)||null,lastVisitedTopicId:(null===h||void 0===h?void 0:h.currentTopicId)||null,networkStatus:(null===h||void 0===h?void 0:h.networkStatus)||null});this.pluginAccess.send(v.videoInsert,{kind:v.VideoInsertSidebarMessageKind.setActivePathElement,activePathElementId:null===(c=this.getActivePathElementRef(this.uiRoot.getState()))||void 0===c?void 0:c.id});this.pluginAccess.send(v.turnIntoTopic,{kind:v.TurnIntoTopicMessageKind.setActivePathElement,activePathElementId:null===(f=this.getActivePathElementRef(this.uiRoot.getState()))||
void 0===f?void 0:f.id})}}requestRenderPathElement(a,b){return F(this,void 0,void 0,function*(){const c=yield G.ThumbnailRenderModule.getThumbnailService(),d=(b)=>F(this,void 0,void 0,function*(){const d=yield c.renderPathElement(a,{size:J,needHighQuality:b}).getThumbnail();null!=d&&this.updateStateFromThumbnail(a,d,b)});d(!0);b||d(!1)})}updateStateFromThumbnail(a,b,c){const d=this.uiRoot.getState();if(null!=d&&null!=d.listItemMap){var e=(a)=>{var d,f;const e=a.thumbnail;return c?(null===(d=e.canvas)||
void 0===d?void 0:d.id)===b.canvas.id?a:Object.assign(Object.assign({},a),{thumbnail:Object.assign(Object.assign({},e),{canvas:b.canvas})}):(null===(f=e.fastCanvas)||void 0===f?void 0:f.id)===b.canvas.id?a:Object.assign(Object.assign({},a),{thumbnail:Object.assign(Object.assign({},e),{fastCanvas:b.canvas})})};for(const b of d.listItemMap.values())switch(b.kind){case w.text:break;case w.deck:case w.frame:case w.main:let c=b;c.id===a.id&&(c=e(c));if(b!==c){a=new Map(d.listItemMap);a.set(c.id,c);this.uiRoot.setState({listItemMap:a});
return}break;default:u.Utils.assertNever(b)}}}getItemActions(a){const {networkStatus:b}=this.uiRoot.getState();return[a.actions.canAddAudio?{id:"audio-item",icon:e.IconSmallId.Audio,title:g.I18n.ts("Edit sound"),enabled:b===e.NetworkStatus.Online,onClick:()=>{this.audioButtonOnClick(a.pathElementRef)}}:null,a.actions.canAddAnimation?{id:"animation-item",icon:e.IconSmallId.Animation,title:g.I18n.ts("Add animation"),onClick:(b)=>{a.pathElementRef.kind===d.visitPlanet&&this.session.document.read((c)=>
{c=c.lookup.resolve(a.pathElementRef);null!=c&&c.is(d.visitPlanet)&&(this.session.selection.setSelection(b,[c.target]),this.uiRoot.sidebar.toggle("sidebar-animations"))})}}:null,a.actions.customStartPoint.canSet&&!a.actions.customStartPoint.isSet?{id:"set-custom-start-point",icon:e.IconSmallId.CustomStartingpoint,title:g.I18n.ts("Set as starting point"),onClick:(b)=>{this.session.document.executeApiCommand(b,{name:"set custom start point",run:(b)=>{const c=b.lookup.resolve(a.pathElementRef);null!=
c&&(b.structuredPath.customStartPoint=c,r.avro.Avro.createDefaultLogger().logSetCustomStartingPoint({object_id:c.id,object_type:this.mapPathElementToLoggingObjectType(c)}))}})}}:a.actions.customStartPoint.isSet?{id:"remove-custom-start-point",icon:e.IconSmallId.CustomStartingpoint,title:g.I18n.ts("Remove custom start point"),onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"remove custom start point",run:(a)=>{r.avro.Avro.createDefaultLogger().logRemoveCustomStartingPoint({object_id:a.structuredPath.customStartPoint.id,
object_type:this.mapPathElementToLoggingObjectType(a.structuredPath.customStartPoint)});a.structuredPath.customStartPoint=null}})}}:null,a.actions.canAddNarrative?{id:"open-narrative",icon:e.IconSmallId.PresenterNotes,title:g.I18n.ts("Presenter notes"),onClick:(b)=>{this.pluginAccess.send(v.narrativeEditor,{kind:"openSidebar",uat:b,body:a.pathElementRef.id})}}:null,a.actions.canDuplicate?e.DropdownMenuSeparatorConst:null,a.actions.canDuplicate?{id:"duplicate-item",icon:e.IconSmallId.Copy,title:g.I18n.ts("Duplicate"),
onClick:(b)=>{this.session.document.executeApiCommand(b,{name:"duplicate",run:(b)=>{var c=b.lookup.resolve(a.pathElementRef);if(null!=c)if(c.is(d.visitPlanet)||c.is(d.visitStack)){var e=c.target.copy();e=c.target.parent.layout.add.inserter(e);e.isValid()&&(c=c.target.parent.topicChildren.indexOf(c.target)+1,c=e.insert(c),1===c.topics.length&&b.animate(c.topics[0]).dropIn())}else c.is(d.visitPage)&&(b=c.target.copy(),b=c.target.parent.add.inserter(b),b.isValid()&&(c=c.target.parent.pageChildren.indexOf(c.target)+
1,b.insert(c)))}})}}:null,a.actions.canDelete?e.DropdownMenuSeparatorConst:null,a.actions.canDelete?{id:"delete-element",icon:e.IconSmallId.Trash,title:g.I18n.ts("Delete"),onClick:(b)=>{this.session.document.executeApiCommand(b,{name:"delete path element",run:(b)=>{b=b.lookup.resolve(a.pathElementRef);if(null!=b&&!b.is(d.backToParent)&&!b.is(d.visitOverview))if(b.is(d.fadeIn)||b.is(d.fadeOut)||b.is(d.zoom))b.delete();else if(b.is(d.visitPage)&&1<b.target.parent.pageChildren.length){var c={delete_type:"CONTEXT_DELETE",
object_type:"THUMBNAIL",object_id:b.target.id,topic_relationship:"CONTENT"};r.avro.Avro.createDefaultLogger().logDeleteObject(c);b.target.delete();r.avro.Avro.createDefaultLogger().logDeletedObject(c)}else if(b.is(d.visitStack)||b.is(d.visitPlanet))c={delete_type:"CONTEXT_DELETE",object_type:"THUMBNAIL",object_id:b.target.id,topic_relationship:"CONTENT"},r.avro.Avro.createDefaultLogger().logDeleteObject(c),b.target.delete(),r.avro.Avro.createDefaultLogger().logDeletedObject(c)}})}}:null].filter((a)=>
null!=a).filter((a,b,d)=>a!==e.DropdownMenuSeparatorConst||0<b&&b<d.length-1)}showPathChild(a){this.uiRoot.scrollIntoView(a.id)}zoomOutName(a,b){return p.isActive("js-unique-differentiation")&&b?g.I18n.ts("Zoom out"):n(a.targetRef,d.stackTopic)?g.I18n.ts("Zoom out to Page"):n(a.targetRef,d.overview)?g.I18n.ts("Zoom out to Overview"):p.isActive("js-unique-differentiation")?g.I18n.ts("Zoom out to Planet"):n(a.targetRef,d.planetTopic)&&n(a.backToRef,d.overview)?g.I18n.ts("Zoom out to Topic"):g.I18n.ts("Zoom out to Subtopic")}addAnimation(a,
b,c){var e,g;let l=b.lookup.resolve(a.currentVisitRef),m=l;const n=this.session.selection.getSelectionInfo(b);if(this.canAddAnimation(n,c)){let f=-1;if(c===q.fadeIn&&1===n.allObjects.length){var p=n.allObjects[0];p.is(d.topic)&&(p=b.lookup.resolve(a.targetIdMap.get(p.id)),null!=p&&p.is(d.pathChild)&&(f=p.index))}if(-1===f&&(a=this.getActivePathElementRef(a),null!=a)){const c=b.lookup.resolve(a);if(c===l||c.kind===h.base.ObjectKind.visitOverview||c.kind===h.base.ObjectKind.visitPage)m=c,f=null!==(e=
m.children.findIndex((a)=>a.is(h.base.ObjectKind.visitOverview)||a.is(h.base.ObjectKind.visitPlanet)||a.is(h.base.ObjectKind.visitStack)||a.is(h.base.ObjectKind.visitPage)||a.is(h.base.ObjectKind.zoom)))&&void 0!==e?e:-1;else switch(c.kind){case h.base.ObjectKind.fadeOut:case h.base.ObjectKind.fadeIn:case h.base.ObjectKind.zoom:case h.base.ObjectKind.visitPlanet:case h.base.ObjectKind.visitStack:m=c.parent;f=null!==(g=m.children.findIndex((a,b)=>b>c.index&&(a.is(h.base.ObjectKind.visitOverview)||
a.is(h.base.ObjectKind.visitPlanet)||a.is(h.base.ObjectKind.visitStack)||a.is(h.base.ObjectKind.visitPage)||a.is(h.base.ObjectKind.zoom))))&&void 0!==g?g:-1;break;case h.base.ObjectKind.backToParent:u.Utils.fail(`active path element should not be ${c.kind}`);break;default:u.Utils.assertNever(c)}}-1===f&&(f=m.children.length);b=c===q.fadeIn?m.add.fadeIn(f,n.nonGroupedObjects,n.groups):c===q.fadeOut?m.add.fadeOut(f,n.nonGroupedObjects,n.groups):c===q.zoomTo?m.add.zoom(f,n.allObjects[0]):c===q.zoomOut?
m.add.zoom(f,l.target):u.Utils.assertNever(c);r.avro.Avro.createDefaultLogger().logAddAnimation({animation_type:c===q.fadeIn?"FADE_IN":c===q.fadeOut?"FADE_OUT":c===q.zoomTo?n.allObjects[0].kind===h.base.ObjectKind.zoomArea?"ZOOM_AREA":"ZOOM_TO_OBJECT":c===q.zoomOut?l.target.kind===h.base.ObjectKind.overview?"ZOOM_OUT_TO_OVERVIEW":"ZOOM_OUT_TO_TOPIC":u.Utils.assertNever(c)});this.showPathChild(b)}}logAfterTopicOrPageInsert(a){const b=a.parent;r.avro.Avro.createDefaultLogger().logNewObject({object_type:b.is(h.base.ObjectKind.overview)?
"TOPIC":"SUBTOPIC",topic_relationship:"CONTENT",parent_type:b.is(h.base.ObjectKind.overview)?"OVERVIEW":"TOPIC",object_id:a.id});let c=0,d=b;for(;!d.is(h.base.ObjectKind.overview);)c++,d=d.parent;r.avro.Avro.createDefaultLogger().logInsertTopic({dynamic_topic:null,topic_depth:c,topic_id:null,topic_sidebar_section:null,topic_type:a.kind===h.base.ObjectKind.planetTopic?b.is(h.base.ObjectKind.overview)?"TOPIC_PLANET":"SUBTOPIC_PLANET":a.kind===h.base.ObjectKind.stackTopic?b.is(h.base.ObjectKind.overview)?
"TOPIC_STACK":"SUBTOPIC_STACK":a.kind===h.base.ObjectKind.page?"SUBTOPIC_PAGE":u.Utils.assertNever(a)})}targetRefFromPathElementRef(a){if(n(a,d.visitPage)||n(a,d.visitPlanet)||n(a,d.visitStack)||n(a,d.zoom)){const b=this.session.document.read((b)=>{var c;return null===(c=b.lookup.resolve(a))||void 0===c?void 0:c.target.ref});return null!=b?[b]:[]}return n(a,d.fadeIn)||n(a,d.fadeOut)?this.session.document.read((b)=>{b=b.lookup.resolve(a);return null!=b?[...b.targets,...b.groupTargets].map((a)=>a.ref):
[]}):[]}targetIdFromPathElementRefForLog(a){a=this.targetRefFromPathElementRef(a);return 0<a.length?a[0].id:null}};var K={};Object.defineProperty(K,"__esModule",{value:!0});K.lazyModule={createPlugin(){return new E.PathEditingPlugin}};return K});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_path_editing",["require","prezi_cet_model_editor","prezi_commenting","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_thumbnail_render","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_path_editing.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_commenting"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_thumbnail_render"),require("prezi_utils"));}else{this["prezi_path_editing"]=__factory(this["prezi_cet_model_editor"],this["prezi_commenting"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_thumbnail_render"],this["prezi_utils"]);}}).call(this);