;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_chart_insert";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_editor_error":dependencies[1],"prezi_featureswitcher":dependencies[2],"prezi_i18n":dependencies[3],"prezi_logger":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_plugin_meta":dependencies[6],"prezi_utils":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(h){var v=h.dependencies.prezi_featureswitcher,q=h.dependencies.prezi_cet_model_editor,w=h.dependencies.prezi_editor_error,b=h.dependencies.prezi_i18n,e=h.dependencies.prezi_logger,c=h.dependencies.prezi_plugin_api,r=h.dependencies.prezi_plugin_meta,x=h.dependencies.prezi_utils,l={};Object.defineProperty(l,"__esModule",{value:!0});l.ba=[{name:b.I18n.ts("Line"),f:"line",u:[{name:b.I18n.ts("Line"),f:"line",i:"6_0"}]},{name:b.I18n.ts("Bar"),f:"bar",u:[{name:b.I18n.ts("Bar"),f:"bar",i:"4_0"},
{name:b.I18n.ts("Stacked"),f:"stacked_bar",i:"17_0"},{name:b.I18n.ts("Grouped"),f:"grouped_bar",i:"4_1"},{name:b.I18n.ts("Radial"),f:"radial",i:"2_1"}]},{name:b.I18n.ts("Column"),f:"column",u:[{name:b.I18n.ts("Column"),f:"column",i:"1_0"},{name:b.I18n.ts("Stacked"),f:"stacked_column",i:"10_0"},{name:b.I18n.ts("Grouped"),f:"grouped_column",i:"1_1"}]},{name:b.I18n.ts("Pie"),f:"pie",u:[{name:b.I18n.ts("Pie"),f:"pie",i:"2_0"},{name:b.I18n.ts("Doughnut"),f:"doughnut",i:"2_2"},{name:b.I18n.ts("Irregular"),
f:"irregular",i:"22_0"},{name:b.I18n.ts("Semi Circle"),f:"semicircle",i:"34_0"}]},{name:b.I18n.ts("Multiple axes"),f:"multiple_axes",u:[{name:b.I18n.ts("Column & Line"),f:"column_and_line",i:"30_0"},{name:b.I18n.ts("Line & Line"),f:"line_and_line",i:"31_0"},{name:b.I18n.ts("Grouped Column & Line"),f:"grouped_column_and_line",i:"35_0"},{name:b.I18n.ts("Stacked Column & Line"),f:"stacked_column_and_line",i:"36_0"}]},{name:b.I18n.ts("Scatter"),f:"scatter",u:[{name:b.I18n.ts("Scatter"),f:"scatter",i:"20_0"}]},
{name:b.I18n.ts("Hierarchy"),f:"hierarchy",u:[{name:b.I18n.ts("Funnel"),f:"funnel",i:"29_1"}]}];var k={},u=this&&k.oa||function(a,b,f,g){function d(a){return a instanceof f?a:new f(function(b){b(a)})}return new (f||(f=Promise))(function(f,t){function c(a){try{m(g.next(a))}catch(n){t(n)}}function e(a){try{m(g["throw"](a))}catch(n){t(n)}}function m(a){a.done?f(a.value):d(a.value).then(c,e)}m((g=g.apply(a,b||[])).next())})};Object.defineProperty(k,"__esModule",{value:!0});const y={$:!1,w:"DARK",aa:!1,
ca:!1};k.o=class{constructor(){this.editChart=(a)=>{if(this.j.getState().aa){var b=this.session.document.read((a)=>{a=this.session.selection.getReadonlySelectionInfo(a);if(1!==a.allObjects.length)return null;a=a.allObjects[0];return a.is(q.base.ObjectKind.chart)?{id:a.id,chartAsset:a.chartAsset}:null});if(null!=b){var {id:f,chartAsset:b}=b;this.logger.info({action:"open",feature:"charts",object:"chart_editor",trigger:"click",payload:{chart_type:b.chartType}});a.doAsync(this.ka(f,b.chartId),(a,b)=>
{null!=b&&a.isValid()&&this.session.document.executeApiCommand(a,{name:"chart upload for replace",run:(a)=>{a=a.lookup.chart(f);var d=a.chartAsset;d=this.session.document.progressiveAssetManager.uploadChart({params:b,chartType:d.chartType,width:d.width,height:d.height});d.finished.catch(()=>{this.j.dialog.showBuiltInError(w.EditorErrorCase.CHART_UPLOAD_ERROR,!1)});a.chartAsset=d.token;e.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"CHART",modify_action:"REPLACE",topic_relationship:a,
object_id:f})}})})}}else this.j.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertChart)};this.logger=e.LoggerModule.getLoggerManager().createLogger("prezi_chart_insert.ChartInsertPlugin")}init(a){this.ea=this.ga(a);this.j=a.declareUI(y,(a,b)=>{this.createSidebar(a,b);this.ja(a,b);this.ha(a,b)});a.onLicenseChange((a)=>{this.j.setState({aa:a.featureSet.editChart})});a.onSelectionChange(()=>{this.da()});a.onDocumentChange(()=>{this.da()})}da(){this.session.document.read((a)=>{a=this.session.selection.getReadonlySelectionInfo(a).allObjects;
this.j.setState({ca:1===a.length&&a[0].is(q.base.ObjectKind.chart)&&!a[0].locked})})}ma(a,b){this.logger.info({feature:"charts",action:"insert",object:"chart",trigger:a.dropKind===c.DropKind.click?"double_click":"dragdrop",payload:{chart_type:b}});e.avro.Avro.createDefaultLogger().logInsertChart({chart_source:a.dropKind===c.DropKind.click?"DOUBLE_CLICK":"DRAG_DROP",chart_type:b})}processMessage(a){if("openChartInsertSidebar"===a)this.openSidebar();else throw Error(`unexpected message: ${a}`);}openSidebar(){this.j.getState().$||
this.j.sidebar.open(k.o.v)}unload(){}na(a,b){const f=e.LoggerModule.getAvroLoggerHelper().getLogTopicRelationship(b),c=e.LoggerModule.getAvroLoggerHelper().getLogParentType(b),d=b.id;a.finished.then(()=>{e.avro.Avro.createDefaultLogger().logNewObject({object_type:"CHART",topic_relationship:f,parent_type:c,object_id:d})})}ka(a,d){return u(this,void 0,void 0,function*(){e.avro.Avro.createDefaultLogger().logOpenEditChartDialog({object_id:a});const f=yield this.ea.editChart(d),g=new URL(f.edit_url);return new Promise((a)=>
{let d;const e=(b)=>{b.origin===g.origin&&("update"===b.data.action&&null!=b.data.pdf&&null!=b.data.chartId?(this.logger.info({feature:"charts",action:"update_changes",trigger:"click",object:"chart_editor",payload:{chart_type:b.data.chartType,la:b.data.insertData}}),b={pdf:x.Utils.arrayBufferToPdfFile(b.data.pdf),chartId:b.data.chartId},window.removeEventListener("message",e),a(b)):"close"===b.data.action&&(this.logger.info({feature:"charts",action:"cancel_changes",trigger:"click",object:"chart_editor",
payload:{chart_type:b.data.chartType,la:b.data.insertData}}),window.removeEventListener("message",e),a(null)),this.j.dialog.hide(d))};d=this.j.dialog.showIFrame({url:f.edit_url,size:c.DialogType.full,title:b.I18n.ts("Edit chart"),onOpen:()=>{window.addEventListener("message",e,!1)},onClose:()=>{window.removeEventListener("message",e);a(null)}})})})}createSidebar(a,d){d.createSidebar(k.o.v,(d)=>{const f={};l.ba.forEach((g)=>{f[g.f]={title:g.name,content:[d.tabMenuButtons({activeId:a.w,onChange:(a,
b)=>{e.avro.Avro.createDefaultLogger().logClickChartBar({chart_item:b});this.j.setState({w:b})},options:[{kind:c.TabMenuItemKind.title,title:b.I18n.ts("Dark"),id:"DARK"},{kind:c.TabMenuItemKind.title,title:b.I18n.ts("Light"),id:"LIGHT"}]}),d.simpleList((b)=>({itemType:c.ListItemType.large,itemLayout:c.ListItemLayout.dynamic,showTitle:!0,items:g.u.map((d)=>b.droppableImage({title:d.name,src:{url:h.getResourceUrl(a.w.toLowerCase()+"/"+d.f+".png")},onDrop:(b,f)=>{f.dropKind===c.DropKind.click&&e.avro.Avro.createDefaultLogger().logClickChartBar({chart_item:"CHART_TYPE"});
this.j.getState().aa?this.session.document.executeApiCommand(b,{name:"insert chart",run:(c)=>{this.ma(f,d.i);const e=this.session.document.progressiveAssetManager.uploadChart({chartType:d.i,params:{colors:"DARK"===a.w?c.styleSheet.chartStyle.dark:c.styleSheet.chartStyle.light},width:160,height:90});var g=this.session.insertTarget.getSimpleObjectParent(c);c=this.session.positionFinder.findLayoutBox(g,160,90,f.stageX,f.stageY);g=g.add.chart(e.token);this.na(e,g);g.fitInto(c);this.session.selection.setSelection(b,
[g])}}):this.j.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertChart)}}))}))]}});return{root:{title:b.I18n.ts("CHARTS"),content:[...v.isActive("js-hide-library-sidebar-button")?[]:this.ia(d),this.fa(d)]},pages:f,onCloseButtonClicked:()=>{e.avro.Avro.createDefaultLogger().logCloseChartSidebar()},onOpen:()=>{this.logger.info({feature:"charts",action:"open",object:"sidebar",trigger:"click"});e.avro.Avro.createDefaultLogger().logShowChartInsertOptions();this.j.setState({$:!0})},onClose:()=>{this.j.setState({$:!1})}}})}fa(a){return a.simpleList((a)=>
({itemLayout:c.ListItemLayout.fixed,itemType:c.ListItemType.large,showTitle:!0,items:l.ba.map((b)=>a.folder({src:{url:h.getResourceUrl("folders/"+b.f+".png")},title:b.name,onClick:()=>{this.j.sidebar.open(k.o.v,b.f)}}))}))}ia(a){return[a.sectionHeader({content:b.I18n.ts("My Library")}),a.button(c.ButtonSize.Large,c.ButtonAlign.Start,(a)=>[a.button({id:"open-my-library-button",color:c.ButtonColor.Blue,content:{text:b.I18n.ts("Add from my library")},onClick:()=>{this.pluginAccess.send(r.favorites,r.createOpenFavoritesFromAnotherSidebarMessage("charts",
"insert"))}})]),a.separator()]}ja(a,d){d.createTopMenuItem(c.TopMenuId.Media,{id:"topmenu-insert-item-chart",title:b.I18n.ts("Chart"),icon:c.IconSmallId.Charts,onClick:()=>{e.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"CHART"});this.j.getState().aa?a.$?this.j.sidebar.close(k.o.v):this.j.sidebar.open(k.o.v):this.j.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertChart)},kind:c.MenuItemKind.largeButton,weight:7,categoryWeight:0})}ha(a,d){a.ca&&(d.createMenuItem({id:"context-menu-edit-chart",
title:b.I18n.ts("Edit chart"),onClick:this.editChart,kind:c.MenuItemKind.context,weight:67}),d.createPropertyBarItem((a)=>a.button({id:"propertybar-edit-chart",icon:c.IconSmallId.EditChart,tooltip:b.I18n.ts("Edit chart"),groupWeight:1,weight:1,onClick:(a)=>{e.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANY"});this.editChart(a)}})))}ga(a){return a.service(["api","v4","presentation-ext","chart"],(a)=>({editChart(d){return u(this,void 0,void 0,function*(){const c=yield a.access("PUT",
[d],{},{});return{chart_uuid:c.chart_uuid,edit_url:`https://prezi.infogram.com/prezi?chart_id=${c.chart_uuid}&lang=${b.I18n.getLanguage()}`}})}}))}};k.o.v="chart-sidebar";var p={};Object.defineProperty(p,"__esModule",{value:!0});p.lazyModule={createPlugin(){return new k.o}};return p});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_chart_insert",["require","prezi_cet_model_editor","prezi_editor_error","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_chart_insert.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_editor_error"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"));}else{this["prezi_chart_insert"]=__factory(this["prezi_cet_model_editor"],this["prezi_editor_error"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"]);}}).call(this);