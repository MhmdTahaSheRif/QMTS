;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_ppt_insert";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.engine.dom.converter.xpdom2":dependencies[1],"prezi.geometry":dependencies[2],"prezi_cet_model_editor":dependencies[3],"prezi_editor_commander":dependencies[4],"prezi_featureswitcher":dependencies[5],"prezi_i18n":dependencies[6],"prezi_koi_navigation":dependencies[7],"prezi_logger":dependencies[8],"prezi_plugin_api":dependencies[9],"prezi_plugin_meta":dependencies[10],"prezi_ppt_common":dependencies[11],"prezi_ppt_service":dependencies[12],"prezi_service_data":dependencies[13],"prezi_textmodel":dependencies[14],"prezi_utils":dependencies[15],"prezi_widgets":dependencies[16]}};})());};})(arguments);var moduleImpl=(function(){return module(function(n){function I(a,d){return a.getState().uploadProcess.slideResults?a.getState().uploadProcess.slideResults.map((c,b)=>{var f;if(c.state===x.Error)return d.error({dataLookup:`ppt-slide-thumbnail-${c.slideOrder}`});const g=c.state===x.InProgress?`ppt-slide-thumbnail-progress-${c.slideOrder}`:`ppt-slide-thumbnail-${c.slideOrder}`;var k=a.getState().slidesInPrezi;k=-1!==Array.from(k.values()).indexOf(b+1)?{r:177,g:184,b:190,intensity:.4}:null;return d.droppableImage({id:`${b}`,src:{url:null===
(f=c.content)||void 0===f?void 0:f.thumbnail},blendColor:k,dataLookup:g})}):[]}var K=n.dependencies.prezi_ppt_service,r=n.dependencies.prezi_cet_model_editor,w=n.dependencies.prezi_editor_commander,y=n.dependencies.prezi_featureswitcher,l=n.dependencies.prezi_i18n,u=n.dependencies.prezi_logger,h=n.dependencies.prezi_plugin_api,e=n.dependencies.prezi_ppt_common,A=n.dependencies.prezi_utils,t=n.dependencies.prezi_widgets,E=n.dependencies.prezi_koi_navigation,L=n.dependencies.prezi_service_data,p={};
Object.defineProperty(p,"__esModule",{value:!0});E=E.Lookup.ZoomButton;p.SidebarId="ppt-sidebar-id";p.InsertButtonId="insert-ppt-button";p.StyleTabMenuId="style";p.TopicShapeMixerId="topic-shape-mixer-button";p.ZoominButtonId="selection-zoom-in-button";class B{}B.groupCalloutText=l.I18n.ts("Pick a few slides that belong together in the same chapter.");B.groupCalloutTitle=l.I18n.ts("Group your slides!");p.pptOnboardingSteps=[{id:"upload-in-progress",visual:{},isDone:(a)=>a.uploadFinished&&!a.uploadModalOpen},
{id:"multi-select",visual:{overlay:Object.assign(Object.assign({},w.DEFAULT_OVERLAY),{holes:[{around:{uiElementId:p.SidebarId},shape:t.HoleShape.rect,strict:!0,callout:{text:B.groupCalloutText,title:B.groupCalloutTitle,anchor:"left",media:{url:n.getResourceUrl("/multiselect.mp4"),type:t.CalloutMediaTypes.Mp4}}}]})},disableVisual:(a)=>!a.privacyNotificationChecked,onCompleted:()=>{u.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:2,tutorial_step_name:"SLIDE_SELECT"})},
isDone:(a)=>2<=a.selectedIds.length||0<a.numberOfSlidesNotOnOverview},{id:"insert-slides",visual:{highlights:[{around:{uiElementId:p.InsertButtonId},shape:t.HoleShape.rounded,pulse:!0}]},isDone:(a)=>0<a.numberOfSlidesNotOnOverview},{id:"zoom-in",visual:{highlights:[{around:{uiElementId:p.ZoominButtonId},shape:t.HoleShape.rounded,pulse:!0}]},onCompleted:()=>{u.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:4,tutorial_step_name:"NAVIGATION_FIRST_TOPIC"})},isDone:(a)=>
a.onNonOverview},{id:"open-tabmenu",visual:{highlights:[{around:{uiElementId:p.StyleTabMenuId},shape:t.HoleShape.rounded,pulse:!0}]},onCompleted:()=>{u.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:5,tutorial_step_name:"OPEN_TABMENU"})},isDone:(a)=>a.actualStyleId!==a.originalStyleId},{id:"style-mix",visual:{highlights:[{around:{uiElementId:p.TopicShapeMixerId},shape:t.HoleShape.rounded,pulse:!0}]},onCompleted:()=>{u.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:6,
tutorial_step_name:"STYLE_MIX"})},fallback:{to:"open-tabmenu",when:()=>!0},isDone:(a)=>a.actualStyleId!==a.originalStyleId},{id:"zoom-out",visual:{highlights:[{around:{uiElementId:E},shape:t.HoleShape.circle,pulse:!0}]},onCompleted:()=>{u.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:7,tutorial_step_name:"ZOOM_OUT"})},isDone:(a)=>!a.onNonOverview},{id:"present",visual:{highlights:[{around:{uiElementId:"present-button"},shape:t.HoleShape.rounded,pulse:!0}]},onCompleted:()=>
{u.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:8,tutorial_step_name:"PRESENT"})},setFlagsOnCompleted:[L.UserSettingBooleanKeys.JS_EDITOR_PPT_ONBOARDING],isDone:(a)=>!a.editMode}];var C={},D=this&&C.__awaiter||function(a,d,c,b){function f(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,k){function g(a){try{z(b.next(a))}catch(v){k(v)}}function e(a){try{z(b["throw"](a))}catch(v){k(v)}}function z(a){a.done?c(a.value):f(a.value).then(g,
e)}z((b=b.apply(a,d||[])).next())})};Object.defineProperty(C,"__esModule",{value:!0});C.PptUpload=class{constructor(a,d,c,b,f){this.onboarding=a;this.uiRoot=d;this.setState=c;this.uploadTimer=b;this.session=f;this.uploadToken=null;this.pptUploadUtils=e.createPptUploadUtils()}cancelUpload(){this.uploadToken=null}uploadPptFile(a,d){return D(this,void 0,void 0,function*(){const a=this.uploadToken=`${(new Date).getTime()}`,b=d.file;(()=>D(this,void 0,void 0,function*(){this.pptUploadUtils.logFilePickedForPptUpload(b,
d.source);let c;this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{slideResults:[]}),slidesInPrezi:new Map});try{let d=this.uiRoot.getState().uploadProcess;this.pptUploadUtils.logUploadStarted(d.progress.startTime,d.jobId);this.setState({uploadProcess:Object.assign(Object.assign({},d),{state:e.UploadState.Uploading,fileName:b.name,slideResults:[],progress:Object.assign(Object.assign({},d.progress),{percentage:0,startTime:(new Date).getTime(),remainingTime:-1})})});
this.uploadTimer.run();c=yield this.session.document.progressiveAssetManager.uploadPpt(b,320,(a)=>this.uploadTimer.updateFileUploadPercentage(a));if(a!==this.uploadToken)return null;d=this.uiRoot.getState().uploadProcess;this.setState({uploadProcess:Object.assign(Object.assign({},d),{jobId:c.jobId})});return c}catch(g){return this.handleError(g,this.uiRoot.getState().uploadProcess.progress.startTime,null),null}}))().then((a)=>{null!=a&&this.handlePptUploadResult(a,this.uiRoot,a.jobId)})})}uploadSamplePptFile(a,
d){return D(this,void 0,void 0,function*(){try{const a=this.uploadToken=`${(new Date).getTime()}`;this.pptUploadUtils.logUploadStarted(d.progress.startTime,d.jobId);this.setState({uploadProcess:Object.assign(Object.assign({},d),{state:e.UploadState.Uploading,jobId:null,fileName:l.I18n.ts("Loading Sample PPT"),progress:Object.assign(Object.assign({},d.progress),{percentage:0,startTime:(new Date).getTime(),remainingTime:-1})}),slidesInPrezi:new Map});const b=this.session.document.progressiveAssetManager.getPpt(K.SAMPLE_PPT_JOB_ID,
320);u.avro.Avro.createDefaultLogger().logUseSamplePpt();b.then((b)=>{if(a!==this.uploadToken)return null;this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{jobId:b.jobId})});this.handlePptUploadResult(b,this.uiRoot,b.jobId)})}catch(c){this.handleError(c,this.uiRoot.getState().uploadProcess.progress.startTime,null)}})}showError(a){null==a||null==a.state||a.modalShown||a.state!==e.UploadState.InvalidFileExtension&&a.state!==e.UploadState.Error||(this.onboarding.restartOnboarding(),
this.uiRoot.dialog.showError(l.I18n.ts("Ppt upload error"),this.calculateErrorModalText(a.state),"ppt_upload_error"),this.setState({uploadProcess:Object.assign(Object.assign({},a),{progress:e.IDLE_STATE_COMMON.progress,modalShown:!0})}))}calculateErrorModalText(a){switch(a){case e.UploadState.InvalidFileExtension:return l.I18n.ts("Unsupported file extension");case e.UploadState.Error:return l.I18n.ts("Unexpected error");default:return A.Utils.assertNever(a)}}handleError(a,d,c){if(this.uiRoot.getState().uploadProcess.jobId===
c){var b=this.uiRoot.getState().uploadProcess,f=e.UploadState.Error;b=Object.assign(Object.assign({},b),{progress:e.IDLE_STATE_COMMON.progress,state:f,modalShown:!1});this.setState({uploadProcess:b});this.showError(b);this.pptUploadUtils.logUploadError(d,c,a)}}handleSlidePromise(a,d,c){return D(this,void 0,void 0,function*(){return a.then((a)=>{const b=c.getState().uploadProcess;b.jobId===d&&(0===b.slideResults.length&&this.pptUploadUtils.logUploadFirstResult(b.progress.startTime,d),this.setState({uploadProcess:Object.assign(Object.assign({},
b),{slideResults:c.getState().uploadProcess.slideResults.map((b)=>b.slideOrder===a.slideAsset.sourcePageNumber?{content:a,state:q.SlideResultState.Done,slideOrder:a.slideAsset.sourcePageNumber,jobId:d}:b)})}))})})}handleSlidePromiseFailure(a,d){const c=this.uiRoot.getState().uploadProcess;c.jobId===d&&this.setState({uploadProcess:Object.assign(Object.assign({},c),{slideResults:c.slideResults.map((b)=>b.slideOrder===a?{content:null,state:q.SlideResultState.Error,slideOrder:a,jobId:d}:b)})})}handleFinishedOK(a){this.pptUploadUtils.logUploadComplete(this.uiRoot.getState().uploadProcess.progress.startTime,
this.uiRoot.getState().uploadProcess.jobId);u.avro.Avro.createDefaultLogger().logLoadedPptFile({ppt_slide_count:a.slides.length,ppt_import_flow_version:"VERSION_TWO"})}handleFinishedSlidesFailed(){var a=this.uiRoot.getState().uploadProcess;a=Object.assign(Object.assign({},a),{progress:e.IDLE_STATE_COMMON.progress,state:e.UploadState.Error});this.setState({uploadProcess:a})}handlePptImportFinished(a,d,c,b){if(c.getState().uploadProcess.jobId===b)switch(a){case "FinishedOk":this.handleFinishedOK(d);
this.setState({uploadFinished:!0});break;case "Crashed":this.setState({uploadFinished:!0});this.handleError(null,this.uiRoot.getState().uploadProcess.progress.startTime,b);this.pptUploadUtils.logUploadError(c.getState().uploadProcess.progress.startTime,b,`pptImportFinishedWith: ${a}`);break;case "FinishedStructureFailed":this.handleError(null,this.uiRoot.getState().uploadProcess.progress.startTime,b);this.pptUploadUtils.logUploadError(c.getState().uploadProcess.progress.startTime,b,`pptImportFinishedWith: ${a}`);
break;case "FinishedSlidesFailed":this.handleFinishedSlidesFailed();this.setState({uploadFinished:!0});break;default:A.Utils.assertNever(a)}}myPromiseAll(a,d){let c=0;return new Promise((b)=>{const f=()=>{null!==this.uiRoot.getState().uploadProcess&&this.uiRoot.getState().uploadProcess.jobId===d&&(c++,c===a.length&&b())};a.forEach((a)=>{a.slideResult.then(()=>f()).catch(()=>f())})})}handlePptUploadResult(a,d,c){this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),
{slideResults:a.slides.map((a)=>({content:null,state:q.SlideResultState.InProgress,slideOrder:a.slideOrder,jobId:c})).sort((a,d)=>a.slideOrder-d.slideOrder)})});this.myPromiseAll(a.slides,c).then(()=>{this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{state:e.UploadState.UploadFinished,progress:e.IDLE_STATE_COMMON.progress,modalShown:!1})});null!=this.uploadTimer&&this.uploadTimer.isRunning()&&this.uiRoot.getState().uploadProcess.state===e.UploadState.UploadFinished&&
this.uploadTimer.finish()}).catch();a.slides.forEach((a)=>{this.handleSlidePromise(a.slideResult,c,d).catch(()=>this.handleSlidePromiseFailure(a.slideOrder,c))});a.fullPptResult.then((b)=>this.handlePptImportFinished(b,a,d,c)).catch(()=>{this.pptUploadUtils.logUploadError(d.getState().uploadProcess.progress.startTime,c,"Error during handling ppt status")})}};var G={};Object.defineProperty(G,"__esModule",{value:!0});var M=r.base.CoverLayoutRole,m=r.base.ObjectKind;G.SlideInsert=class{constructor(a){this.session=
a}insertSlides(a,d,c,b,f,g){const k=this.createSlideParent(c,b,d),e=k.topic;b=null!=e?e.id:null==b?this.session.insertTarget.getSimpleObjectParent(d).id:b;b=d.lookup.base(b);if(b.is(m.planetTopic)||b.is(m.overview))f=this.insertSlideIntoPlanetOrOverview(a,d,c,b,e,f,!k.hasFinalPosition,g);else if(b.is(m.stackTopic)||b.is(m.page))f=this.insertSlideIntoStackOrPage(a,d,c,b,g);else throw Error("invalid parent type");if(null!=e)this.session.selection.setSelection(a,[e]);else if(b.is(m.planetTopic)||b.is(m.overview))g=
f.map((a)=>d.lookup.topic(a)),this.session.selection.setSelection(a,g);u.avro.Avro.createDefaultLogger().logInsertPptSlide({ppt_slide_count:c.length,group_target:null!=e?"PPT_SLIDE":"TOPIC",target_object_id:null!=e?e.id:b.id,workflow_mode:"STANDARD"});return f}addNarrativeToTopic(a,d,c){null!=c.narrative&&(a=a.structuredPath.pathElementsInOrder.find((a)=>(a.is(r.base.ObjectKind.visitPlanet)||a.is(r.base.ObjectKind.visitPage))&&a.target.id===d),null!=a&&(a.narrative=c.narrative))}insertSlideIntoPlanetOrOverview(a,
d,c,b,f,g,e,h){const k=w.EditorCommander.createLayoutQuery(),z=w.EditorCommander.getLayoutRepository(),F=c.map((a)=>{const c=k.isSortedBySlideIdx(b)?b.layout.add.planet(k.findPositionBySlideIndex(a.sourcePageNumber,b)):b.layout.add.planet();c.contentChildren.forEach((a)=>a.delete());c.cover.contentChildren.forEach((a)=>a.delete());c.visual.contentChildren.filter((a)=>a.is(m.slide)).forEach((a)=>a.delete());var f=z.getPlanetLayoutInfos().find((a)=>a.id===c.layout.id);f=null!=f&&2===f.category?c.surface.add.slide(a):
c.visual.add.slide(a);h(a.sourcePageNumber,f.id);var g=c.simpleChildren(r.base.ChildVisibilityKind.outside).filter((a)=>!a.is(r.base.ObjectKind.slide)).map((a)=>a.layoutBox);0<g.length&&(g=g.reduce((a,b)=>a.union(b)),f.fitInto(g.scale(.7)));this.addNarrativeToTopic(d,c.id,a);return c}),v=w.EditorCommander.getLayoutRepository().getFocusedToContentLayoutId();null!=v&&F.forEach((a)=>{a.is(m.planetTopic)&&a.applyLayout(v)});null!=f&&(f.layout.reset(),f.applyTheme(f.getThemeIdForNewSubtopic(0,f.kind)));
c=F.map((a)=>a.id);((a,b)=>{const c=d.lookup.base(a);c.is(m.planetTopic)&&c.layout.adjust(b.map((a)=>{a=d.lookup.base(a);return null!=a&&a.is(r.base.ObjectKind.topic)&&a.parent===c?a:null}).filter((a)=>null!=a))})(b.id,c);e&&(e=F.filter((a)=>a.is(m.planetTopic)),this.positionNewlyInsertedTopics(e,b,f,g,this.session.positionFinder),this.session.navigation.flyTo(a,null!=f?f.parent:b));return c}insertSlideIntoStackOrPage(a,d,c,b,f){const g=b.is(m.stackTopic)?b:b.parent;let e=b.is(m.stackTopic)?g.pageChildren.length:
g.pageChildren.indexOf(b)+1;c=c.map((a)=>{const b=g.add.page(e++);b.simpleChildren(r.base.ChildVisibilityKind.inside).forEach((a)=>a.delete());const c=b.add.slide(a);f(a.sourcePageNumber,c.id);c.fitInto(b.zoomLayoutBox.scale(.9));this.addNarrativeToTopic(d,b.id,a);return b});b.is(m.page)&&0<c.length&&this.session.navigation.focusTo(a,c[c.length-1]);return c.map((a)=>a.id)}positionNewlyInsertedTopics(a,d,c,b,f){const g=null!=c?c.parent:d;if(g.is(m.overview)){const k=a.map((a)=>a.id),h=g.zoomLayoutBox.referenceFrame;
var e=g.zoomLayoutBox.size.width*f.getDefaultTopicWidthToContainerRatio();if(null!=c)d=g.topicChildren.filter((a)=>-1===k.indexOf(a.id)&&a.id!==c.id),e=this.getAverageWidth(g,[c.id],h,e),0<d.length&&c.fitInto(d[0].layoutBox),d=null!=b.x?f.findLayoutBox(g,42,42,b.x,b.y):f.findTopicPosition(c,d),this.positionTopic(c,e,d,h);else{const c=g.topicChildren.filter((a)=>-1===k.indexOf(a.id));0<c.length&&a.forEach((a)=>{a.fitInto(c[0].layoutBox)});const d=this.getAverageWidth(g,k,h,e);a.forEach((e,k)=>{k=null!=
b.x?f.findLayoutBox(g,42,42,b.x,b.y):f.findTopicPosition(e,c.concat(a.slice(0,k)));this.positionTopic(e,d,k,h)})}}}getAverageWidth(a,d,c,b){a=a.topicChildren.filter((a)=>-1===d.indexOf(a.id)).map((a)=>this.getAnchorBox(a)).filter((a)=>null!=a);const f=a.reduce((a,b)=>a+b.layoutBox.withReferenceFrame(c).size.width,0);return 0!==a.length?f/a.length:b}positionTopic(a,d,c,b){const f=this.getAnchorBox(a).layoutBox,e=d*f.size.height/f.size.width;d=c.withReferenceFrame(b).withSize({width:d,height:e});a.fitInto(a.layoutBox.align(f.centerLeft,
f.centerRight,d.centerLeft,d.centerRight))}getAnchorBox(a){a=a.simpleChildren(r.base.ChildVisibilityKind.outside);if(0===a.length)return null;let d=a[0];1<a.length&&(d=a[0].createLayoutGroupWith(a.slice(1)));return d}createSlideParent(a,d,c){if(null==d){if(d=this.session.insertTarget.getSimpleObjectParent(c),d.is(m.overview)&&1<a.length){const b=d.layout.add.planet();b.layout.reset();const f=b.contentChildren.filter((a)=>a.is(m.text));for(let a=1;a<f.length;++a)f[a].delete();f[0].contentLayoutRole=
r.base.ContentLayoutRole.contentTitle;this.setTopicTitle(b,a,c);d.layout.adjust([b]);return{topic:b,hasFinalPosition:!1}}}else if(a=c.lookup.base(d),a.is(m.planetTopic))return{topic:a,hasFinalPosition:!0};return{topic:null,hasFinalPosition:!1}}setTopicTitle(a,d,c){let b=a.cover.contentChildren.find((a)=>a.coverLayoutRole===M.coverTitle);null==b&&(b=a.cover.contentChildren.find((a)=>a.is(m.text)));a=d.reduce((a,b)=>a.sourcePageNumber<b.sourcePageNumber?a:b).title;null!=b&&null!=a&&""!==a&&(a=50<a.length?
a.slice(0,50)+"...":a,b.setText(a),b.isPlaceholder=!1,w.EditorCommander.createCounterpartUpdater(c).updateCounterpartTexts(b.id,w.UpdateOrigin.current))}};var q={},J=this&&q.__awaiter||function(a,d,c,b){function f(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function g(a){try{h(b.next(a))}catch(v){e(v)}}function k(a){try{h(b["throw"](a))}catch(v){e(v)}}function h(a){a.done?c(a.value):f(a.value).then(g,k)}h((b=b.apply(a,d||[])).next())})};Object.defineProperty(q,
"__esModule",{value:!0});const H=Object.assign(Object.assign({},e.IDLE_STATE_COMMON),{slideResults:[]});q.insertModalId="pptPreloadInsertModal";var x;(function(a){a[a.InProgress=0]="InProgress";a[a.Error=1]="Error";a[a.Done=2]="Done"})(x=q.SlideResultState||(q.SlideResultState={}));class N{constructor(a,d){this.uiRoot=a;this.setState=d}getProcess(){return this.uiRoot.getState().uploadProcess}setProcess(a){this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),
a)})}}q.getThumbnailData=I;class O{constructor(){this.name="PptPlugin";this.supportsOffline=!1;this.pptUploadUtils=e.createPptUploadUtils()}openSidebar(){this.uiRoot.getState().isDirty&&this.updateOnDocumentChange();this.uiRoot.sidebar.open(p.SidebarId);this.setState({sidebarOpen:!0,sidebarClosedExplicitly:!1});this.licenseDownloadedPromise.then(()=>{this.uiRoot.getState().sidebarOpen&&(this.showPrivacyWarning(this.uiRoot.getState())?(this.setState({privacyNotificationShowed:!0}),this.uiRoot.dialog.showBuiltIn(h.BuiltinDialog.privacyPaywallWarning,
()=>{setTimeout(()=>this.setState({privacyNotificationChecked:!0}),t.DialogAnimationTime+1)})):setTimeout(()=>this.setState({privacyNotificationChecked:!0}),t.SidebarAnimationTime+1))})}showPrivacyWarning(a){return y.isActive("prezioption-pptcreate")&&(y.isActive("js-force-ppt-privacy-warning")||!a.license.featureSet.pitchPrivacyPrivate)&&!a.privacyNotificationShowed}closeSidebar(){this.uiRoot.sidebar.close(p.SidebarId);this.setState({sidebarOpen:!1,sidebarClosedExplicitly:!0,selectedIds:[]})}closeModal(){this.uiRoot.dialog.hide(q.insertModalId);
this.setState({uploadModalOpen:!1})}processMessage(a){return J(this,void 0,void 0,function*(){switch(a.kind){case "handover":this.uploadTimer.isRunning()?this.uploadTimer.reset():this.uploadTimer.run();this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{progress:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess.progress),a),jobId:a.jobId,state:e.UploadState.Uploading,fileName:a.fileName})});this.session.document.progressiveAssetManager.getPpt(a.jobId,
320).then((a)=>{null!=a&&this.pptUpload.handlePptUploadResult(a,this.uiRoot,a.jobId)});this.openSidebar();break;case "requestOpen":null==this.uiRoot.getState().uploadProcess.jobId||this.uiRoot.getState().sidebarClosedExplicitly||this.openSidebar();break;case "requestModalOpen":this.openPptUploadFileDialog();break;default:A.Utils.assertNever(a)}})}calculateButtonContent(a){switch(a){case e.UploadState.Idle:case e.UploadState.InvalidFileExtension:case e.UploadState.UploadFinished:return{text:l.I18n.ts("Upload PowerPoint")};
case e.UploadState.Uploading:return{text:l.I18n.ts("Uploading...")};default:return A.Utils.assertNever(a)}}openPptUploadFileDialog(){this.closeSidebar();this.uiRoot.dialog.show(q.insertModalId);this.setState({uploadModalOpen:!0})}uploadButton(a,d){return a.button(h.ButtonSize.Small,h.ButtonAlign.Center,(a)=>[a.button({id:"upload-ppt-button",color:h.ButtonColor.Blue,content:this.calculateButtonContent(d),disabled:d===e.UploadState.Uploading,onClick:()=>this.openPptUploadFileDialog()})])}onUploadRestart(){this.setState({uploadProcess:H});
this.openPptUploadFileDialog()}handleProgressBarCancel(){this.pptUpload.cancelUpload();this.uploadTimer.finish();this.openPptUploadFileDialog();this.initUploadTimer();this.setState({uploadFinished:!1,privacyNotificationChecked:!1,uploadProcess:Object.assign(Object.assign({},H),{progress:e.IDLE_STATE_COMMON.progress})});this.onboarding.restartOnboarding()}progressBarButton(a,d,c,b,f){return a.progressBar({id:"ppt-progressbar-id",title:c.split(/[\\/]/).pop(),titleTooltip:c,errorText:0<f.length&&f.some((a)=>
a.state===x.Error)?l.I18n.ts("Failed to upload some slides. Please click reload to try again"):d===e.UploadState.Error?l.I18n.ts("Failed to upload slides. Please click reload to try again"):null,caption:null!=b.prevPercentage?this.pptUploadUtils.calculateProgressMessage(b.remainingTime):null,percentage:null!=b.prevPercentage?b.percentage:d===e.UploadState.Error?100:0,onCancel:()=>this.handleProgressBarCancel(),onRestart:()=>this.onUploadRestart(),control:this.pptUploadUtils.calculateProgressBarControl(d)})}createProgressBarButton(a,
d){switch(d.state){case e.UploadState.Error:case e.UploadState.Uploading:return this.progressBarButton(a,d.state,d.fileName,d.progress,d.slideResults);case e.UploadState.Idle:case e.UploadState.UploadFinished:case e.UploadState.InvalidFileExtension:return null}}createTopPptButton(a,d,c){switch(d){case e.UploadState.Error:case e.UploadState.Uploading:return null;case e.UploadState.Idle:case e.UploadState.UploadFinished:case e.UploadState.InvalidFileExtension:return this.showsSomeResult(c)?null:this.uploadButton(a,
d)}}showsSomeResult(a){return a.uploadProcess.slideResults.some((a)=>a.state===x.Error||a.state===x.Done)}createBottomSection(a,d){if(this.showsSomeResult(d)){let c=!1,b=null;2>d.selectedIds.length&&this.onboarding.isActive()?(c=!0,b=l.I18n.ts("Please select at least 2 slides to insert.")):0===d.selectedIds.length&&(c=!0,b=l.I18n.ts("Please select a slide to insert."));return[a.button(h.ButtonSize.Large,h.ButtonAlign.Center,(a)=>[a.button({id:"insert-ppt-button",color:h.ButtonColor.Blue,content:{text:l.I18n.ts("Insert")},
disabled:c,tooltipText:b,tooltipPosition:"top",onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert ppt slides",run:(b)=>{const c=d.selectedIds.map((a)=>{a=d.uploadProcess.slideResults[parseInt(a,10)].content;return Object.assign(Object.assign({},a.slideAsset),{title:a.title,narrative:a.narrative})}),e=new Map(this.uiRoot.getState().slidesInPrezi);this.slideInsert.insertSlides(a,b,c,null,{x:null,y:null},(a,b)=>{e.set(b,a)});this.onboarding&&this.onboarding.isActive()?(b=this.session.selection.getSelectionInfo(b).allObjects,
0<b.length&&b[0].is(r.base.ObjectKind.topic)&&this.setState({originalStyleId:b[0].coverLayoutId,slidesInPrezi:e})):this.setState({slidesInPrezi:e})}});this.setState({selectedIds:[]})}}),a.button({id:"upload-ppt-button",color:h.ButtonColor.Gray,content:{text:l.I18n.ts("Upload New")},disabled:!1,onClick:()=>{this.setState({privacyNotificationChecked:!1});this.onboarding.restartOnboarding();this.openPptUploadFileDialog()}})])]}return[]}createSampleButtonProps(a,d){return{size:h.ButtonSize.Small,align:h.ButtonAlign.Center,
args:{id:"upload-sample-ppt-button",color:h.ButtonColor.Gray,content:{text:l.I18n.ts("Use sample .ppt file")},disabled:!1,onClick:(c)=>{d();this.pptUpload.uploadSamplePptFile(c,a)}}}}createLoadSamplePptButton(a,d,c){switch(d){case e.UploadState.Idle:return this.onboarding&&this.onboarding.isActive()&&!this.uiRoot.getState().uploadFinished?this.createSampleButtonProps(a,c):null;default:return null}}createSideBarContent(a){const {selectedIds:d,uploadProcess:c}=this.uiRoot.getState(),b=this.createLoadSamplePptButton(c,
c.state,()=>{}),e=[this.createProgressBarButton(a,c),this.createTopPptButton(a,c.state,this.uiRoot.getState()),null!=b?a.button(b.size,b.align,(a)=>[a.button(b.args)]):null,a.multiSelectList((a)=>({selectedIds:d,onSelectionChange:(a)=>{this.setState({selectedIds:a.selectedIds})},itemType:h.ListItemType.numbered,items:I(this.uiRoot,a),itemLayout:h.ListItemLayout.dynamic,progress:0===c.slideResults.length?h.ListProgress.working:h.ListProgress.finished,onDrop:(a,b)=>{this.session.document.executeApiCommand(a,
{name:"drop",run:(d)=>{const e=c.slideResults,f=b.draggedIds.map((a)=>e[parseInt(a,10)]).filter((a)=>null!=a.content).map((a)=>Object.assign(Object.assign({},a.content.slideAsset),{title:a.content.title,narrative:a.content.narrative})),g=new Map(this.uiRoot.getState().slidesInPrezi);this.slideInsert.insertSlides(a,d,f,b.targetTopic,{x:b.stageX,y:b.stageY},(a,b)=>{g.set(b,a)});this.setState({selectedIds:[],slidesInPrezi:g})}})},preziDataMimeParams:t.PreziDataMimeParam.snapTargetRegularPlanet|t.PreziDataMimeParam.snapTargetSlideOnOverview}))];
return[a.label(l.I18n.ts("Select one or more slides and click \u201cInsert\u201d to create a topic.")),...e]}init(a){a.onFileDrop({allowPpt:!0},(a,{data:c})=>J(this,void 0,void 0,function*(){this.uiRoot.getState().sidebarOpen||this.openSidebar();this.pptUpload.uploadPptFile(a,c)}));a.onApplicationModeChange((a)=>{this.setState({editMode:a===h.ApplicationMode.Edit})});a.onLicenseChange((a)=>this.setState({license:a}));this.licenseDownloadedPromise=new Promise((b)=>{a.onLicenseChange((a)=>{a.featureSet.isDefaultLicense||
b()})});const d=a.declareUI({uploadFinished:!1,sidebarOpen:!1,sidebarClosedExplicitly:!1,uploadProcess:H,currentTopic:null,onNonOverview:!1,selectedIds:[],numberOfSlidesNotOnOverview:null,uploadModalOpen:!1,license:null,privacyNotificationShowed:!1,editMode:!0,actualStyleId:null,originalStyleId:null,slidesInPrezi:new Map,privacyNotificationChecked:!1,isDirty:!1},({sidebarOpen:a,uploadProcess:c,editMode:d},e)=>{y.isActive("js-frame-only-editor")||e.createTopMenuItem(h.TopMenuId.Media,{kind:h.MenuItemKind.largeButton,
enabled:d,onClick:()=>{u.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"PPT_IMPORT"});a?(this.uiRoot.sidebar.close(p.SidebarId),this.setState({sidebarClosedExplicitly:!0})):(null==this.uiRoot.getState().uploadProcess.jobId?this.openPptUploadFileDialog():(this.openSidebar(),this.setState({sidebarClosedExplicitly:!1})),u.avro.Avro.createDefaultLogger().logShowPptInsertOptions({ppt_import_flow_version:"VERSION_TWO"}))},weight:8,categoryWeight:0,icon:h.IconSmallId.Ppt,id:"topmenu-insert-item-ppt-import",
title:l.I18n.ts("PowerPoint")});const b=(a)=>{let b=[];b.push(a.droparea({text:l.I18n.ts("**Drag and drop** your .ppt file here or upload one from your computer."),illustration:h.IllustrationSmallId.Ppt,caption:l.I18n.ts("We recommend using files under 15 MB (about 30 slides) for quicker uploads."),filter:{allowPpt:!0},onFileSelected:(a,b)=>{this.setState({privacyNotificationChecked:!1});this.onboarding.restartOnboarding();this.openSidebar();this.closeModal();this.pptUpload.uploadPptFile(a,b)},color:h.ButtonColor.Blue}));
const d=this.createLoadSamplePptButton(c,c.state,()=>{this.openSidebar();this.closeModal()});null!=d&&(b.push(a.separator()),b.push(a.button(d.size,d.align,(a)=>[a.button(d.args)])));return b};e.dialog.small((a)=>({id:q.insertModalId,title:l.I18n.ts("Upload PowerPoint file"),align:h.DialogAlign.center,content:b(a),onCloseButtonClicked:()=>{this.closeModal()}}));e.createSidebar(p.SidebarId,(a)=>({onClose:()=>{this.setState({sidebarOpen:!1,selectedIds:[]})},disableClose:this.onboarding&&this.onboarding.isActive(),
onCloseButtonClicked:()=>{this.setState({sidebarClosedExplicitly:!0,selectedIds:[]})},root:{title:l.I18n.ts("PowerPoint"),content:this.createSideBarContent(a),footer:this.createBottomSection(a,this.uiRoot.getState())}}));this.onboarding.declareUI(e)});this.uiRoot=d;this.setState=(a)=>{d.setState(a);this.onboarding.refreshOnboarding()};let c;y.isActive("js-unique-differentiation")?c="disable":y.isActive("js-force-ppt-onboarding")?c="force":(y.isActive("js-disable-ppt-onboarding"),c="disable");this.onboarding=
w.EditorCommander.createOnboarding(p.pptOnboardingSteps,this.uiRoot,c,this.userSettings);this.initUploadTimer();a.onApplicationModeChange((a)=>{this.setState({editMode:a===h.ApplicationMode.Edit})});a.onCurrentTopicChange((a)=>{const b=this.session.document.read((b)=>b.overview.id!==a);this.setState({currentTopic:a,onNonOverview:b})});this.pptUpload=new C.PptUpload(this.onboarding,this.uiRoot,this.setState,this.uploadTimer,this.session);this.slideInsert=new G.SlideInsert(this.session);a.onDocumentChange(()=>
{this.uiRoot.getState().sidebarOpen||this.onboarding.isActive()?this.updateOnDocumentChange():this.setState({isDirty:!0})})}updateOnDocumentChange(){var a=this.session.document.read((a)=>a.lookup.findAll(r.base.ObjectKind.slide).filter((c)=>c.parent!==a.overview).length);this.setState({numberOfSlidesNotOnOverview:a});a=this.session.document.read((a)=>0<a.overview.topicChildren.length?a.overview.topicChildren[0].coverLayoutId:null);this.session.document.read((a)=>{const c=new Map(this.uiRoot.getState().slidesInPrezi);
Array.from(c.keys()).filter((b)=>null==a.lookup.base(b)).forEach((a)=>c.delete(a));this.setState({slidesInPrezi:c})});null!=a&&this.setState({actualStyleId:a});this.setState({isDirty:!1})}initUploadTimer(){null!=this.uploadTimer?this.uploadTimer.reset():this.uploadTimer=e.createUploadTimer(e.createProgressState(new N(this.uiRoot,this.setState)))}unload(){null!=this.uploadTimer&&this.uploadTimer.reset()}}q.PptPlugin=O;n={};Object.defineProperty(n,"__esModule",{value:!0});n.lazyModule={createPlugin(){return new q.PptPlugin}};
return n});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_ppt_insert",["require","prezi.engine.dom","prezi.engine.dom.converter.xpdom2","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_i18n","prezi_koi_navigation","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_ppt_common","prezi_ppt_service","prezi_service_data","prezi_textmodel","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_ppt_insert.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.engine.dom.converter.xpdom2"),require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_koi_navigation"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_ppt_common"),require("prezi_ppt_service"),require("prezi_service_data"),require("prezi_textmodel"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_ppt_insert"]=__factory(this["prezi.engine.dom"],this["prezi.engine.dom.converter.xpdom2"],this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_koi_navigation"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_ppt_common"],this["prezi_ppt_service"],this["prezi_service_data"],this["prezi_textmodel"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);