;(function(){var baseUrl;var __factory=function(){var React=arguments[0];var ReactDOM=arguments[1];var ReactTransitionGroup=arguments[2];var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_commenting";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[3],"prezi_app_utils":dependencies[4],"prezi_bacon":dependencies[5],"prezi_cet":dependencies[6],"prezi_cet_model":dependencies[7],"prezi_cet_model_editor":dependencies[8],"prezi_editor_store_focus":dependencies[9],"prezi_editor_store_mode":dependencies[10],"prezi_editor_store_object":dependencies[11],"prezi_editor_store_ui":dependencies[12],"prezi_featureswitcher":dependencies[13],"prezi_i18n":dependencies[14],"prezi_koi_widgets":dependencies[15],"prezi_logger":dependencies[16],"prezi_playback":dependencies[17],"prezi_utils":dependencies[18],"prezi_vaguetime":dependencies[19]}};})(),React,ReactDOM,ReactTransitionGroup);};})(arguments);var moduleImpl=(function(){return module(function(p,f,H){function aa(a){switch(a){default:case d.TargetObjectType.UNKNOWN:case d.TargetObjectType.OBJECT:return h.I18n.ts("Leave a comment on this object");case d.TargetObjectType.LINE:return h.I18n.ts("Leave a comment on this line");case d.TargetObjectType.ARROW:return h.I18n.ts("Leave a comment on this arrow");case d.TargetObjectType.TOPIC:return h.I18n.ts("Leave a comment on this topic");case d.TargetObjectType.SUBTOPIC:return h.I18n.ts("Leave a comment on this subtopic");case d.TargetObjectType.PAGE:return h.I18n.ts("Leave a comment on this page");
case d.TargetObjectType.OVERVIEW:return h.I18n.ts("Leave a comment on this overview");case d.TargetObjectType.IMAGE:return h.I18n.ts("Leave a comment on this image");case d.TargetObjectType.PDF:return h.I18n.ts("Leave a comment on this PDF");case d.TargetObjectType.VIDEO:return h.I18n.ts("Leave a comment on this video");case d.TargetObjectType.TEXT:return h.I18n.ts("Leave a comment on this text");case d.TargetObjectType.FADE_IN:return h.I18n.ts("Leave a comment on this fade-in");case d.TargetObjectType.FADE_OUT:return h.I18n.ts("Leave a comment on this fade-out");
case d.TargetObjectType.ZOOM_TO:return h.I18n.ts("Leave a comment on this zoom-to");case d.TargetObjectType.CHART:return h.I18n.ts("Leave a comment on this chart")}}var L=null,ba=p.dependencies.prezi_featureswitcher;L=p.dependencies.prezi_i18n;var u=p.dependencies.prezi_koi_widgets,Y=p.dependencies.prezi_vaguetime,I=p.dependencies.prezi_utils,F=p.dependencies.prezi_app_utils,l=p.dependencies.prezi_bacon,q=p.dependencies.prezi_cet,m=p.dependencies.prezi_cet_model,C=p.dependencies.prezi_cet_model_editor,
P=p.dependencies.prezi_editor_store_focus,ca=p.dependencies.prezi_editor_store_object,v=p.dependencies.prezi_logger,M=p.dependencies["prezi.geometry"],Q={};Object.defineProperty(Q,"__esModule",{value:!0});Q.nd=class{constructor(a,b,c){this.da=a;this.Ma=b;this.id=c;this.jc=this.wb=!1;this.Lb=n.Vb+c;this.cd=this.ed=0;this.hidden=!1;this.pe()}zc(a,b){return null!=b&&this.Qa(b)&&this.Ab(a,this.da.getPrevSelectedEntityId(),this.da.getSelectedEntityId())}isClosing(a,b){return null!=b&&this.da.getPrevSelectedEntityId()===
b.getId()&&this.Ab(a,this.da.getSelectedEntityId(),this.da.getPrevSelectedEntityId())}refresh(a,b){const c=a.getRenderedScene();b=c.getEntityById(b.getId());var e=$(this.ba),g=this.Qa(b);if(this.isVisible(c,b)){this.pf(this.jc&&!g);var d=q.Cet.createHierarchyQuery(c);d=c.getEntityById(d.getParentId(b));var f=null,y=null;if(this.zc(c,b)||this.isClosing(c,b)){const e=this.ze(c,b);null!=e?(g=this.Na(c,e),this.wb?(y=this.tb(a.getCamera()),f=1-this.pc(c,e),a=1):a=this.pc(c,e)):(g=g?this.tb(a.getCamera()):
this.Na(c,b),a=q.Cet.commentVisibility(b).getAlpha())}else this.zc(c,d)||this.isClosing(c,d)?(g=this.Na(c,d),y=this.Na(c,b),f=q.Cet.commentVisibility(b).getAlpha(),a=0===f?0:1):(g=g?this.tb(a.getCamera()):this.Na(c,b),a=q.Cet.commentVisibility(b).getAlpha());e.css({display:"block",opacity:a});a=null==g?y:null==y?g:null==f?y:M.Geometry.interpolatePoint(g,y,(Math.sin((f-.5)*Math.PI)+1)/2);d&&d.isDef(m.CetModel.ID.Z_TOPIC_CONTAINER)&&(b=q.Cet.world(d).getWorldBoundingShape().getObb(),d=b.topRightVertex(),
b=b.bottomLeftVertex(),a.x>d.x?a.x=d.x:a.x<b.x&&(a.x=b.x),a.y<d.y?a.y=d.y:a.y>b.y&&(a.y=b.y));null!=a?(e=M.Geometry.createTranslation(a.x,a.y),this.Ma.positionElementToCenter(this.Lb,36,36),this.Ma.transformWithoutScaleAndRotation(this.Lb,e)):e.css({display:"none"})}else e.css({display:"none"})}tb(a){return a.screenPointToWorld({x:a.getStageArea().getRight()-(this.cd+24+18),y:a.getStageArea().getTop()+(this.ed+24+18)})}ze(a,b){for(;;){if(null!=this.qc(a,b))return b;b=q.Cet.createHierarchyQuery(a).getParentId(b);
if(null==b)return null;b=a.getEntityById(b)}}qc(a,b){let c=null;b=q.Cet.createTopicChildrenQuery(a).getChildrenIds(b.getId(),q.TopicChildBehavior.Cover);null!=b&&0<b.length&&(c=a.getEntityById(b[0]));return c}pc(a,b){a=this.qc(a,b);return null==a?null:q.Cet.commentVisibility(a).getAlpha()}Na(a,b){if(null==b)return null;var c=q.Cet.createBoundsCalculator(a).getWorldBoundsForLayout(b.getId(),q.TextBoundsOptions.TextBox).getObb();a=30/this.Ma.getCameraScale();m.CetModel.textKludge.isEntityText(b)&&(b=
10/this.Ma.getCameraScale(),c=c.inflate(b));b=M.Geometry.fromPoint(c.getVertices()[0]);c=M.Geometry.fromPoint(c.getVertices()[1]);return c.add(b.sub(c).setLength(a)).toPoint()}bd(a,b){this.ed=a;this.cd=b}pe(){this.ba=this.Ma.createElement(this.Lb);if(0===this.ba.children.length){const a=document.createElement("div");this.ba.appendChild(a);this.ba.className=n.Ja;this.ba.setAttribute(n.Ua,this.id);this.ba.setAttribute("data-lookup",`${d.Lookup.THREAD_ICON}:${this.id}`);a.setAttribute(n.Ua,this.id);
this.ba.style.display="block"}}pf(a){$(this.ba).toggleClass("show-dots",a)}Qa(a){return this.da.getSelectedEntityId()===a.getId()}Ab(a,b,c){return 0<=q.Cet.createHierarchyQuery(a).getAncestorEntities(c).indexOf(b)}Ve(a,b){return this.Ab(a,this.da.getSelectedEntityId(),b)}isVisible(a,b){if(this.hidden)return!1;var c=q.Cet.commentVisibility(b);if(null==c||!c.isVisible()||0===c.getAlpha())return!1;c=this.Qa(b);return!c&&!this.Ve(a,b.getId())||c&&!this.wb?!1:!0}dispose(){null!=this.ba&&(null!=this.ba.parentElement&&
this.ba.parentElement.removeChild(this.ba),this.ba=null)}rf(a){this.hidden=a}qf(a){this.wb=a}nf(a){this.jc=a}};var z={};Object.defineProperty(z,"__esModule",{value:!0});var G;(function(a){a[a.Ob=0]="AVATAR";a[a.NAME=1]="NAME";a[a.xd=2]="SIDEBAR_PUCUKA";a[a.Pb=3]="COMMENT_TEXT";a[a.Rb=4]="DATE"})(G=z.Ia||(z.Ia={}));class r{Gf(a,b){this.logInfo(a,b?"show_comments":"hide_comments","view_menu","click",{})}zoomIn(a){v.avro.Avro.createDefaultLogger().logNavigatePrezi({navigation_type:"ZOOM",action_index:a.actionIndex,
step_index:a.stepIndex,total_step_number:a.totalStepNumber})}cf(a,b,c){let e;switch(b){case d.OpenCommentThreadTrigger.INSERT_MENU:e="insert_menu";break;case d.OpenCommentThreadTrigger.PUCUKA:e="pucuka";break;case d.OpenCommentThreadTrigger.PROPERTY_BAR:e="property_bar";break;case d.OpenCommentThreadTrigger.CONTEXT_MENU:e="context_menu";break;case d.OpenCommentThreadTrigger.DEEP_LINK:e="deep_link";break;case d.OpenCommentThreadTrigger.COMMENT_MENU:e="comment_menu"}this.logInfo(a,"open","thread",e,
r.fa(c));v.avro.Avro.createDefaultLogger().logOpenCommentThread({comment_thread_id:c.threadId})}Ud(a){v.avro.Avro.createDefaultLogger().logCreateCommentThread({comment_thread_id:a.threadId})}addComment(a,b,c,e,g){let k;switch(b){case d.AddCommentTrigger.ENTER:k="enter";break;case d.AddCommentTrigger.CLICK:k="click"}b=r.fa(e);$.extend(b,{nr_mentions:null==g?0:g.length,length:c});this.logInfo(a,"add","comment",k,b);this.Gc("add",g,b,a);v.avro.Avro.createDefaultLogger().logAddedComment({comment_thread_id:e.threadId,
mentioned_collaborator:g&&0<g.length?"YES":"NO",target_user_id_list:g?g.map((a)=>a.getUserOid()).join():""})}Gc(a,b,c,e){null!=b&&b.forEach((b)=>{const d={target_useroid:b.getUserOid()};"nr_comments object_type status thread_id thread_uuid comment_uuid".split(" ").forEach((a)=>{d[a]=c[a]});this.logInfo(e,a,"mention","machine",d)})}Jd(a,b,c,e){e=r.fa(e);$.extend(e,{length:c});this.logInfo(a,b?"add_success":"add_error","comment","machine",e)}Nd(a,b){this.logInfo(a,"close","thread","click_outside",r.fa(b),
1)}resolveThread(a,b){this.logInfo(a,"resolve","thread","click",r.fa(b));v.avro.Avro.createDefaultLogger().logEndCommentThread({comment_thread_id:b.threadId})}jf(a,b,c){this.logInfo(a,c?"resolve_success":"resolve_error","thread","machine",r.fa(b))}Md(a,b,c){let e;switch(b){case G.Ob:e="avatar";break;case G.Pb:e="comment_text";break;case G.NAME:e="username";break;case G.xd:e="sidebar_pucuka";break;case G.Rb:e="date"}this.logInfo(a,"nothing",e,"click",r.fa(c))}editComment(a,b,c,e,g){let k;switch(b){case d.EditCommentTrigger.ENTER:k=
"enter";break;case d.EditCommentTrigger.CLICK:k="click"}b=r.Xa(e);$.extend(b,{nr_mentions:null==g?0:g.length,length:c});this.logInfo(a,"edit","comment",k,b);this.Gc("edit",g,b,a)}ve(a,b,c,e){const d=r.Xa(e);$.extend(d,{length:c});this.logInfo(a,b?"edit_success":"edit_error","comment","machine",d);b&&v.avro.Avro.createDefaultLogger().logChangedComment({comment_thread_id:e.threadId})}deleteComment(a,b,c){this.logInfo(a,"delete","comment",b,r.Xa(c))}ue(a,b,c){this.logInfo(a,b?"delete_success":"delete_error",
"comment","machine",r.Xa(c));b&&v.avro.Avro.createDefaultLogger().logRemovedComment({comment_thread_id:c.threadId})}static fa(a){var b=F.AppUtilsModule.getLogHelperUtils().getEntityLogName(a.entity);b={nr_comments:a.numComments,object_type:b,status:a.isResolved?"resolved":"not_resolved",thread_id:a.threadId,thread_uuid:a.threadUuid,draft:a.hasDraft?"yes":"no"};null!=a.errorMessage&&(b.msg=a.errorMessage);return b}static Xa(a){const b={thread_id:a.threadId,thread_uuid:a.threadUuid,nr_comments:a.numComments,
comment_uuid:a.commentUuid,status:a.isResolved?"resolved":"not_resolved"};null!=a.errorMessage&&(b.msg=a.errorMessage);return b}mentionPopupDisplays(a,b,c){b=r.fa(b);let e;switch(c){case d.ShowMentionPopupTrigger.AT_SIGN:e="at_sign";break;case d.ShowMentionPopupTrigger.EDIT:e="edit_mention"}this.logInfo(a,"display","autocomplete_popup",e,b)}mentionPopupAddedUser(a,b,c){b=r.fa(b);let e;switch(c){case d.AddMentionTrigger.CLICK:e="click";break;case d.AddMentionTrigger.ENTER:e="enter"}this.logInfo(a,
"add","mention_draft",e,b)}mentionPopupClosedByKeyboard(a,b,c){b=r.fa(b);b.keycode=c;this.logInfo(a,"close","autocomplete_popup","keyboard",b)}mentionPopupClosedByClick(a,b){b=r.fa(b);this.logInfo(a,"close","autocomplete_popup","click_outside",b)}kb(a,b,c){this.logError(a,b,"commenting_backend","machine",{error_message:c.substring(0,100)})}logInfo(a,b,c,e,d,k=null){a.info(this.ic(b,c,e,d,k))}logError(a,b,c,e,d){a.error(this.ic(b,c,e,d))}ic(a,b,c,e,d=null){a={action:a,object:b,trigger:c,feature:"commenting",
payload:e};null!=d&&(a.version=d);return a}Ld(a){this.logInfo(a,"learn_more","comment_paywall_popup","click",{})}}z.Sb=r;var A={};Object.defineProperty(A,"__esModule",{value:!0});A.ta=class{constructor(a,b){this.key=a;this.kd=b}static Ce(a){return`[@${a.name}]`}static ye(a){return new A.ta(a.key,a.user_oid)}static mc(a){return new A.ta(this.Ce(a),a.oid)}static Lc(a){return null==a?null:a.map((a)=>a.toData())}getUserOid(){return this.kd}getKey(){return this.key}getKeyText(){return this.key.replace(/^\[@*/,
"").replace(/]$/,"")}toData(){return{key:this.key,user_oid:this.kd}}};var D={};Object.defineProperty(D,"__esModule",{value:!0});D.Ha=class{constructor(a,b,c,e,d,k){this.Hd=a;this.Ed=b;this.Gd=c;this.Cd=e;this.Dd=d;this.Fd=k}getUsername(){return this.Hd}getFirstName(){return this.Ed}getLastName(){return this.Gd}getAvatar(){return this.Cd}getEmail(){return this.Dd}isOwnComment(){return!0===this.Fd}static hc(){return new D.Ha("","","","","",!1)}static Aa(a){return null==a?D.Ha.hc():new D.Ha(a.username,
a.first_name,a.last_name,a.avatar,a.email,a.is_own_comment)}};var N={};Object.defineProperty(N,"__esModule",{value:!0});N.Qb=class{constructor(a,b,c,e,d,k,f){this.id=a;this.author=b;this.te=c;this.Nc=e;this.pb=d;this.text=k;this.mentions=f}getAuthor(){return null===this.author?D.Ha.hc():this.author}getCreationTimeSecs(){return this.te}getText(){return this.text}getCommentUuid(){return this.id}isModified(){return null!==this.Nc&&0<this.Nc}isDeleted(){return null!==this.pb&&0<this.pb}getDeletionTimeSecs(){return this.pb}getMentions(){return this.mentions}static Aa(a,
b){const c=D.Ha.Aa(a.author);return new N.Qb(a.comment_uuid,c,a.created_at-b,a.modified_at?a.modified_at-b:null,a.deleted_at?a.deleted_at-b:null,a.text,null==a.mentions?[]:a.mentions.map((a)=>A.ta.ye(a)))}};var t={};Object.defineProperty(t,"__esModule",{value:!0});t.Xb="zobject";t.Wb="overview";t.ua=class{constructor(a){this.lb=a.id;this.resolved=a.resolved;this.temporaryUnresolved=a.temporaryUnresolved;this.comments=a.comments;this.draft=a.draft;this.commentingState=a.commentingState;this.resolveState=
a.resolveState;this.type=a.type;this.objectId=a.objectId;this.pendingMentions=null!=a.pendingMentions?a.pendingMentions:[];this.xc=!0===a.canResolveThisThread}getId(){return this.getType()===d.ThreadType.OVERVIEW?"OVERVIEW":"Z-"+this.getObjectId()}getBackendId(){return this.lb}isDraft(){return null==this.lb}getComments(){return this.comments}getNonDeletedLastComment(){let a=null,b=this.comments.length-1;for(;null==a&&0<=b;){const c=this.comments[b];c.isDeleted()||(a=c);b--}return a}getType(){return this.type}getObjectId(){return this.objectId}getDraft(){return this.draft}getCommentingState(){return this.commentingState}getResolveState(){return this.resolveState}getCommentCount(){return this.comments?
this.comments.length:0}getNonDeletedCommentCount(){return this.comments?this.comments.filter((a)=>!a.isDeleted()).length:0}isResolved(){return this.resolved}isTemporaryUnresolved(){return this.temporaryUnresolved}getEntityId(a){return this.type===d.ThreadType.ZOBJECT?this.objectId:this.type===d.ThreadType.OVERVIEW?null==a?null:a.getPreziW().getOverview().getId():null}static De(a){return"Z-"!==a.slice(0,2)?null:a.slice(2)}canResolveThisThread(){return!0===this.xc}clone(a){return new t.ua({id:void 0===
a.id?this.lb:a.id,resolved:void 0===a.resolved?this.resolved:a.resolved,temporaryUnresolved:void 0===a.temporaryUnresolved?this.temporaryUnresolved:a.temporaryUnresolved,comments:void 0===a.comments?this.comments:a.comments,draft:void 0===a.draft?this.draft:a.draft,pendingMentions:void 0===a.pendingMentions?this.pendingMentions:a.pendingMentions,commentingState:void 0===a.commentingState?this.commentingState:a.commentingState,resolveState:void 0===a.resolveState?this.resolveState:a.resolveState,type:void 0===
a.type?this.type:a.type,objectId:void 0===a.objectId?this.objectId:a.objectId,canResolveThisThread:void 0===a.canResolveThisThread?this.xc:a.canResolveThisThread})}getPendingMentions(){return this.pendingMentions}static Aa(a,b,c=null,e=null,g=null,k=!1){if(null==a.thread_id&&null==a.thread_uuid)return null;let f,y;if(null!=a.type)if(a.type===t.Xb)f=d.ThreadType.ZOBJECT,y=a.zobject_id;else if(a.type===t.Wb)f=d.ThreadType.OVERVIEW;else return null;else{f=d.ThreadType.ZOBJECT;if(null==a.thread_id)return null;
"OVERVIEW"===a.thread_id?f=d.ThreadType.OVERVIEW:y=t.ua.De(a.thread_id)}const h=a.comments.map((a)=>N.Qb.Aa(a,b));return new t.ua({id:a.thread_uuid||a.thread_id,resolved:a.resolved,temporaryUnresolved:k,comments:h,type:f,objectId:y,commentingState:null==c?d.CommentingServiceCallState.Ready:c,resolveState:null==e?d.CommentingServiceCallState.Ready:e,draft:void 0===g?null:g,canResolveThisThread:!0===a.can_resolve_this_thread})}static $d(a,b){a=a.getPreziW().getOverview().getId();let c=d.ThreadType.ZOBJECT,
e;a===b?c=d.ThreadType.OVERVIEW:e=b;return new t.ua({id:null,resolved:!1,comments:[],type:c,objectId:e,commentingState:d.CommentingServiceCallState.Ready,resolveState:d.CommentingServiceCallState.Ready})}};var w={Re:function(a){return void 0!==a.permissions&&void 0!==a.threads},Se:function(a){return void 0!==a.message}};Object.defineProperty(w,"__esModule",{value:!0});w.ra=class{constructor(a){this.va=a;this.logger=v.LoggerModule.getLoggerManager().createLogger("prezi_commenting.CommentingBackend");
this.o=new z.Sb;this.Mc=w.ra.rd;this.Sc=a.isFrequentPollingAllowed()?w.ra.vd:w.ra.sd;this.Ga=!1;this.Cc=null;this.Ka=l.Bacon.newBus();this.getComments()}Ae(){return this.Ka.toProperty(this.Cc)}addComment(a,b,c,e,d){this.Ga=!0;this.va.addComment(a,b,A.ta.Lc(c),(a)=>{this.Da(a);e&&e(a)},(a)=>{this.Za("add_comment_failure",a);d&&d(a)})}resolveThread(a,b,c){this.va.resolveThread(a,(a)=>{this.Da(a);b&&b(a)},(a)=>{this.Za("resolve_thread_failure",a);c&&c(a)})}createThread(a,b,c,e){let g;switch(a){case d.ThreadType.OVERVIEW:g=
t.Wb;break;case d.ThreadType.ZOBJECT:g=t.Xb}this.va.createThread(g,b,(a)=>{c&&c(a)},(a)=>{e&&e(a)})}tf(a){a?this.Yc():this.gd()}editComment(a,b,c,e,d,k){this.Ga=!0;this.va.editComment(a,b,c,A.ta.Lc(e),(a)=>{this.Da(a);d&&d(a)},(a)=>{this.Za("edit_comment_failure",a);k&&k(a)})}deleteComment(a,b,c,e){this.Ga=!0;this.va.deleteComment(a,b,(a)=>{this.Da(a);c&&c(a)},(a)=>{this.Za("delete_comment_failure",a);e&&e(a)})}Da(a){this.Bc=Date.now();this.Ac=a.server_current_time_msecs;this.Cc=a;this.Ga=!1}Za(a,
b){this.Ga=!1;this.o.kb(this.logger,a,b)}setPollingInterval(a){this.Sc=a;this.Yc()}Yc(){this.gd();this.Rc=setInterval(()=>{this.Je()},this.Sc)}gd(){null!=this.Rc&&clearInterval(this.Rc)}sf(){this.Mc=0}Je(){this.Bc&&this.Bc>Date.now()-this.Mc||this.Ga||(this.Ac?this.ef(this.Ac):this.getComments())}getComments(){this.va.getComments((a)=>{this.Da(a);this.Ka.push(a)},(a)=>{this.o.kb(this.logger,"get_comments_failure",a);this.Ka.push({message:a})})}ef(a){this.va.pollComments(a,(a)=>{!1!==a.changed&&(this.Da(a),
this.Ka.push(a))},(a)=>{this.o.kb(this.logger,"poll_failure",a);this.Ka.push({message:a})})}};w.ra.sd=3E5;w.ra.vd=1E4;w.ra.rd=1E4;var J={};Object.defineProperty(J,"__esModule",{value:!0});J.hb=class{constructor(a){this.Rd=a}mf(a){setInterval(()=>{this.getContacts(a)},J.hb.ld)}getContacts(a){this.Rd.getContacts((b)=>{a(this.ff(b.data))},()=>{},!0)}ff(a){return a.filter((a)=>!!a.name).map((a)=>({username:a.username,name:a.name,oid:a.oid,email:a.email}))}};J.hb.ld=6E4;var K={};Object.defineProperty(K,
"__esModule",{value:!0});K.Ad=class{constructor(a){this.entityId=a;this.jd=null;this.wc=0}getEntityId(){return this.entityId}getThread(){return this.jd}getInsideThreadCount(){return this.wc}isThreadActive(){return null!=this.getThread()&&(!this.getThread().isResolved()||this.getThread().isTemporaryUnresolved())}};K.Bd=class{constructor(){this.zb={};this.Ib=null;this.Eb={};this.mb={};this.threads=[];this.rb={};this.Mb=[]}setList(a,b){this.threads=b;if(null==this.threads||null==this.threads.forEach)this.threads=
[];this.buildMap(a)}buildMap(a){this.zb={};this.mb={};this.Eb={};this.Ib=null;this.rb={};this.Mb=[];this.threads.forEach((a)=>{this.zb[a.getId()]=a;this.mb[a.getBackendId()]=a;a.getType()===d.ThreadType.OVERVIEW?this.Ib=a:this.Eb[a.getObjectId()]=a});null!=a&&this.threads.forEach((b)=>{var c=b.getEntityId(a);let e=this.kc(c);e.jd=b;c=a.getEntityById(c);if(null!=c)for(b=q.Cet.createHierarchyQuery(a),c=a.getEntityById(b.getParentId(c));null!=c;c=a.getEntityById(b.getParentId(c))){var d=c.getId();d=
this.kc(d);e.isThreadActive()&&d.wc++}})}getThreadInfoByEntityId(a){return this.rb[a]}getThreadInfos(){return this.Mb}xe(a,b,c,e){return a.hasOwnProperty(c)?a[c]:(e=e(c),a[c]=e,b.push(e),e)}kc(a){return this.xe(this.rb,this.Mb,a,(a)=>new K.Ad(a))}addThread(a,b){this.threads.push(b);this.buildMap(a)}removeThread(a,b){const c=[];this.threads.forEach((a)=>{a.getId()!==b&&c.push(a)});this.threads=c;this.buildMap(a)}replaceThread(a,b,c){this.removeThread(a,b);this.addThread(a,c)}getThreadById(a){return this.zb[a]}getThreadByBackendId(a){return this.mb[a]}getThreadByEntityId(a,
b){return(a.getPreziW()&&a.getPreziW().getOverview().getId())===b?this.Ib:this.Eb[b]}forEach(a){for(let b=0;b<this.threads.length;b++)a(this.threads[b])}getNumberOfThreads(){return this.threads.length}getThreadArray(){return this.threads}};var n={};Object.defineProperty(n,"__esModule",{value:!0});var E;(function(a){a[a.Ub=0]="NOT_LOADED";a[a.LOADED=1]="LOADED";a[a.ERROR=2]="ERROR"})(E||(E={}));n.Ja="thread_handler_icon";n.Vb="thread_handler_icon_";n.Ua="data-popupId";n.sa=class{constructor(a){this.selectedEntityId=
this.Tc=null;this.threadList=new K.Bd;this.gb=l.Bacon.newBus();this.Nb=l.Bacon.newVoidBus();this.Gb=l.Bacon.newBus();this.Gb.onValue((b)=>a(b));this.df=l.Bacon.newBus();this.vc=this.be();this.aa=l.Bacon.newBus();this.Zc=l.Bacon.newBus();this.ab=E.Ub;this.permissions={canResolveThreads:!1,canComment:!1};this.o=new z.Sb;this.ec=this.wa=!1;this.ia=[];this.isLoading=!0;this.sb=[];this.Uc=l.Bacon.newBus();this.tc=l.Bacon.newBus();this.Fa=l.Bacon.newBus();this.Fa.onValue((b)=>a(d.CommentingModule.createThreadboxPopupId(b)));
this.Kb=l.Bacon.newVoidBus();this.cc=l.Bacon.newBus();this.logger=v.LoggerModule.getLoggerManager().createLogger("prezi_commenting.CommentingControllerImpl")}init(a){this.domLayerManager=a.domLayerManager;this.Wa=a.currentTopicProperty;this.deferredOpenedPopupIdStream=a.deferredOpenedPopupIdStream;this.scene=a.baseScene;this.playbackScene=a.playbackScene;this.mainStage=a.mainStage;this.mainStage.getMarginsProperty().onValue((a)=>{this.fd=a;this.Cf(a)});this.playback=a.playback;this.ya();this.Ne();
this.Ie();$(".domLayer").on("mousedown",`.${n.Ja}`,(a)=>{a.stopPropagation()});this.scene.getImmediateChangeStream(q.ChangeEventKind.Entity).onValue((a)=>{a.some((a)=>null!=a.entity&&(a.type===m.ChangeType.AddEntity||a.type===m.ChangeType.RemoveEntity))&&(this.threadList.buildMap(this.scene),this.Nb.push(),this.aa.push(this.threadList))});this.Wa.sampledBy(this.Nb).onValue((a)=>{this.ya(a)});this.threadList.buildMap(this.scene);a.editorModeProperty.combineAndSample((a,b)=>({editorMode:a,entityId:b}),
this.vc).onValue(({editorMode:a,entityId:b})=>{a=this.sc(a,b);null!=a&&this.playback.seekTo(a);this.Fa.push(b);this.Kb.push(null)});a.currentTopicProperty.combineAndSample((a,b)=>a===b?null:b,this.vc).onValue((a)=>{null!=a&&this.$c(a)});const b=l.Bacon.combineWith4(n.sa.Kd,a.fullScreenChangeProperty,a.isRemotePresentationInProgressProperty,this.cc.toProperty(this.w),a.editorModeProperty);b.onValue((a)=>{this.ec=!a;this.ya()});l.Bacon.combineWith((a,b)=>a&&2!==b,b,a.networkStatusProperty).onValue((a)=>
{this.w&&this.w.tf(a)});this.wf(a.editorModeProperty);this.Oe(a.fullScreenChangeProperty,a.editorModeProperty);l.Bacon.combineWith4((a,b,d,k)=>k&&1===b&&null==a&&!d,a.coverEditMode,a.networkStatusProperty,a.isRemotePresentationInProgressProperty,a.userHasCommentRightProperty).onValue((a)=>{this.Pd=a})}Oe(a,b){this.Uc.plug(l.Bacon.combineWith4((a,b,d,k)=>k!==F.EditorMode.playback||a||!this.isCommentsVisible()?!1:!this.yb(b),a,this.Wa,this.aa.merge(l.Bacon.once(null)),b).skipDuplicates())}addComment(a,
b,c,e){if(this.w){var g=this.Wc(b,c),k=this.threadList.getThreadById(a).clone({commentingState:d.CommentingServiceCallState.Pending,draft:b,pendingMentions:g});this.threadList.replaceThread(this.scene,k.getId(),k);this.Xe(k,b,e,c);this.aa.push(this.threadList);var f=(c)=>{this.w.addComment(c,b,g,(a)=>{this.fb(a,d.CommentingServiceCallState.Saved,null,c);this.Ra(a);this.qa();this.Dc(this.threadList.getThreadById(c),b,!0)},(c)=>{this.ub(a,b,c)})};k.isDraft()?this.w.createThread(k.getType(),k.getObjectId(),
(c)=>{if(c.thread_uuid)return k=this.threadList.getThreadById(a).clone({id:c.thread_uuid}),this.threadList.replaceThread(this.scene,k.getId(),k),f(c.thread_uuid);this.ub(a,b,"missing_uuid_field")},(c)=>{this.ub(a,b,c)}):f(k.getBackendId())}else this.$a()}editComment(a,b,c,e,g){if(this.w){e=this.Wc(c,e);var k=this.threadList.getThreadById(a).clone({commentingState:d.CommentingServiceCallState.Pending,pendingMentions:e});this.threadList.replaceThread(this.scene,k.getId(),k);var f=k.getComments().filter((a)=>
a.getCommentUuid()===b);if(1===f.length){var h=f[0];this.logEditComment(k,h,c,g,e);this.aa.push(this.threadList);var l=k.getBackendId();this.w.editComment(l,b,c,e,(a)=>{this.fb(a,d.CommentingServiceCallState.Saved,null,l);this.Ra(a);this.qa();this.Fc(k,h,c,!0)},(b)=>{this.He(a,h,c,b)})}}else this.$a()}deleteComment(a,b,c,e){if(this.w){var g=this.threadList.getThreadById(a).clone({commentingState:d.CommentingServiceCallState.Pending});this.threadList.replaceThread(this.scene,g.getId(),g);var k=g.getComments().filter((a)=>
a.getCommentUuid()===b);if(1===k.length){var f=k[0];this.logDeleteComment(g,f);this.aa.push(this.threadList);var h=g.getBackendId();this.w.deleteComment(h,b,(a)=>{this.fb(a,d.CommentingServiceCallState.Saved,null,h);this.Ra(a);this.qa();this.Ec(g,f,!0);c()},(b)=>{this.Ge(a,f,b);e()})}}else this.$a()}resolveThread(a){if(this.w){var b=this.threadList.getThreadById(a).clone({resolveState:d.CommentingServiceCallState.Pending});this.threadList.replaceThread(this.scene,b.getId(),b);this.Ye(b);this.aa.push(this.threadList);
this.w.resolveThread(b.getBackendId(),(c)=>{this.fb(c,null,d.CommentingServiceCallState.Saved,a);this.Ra(c);this.qa();this.popupClosed(b.getEntityId(this.scene),"");this.Ic(this.threadList.getThreadById(a),!0)},(b)=>{this.Ke(a,b)})}else this.$a()}qe(a,b){const c=a.threads.map((c)=>{var e=c.thread_uuid||c.thread_id;let d=this.Fe(e,b),g=!1;const f=this.Zb(a.server_current_time);(e=this.threadList.getThreadByBackendId(e))&&(g=e.isTemporaryUnresolved());c=t.ua.Aa(c,f,d,null,null,g);return null==c?null:
c}).filter((a)=>null!=a);let e=[];e=this.threadList.getThreadArray().filter((a)=>a.isDraft());this.threadList.setList(this.scene,c.concat(e))}Fe(a,b){a=null===b?(a=this.threadList.getThreadById(a))?a.getCommentingState():d.CommentingServiceCallState.Ready:b;return a}fb(a,b,c,e){a.threads.forEach((d)=>{let g,f,h;var l=this.Zb(a.server_current_time);l=t.ua.Aa(d,l);d=this.threadList.getThreadById(l.getId());if(null!=d){var m=d.getCommentingState();g=d.getResolveState();f=d.getDraft();h=d.getPendingMentions();
if(d.getId()===e||d.getBackendId()===e)f="",h=[],null!==b&&(m=b),null!==c&&(g=c)}m=l.clone({commentingState:m,resolveState:g,draft:f,pendingMentions:h,temporaryUnresolved:!1});null!=d?this.threadList.replaceThread(this.scene,d.getId(),m):this.threadList.addThread(this.scene,m)});this.threadList.forEach((b)=>{0===a.threads.filter((a)=>(a.thread_uuid||a.thread_id)===b.getBackendId()).length&&this.threadList.removeThread(this.scene,b.getId())})}vf(a){this.threadList.setList(this.scene,a);this.qa()}qa(){this.Nb.push();
this.aa.push(this.threadList)}Ra(a){this.permissions={canResolveThreads:a.permissions.can_resolve_all_thread,canComment:!0}}setCommentingBackend(a){this.w=new w.ra(a);this.Me();this.cc.push(this.w)}setContactsBackend(a){this.gc=new J.hb(a);this.Df();this.gc.mf((a)=>this.Qc(a))}Me(){this.w.Ae().onValue((a)=>{null!==a&&(w.Re(a)?(this.ab=E.LOADED,this.qe(a,d.CommentingServiceCallState.Ready),this.Ra(a),this.qa(),this.isLoading&&(this.isLoading=!1,null!=this.Hb&&this.goToThreadOnEntity(this.Hb))):w.Se(a)&&
this.ab===E.Ub&&(this.ab=E.ERROR))})}Ne(){this.Wa.onValue((a)=>{this.ya(a);this.Hb=null})}getCommentingUpdatedStream(){return this.aa}Le(a){return null!=this.threadList.getThreadByEntityId(this.scene,a)}yb(a){a=this.threadList.getThreadByEntityId(this.scene,a);return null!=a&&!a.isResolved()}hasUnresolvedCommentOnTargetEntityOrChild(a){if(this.wa||null==this.scene)return!1;if(this.yb(a))return!0;a=q.Cet.createHierarchyQuery(this.scene).getChildrenIdsWithOverviewFallback(a);if(null!=a)for(let b=0;b<
a.length;b++){const c=a[b];if(!C.CetModelEditor.isPlanetOrStack(c,this.scene)&&this.yb(c))return!0}return!1}addThreadsStream(a){a.onValue((a)=>this.vf(a))}addOpenCommentPopupStream(a){this.gb.plug(a)}avatarClicked(a){this.bb(z.Ia.Ob,a)}nameClicked(a){this.bb(z.Ia.NAME,a)}textClicked(a){this.bb(z.Ia.Pb,a)}dateClicked(a){this.bb(z.Ia.Rb,a)}oc(a){if(null==a)return null;a=a.getComponent(n.sa.Sa);return null==a?null:a.getData()}ya(a){null!=this.scene&&null!=this.playbackScene&&(null!=a&&this.uf(a),this.scene.requestNoDomBatchUpdate((a)=>
{this.sb.forEach((b)=>{null==this.threadList.getThreadInfoByEntityId(b)&&(b=a.getEntityById(b),this.ac(a,b))});this.sb=[];this.threadList.getThreadInfos().forEach((b)=>{const c=b.getEntityId(),d=a.getEntityById(c);if(null!=d){var f=0<b.getInsideThreadCount();b=b.isThreadActive();if(f||b){const a=this.we(d);this.sb.push(c);this.Bf(a,d,b,f)}else this.ac(a,d)}})}),this.scene.update())}we(a){var b=a.getId();let c=this.oc(a);null==c&&(c=new Q.nd(this,this.domLayerManager,b),b=q.Cet.createOverlayComponent(c,
c),a.setComponent(n.sa.Sa,b));return c}ac(a,b){if(null!=b){var c=this.oc(b);null!=c&&(c.dispose(),a.getEntityById(b.getId()).discardOwnComponent(n.sa.Sa))}}Bf(a,b,c,e){a.bd(this.fd.top,this.fd.right);a.rf(this.wa||this.ec);a.qf(c);a.nf(e);a.refresh(this.mainStage,b,!0)}Cf(a){this.mainStage.getRenderedScene().getEntityList().forEach(function(b){b=b.getComponent(n.sa.Sa);null!=b&&b.getData().bd(a.top,a.right)})}be(){return l.Bacon.fromEvent(document,"mouseup",`.${n.Ja}`).map((a)=>{const b=a.target;
a.stopPropagation();a=b.getAttribute(n.Ua);this.threadList.getThreadInfoByEntityId(a).isThreadActive()&&this.Hc({entityId:a,trigger:d.OpenCommentThreadTrigger.PUCUKA});return a})}getComponentFocusStream(){let a=l.Bacon.fromEvent(document,"mouseup",".selectable-text").map(()=>P.ComponentFocusActionKind.enterUi);return this.Fa.map((a)=>null!=this.threadList.getThreadById(a)?P.ComponentFocusActionKind.enterUi:P.ComponentFocusActionKind.exitAll).merge(a)}getHoveredEntityStream(){return this.ce().merge(this.de()).map((a)=>
({hoveredEntityIds:[a]}))}ce(){return l.Bacon.fromEvent(document,"mouseenter",`.${n.Ja}`).map((a)=>{const b=a.target;a.stopPropagation();return b.getAttribute(n.Ua)})}de(){return l.Bacon.fromEvent(document,"mouseout",`.${n.Ja}`).map(()=>null)}getThreadList(){return this.threadList}getOpenPopupIdStream(){return l.Bacon.mergeAll([this.Fa.map(d.CommentingModule.createThreadboxPopupId),this.Gb])}getOpenModalIdStream(){return this.df}getOpenPopupForEntityIdStream(){return this.Fa}$a(){this.ab=E.ERROR}Ke(a,
b){const c=this.threadList.getThreadById(a).clone({resolveState:d.CommentingServiceCallState.Error});this.threadList.replaceThread(this.scene,a,c);this.aa.push(this.threadList);this.Ic(c,!1,b)}ub(a,b,c){var e=this.threadList.getThreadById(a);null!==e&&(e=e.clone({commentingState:d.CommentingServiceCallState.Error}),this.threadList.replaceThread(this.scene,a,e),this.aa.push(this.threadList),this.Dc(e,b,!1,c))}He(a,b,c,e){var g=this.threadList.getThreadById(a);null!==g&&(g=g.clone({commentingState:d.CommentingServiceCallState.Error}),
this.threadList.replaceThread(this.scene,a,g),this.aa.push(this.threadList),this.Fc(g,b,c,!1,e))}Ge(a,b,c){var e=this.threadList.getThreadById(a);null!==e&&(e=e.clone({commentingState:d.CommentingServiceCallState.Error}),this.threadList.replaceThread(this.scene,a,e),this.aa.push(this.threadList),this.Ec(e,b,!1,c))}popupClosed(a,b){const c=this.threadList.getThreadByEntityId(this.scene,a);null!=c&&(a=c.getId(),null!=b&&0<b.length?(b=c.clone({draft:b}),this.threadList.replaceThread(this.scene,a,b),
this.cb(b)):c.isResolved()?(this.cb(c),this.threadList.replaceThread(this.scene,a,c.clone({temporaryUnresolved:!1})),this.ya()):0===c.getCommentCount()?(this.cb(c),this.threadList.replaceThread(this.scene,a,c.clone({resolved:!0})),this.ya(),this.threadList.removeThread(this.scene,a)):this.cb(c),this.aa.push(this.threadList))}Ie(){l.Bacon.combineWith((a,b)=>({currentTopicId:a,Fb:b}),this.Wa,this.gb).sampledBy(this.gb).onValue((a)=>{const b=a.Fb.entityId;if(b!==a.currentTopicId){const a=d.CommentingModule.createThreadboxPopupId(b);
this.deferredOpenedPopupIdStream.filter((b)=>b===a).take(1).onValue(()=>{this.$c(b)})}this.bf(a)})}bf(a){var b=a.Fb.entityId;const c=a.currentTopicId;this.wa=!1;if(!this.Le(b)){const a=t.ua.$d(this.scene,b);this.threadList.addThread(this.scene,a);this.logCreateCommentThread(a)}b=this.threadList.getThreadByEntityId(this.scene,b);b.isResolved()&&this.threadList.replaceThread(this.scene,b.getId(),b.clone({temporaryUnresolved:!0}));this.ya(c);this.aa.push(this.threadList);this.Hc(a.Fb);this.Fa.push(b.getEntityId(this.scene));
this.Kb.push(null)}$c(a){null!=a&&this.Zc.push({selectedGroupIds:[],selectedEntityIds:[a],type:ca.SelectActionType.replace})}goToThreadOnEntity(a){const b=this.threadList.getThreadByEntityId(this.scene,a);this.isLoading?this.Hb=a:null!=b&&this.goToThread(b.getId())}zoomIn(a){var b=this.scene.getEntityById(a);if(null!=b){if(!C.CetModelEditor.isPlanet(a,this.scene)){a=q.Cet.createHierarchyQuery(this.scene).getChildrenIdsWithOverviewFallback(a).filter((a)=>C.CetModelEditor.isPage(a,this.scene));if(0===
a.length)return;let b=a.filter((a)=>null!=this.threadList.getThreadInfoByEntityId(a));a=0===b.length?a[0]:b[0]}null!=a&&(this.closePopups(),this.playback.getPathNavigator().see(a));b=q.Cet.createHierarchyQuery(this.scene).getParentId(b);b=null!=b&&b!==this.scene.getPreziW().getOverview().getId();v.avro.Avro.createDefaultLogger().logOpenedTopic({object_type:b?"SUBTOPIC":"TOPIC",object_id:a});this.o.zoomIn({actionIndex:this.playback.getCurrentActionIndex(),stepIndex:this.playback.getCurrentStepIndex(),
totalStepNumber:this.playback.getStepCount()})}}closePopups(){this.Gb.push(null)}sc(a,b){return a!==F.EditorMode.playback||this.playback.isEntityVisibleAtCurrentPathPosition(b)?null:this.playback.getClosestPathPositionWhereVisible(b)}goToThread(a){l.Bacon.later(0,null).onValue(()=>{this.tc.push(a)})}wf(a){a.combineAndSample((a,c)=>({editorMode:a,threadId:c}),this.tc).onValue((a)=>{const {threadId:b,editorMode:e}=a;a=this.threadList.getThreadById(b);if(null!=a&&null!=this.playback&&null!=this.scene&&
this.hasTargetObject(a)){var g=a.getEntityId(this.scene);a=this.sc(e,g);null!=a?this.playback.flyToStepAction(a.getStep(),a.getAction(),()=>{this.goToThread(b)}):(a=C.CetModelEditor.getPageOrChapterId(g,this.scene),null!=a&&(this.wa&&(this.wa=!1,this.qa()),a=this.playback.flyToObject(a),this.closePopups(),a.onValue((a)=>{a.phase===q.NavigationActionAnimationPhase.End&&this.gb.push({entityId:g,trigger:d.OpenCommentThreadTrigger.COMMENT_MENU})})))}})}hasTargetObject(a){return null==this.scene?!0:null!=
this.scene.getEntityById(a.getEntityId(this.scene))}getThreadIconNode(a){return $(`#${n.Vb}${a}`).get(0)}getTargetObjectType(a){return null==this.scene?d.TargetObjectType.UNKNOWN:this.Ee(this.scene,a.getEntityId(this.scene))}Ee(a,b){if(null==a)return d.TargetObjectType.UNKNOWN;const c=a.getEntityById(b);if(null==c)return d.TargetObjectType.UNKNOWN;const e=(a)=>{switch(a){case m.CetModel.ID.Z_LINE:return d.TargetObjectType.LINE;case m.CetModel.ID.Z_ARROW:return d.TargetObjectType.ARROW;case m.CetModel.ID.OVERVIEW:return d.TargetObjectType.OVERVIEW;
case m.CetModel.ID.Z_IMAGE:return d.TargetObjectType.IMAGE;case m.CetModel.ID.Z_PDF:return d.TargetObjectType.PDF;case m.CetModel.ID.Z_VIDEO:return d.TargetObjectType.VIDEO;case m.CetModel.ID.Z_TEXT:case m.CetModel.ID.Z_RICH_TEXT:return d.TargetObjectType.TEXT;case m.CetModel.ID.FADE_IN_OBJECT:case m.CetModel.ID.FADE_IN_OBJECT_EP:case m.CetModel.ID.FADE_IN_OBJECTS:case m.CetModel.ID.FADE_IN_OBJECTS_EP:return d.TargetObjectType.FADE_IN;case m.CetModel.ID.FADE_OUT_OBJECT:case m.CetModel.ID.FADE_OUT_OBJECT_EP:case m.CetModel.ID.FADE_OUT_OBJECTS:case m.CetModel.ID.FADE_OUT_OBJECTS_EP:return d.TargetObjectType.FADE_OUT;
case m.CetModel.ID.ZOOM_TO_OBJECT:case m.CetModel.ID.ZOOM_TO_OBJECT_EP:return d.TargetObjectType.ZOOM_TO;case m.CetModel.ID.Z_CHART_PDF:return d.TargetObjectType.CHART;case null:return d.TargetObjectType.UNKNOWN;default:return d.TargetObjectType.OBJECT}};return C.CetModelEditor.isSubChapter(b,a)?d.TargetObjectType.SUBTOPIC:C.CetModelEditor.isPlanetOrStack(b,a)?d.TargetObjectType.TOPIC:C.CetModelEditor.isPage(b,a)?d.TargetObjectType.PAGE:e(c.get(m.CetModel.DEF()))}Hc(a){var b=this.threadList.getThreadByEntityId(this.scene,
a.entityId);b=this.ea(b,a.entityId);this.o.cf(this.logger,a.trigger,b)}logCreateCommentThread(a){a=this.ea(a);this.o.Ud(a)}Xe(a,b,c,e){a=this.ea(a);this.o.addComment(this.logger,c,b.length,a,e)}Dc(a,b,c,e){a=this.ea(a);null!=e&&(a.errorMessage=e);this.o.Jd(this.logger,c,b.length,a)}logEditComment(a,b,c,e,d){a=this.Ya(a,b);this.o.editComment(this.logger,e,c.length,a,d)}Fc(a,b,c,d,g){a=this.Ya(a,b);null!=g&&(a.errorMessage=g);this.o.ve(this.logger,d,c.length,a)}logDeleteComment(a,b){a=this.Ya(a,b);
this.o.deleteComment(this.logger,"click",a)}Ec(a,b,c,d){a=this.Ya(a,b);null!=d&&(a.errorMessage=d);this.o.ue(this.logger,c,a)}cb(a){a=this.ea(a);this.o.Nd(this.logger,a)}Ye(a){a=this.ea(a);this.o.resolveThread(this.logger,a)}Ze(a){this.o.Gf(this.logger,a)}Ic(a,b,c){a=this.ea(a);null!=c&&(a.errorMessage=c);this.o.jf(this.logger,a,b)}bb(a,b){b=this.threadList.getThreadById(b);b=this.ea(b);this.o.Md(this.logger,a,b)}getPermissions(){return this.permissions}setPollingInterval(a){this.w&&(this.w.sf(),
this.w.setPollingInterval(a))}ea(a,b=null){let c,d,g,f,h;null!=a?(c=a.getCommentCount(),d=a.isResolved(),g=a.getId(),f=a.getBackendId(),h=null!=a.getDraft()&&0<a.getDraft().length):(c=0,d=!1,f=g=null,h=!1);let l=null;b?l=this.scene.getEntityById(b):a&&(l=this.scene.getEntityById(a.getEntityId(this.scene)));return{numComments:c,entity:l,isResolved:d,threadId:g,threadUuid:f,hasDraft:h}}Ya(a,b){return{threadId:a.getId(),threadUuid:a.getBackendId(),numComments:a.getCommentCount(),commentUuid:b.getCommentUuid(),
isResolved:a.isResolved()}}Zb(a){const b=Math.floor((new Date).getTime()/1E3);return a-b}isCommentsVisible(){return!this.wa}changeCommentsVisibility(a){this.wa=!a;this.qa();this.Ze(a);a||this.closePopups()}Df(){this.gc.getContacts((a)=>this.Qc(a))}Qc(a){this.ia=a}filterContacts(a){const b=a.length,c=a.toLowerCase();return this.ia.filter((a)=>a.email.length>=b&&-1!==a.email.toLowerCase().indexOf(c)||a.name.length>=b&&-1!==a.name.toLowerCase().indexOf(c))}uf(a){this.selectedEntityId!==a&&(this.Tc=null==
this.selectedEntityId?a:this.selectedEntityId,this.selectedEntityId=a)}getSelectedEntityId(){return this.selectedEntityId}getPrevSelectedEntityId(){return this.Tc}getSelectActionStream(){return this.Zc}addContactToPendingMentions(a,b){a=this.threadList.getThreadByEntityId(this.scene,a);if(null==a)return null;const c=A.ta.mc(b);b=a.getPendingMentions().filter((a)=>a.getKey()===c.getKey());if(0<b.length)return b[0];const d=a.getPendingMentions().concat([c]);b=a.getId();a=a.clone({pendingMentions:d});
this.threadList.replaceThread(this.scene,b,a);this.aa.push(this.threadList);return c}Wc(a,b){return b.filter((b)=>-1!==a.indexOf(b.getKey()))}getContact(a){if(null==this.ia)return null;let b=this.ia.filter((b)=>b.oid===a);return 0===b.length?null:b[0]}mentionPopupDisplays(a,b){this.o.mentionPopupDisplays(this.logger,this.ea(a),b)}mentionPopupAddedUser(a,b){this.o.mentionPopupAddedUser(this.logger,this.ea(a),b)}mentionPopupClosedByKeyboard(a,b){this.o.mentionPopupClosedByKeyboard(this.logger,this.ea(a),
b)}mentionPopupClosedByClick(a){this.o.mentionPopupClosedByClick(this.logger,this.ea(a))}getPreviewInsertCommentButtonVisibilityStream(){return this.Uc}logLinkClicked(){this.o.Ld(this.logger)}static Kd(a,b,c,d){return null==c?!1:d===F.EditorMode.edit?!0:d===F.EditorMode.view||d===F.EditorMode.playback?!a&&!b:!1}isCommentingEnabled(){return this.Pd}getStopCoverEditingStream(){return this.Kb}};n.sa.Sa=q.Cet.createOverlayComponentKey("commentOverlay");var h=L,R={};Object.defineProperty(R,"__esModule",
{value:!0});R.qd=class extends f.Component{constructor(a){super(a);this.Oc=(a)=>{this.onMouseDown(a)}}render(){return f.createElement("div",{key:`mention-popup-contact-item-${this.props.fc.oid}`,className:"mention-popup-contact-item"+(this.props.Qa?" selected":"")},this.props.fc.name)}onMouseDown(a){if(null!=this.props.onMouseDown)this.props.onMouseDown(a)}componentDidMount(){H.findDOMNode(this).addEventListener("mousedown",this.Oc)}componentWillUnmount(){H.findDOMNode(this).removeEventListener("mousedown",
this.Oc)}};var S={};Object.defineProperty(S,"__esModule",{value:!0});S.wd=class extends f.Component{constructor(a){super(a);this.state={scrollTo:0};this.Qd=f.createFactory(R.qd);this.ca=u.KoiWidgetsModule.getWidgetFactory()}componentWillReceiveProps(a){if(a.v!==this.props.v){const b=a.v-this.props.v;0>b&&this.state.scrollTo>24+24*(a.v-1)&&this.setState({scrollTo:24+24*(a.v-1)});const c=Math.max(Math.min(this.props.Jc,null!=this.props.ia?this.props.ia.length:0),1);0<b&&this.state.scrollTo<24+24*(a.v-
c)&&this.setState({scrollTo:24+24*(a.v-c)})}}render(){if(!this.props.anchorNode||!this.props.visible)return null;const a=Math.min(this.props.Jc,null!=this.props.ia?this.props.ia.length:0),b=this.props.width,c=0===a?120:24+24*a;return u.KoiWidgetsModule.getWidgetFactory().fixedSizeFloatingPopup({key:`thread-box-mention-popup-${this.props.pa}`,lookupId:`${d.Lookup.MENTION_POPUP}:${this.props.pa}`,className:"thread-box-mention-popup",preferredAnchorOrientation:u.KoiFixedSizeFloatingPopupAnchorOrientation.TOP,
content:[0===a?f.createElement("p",{className:"thread-box-mention-popup-empty","data-lookup":`${d.Lookup.MENTION_POPUP_CONTENT_EMPTY}:${this.props.pa}`},h.I18n.ts("Are you sure you have a team member by that name?\n\nIf you want to invite someone to collaborate, please share this prezi with them.")):f.createElement("div",{className:"thread-box-mention-popup-container","data-lookup":`${d.Lookup.MENTION_POPUP_CONTENT}:${this.props.pa}`,style:{width:b,height:c}},this.nb())],anchorNode:this.props.anchorNode,
visible:!0,usePointer:!1,width:b,height:c})}nb(){const a=(this.props.ia||[]).map((a,c)=>{const b=this.props.v===c,f=`${d.Lookup.MENTION_POPUP_CONTACT_ITEM}:${this.props.pa}:${a.oid}`;return{children:[this.Qd({key:a.oid,onMouseDown:(a)=>{a.preventDefault();null!=this.props.Pc&&this.props.Pc(c)},index:c,fc:a,Qa:b})],className:b?"selected":"",lookupId:f,onRemove:null}});return[this.ca.list({key:"contact-list",ref:"contact-list-component",className:"mention-popup-contact-list",isLoading:!1,items:a,gradientFader:!1,
scrollToBottom:!1,scrollTo:this.state.scrollTo})]}};var O={};Object.defineProperty(O,"__esModule",{value:!0});O.Tb=class extends f.Component{constructor(a){super(a);this.Cb=null;this.state={ka:null,Kc:null,ga:!1,v:null,hd:0};this.$e=f.createFactory(S.wd);this.ca=u.KoiWidgetsModule.getWidgetFactory();this.lc=(a)=>{"Escape"===a.key&&this.state.ga&&(a.stopPropagation(),this.Ba(),this.props.ma.mentionPopupClosedByKeyboard(a.keyCode))}}componentDidMount(){const {Oa:a}=this.ja();a.addEventListener("keydown",
this.lc);this.setState({Kc:a})}componentWillUnmount(){H.findDOMNode(this).removeEventListener("keydown",this.lc)}he(){return this.state.ga?this.$e({ref:"mention-popup",pa:this.props.pa,visible:!0,ia:this.state.ka,anchorNode:this.state.Kc,width:228,Jc:5,v:this.state.v||0,Pc:(a)=>{this.uc(a);this.props.ma.mentionPopupAddedUser(d.AddMentionTrigger.CLICK)}}):null}Id(){this.setState({ga:!0,v:0})}Ba(){this.setState({ga:!1,v:null,ka:null})}uc(a){if(this.state.v>=this.state.ka.length)throw"selectedContactIndex out of range";
a=this.props.Va(this.state.ka[null!=a?a:this.state.v]);this.Qe(a);this.Ba()}Qe(a){const {Oa:b,La:c,value:d}=this.ja(),f=d.slice(0,c).lastIndexOf("@");b.value=d.slice(0,f)+a.getKey()+" "+d.slice(c);this.Xc($(b))}lf(){if(0!==this.state.ka.length){var a=this.state.ka.length;this.setState({v:null===this.state.v?this.state.ka.length-1:(this.state.v-1+a)%a})}}kf(){const a=this.state.ka.length;0!==a&&this.setState({v:((this.state.v||0)+1)%a})}ja(){const a=this.refs.inputText,b=H.findDOMNode(a);return{Pe:a,
Oa:b,La:null==b?null:b.selectionEnd,value:null==b?null:b.value}}Ef(a,b){a=a.slice(0,b);b=a.lastIndexOf("@");-1===b?a=[]:(a=a.slice(b+1),a=this.props.filterContacts(a));this.setState({ka:a,v:0})}render(){const a=Object.assign(Object.assign({},this.props.textArea),{style:null==this.props.textArea.style?{}:Object.assign({},this.props.textArea.style),ref:"inputText",onKeyPress:(a)=>{if("Enter"!==a.key||a.ctrlKey||a.shiftKey||a.metaKey||!this.state.ga){if("@"===a.key&&(this.Cb=a.key),null!=this.props.textArea.onKeyPress)this.props.textArea.onKeyPress(a)}else a.preventDefault(),
0===this.state.ka.length||null===this.state.v?(this.Ba(),this.props.ma.mentionPopupClosedByKeyboard(a.keyCode)):(this.uc(),this.props.ma.mentionPopupAddedUser(d.AddMentionTrigger.ENTER))},onKeyUp:(a)=>{const {La:b,value:e}=this.ja();null==this.Cb||null!=e&&-1===e.substr(0,b).search(/(\s|^)@$/)||(this.Cb=null,this.state.ga||(this.Id(),this.props.ma.mentionPopupDisplays(d.ShowMentionPopupTrigger.AT_SIGN)));if(null!=this.props.textArea.onKeyUp)this.props.textArea.onKeyUp(a)},onBlur:(a)=>{this.state.ga&&
(this.Ba(),this.props.ma.mentionPopupClosedByClick());if(null!=this.props.textArea.onBlur)this.props.textArea.onBlur(a)},onKeyDown:(a)=>{switch(a.key){case "ArrowUp":if(this.state.ga){a.preventDefault();this.lf();return}break;case "ArrowDown":if(this.state.ga){a.preventDefault();this.kf();return}break;case "ArrowLeft":case "ArrowRight":case " ":this.state.ga&&(this.Ba(),this.props.ma.mentionPopupClosedByKeyboard(a.keyCode));break;case "Backspace":if(this.state.ga){const {La:b,value:d}=this.ja();"@"===
d[b-1]&&(this.Ba(),this.props.ma.mentionPopupClosedByKeyboard(a.keyCode))}}if(null!=this.props.textArea.onKeyDown)this.props.textArea.onKeyDown(a)},onChange:(a)=>{const {La:b,value:d,Oa:f}=this.ja();this.Ef(d,b);this.Xc($(f));if(null!=this.props.textArea.onChange)this.props.textArea.onChange(a)}});this.props.Jb&&(a.style.height=this.state.hd);return f.createElement("div",{style:{display:"flex"}},this.he(),this.ca.textArea(a))}Xc(a){if(this.props.Jb){var b={position:"absolute",display:"block",wordWrap:"break-word",
whiteSpace:"pre-wrap"};$("paddingTop paddingRight paddingBottom paddingLeft fontSize lineHeight fontFamily width boxSizing letterSpacing fontWeight borderTopWidth borderRightWidth borderBottomWidth borderLeftWidth borderTopStyle borderTopColor borderRightStyle borderBottomStyle borderLeftStyle".split(" ")).each(function(c,d){b[d.toString()]=a.css(d).toString()});var c=$("<div />").css(b);$(document.body).append(c);var d=a.val();c.text((null==d?"":d)+"l");d=c.outerHeight();c.remove();this.setState({hd:d})}}};
var x={};Object.defineProperty(x,"__esModule",{value:!0});var T;(function(a){a[a.START=0]="START";a[a.APPLY=1]="APPLY";a[a.CANCEL=2]="CANCEL"})(T=x.ib||(x.ib={}));var B;(function(a){a[a.za=0]="LABEL";a[a.Ta=1]="TEXTAREA"})(B=x.jb||(x.jb={}));class Z extends f.Component{constructor(a,b){super(a,b);this.state={ha:this.props.ha===B.Ta?B.Ta:B.za,text:this.props.text,oa:[]};this.Ff=I.Utils.createUrlUtils();this.vb=this.vb.bind(this);this.Db=f.createFactory(O.Tb)}componentWillReceiveProps(a){const b={text:a.text,
oa:this.state.oa};a.disabled&&(b.ha=B.za);b.ha!==a.ha&&(b.ha=a.ha);this.setState(b)}render(){return this.Ue()||this.props.disabled?this.hf():this.gf()}yf(a,b){let c=[];for(;;){let d=b.getKey(),f=a.indexOf(d);if(0>f){c.push(a);break}c.push(a.substring(0,f));c.push(this.ge(b));a=a.substring(f+d.length)}return c}ge(a){a=a.getKeyText();return f.createElement("span",{className:"comment-text-mention"},a)}We(a){const b=[];let c=0;I.Utils.getUrlsInString(a).forEach((d)=>{d.pos>c&&b.push(a.substring(c,d.pos));
b.push(f.createElement("a",{href:this.Ff.getRedirectLink(d.str),target:"_blank"},d.str));c=d.end});b.push(a.substring(c));return b}Vc(a,b){let c=[];a.forEach((a)=>{"string"===typeof a?c=c.concat(b(a)):c.push(a)});return c}hf(){var a=this.props.className?"koi-editable-label-label "+this.props.className:"koi-editable-label-label";let b=this.props.mentions.sort((a)=>-a.getKey().length),c=this.state.text?[this.state.text]:[];b.forEach((a)=>{c=this.Vc(c,(b)=>this.yf(b,a))});c=this.Vc(c,(a)=>this.We(a));
a=f.createElement("div",{key:`editable-comment-text-label-${this.props.la}`,className:a,onClick:(a)=>{if(null!=this.props.onClick)this.props.onClick(a)},ref:"labelComponent"},c);return this.props.tooltipText?(a={content:a,tooltip:this.props.tooltipText,pointerPosition:this.props.tooltipPosition},u.KoiWidgetsModule.getWidgetFactory().tooltip(a)):a}gf(){return f.createElement("div",{key:`editable-comment-text-container-${this.props.la}`,className:"editable-comment-text-container"},[this.Db({key:`editable-comment-text-mention-editor-${this.props.la}`,
ref:"inputText",filterContacts:this.props.filterContacts,pa:this.props.la,Va:(a)=>{const b=A.ta.mc(a);a=this.props.mentions.concat(this.state.oa).filter((a)=>a.getKey()===b.getKey());if(0<a.length)return a[0];this.setState({oa:this.state.oa.concat([b])});return b},textArea:{key:`editable-comment-text-textarea-${this.props.la}`,defaultValue:this.state.text,onKeyPress:this.vb,className:"editable-comment-text-textarea",ref:"inputComponentInput",isFocused:!0,selectOnFocus:!0,style:{height:null!==this.props.Ca?
this.props.Ca:"auto"}},ma:this.props.eb,Jb:!1}),f.createElement("div",{key:`editable-comment-text-tools-${this.props.la}`,className:"editable-comment-text-tools"},[f.createElement("span",{key:`editable-comment-text-btn-cancel-${this.props.la}`,className:"editable-comment-text-btn-cancel icon-button icon-cross",onClick:()=>{this.$b("button")}},null),f.createElement("span",{key:`editable-comment-text-btn-apply-${this.props.la}`,className:"editable-comment-text-btn-apply icon-button icon-checkmark",
onClick:()=>{this.Yb("button")}},null)])])}vb(a){27===a.keyCode&&(this.$b("keyboard"),a.stopPropagation());"Enter"!==a.key||a.ctrlKey||a.shiftKey||a.metaKey||(this.Yb("keyboard"),a.stopPropagation())}Yb(a){if(this.yc()){const b=this.state.text,c=H.findDOMNode(this.refs.inputText.refs.inputText).value.trim()||b;this.setState({ha:B.za,text:c,oa:[]});this.props.qb(T.APPLY,a,b,c,this.state.oa)}}$b(a){this.yc()&&(this.setState({ha:B.za,oa:[]}),this.props.qb(T.CANCEL,a,this.state.text,null,null))}Ue(){return this.state.ha===
B.za}yc(){return this.state.ha===B.Ta}}x.ud=Z;Z.Hf={text:"",qb:null,la:null,Ca:"auto",getContact:null,filterContacts:null,mentions:[],eb:null};var U={};Object.defineProperty(U,"__esModule",{value:!0});U.md=class extends f.Component{constructor(a){super(a);this.state={isEditing:!1,Ca:"auto",na:!1,ob:null,text:this.props.j.getText()}}componentWillReceiveProps(a){this.props.j.getText()!==a.j.getText()&&this.setState({text:a.j.getText()});this.props.isOffline!==a.isOffline&&a.isOffline&&this.setState({isEditing:!1,
na:!1})}Sd(a){const b=this.props.j.getAuthor();let c="thread-box-comment-container-user-avatar";this.props.j.isDeleted()&&(c+=" comment-deleted");return u.KoiWidgetsModule.getWidgetFactory().avatar({key:`thread-box-comment-container-user-avatar-${a}`,className:c,avatarUrl:b.getAvatar(),firstName:b.getFirstName(),lastName:b.getLastName(),onClick:()=>{this.avatarClicked()},userName:b.getUsername()})}avatarClicked(){this.props.controller.avatarClicked(this.props.threadId)}le(a){let b;b=this.props.j.isDeleted()?
h.I18n.ts("Deleted comment"):`${this.props.j.getAuthor().getFirstName()} ${this.props.j.getAuthor().getLastName()}`;return u.KoiWidgetsModule.getWidgetFactory().label({key:`thread-box-comment-container-user-name-${a}`,className:"thread-box-comment-container-user-name",text:b,onClick:()=>{this.nameClicked()}})}nameClicked(){this.props.controller.nameClicked(this.props.threadId)}Vd(a){if(this.state.isEditing)return null;var b=this.props.j.isDeleted()?this.props.j.getDeletionTimeSecs():this.props.j.getCreationTimeSecs();
const c=Math.floor((new Date).getTime()/1E3)-1;b=Y.get({to:Math.min(c,b),units:Y.PreziVagueTimeModuleUnits.Second});this.props.j.isModified()&&!this.props.j.isDeleted()&&(b=h.I18n.tsFormatKeys("{comment_date} - edited",{comment_date:b}));return u.KoiWidgetsModule.getWidgetFactory().label({key:`thread-box-comment-container-date-${a}`,className:"thread-box-comment-container-date",text:b,onClick:()=>{this.dateClicked()}})}dateClicked(){this.props.controller.dateClicked(this.props.threadId)}re(a){let b=
[];this.state.isEditing||this.props.Te||this.props.isOffline||!this.props.j.getAuthor().isOwnComment()||(b=[f.createElement("span",{key:`thread-box-comment-container-tools-delete-${a}`,className:"thread-box-comment-container-tools-delete icon-button icon-trash",onClick:(a)=>{if(this.state.na)this.setState({na:!1});else{a=$(a.target).parents(".thread-box-comment-container");let b=0;1===a.length&&(b=a.height());this.setState({na:!0,ob:b});v.avro.Avro.createDefaultLogger().logDeleteComment({comment_thread_id:this.props.threadId})}}}),
f.createElement("span",{key:`thread-box-comment-container-tools-edit-${a}`,className:"thread-box-comment-container-tools-edit icon-button icon-edit",onClick:(a)=>{if(this.state.isEditing)this.setState({isEditing:!1});else{a=$(a.target).parents(".thread-box-comment-container").find(".thread-box-comment-container-text");let b="auto";1===a.length&&(b=a.height()+"px");this.setState({isEditing:!0,Ca:b});v.avro.Avro.createDefaultLogger().logEditComment({comment_thread_id:this.props.threadId})}}})]);return f.createElement("div",
{key:`thread-box-comment-container-tools-${a}`,className:"thread-box-comment-container-tools"},...b)}createText(a){return f.createElement(x.ud,{key:`thread-box-comment-container-text-${a}`,className:"thread-box-comment-container-text selectable-text",la:a,text:this.state.text,ha:this.state.isEditing?x.jb.Ta:x.jb.za,Ca:this.state.Ca,mentions:this.props.j.getMentions(),eb:this.props.eb,onClick:()=>{this.textClicked()},qb:(a,c,e,f,h)=>{a===x.ib.APPLY?(a=d.EditCommentTrigger.CLICK,"keyboard"===c&&(a=
d.EditCommentTrigger.ENTER),this.props.controller.editComment(this.props.threadId,this.props.j.getCommentUuid(),f,this.props.j.getMentions().concat(h),a),this.setState({isEditing:!1,text:f})):a===x.ib.CANCEL&&this.setState({isEditing:!1,text:e})},getContact:(a)=>this.props.controller.getContact(a),filterContacts:(a)=>this.props.controller.filterContacts(a)})}textClicked(){this.props.controller.textClicked(this.props.threadId)}Wd(a){const b=this.state.na?"visible":"hidden";return[f.createElement("div",
{key:`thread-box-comment-container-delete-confirm-${a}`,className:"thread-box-comment-container-delete-confirm",style:{visibility:b}}),u.KoiWidgetsModule.getWidgetFactory().button({className:"small thread-box-comment-container-delete-confirm-btn-cancel",onClick:()=>{this.setState({na:!1})},style:{visibility:b,top:this.state.ob/2},text:h.I18n.ts("Cancel")}),u.KoiWidgetsModule.getWidgetFactory().button({className:"small thread-box-comment-container-delete-confirm-btn-delete",onClick:()=>{this.props.controller.deleteComment(this.props.threadId,
this.props.j.getCommentUuid(),()=>{this.setState({na:!1})},()=>{})},style:{visibility:b,top:this.state.ob/2},text:h.I18n.ts("Delete")})]}Xd(a){return this.props.j.isDeleted()?[f.createElement("div",{key:`thread-box-comment-container-deleted-bg-${a}`,className:"thread-box-comment-container-deleted-bg"})]:[]}ae(a){return this.props.j.isDeleted()||!this.props.j.getAuthor().isOwnComment()||this.props.isOffline?[]:[f.createElement("div",{key:`thread-box-comment-container-hover-bg-${a}`,className:"thread-box-comment-container-hover-bg"})]}Td(a){return f.createElement("div",
{key:`thread-box-comment-container-${a}`,className:`thread-box-comment-container
					${this.state.isEditing?" editing":""}
					${this.state.na?" deleting":""}
					${this.props.j.isDeleted()?" deleted":""}
					${0===this.props.index?" first":""}`},[this.Xd(a),this.ae(a),this.Sd(a),this.le(a),this.Vd(a),this.re(a),this.createText(a),this.Wd(a)])}render(){const a=`${this.props.threadId}-${this.props.index}`;return f.createElement("div",{key:`thread-box-comment-${a}`,"data-lookup":`${d.Lookup.COMMENT_ITEM}:${this.props.threadId}:${this.props.index}`},[this.Td(a)])}};var V={};Object.defineProperty(V,"__esModule",{value:!0});V.yd=class extends f.Component{constructor(a){super(a);const b=a.f.getThread();
this.state={xa:!1,Pa:!a.isOffline,Bb:!0,Ea:!1,text:null==b?null:b.getDraft()};this.Od=f.createFactory(U.md);this.Db=f.createFactory(O.Tb);this.ca=u.KoiWidgetsModule.getWidgetFactory()}nc(a,b=""){let c=b;switch(a){case d.CommentingServiceCallState.Ready:c+="ready";break;case d.CommentingServiceCallState.Saved:c+="saved";break;case d.CommentingServiceCallState.Pending:c+="pending";break;case d.CommentingServiceCallState.Error:c+="error"}this.props.isOffline&&(c+=" "+b+"offline");return c}ie(){return 0===
this.props.f.getThread().getPendingMentions().filter((a)=>this.state.text&&-1!==this.state.text.indexOf(a.getKey())).length?null:f.createElement("div",{key:"thread-box-mention-share-warning",className:"thread-box-mention-share-warning"},this.je(),this.ke())}je(){const a=f.createElement("span",{className:"icon-add-user"});return f.createElement("div",{className:"thread-box-mention-share-warning-icon"},a)}ke(){var a=h.I18n.ts("Any tagged users will be added as a collaborator of this prezi.");a=f.createElement("span",
{},a);return f.createElement("div",{className:"thread-box-mention-share-warning-text"},a)}ja(){const a=this.refs.inputText;return null==a?{Pe:null,Oa:null,La:null,value:null}:a.ja()}ee(){let a=this.props.f.getThread();if(this.props.permissions.canComment&&null!=a){const b=this.nc(a.getCommentingState(),"commenting-state-");return f.createElement("div",{key:"thread-box-input-group",className:"thread-box-input-group "+b},this.Yd(),this.se(),this.ca.inputGroup({ref:"inputGroup",children:[this.Db({key:`${d.Lookup.COMMENT_INSERT_INPUT}-mention-editor-${a.getId()}`,
ref:"inputText",filterContacts:(a)=>this.props.controller.filterContacts(a),pa:this.props.f.getEntityId(),Va:(a)=>this.Va(a),textArea:{placeholder:h.I18n.ts("Type your comment here"),"data-lookup":`${d.Lookup.COMMENT_INSERT_INPUT}:${a.getId()}`,key:`${d.Lookup.COMMENT_INSERT_INPUT}-${a.getId()}`,maxLength:500,selectOnFocus:!0,isFocused:this.props.opened,defaultValue:a.getDraft(),disabled:a.getCommentingState()===d.CommentingServiceCallState.Pending||!this.state.Pa,style:{maxHeight:61,minHeight:29},
onKeyPress:(a)=>{"Enter"!==a.key||a.ctrlKey||a.shiftKey||a.metaKey||(a.preventDefault(),this.state.xa&&this.bc(d.AddCommentTrigger.ENTER))},onChange:()=>{const {value:a}=this.ja();this.ad(a);this.setState({text:a,Ea:!1})}},ma:this.rc(a),Jb:!0}),this.ca.button({onClick:()=>{this.state.xa&&this.bc(d.AddCommentTrigger.CLICK)},key:`${d.Lookup.COMMENT_INSERT_BUTTON}-${a.getId()}`,className:"icon-comment"+(this.state.Ea?" thread-box-blinking-button":""),disabled:a.getCommentingState()===d.CommentingServiceCallState.Pending||
!this.state.xa,lookupId:`${d.Lookup.COMMENT_INSERT_BUTTON}:${a.getId()}`})]}))}return null}rc(a){return{mentionPopupDisplays:(b)=>this.props.controller.mentionPopupDisplays(a,b),mentionPopupAddedUser:(b)=>this.props.controller.mentionPopupAddedUser(a,b),mentionPopupClosedByKeyboard:(b)=>this.props.controller.mentionPopupClosedByKeyboard(a,b),mentionPopupClosedByClick:()=>this.props.controller.mentionPopupClosedByClick(a)}}Yd(){return f.createElement("div",{className:"thread-box-error-label"},f.createElement("i",
{className:"icon-warning"}),h.I18n.ts("We could not upload your comment"))}se(){return f.createElement("div",{className:"thread-box-warning-label"},f.createElement("i",{className:"icon-warning"}),h.I18n.ts("You must be online to comment."))}bc(a){const {value:b}=this.ja();this.setState({xa:!1,Bb:!0,Ea:!1});this.props.controller.addComment(this.props.f.getThread().getId(),b,this.props.f.getThread().getPendingMentions(),a)}componentWillReceiveProps(a){const b=this.props.f.getThread(),c=a.f.getThread(),
{Oa:e}=this.ja();let f=!1;this.props.isOffline!==a.isOffline&&(a.isOffline?this.setState({xa:!1,Pa:!1}):this.setState({xa:!0,Pa:!0}));this.props.opened&&!a.opened&&(this.props.controller.popupClosed(this.props.f.getEntityId(),null!=e?e.value:null),this.setState({Ea:!1}));!this.props.opened&&a.opened&&(f=!0);null!=e&&(null!=c&&c.getCommentingState()===d.CommentingServiceCallState.Pending?f=!0:(null==b||null==c||b.getCommentingState()!==d.CommentingServiceCallState.Pending||c.getCommentingState()!==
d.CommentingServiceCallState.Saved&&c.getCommentingState()!==d.CommentingServiceCallState.Ready||(e.value="",f=!0,this.setState({text:""})),this.ad(e.value)));this.setState({Bb:f})}ad(a){this.setState({xa:null!=a&&0<a.length&&!this.props.isOffline})}oe(){let a=this.props.f.getThread();if(null==a||null==this.props.anchorNode||!this.props.permissions.canResolveThreads&&!a.canResolveThisThread()||0>=a.getCommentCount()||a.isResolved()||!this.state.Pa)return null;const b=this.nc(a.getResolveState(),"resolve-state-");
return f.createElement("div",{key:"thread-box-header",className:"thread-box-header "+b},this.ca.button({text:h.I18n.ts("End thread"),className:"thread-box-resolve-button",onClick:()=>{this.Af()},lookupId:`${d.Lookup.THREAD_RESOLVE_BUTTON}:${a.getId()}`}),this.ca.label({className:"thread-box-header-error-label icon-warning",text:h.I18n.ts("Something went wrong.")}))}me(){let a=this.props.f.getThread();return null==a||null==this.props.anchorNode||0!==a.getCommentCount()?null:f.createElement("div",{key:"thread-box-placeholder",
className:"thread-box-placeholder"},f.createElement("div",{key:"thread-box-placeholder-img",className:"thread-box-placeholder-img"}))}xb(){return!this.props.af&&0!==this.props.f.getInsideThreadCount()}fe(){if(!this.xb())return null;let a=this.props.f.getInsideThreadCount();return f.createElement("div",{key:"thread-box-inside-comment",className:"thread-box-inside-comment"},this.ca.button({text:h.I18n.ts("Zoom in"),className:"thread-box-inside-comment-button",onClick:()=>{this.zoomIn()},lookupId:`${d.Lookup.INSIDE_COMMENT_ZOOM_IN_BUTTON}:${this.props.f.getEntityId()}`}),
this.ca.label({key:"thread-box-inside-comment-label",className:"thread-box-inside-comment-label",text:this.Be(a)}))}Be(a){return 1===a?h.I18n.ts("There is one comment thread inside this chapter."):h.I18n.tsFormatKeys("There are {count} comment threads inside this chapter.",{count:a})}zoomIn(){this.props.controller.zoomIn(this.props.f.getEntityId())}Af(){this.props.controller.resolveThread(this.props.f.getThread().getId())}xf(a){return null!=a&&0<a.getCommentCount()&&!(1===a.getCommentCount()&&a.getComments()[0].isDeleted())&&
this.props.f.isThreadActive()}nb(){let a=this.props.f.getThread(),b=this.xf(a)?a.getComments().map((b,d)=>({children:[this.Od({key:d.toString(),j:b,index:d,threadId:a.getId(),Te:a.isResolved()||!this.state.Pa,isOffline:this.props.isOffline,controller:this.props.controller,eb:this.rc(a)})],onRemove:null})):[];return[this.fe()].concat(this.props.f.isThreadActive()?[this.ca.label({key:"thread-box-placeholder-label",className:"thread-box-placeholder-label",text:aa(this.props.controller.getTargetObjectType(a))}),
this.oe(),this.me(),this.ca.list({key:"list",ref:"listComponent",className:"thread-box-comments-list",isLoading:!1,items:b,gradientFader:!0,scrollToBottom:this.state.Bb}),this.ee(),this.ie()]:[])}Zd(){if(null==this.props.anchorNode||"none"===this.props.anchorNode.style.display)return null;let a=null!=this.state.text&&0<this.state.text.length&&!this.state.Ea&&this.props.opened;return this.ca.fixedSizeFloatingPopup({key:`thread-box-${this.props.f.getEntityId()}`,preferredAnchorOrientation:u.KoiFixedSizeFloatingPopupAnchorOrientation.LEFT,
className:"thread-box-popup-floating-popup"+(this.props.f.isThreadActive()?this.xb()?" thread-box-popup-with-inside-comment":"":" thread-box-popup-inside-comment-only"),contentClassName:"threadbox-popup-content",lookupId:`${d.Lookup.THREAD_BOX_POPUP}:${this.props.f.getEntityId()}`,content:this.nb(),visible:this.props.opened,anchorNode:this.props.anchorNode,width:276,height:this.props.f.isThreadActive()?321:50,topMargin:this.xb()&&this.props.f.isThreadActive()?154:92,showCover:a,onCoverClick:()=>{this.setState({Ea:!0})},
appearWithAnimation:!1})}Va(a){return this.props.controller.addContactToPendingMentions(this.props.f.getEntityId(),a)}render(){return f.createElement("div",{},this.Zd())}shouldComponentUpdate(a,b){return!I.Utils.shallowCompare(this.props,a)||!I.Utils.shallowCompare(this.state,b)}};var W={};Object.defineProperty(W,"__esModule",{value:!0});W.zd=class extends f.Component{constructor(a){super(a);this.state={}}ne(){const a=f.createFactory(V.yd);return this.props.threadList.getThreadInfos().map((b)=>{const c=
b.getEntityId();return a({key:`thread-box-popup-${c}`,f:b,af:this.props.selectedEntityId===c,opened:this.props.openedPopupId_KILLME===d.CommentingModule.createThreadboxPopupId(c)&&(this.props.selectedEntityId!==c||b.isThreadActive()),anchorNode:this.props.controller.getThreadIconNode(c),permissions:this.props.permissions,controller:this.props.controller,isOffline:this.props.isOffline})})}render(){return f.createElement("div",{className:"koi-editor-ui-comment-thread-box-popups"},this.ne())}shouldComponentUpdate(a){return d.CommentingModule.isThreadboxPopupId(this.props.openedPopupId_KILLME)||
d.CommentingModule.isThreadboxPopupId(a.openedPopupId_KILLME)}};var X={};Object.defineProperty(X,"__esModule",{value:!0});X.pd=class{constructor(a){this.da=a;this.zf=f.createFactory(W.zd)}createThreadBoxPopupCollection(a,b,c){b=!ba.isActive("js-commenting-always-online")&&1!==c;a={threadList:this.da.getThreadList(),openedPopupId_KILLME:a,selectedEntityId:this.da.getSelectedEntityId(),permissions:this.da.getPermissions(),controller:this.da,isOffline:b};return this.zf(a)}};p={};Object.defineProperty(p,
"__esModule",{value:!0});p.od=class{constructor(){this.dc=I.Utils.createSingletonAccess((a)=>new n.sa(a))}createCommentingController(a){return this.dc.create(a)}getCommentingController(){return this.dc.getValue()}createCommentingSection(a){return new X.pd(a)}createThreadboxPopupId(a){return d.COMMENTING_POPUPID_PREFIX+a}isThreadboxPopupId(a){return null!=a&&a.substr(0,d.COMMENTING_POPUPID_PREFIX.length)===d.COMMENTING_POPUPID_PREFIX}};var d={};Object.defineProperty(d,"__esModule",{value:!0});(function(a){a[a.Ready=
0]="Ready";a[a.Saved=1]="Saved";a[a.Pending=2]="Pending";a[a.Error=3]="Error"})(d.CommentingServiceCallState||(d.CommentingServiceCallState={}));(function(a){a[a.ZOBJECT=0]="ZOBJECT";a[a.OVERVIEW=1]="OVERVIEW"})(d.ThreadType||(d.ThreadType={}));(function(a){a[a.INSERT_MENU=0]="INSERT_MENU";a[a.PUCUKA=1]="PUCUKA";a[a.PROPERTY_BAR=2]="PROPERTY_BAR";a[a.CONTEXT_MENU=3]="CONTEXT_MENU";a[a.DEEP_LINK=4]="DEEP_LINK";a[a.COMMENT_MENU=5]="COMMENT_MENU";a[a.PLAYER_UI=6]="PLAYER_UI"})(d.OpenCommentThreadTrigger||
(d.OpenCommentThreadTrigger={}));(function(a){a[a.INSERT_MENU=0]="INSERT_MENU";a[a.TOPMENU=1]="TOPMENU"})(d.OpenCommentMenuSource||(d.OpenCommentMenuSource={}));(function(a){a[a.ENTER=0]="ENTER";a[a.CLICK=1]="CLICK"})(d.AddCommentTrigger||(d.AddCommentTrigger={}));(function(a){a[a.ENTER=0]="ENTER";a[a.CLICK=1]="CLICK"})(d.EditCommentTrigger||(d.EditCommentTrigger={}));(function(a){a[a.ENTER=0]="ENTER";a[a.CLICK=1]="CLICK"})(d.AddMentionTrigger||(d.AddMentionTrigger={}));(function(a){a[a.EDIT=0]="EDIT";
a[a.AT_SIGN=1]="AT_SIGN"})(d.ShowMentionPopupTrigger||(d.ShowMentionPopupTrigger={}));(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.OBJECT=1]="OBJECT";a[a.LINE=2]="LINE";a[a.ARROW=3]="ARROW";a[a.TOPIC=4]="TOPIC";a[a.SUBTOPIC=5]="SUBTOPIC";a[a.OVERVIEW=6]="OVERVIEW";a[a.IMAGE=7]="IMAGE";a[a.PDF=8]="PDF";a[a.VIDEO=9]="VIDEO";a[a.TEXT=10]="TEXT";a[a.FADE_IN=11]="FADE_IN";a[a.FADE_OUT=12]="FADE_OUT";a[a.ZOOM_TO=13]="ZOOM_TO";a[a.PAGE=14]="PAGE";a[a.CHART=15]="CHART"})(d.TargetObjectType||(d.TargetObjectType=
{}));(function(a){a.THREAD_ICON="thread-icon";a.THREAD_BOX_POPUP="thread-box-popup";a.COMMENT_INSERT_INPUT="comment-insert-input";a.COMMENT_INSERT_BUTTON="comment-insert-button";a.COMMENT_ITEM="comment-item";a.THREAD_RESOLVE_BUTTON="thread-resolve-button";a.INSIDE_COMMENT_ZOOM_IN_BUTTON="thread-box-inside-comment-button";a.COMMENTING_MENU_BUTTON="commenting-menu-button";a.COMMENTING_MENU_DROPDOWN="commenting-menu-dropdown";a.MENTION_POPUP="thread-box-mention-popup";a.MENTION_POPUP_CONTENT="thread-box-mention-popup-content";
a.MENTION_POPUP_CONTENT_EMPTY="thread-box-mention-popup-content-empty";a.MENTION_POPUP_CONTACT_ITEM="thread-box-mention-popup-contact-item";a.THREAD_ITEM="thread-item"})(d.Lookup||(d.Lookup={}));d.CommentingModule=new p.od;d.COMMENTING_POPUPID_PREFIX="THREADBOX-";L=d;p=document.createElement("style");p.textContent=".koi-editor-ui-comment-thread-box-popups .koi-tooltip .koi-floating-popup-container{box-shadow:none;border:1px solid rgba(255,255,255,0.3);background:none}.koi-editor-ui-comment-thread-box-popups .koi-tooltip .koi-floating-popup-container .koi-floating-popup-pointer{border:1px solid rgba(255,255,255,0.3);box-shadow:none;background:#152235;z-index:1}.koi-editor-ui-comment-thread-box-popups .koi-tooltip .koi-floating-popup-container .koi-floating-popup-pointer-shadow{z-index:0}.koi-editor-ui-comment-thread-box-popups .koi-tooltip .koi-floating-popup-container .koi-floating-popup-content{font-family:\"RalewayMedium\";font-size:11px;letter-spacing:.5px;padding:6px 12px;color:#fff;background:#152235;height:auto;z-index:2}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content{height:321px;display:-ms-flexbox;display:flex;display:-webkit-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:0}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-inside-comment{display:block;margin:12px;padding:10px;background-color:#152235;box-shadow:0 1px 3px rgba(21,34,53,0.5);border-radius:3px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-inside-comment .thread-box-inside-comment-label{color:#fff;line-height:1.4;font-size:11px;letter-spacing:.5px;font-family:\"RalewaySemiBold\";white-space:normal}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-inside-comment .thread-box-inside-comment-button{float:right;font-size:13px;height:24px;letter-spacing:.5px;font-family:\"RalewaySemiBold\";color:#fff;background-color:#152235;border:solid 1px #fff;border-radius:3px;margin-top:3px;margin-left:6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-placeholder-label{background-color:#eceef1;font-family:\"RalewayMedium\";font-size:11px;letter-spacing:.5px;color:#152235;padding:6px 46px;top:6px;position:relative}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-placeholder .thread-box-placeholder-img{width:212px;height:100px;margin:20px 0 0 10px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaYAAABiCAMAAAAsoYcnAAAAPFBMVEUAAADt7/Ls7vHs7vLt7/L////t7/Ls7/Hs7/Ht7vHs7/Lt7/Ps7/Pu8PPv7/Ls8fHs9vbw8P/////s7vHMT6MXAAAAE3RSTlMA9/LmXgns28u3r498Zk43GxED8BkukAAAAfFJREFUeNrs3EeOAzEMRFEqdc51/7vOdgDPKHhhUnC9K3zY6G6JlBfpWOdxcG4Y5/VIQgbdcfH4xS/xFrIlbR4v/MaflCXPHvCnsD9CRlwT/jVdQiacARnhFDIgOmS5KKQuooid1J0ORe6UHHwh+awroEK4mEkz0zOhyvQwk2KmHZV2ZtLLlAIqhcRMapk2VNuYSSvT7VHN38yklCmiQWQmpUwLGizMpJMpeTTwiZlUMh1ocjCTSqYVTVZmUsk0o8nMTCqZRjQZmUkl04AmAzOpZHJo4piJmTojGfzTM0Ny+AhhhWTxgdwIyePrrQ1SwI9FJkgRP70aIAU8yDBByngsqE/KeMiuT8p4ZUWfVOEFsDZ9Z+J1yj4y8XJyF5lqr/pzZPA9lgZnKItjaN+EQ5194Ih0H7hwoA9c39EJLsPpBFdL9YKL2ojopx07OGEgCGIgGITyz9URiMPYjxFXFcAuqH/Ds/zZ06vr/31HJpmWZpNpYjaZJmaTaWI2mSZmk2liNpkmZpNpYjaZJmaTaWI2mSZmk2liNpkmZpNpYjaZJmaTaWK2l2QCAAAAALakcyS9I51Md6ST6Y50Mt2RTqY70sl0RzqZ7kgn0x3pZLojnUx3pJPpjnQy3ZFOpjvSyXRHOpnuSCfTHelkuiOdTD/7ALtTv8hoXjtNAAAAAElFTkSuQmCC) no-repeat top left / 211px 49px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header{display:block;height:36px;margin-top:6px;padding:12px 12px 0 12px;-webkit-align-items:flex-start;-ms-flex-align:start;align-items:flex-start}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header.resolve-state-ready .thread-box-header-error-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header.resolve-state-saved .thread-box-header-error-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header.resolve-state-pending .thread-box-header-error-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header.resolve-state-error{height:54px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header.resolve-state-error .thread-box-header-error-label{display:block;clear:both}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header .thread-box-header-error-label{background-color:#df0000;color:#fff;padding:6px 18px;margin:12px -12px;top:6px;position:relative;font-size:11px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header .thread-box-header-error-label:before{margin-right:18px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header .thread-box-resolve-label{color:#8e939c;display:inline-block;float:right;line-height:15px;margin-right:12px;margin-top:6px;font-size:11px;letter-spacing:.5px;font-family:\"RalewayMedium\"}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-header .thread-box-resolve-button{float:left;font-size:13px;margin-left:12px;height:24px;background-color:#c2c7cd;letter-spacing:.5px;padding-right:12px;padding-left:12px;font-family:\"RalewaySemiBold\";color:#152235}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list{display:-ms-flexbox;display:flex;display:-webkit-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;width:276px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .gradient-fader{right:0}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .koi-infinite-scroll-outer{position:absolute}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .koi-infinite-scroll-outer .koi-infinite-scroll-mid{overflow-y:auto;overflow-x:hidden}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .koi-infinite-scroll-outer .koi-infinite-scroll-mid .koi-infinite-scroll-inner{box-sizing:border-box;height:100%;margin:0;padding:0 12px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .koi-list-item-container{padding-left:0;padding-right:0;padding-top:9px;padding-bottom:9px;border:none;position:relative}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-user-avatar{float:left}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-hover-bg{background-color:#eceef1;left:-12px;right:-36px;top:0;bottom:0;position:absolute;z-index:-1;visibility:hidden}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-deleted-bg{background-color:#eceef1;left:-12px;right:-36px;top:0;bottom:0;position:absolute;z-index:-1}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-user-name{font-weight:bold;overflow:visible;font-size:13px;color:#152235;padding-left:36px;line-height:18px;letter-spacing:.5px;font-family:\"RalewaySemiBold\";white-space:normal;width:210px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-date{padding-left:36px;font-size:11px;color:#8e939c;line-height:18px;letter-spacing:.5px;width:210px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .icon-button{font-size:16px;cursor:pointer}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-tools{position:absolute;right:-6px;top:6px;visibility:hidden}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-tools .thread-box-comment-container-tools-delete{margin-right:6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-text{padding-left:36px;line-height:15px;max-width:204px;font-size:11px;white-space:pre-line;word-wrap:break-word;letter-spacing:.5px;width:210px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-delete-confirm{position:absolute;top:0;left:-12px;right:-36px;height:100%;background-color:#152235;opacity:.8}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .koi-button{padding:0 6px;position:absolute;cursor:pointer;font-family:\"RalewaySemiBold\";min-width:72px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-delete-confirm-btn-delete{background-color:#df4840;color:#fff;left:30px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .thread-box-comment-container-delete-confirm-btn-cancel{background-color:#dbdfe5;color:#152235;right:6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container:hover .thread-box-comment-container-tools,.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.editing .thread-box-comment-container-tools{visibility:visible}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container:hover .thread-box-comment-container-hover-bg,.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.editing .thread-box-comment-container-hover-bg{visibility:visible}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.deleting .thread-box-comment-container-tools{visibility:hidden}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list{display:-ms-flexbox;display:flex;display:-webkit-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;margin:12px 0 12px 0}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .gradient-fader{right:0}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .koi-infinite-scroll-outer{position:absolute}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .koi-infinite-scroll-outer .koi-infinite-scroll-mid{overflow-x:hidden}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .koi-infinite-scroll-outer .koi-infinite-scroll-mid .koi-infinite-scroll-inner{padding:0;margin:0;font-size:11px;letter-spacing:.4px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .koi-list-item-container{padding-left:15px;padding-right:0;padding-top:0;padding-bottom:0;border:none;position:relative;height:24px;width:100%}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .koi-list-item-container.selected{background:#3181ff;color:#fff}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .koi-list-container.mention-popup-contact-list .koi-list-item-container .mention-popup-contact-item{cursor:pointer;position:absolute;top:5px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .editable-comment-text-textarea{line-height:15px;max-width:204px;font-size:11px;white-space:pre-line;letter-spacing:.5px;width:205px;resize:none;padding:6px 0 6px 11px;overflow:hidden;min-height:15px;font-family:'RalewayMedium';border:1px solid #c2c7cd;border-radius:3px;margin-top:4px;box-sizing:content-box}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .editable-comment-text-tools{position:absolute;right:-6px;top:6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container .editable-comment-text-container .editable-comment-text-tools .editable-comment-text-btn-cancel{margin-right:6px;font-size:18px;display:block;float:left}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.deleted{margin-top:-6px;margin-bottom:-6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.deleted.first{margin-top:6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.deleted.first .thread-box-comment-container-deleted-bg{top:12px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.deleted .thread-box-comment-container-user-avatar{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .koi-list-container.thread-box-comments-list .thread-box-comment-container.deleted .thread-box-comment-container-user-name{float:left;width:auto;font-size:11px;padding-right:4px;color:#8e939c}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group{padding:0 12px 12px 12px;-webkit-align-items:flex-start;-ms-flex-align:start;align-items:flex-start}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .thread-box-warning-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group.commenting-state-ready .thread-box-error-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group.commenting-state-saved .thread-box-error-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group.commenting-state-pending .thread-box-error-label{display:none}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group.commenting-state-error .thread-box-error-label{display:block}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group.commenting-state-offline .thread-box-warning-label{display:block}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .thread-box-error-label,.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .thread-box-warning-label{background-color:#df0000;color:#eceef1;padding:6px 18px;margin:12px -12px;font-family:\"RalewayMedium\";font-size:11px;overflow:hidden;text-overflow:ellipsis}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .thread-box-error-label .icon-warning,.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .thread-box-warning-label .icon-warning{margin-right:6px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .thread-box-warning-label{background-color:#f1d236;color:#152235}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .koi-input-group{padding-top:12px;margin-left:-12px;margin-right:-12px;border-top:1px solid #dbdfe5}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .koi-input-group .koi-text-field{margin-left:24px;border:1px solid #c2c7cd;border-radius:3px 0 0 3px;font-family:\"RalewayMedium\";font-size:11px;line-height:15px;letter-spacing:.5px;color:#8e939c;width:187px;min-width:187px;max-width:187px;margin-right:-1px;height:29px;max-height:29px;min-height:29px;padding:6px 6px 6px 12px;resize:none;box-sizing:border-box}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .koi-input-group .koi-text-field:disabled{color:#c2c7cd;border-color:#dbdfe5}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container .threadbox-popup-content .thread-box-input-group .koi-input-group .koi-button{background-color:#c2c7cd;border:1px solid #c2c7cd;letter-spacing:.5px;padding-right:9px;padding-left:9px;color:#152235;font-size:22px}@-webkit-keyframes thread-box-button-blinking-animation{0%{background-color:#dbdfe5}100%{background-color:#8e939c}}@keyframes thread-box-button-blinking-animation{0%{background-color:#dbdfe5}100%{background-color:#8e939c}}.koi-editor-ui-comment-thread-box-popups .thread-box-blinking-button{-webkit-animation:thread-box-button-blinking-animation .5s infinite alternate;animation:thread-box-button-blinking-animation .5s infinite alternate}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-with-inside-comment .koi-fixed-size-floating-popup-container .koi-fixed-size-floating-popup-content{height:321px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-with-inside-comment .koi-fixed-size-floating-popup-container .koi-fixed-size-floating-popup-content .thread-box-inside-comment{margin:-62px 0 0;position:absolute;left:0;right:0}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-inside-comment-only .koi-fixed-size-floating-popup-container .koi-fixed-size-floating-popup-content{height:50px}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-inside-comment-only .koi-fixed-size-floating-popup-container .koi-fixed-size-floating-popup-content .thread-box-inside-comment{margin:0}.koi-editor-ui-comment-thread-box-popups .thread-box-popup-inside-comment-only .koi-fixed-size-floating-popup-container .koi-fixed-size-floating-popup-pointer{background:#152235}.thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container>.koi-fixed-size-floating-popup-content{z-index:1}.thread-box-popup-floating-popup .koi-fixed-size-floating-popup-container>.koi-fixed-size-floating-popup-pointer{z-index:0}.thread-box-popup-floating-popup .koi-fixed-size-floating-popup-cover{opacity:0}.comment-text-mention{font-family:\"RalewayBold\"}.comment-text-mention .koi-tooltip{display:inline}.comment-text-mention .koi-tooltip>div{display:inline}.thread-box-popup-floating-popup .thread-box-mention-share-warning{margin-bottom:12px;padding:0 12px}.thread-box-popup-floating-popup .thread-box-mention-share-warning .thread-box-mention-share-warning-icon{float:left;margin-right:12px}.thread-box-popup-floating-popup .thread-box-mention-share-warning .thread-box-mention-share-warning-icon .icon-add-user{font-size:18px}.thread-box-popup-floating-popup .thread-box-mention-share-warning .thread-box-mention-share-warning-text{float:left;font-family:\"RalewayMedium\";font-size:11px;letter-spacing:.5px;white-space:normal;width:calc(100% - 30px)}.commenting-menu-paywall-box{width:228px;background-color:rgba(21,34,52,0.9);font-family:\"RalewayMedium\";font-size:13px;line-height:1.38;letter-spacing:.5px;padding:24px}.commenting-menu-paywall-box .commenting-menu-paywall-box-title{color:#dfab29;margin-bottom:7px;text-transform:uppercase}.commenting-menu-paywall-box .commenting-menu-paywall-box-info{font-family:\"RalewayRegular\";color:#fff;width:228px;white-space:normal}.commenting-menu-paywall-box .commenting-menu-paywall-box-buttons{margin:24px 0 0 0}.commenting-menu-paywall-box .commenting-menu-paywall-box-buttons .contact-sales-button.koi-button{width:148px;height:30px;font-size:13px;border-radius:3px;background-color:#dfab29;letter-spacing:1px;text-align:center;color:#fff;cursor:pointer;margin:0 24px 0 0}.commenting-menu-paywall-box .commenting-menu-paywall-box-buttons .commenting-menu-paywall-box-learnmore-wrapper{font-family:\"RalewayMedium\";color:#fff;text-decoration:underline;margin:17px 0 0 0}.commenting-menu-paywall-box .commenting-menu-paywall-box-buttons .commenting-menu-paywall-box-learnmore-wrapper a{color:#fff}.commenting-menu-paywall-box .commenting-menu-paywall-box-buttons .commenting-menu-paywall-box-learnmore-wrapper a:hover,.commenting-menu-paywall-box .commenting-menu-paywall-box-buttons .commenting-menu-paywall-box-learnmore-wrapper a:active{color:#fff}.thread-box-mention-popup .koi-fixed-size-floating-popup-container{overflow:hidden}.thread-box-mention-popup .koi-fixed-size-floating-popup-content{padding:0;display:block}.thread-box-mention-popup-container{display:-ms-flexbox;display:flex;display:-webkit-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column}.koi-list-container.mention-popup-contact-list{display:-ms-flexbox;display:flex;display:-webkit-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;margin:12px 0 12px 0}.koi-list-container.mention-popup-contact-list .gradient-fader{right:0}.koi-list-container.mention-popup-contact-list .koi-infinite-scroll-outer{position:absolute}.koi-list-container.mention-popup-contact-list .koi-infinite-scroll-outer .koi-infinite-scroll-mid{overflow-x:hidden}.koi-list-container.mention-popup-contact-list .koi-infinite-scroll-outer .koi-infinite-scroll-mid .koi-infinite-scroll-inner{padding:0;margin:0;font-size:11px;letter-spacing:.4px}.koi-list-container.mention-popup-contact-list .koi-list-item-container{padding-left:15px;padding-right:0;padding-top:0;padding-bottom:0;border:none;position:relative;height:24px;width:100%}.koi-list-container.mention-popup-contact-list .koi-list-item-container.selected{background:#3181ff;color:#fff}.koi-list-container.mention-popup-contact-list .koi-list-item-container .mention-popup-contact-item{cursor:pointer;position:absolute;top:5px}.thread-box-mention-popup-empty{font-family:\"RalewayMedium\";font-size:11px;line-height:1.4;letter-spacing:.5px;color:#152235;white-space:pre-wrap;margin:15px}.comment-deleted{background-color:#c2c7cd !important}.comment-deleted *,.comment-deleted *:after,.comment-deleted *:before{box-sizing:content-box}.domLayer *,.domLayer *:after,.domLayer *:before{box-sizing:content-box}.domLayer .thread_handler_icon{width:38px;height:38px;box-sizing:border-box;padding:0;pointer-events:none}.domLayer .thread_handler_icon div{box-sizing:border-box;width:24px;height:24px;background-image:url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M4 4C3.44772 4 3 4.44772 3 5V11C3 11.5523 3.44772 12 4 12H6.66602L9.33268 14V12H12C12.5523 12 13 11.5523 13 11V5C13 4.44772 12.5523 4 12 4H4Z' fill='white'/%3E%3C/svg%3E%0A\");background-position-x:2px;background-position-y:2px;background-color:#ffc805;border-radius:50%;border:solid 2px #fff;cursor:pointer;pointer-events:auto;display:block;margin-top:6px;margin-left:6px;box-shadow:0 3px 6px rgba(21,34,53,0.5)}.domLayer .thread_handler_icon.show-dots div{background-image:url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M5.5 8C5.5 8.82843 4.82843 9.5 4 9.5C3.17157 9.5 2.5 8.82843 2.5 8C2.5 7.17157 3.17157 6.5 4 6.5C4.82843 6.5 5.5 7.17157 5.5 8ZM9.5 8C9.5 8.82843 8.82843 9.5 8 9.5C7.17157 9.5 6.5 8.82843 6.5 8C6.5 7.17157 7.17157 6.5 8 6.5C8.82843 6.5 9.5 7.17157 9.5 8ZM12 9.5C12.8284 9.5 13.5 8.82843 13.5 8C13.5 7.17157 12.8284 6.5 12 6.5C11.1716 6.5 10.5 7.17157 10.5 8C10.5 8.82843 11.1716 9.5 12 9.5Z' fill='white'/%3E%3C/svg%3E%0A\")}.selectable-text{-moz-user-select:text;-khtml-user-select:text;-webkit-user-select:text;-ms-user-select:text;user-select:text}.selectable-text *,.selectable-text *:after,.selectable-text *:before{box-sizing:content-box}.koi-editor-ui-comment-thread-box-popups *,.koi-editor-ui-comment-thread-box-popups *:after,.koi-editor-ui-comment-thread-box-popups *:before{box-sizing:content-box}.koi-editor-ui-comment-thread-box-popups textarea::-webkit-input-placeholder{color:#c2c7cd}.koi-editor-ui-comment-thread-box-popups textarea::-moz-placeholder{color:#c2c7cd}.koi-editor-ui-comment-thread-box-popups textarea:-ms-input-placeholder{color:#c2c7cd}.koi-editor-ui-comment-thread-box-popups textarea::-ms-input-placeholder{color:#c2c7cd}.koi-editor-ui-comment-thread-box-popups textarea::placeholder{color:#c2c7cd}\n";
document.body.appendChild(p);return L});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_commenting",["require","react","react-dom","react-transition-group","prezi.geometry","prezi_app_utils","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_editor_store_focus","prezi_editor_store_mode","prezi_editor_store_object","prezi_editor_store_ui","prezi_featureswitcher","prezi_i18n","prezi_koi_widgets","prezi_logger","prezi_playback","prezi_utils","prezi_vaguetime"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_commenting.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("react"),require("react-dom"),require("react-transition-group"),require("prezi.geometry"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_editor_store_focus"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_editor_store_ui"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_koi_widgets"),require("prezi_logger"),require("prezi_playback"),require("prezi_utils"),require("prezi_vaguetime"));}else{this["prezi_commenting"]=__factory(React,ReactDOM,ReactTransitionGroup,this["prezi.geometry"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_editor_store_focus"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_editor_store_ui"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_koi_widgets"],this["prezi_logger"],this["prezi_playback"],this["prezi_utils"],this["prezi_vaguetime"]);}}).call(this);