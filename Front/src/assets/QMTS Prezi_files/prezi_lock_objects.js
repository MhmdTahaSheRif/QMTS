;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_lock_objects";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_i18n":dependencies[1],"prezi_logger":dependencies[2],"prezi_plugin_api":dependencies[3],"prezi_utils":dependencies[4]}};})());};})(arguments);var moduleImpl=(function(){return module(function(g){var h=g.dependencies.prezi_i18n,k=g.dependencies.prezi_plugin_api,f=g.dependencies.prezi_cet_model_editor,n=g.dependencies.prezi_utils,m=g.dependencies.prezi_logger,l={};Object.defineProperty(l,"__esModule",{value:!0});var e;(function(a){a[a.none=0]="none";a[a.toLock=1]="toLock";a[a.toUnlock=2]="toUnlock"})(e||(e={}));l.LockObjectsPlugin=class{init(a){this.session.document.read((a)=>a.meta.isSupportedGeneration(f.base.DocumentGeneration.LockableObjects))&&(this.uiRoot=a.declareUI({uiState:{type:e.none}},
(a,c)=>{this.createUI(c,a.uiState)}),a.onSelectionChange(()=>{this.updateStateBySelection()}),a.onDocumentChange(()=>{this.updateStateBySelection()}))}updateStateBySelection(){this.session.document.read((a)=>{a=this.session.selection.getReadonlySelectionInfo(a);if(1===a.allObjects.length&&0===a.groups.length){var b=a.allObjects[0];if(b.is(f.base.ObjectKind.lockable)){this.uiRoot.setState({uiState:{type:b.locked?e.toUnlock:e.toLock,ref:b.ref}});return}}if(1===a.groups.length&&0===a.nonGroupedObjects.length&&
(b=a.groups[0],b.members.some((a)=>a.is(f.base.ObjectKind.lockable)))){a=b.members.some((a)=>a.is(f.base.ObjectKind.lockable)&&a.locked);this.uiRoot.setState({uiState:{type:a?e.toUnlock:e.toLock,ref:b.ref}});return}0===a.groups.length&&1<a.nonGroupedObjects.length&&a.nonGroupedObjects.some((a)=>a.is(f.base.ObjectKind.lockable))?(b=a.nonGroupedObjects.some((a)=>a.is(f.base.ObjectKind.lockable)&&a.locked),this.uiRoot.setState({uiState:{type:b?e.toUnlock:e.toLock,ref:a.nonGroupedObjects.map((a)=>a.ref)}})):
this.uiRoot.setState({uiState:{type:e.none}})})}handleLockness(a,b,c){if(b instanceof Array)for(let d of b)this.setLockness(a,d,c),this.handleLocknessLogs(d,c);else this.setLockness(a,b,c),this.handleLocknessLogs(b,c)}setLockness(a,b,c){this.session.document.executeApiCommand(a,{name:"lock object",run:(d)=>{d=d.lookup.resolve(b);d.is(f.base.ObjectKind.lockable)?null!=d.group?this.setGroupLockness(a,d.group,c):this.setSingleLockness(a,d,c):d.is(f.base.ObjectKind.group)&&this.setGroupLockness(a,d,c)}})}setGroupLockness(a,
b,c){b.members.forEach((b)=>{b.is(f.base.ObjectKind.lockable)&&this.setSingleLockness(a,b,c)})}setSingleLockness(a,b,c){b.locked=c;b.is(f.base.ObjectKind.text)&&c&&this.session.selection.setTextSelection(a,null)}createUI(a,b){switch(b.type){case e.none:break;case e.toLock:a.createMenuItem({kind:k.MenuItemKind.context,id:"lock-object",title:h.I18n.ts("Lock"),weight:200,onClick:(a)=>{this.handleLockness(a,b.ref,!0)},enabled:!0});break;case e.toUnlock:a.createMenuItem({kind:k.MenuItemKind.context,id:"lock-object",
title:h.I18n.ts("Unlock"),weight:200,onClick:(a)=>{this.handleLockness(a,b.ref,!1)},enabled:!0});a.createPropertyBarItem((a)=>a.button({id:"lock-object-property-bar-item",groupWeight:0,weight:0,enabled:!0,icon:k.IconSmallId.Lock,tooltip:h.I18n.ts("Locked"),onClick:(a)=>{this.handleLockness(a,b.ref,!1);m.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"UNLOCK"})}}));break;default:n.Utils.assertNever(b)}}handleLocknessLogs(a,b){this.session.document.read((c)=>{const d=c.lookup.resolve(a);
m.avro.Avro.createDefaultLogger().logChangeObjectLockingState({locked_state:b,object_id:d.id,object_type:d,parent_type:d.parent.id===c.overview.id?"OVERVIEW":"TOPIC"})})}};g={};Object.defineProperty(g,"__esModule",{value:!0});g.lazyModule={createPlugin(){return new l.LockObjectsPlugin}};return g});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_lock_objects",["require","prezi_cet_model_editor","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_lock_objects.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_utils"));}else{this["prezi_lock_objects"]=__factory(this["prezi_cet_model_editor"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_utils"]);}}).call(this);