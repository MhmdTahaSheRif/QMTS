;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_canvas_listener";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_bacon":dependencies[1],"prezi_editor_store_focus":dependencies[2],"prezi_featureswitcher":dependencies[3],"prezi_uaparser":dependencies[4]}};})());};})(arguments);var moduleImpl=(function(){return module(function(h){var e=h.dependencies.prezi_uaparser,d=h.dependencies.prezi_bacon,l=h.dependencies.prezi_editor_store_focus,x=h.dependencies["prezi.geometry"],t=h.dependencies.prezi_featureswitcher,g={};Object.defineProperty(g,"__esModule",{value:!0});g.j=class{constructor(a){this.xa=a;this.i=d.Bacon.newBus();this.m=d.Bacon.newBus();this.Ta()}qa(a,c,b){const f=d.Bacon.newBus();a.slidingWindow(2,1).onValue((a)=>{if(1===a.length)f.push(a[0]);else{var k=a[0];a=a[1];a.action!==c&&0!==(k.buttons&b)&&
0===(a.buttons&b)?f.push(Object.assign(Object.assign({},a),{action:c})):f.push(a)}});return f}ra(a,c,b){return a.merge(c).skipDuplicates((a,c)=>a.action===c.action).filter((a)=>a.action===b)}pa(a,c){return a.filter(this.Ca(g.j.M)).map(()=>!0).merge(c.map(()=>!1))}Ta(){var a=this.qa(this.xa,b.MouseAction.MouseUp,b.MouseButtons.LEFT),c=this.qa(this.xa,b.MouseAction.MouseRightUp,b.MouseButtons.RIGHT),f=a.filter(this.o(b.MouseAction.MouseMove));const k=a.filter(this.o(b.MouseAction.MouseDown));var n=
a.filter(this.o(b.MouseAction.MouseUp));const d=c.filter(this.o(b.MouseAction.MouseRightDown));var e=c.filter(this.o(b.MouseAction.MouseRightUp));n=this.ra(k,n,b.MouseAction.MouseUp);e=this.ra(d,e,b.MouseAction.MouseRightUp);var p=this.ca(a,b.MouseAction.MouseDown,b.MouseAction.MouseUp),h=this.ca(a,b.MouseAction.MouseUp,b.MouseAction.MouseDown),q=this.ca(c,b.MouseAction.MouseRightDown,b.MouseAction.MouseRightUp),l=this.ca(c,b.MouseAction.MouseRightUp,b.MouseAction.MouseRightDown);p=this.na(f,p.toProperty(!1),
b.MouseInteractionType.DragMove);q=this.na(f,q.toProperty(!1),b.MouseInteractionType.DragMoveRight);const m=this.oa(k,p,b.MouseInteractionType.DragMove);var u=this.oa(d,q,b.MouseInteractionType.DragMoveRight);q=this.pa(m,k);p=this.pa(u,d);const r=this.sa(m,n,q,b.MouseInteractionType.DragEnd);u=this.sa(u,e,p,b.MouseInteractionType.DragEndRight);f=this.K(f.filterWithStream(h.merge(l).toProperty(!0)),b.MouseInteractionType.HoverMove);h=this.K(a.filter(this.o(b.MouseAction.MouseScroll)),b.MouseInteractionType.Scroll);
l=this.La(n,k,m);t.isActive("js-unique-differentiation")?(a=c.scan({w:!1,baseEvent:null},(a,c)=>c.action===b.MouseAction.MouseRightDown||c.action===b.MouseAction.MouseDown?{w:!1,baseEvent:c}:null===a.baseEvent?{w:!1,baseEvent:null}:this.ba(c,a.baseEvent)>=g.j.M?{w:!0,baseEvent:a.baseEvent}:{w:a.w,baseEvent:a.baseEvent}).map((a)=>a.w),c=this.wa(c.filter((a)=>a.action!==b.MouseAction.MouseMove).filterWithStream(a.map((a)=>!a).toProperty(!0)).slidingWindow(3).filter((a)=>3!==a.length||a[0].action!==
b.MouseAction.MouseDown&&a[0].action!==b.MouseAction.MouseRightDown||(a[1].action!==b.MouseAction.ContextMenu||a[2].action!==b.MouseAction.MouseRightUp&&a[2].action!==b.MouseAction.MouseUp)&&(a[2].action!==b.MouseAction.ContextMenu||a[1].action!==b.MouseAction.MouseRightUp&&a[1].action!==b.MouseAction.MouseUp)?!1:!0).map((a)=>a[2]))):c=this.wa(a.filter(this.o(b.MouseAction.ContextMenu)));this.i.plug(c);this.i.plug(l);this.i.plug(r);this.i.plug(f);this.i.plug(h);this.m.plug(q);this.m.plug(n.map(()=>
!1));t.isActive("js-unique-differentiation")&&(this.i.plug(u),this.i.plug(this.K(k,b.MouseInteractionType.MouseDown)),this.i.plug(this.K(n,b.MouseInteractionType.MouseUp)),this.i.plug(this.K(d,b.MouseInteractionType.MouseDownRight)),this.i.plug(this.K(e,b.MouseInteractionType.MouseUpRight)),this.m.plug(p),this.m.plug(e.map(()=>!1)))}ca(a,c,b){return a.filter((a)=>a.action===c||a.action===b).map((a)=>a.action===c)}getMouseInteractionStream(){return this.i}getFocusStream(){return this.m.skipDuplicates()}dispose(){this.i.end()}wa(a){return a.map((a)=>
({type:b.MouseInteractionType.ContextMenu,event:a,baseEvent:null}))}na(a,c,b){return a.filterWithStream(c).map((a)=>({type:b,event:a,baseEvent:null,entities:null}))}K(a,c){return a.map((a)=>({type:c,event:a,baseEvent:null}))}o(a){return function(c){return c.action===a}}oa(a,c,b){return d.Bacon.combineWith((a,c)=>({type:b,event:c.event,baseEvent:a}),a,c).toEventStream().sampledBy(c)}Ja(a){return(c)=>this.ba(c.event,c.baseEvent)<a}Ca(a){return(c)=>this.ba(c.event,c.baseEvent)>=a}ba(a,c){return x.Geometry.distance(a.stagePos,
c.stagePos)}sa(a,c,b,k){a=a.filter(this.Ca(g.j.M));c=c.filterWithStream(b.toProperty(!1));c=a.sampledBy(c).map((a)=>({type:k,event:a.event,baseEvent:a.baseEvent}));return a.merge(c)}ia(a,c){return c.timestamp-a.timestamp>g.j.Ga||this.ba(a.event,c.event)>g.j.M?!1:a.event.shiftKey===c.event.shiftKey}v(a,c){return{type:[null,b.MouseInteractionType.Click,b.MouseInteractionType.DoubleClick,b.MouseInteractionType.TripleClick][c],event:a,baseEvent:null}}Ma(a){return 1===a.length?this.v(a[0].event,1):2===
a.length?this.ia(a[0],a[1])?this.v(a[1].event,2):this.v(a[1].event,1):3===a.length?this.ia(a[1],a[2])?this.ia(a[0],a[1])?this.v(a[2].event,3):this.v(a[2].event,2):this.v(a[2].event,1):null}La(a,c,b){b=b.map(this.Ja(g.j.M)).merge(c.map(()=>!0)).toProperty(!0).skipDuplicates();return c.toProperty(null).sampledBy(a).filter((a)=>null!=a).filterWithStream(b.toProperty()).map((a)=>({event:a,timestamp:(new Date).getTime()})).slidingWindow(3,1).map((a)=>this.Ma(a))}};g.j.Ga=500;g.j.M=t.isActive("js-unique-differentiation")?
5:2;var m={};Object.defineProperty(m,"__esModule",{value:!0});m.Fa=class{constructor(a){this.W=d.Bacon.newBus();this.za=d.Bacon.newBus();this.la=a;this.canvas=a.getCanvas();this.O=a.getCanvasContainer();this.f=this.O.parentElement;this.Da();this.u=(a)=>this.Qa(a);this.Aa=(a)=>this.Ra(a);this.L=(a)=>this.Sa(a);this.N()}dispose(){this.f.removeEventListener("touchstart",this.L,!1);this.f.removeEventListener("touchend",this.L,!1);this.f.removeEventListener("touchmove",this.L,!1);this.f.removeEventListener("mousedown",
this.u,!1);this.f.removeEventListener("wheel",this.Aa,!1);this.O.ownerDocument.removeEventListener("mousemove",this.u,!0);this.O.ownerDocument.removeEventListener("mouseup",this.u,!0)}N(){this.f.addEventListener("touchstart",this.L,!1);this.f.addEventListener("touchend",this.L,!1);this.f.addEventListener("touchmove",this.L,!1);this.f.addEventListener("mousedown",this.u,!1);this.f.addEventListener("wheel",this.Aa,!1);this.f.addEventListener("contextmenu",this.u,!1);this.O.ownerDocument.addEventListener("mousemove",
this.u,!0);this.O.ownerDocument.addEventListener("mouseup",this.u,!0)}Da(){this.ma={x:Math.floor(this.la.getSize().width/2),y:Math.floor(this.la.getSize().height/2)}}ja(a){a=a.target;return!a||a===this.f||a.parentNode===this.f||a.parentNode&&a.parentNode.parentNode===this.f||this.Ya(a)}ga(a,c){if(null==a)switch(c){case 0:return b.MouseButtons.NONE;case 1:return b.MouseButtons.LEFT;case 2:return b.MouseButtons.MIDDLE;case 3:return b.MouseButtons.RIGHT;default:return b.MouseButtons.NONE}else return a}da(a,
b){this.Da();const c=$(this.canvas).offset();return{x:Math.round(a-c.left-this.ma.x),y:Math.round(b-c.top-this.ma.y)}}Na(a){let c;switch(a.type){case "mouseup":c=0===a.button||1===a.which?b.MouseAction.MouseUp:b.MouseAction.MouseRightUp;break;case "mousedown":c=0===a.button||1===a.which?b.MouseAction.MouseDown:b.MouseAction.MouseRightDown;break;case "mousemove":c=b.MouseAction.MouseMove;break;case "contextmenu":c=b.MouseAction.ContextMenu}return{action:c,buttons:this.ga(a.buttons,a.which),stagePos:this.da(a.clientX,
a.clientY),wheelDeltaX:null,wheelDeltaY:null,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,pagePos:{x:a.pageX,y:a.pageY},onCanvas:this.ja(a)}}Oa(a){var c=1===a.deltaMode?16:1;const f=c*a.deltaX*-30;c=c*a.deltaY*-30;return{action:b.MouseAction.MouseScroll,buttons:this.ga(a.buttons,a.which),stagePos:this.da(a.clientX,a.clientY),wheelDeltaX:f,wheelDeltaY:c,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,pagePos:{x:a.pageX,y:a.pageY},onCanvas:this.ja(a)}}Pa(a){let c;
switch(a.type){case "touchend":case "doubletap":c=1===a.which?b.MouseAction.MouseUp:b.MouseAction.MouseRightUp;break;case "touchstart":c=1===a.which?b.MouseAction.MouseDown:b.MouseAction.MouseRightDown;break;case "touchmove":c=b.MouseAction.MouseMove}const f=null!=a.touches&&0<a.touches.length?this.da(a.touches[0].clientX,a.touches[0].clientY):{x:null,y:null};return{action:c,buttons:this.ga(null,a.which),stagePos:f,wheelDeltaX:null,wheelDeltaY:null,altKey:a.altKey,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,
metaKey:a.metaKey,pagePos:{x:null,y:null},onCanvas:this.ja(a)}}Qa(a){const b=this.Na(a);switch(a.type){case "mousedown":a.preventDefault();break;case "contextmenu":a.preventDefault(),a.stopPropagation()}this.W.push(b)}Ra(a){const b=this.Oa(a);t.isActive("js-unique-differentiation")?(a.preventDefault(),a.ctrlKey&&a.stopPropagation(),this.W.push(b),this.za.push(a)):a.ctrlKey?a.stopPropagation():this.W.push(b)}Sa(a){a=this.Pa(a);this.W.push(a)}getMouseStream(){return this.W}Ya(a){let b=!1;for(;;){if(null==
a||!(a instanceof HTMLElement))return!1;const c=a.className;b=b||null!=c&&0<=c.indexOf("gadgetFadeOnHover");if(a===this.f)return b;a=a.parentNode}}};var r={};Object.defineProperty(r,"__esModule",{value:!0});r.Ha=class{constructor(a){this.J=d.Bacon.newBus();a.onValue((a)=>{a?this.N():this.ka()})}N(){$(document).on("keydown.KeyboardListener",(a)=>{this.ta(a)});$(document).on("keyup.KeyboardListener",(a)=>{this.ta(a)})}ka(){$(document).off(".KeyboardListener")}ta(a){a=a?a:window.event;a.keyCode!==b.Key.TAB&&
a.keyCode!==b.Key.ALT||a.preventDefault();this.J.push(a)}getKeyboardEventStream(){return this.J}};var v={};Object.defineProperty(v,"__esModule",{value:!0});v.Ia=class{constructor(a){this.ua=d.Bacon.newBus();this.fa=d.Bacon.newBus();const b=a.filterWithStream(this.fa.toProperty(!1)).bufferWithTime(150).map((a)=>10<a.length).slidingWindow(4,4).map((a)=>a.some((a)=>!0===a)).debounce(50);a=a.filterWithStream(this.fa.toProperty(!1)).map((a)=>{if(e.PreziUAParser.isFirefox()&&(e.PreziUAParser.isWindows()||
e.PreziUAParser.isMac()))return a.deltaMode===WheelEvent.DOM_DELTA_LINE?!1:!0;if("wheelDeltaY"in a&&"wheelDeltaX"in a){var b=a.wheelDeltaY/a.deltaY,c=a.wheelDeltaX/a.deltaX;if(!isNaN(c)||!isNaN(b)){if(e.PreziUAParser.isMac()&&(e.PreziUAParser.isChrome()||e.PreziUAParser.isSafari()))return-3===c||-3===b?!0:!1;if(e.PreziUAParser.isWindows()&&(e.PreziUAParser.isChrome()||e.PreziUAParser.isEdgeChromium()))return-1.2===c||-1.2===b?!1:!0;if(e.PreziUAParser.isLinux()&&(e.PreziUAParser.isChrome()||e.PreziUAParser.isFirefox()))return b=
0===Math.abs(a.wheelDeltaY)%120,0===Math.abs(a.wheelDeltaX)%120||b?!1:!0}}});d.Bacon.combineWith((a,b)=>void 0===a?b:a,a,b).toProperty(!1).skipDuplicates().onValue((a)=>this.ua.push(a))}getIsTouchpadInUseStream(){return this.ua}addDoTouchpadDeciding(a){this.fa.plug(a)}};var w={};Object.defineProperty(w,"__esModule",{value:!0});w.Ea=class{constructor(a,b){this.J=d.Bacon.newBus();this.m=d.Bacon.newBus();this.Ba=d.Bacon.newBus();this.aa=new m.Fa(a);this.ea=new g.j(this.aa.getMouseStream());this.Wa=new r.Ha(b);
this.ya=new v.Ia(this.aa.za);b.onValue((a)=>{a?this.N():this.ka()});let c=null;this.va=d.Bacon.combineWith3((a,b,c)=>({U:a,focusMode:b,Xa:c}),this.J,this.m.toProperty(l.ComponentFocusModeKind.none),this.Ba.toProperty(!1)).sampledBy(this.J).slidingWindow(2,1).map((a)=>{const b=a[a.length-1];1!==a.length&&this.Ka(a[0].U,a[1].U)||(c=b.focusMode);return c===l.ComponentFocusModeKind.none||c===l.ComponentFocusModeKind.canvas||this.Ua(b.U)||b.Xa&&b.focusMode===l.ComponentFocusModeKind.textEditor&&this.Va(b.U)?
b.U:null}).toEventStream().filter((a)=>null!=a)}Ua(a){return void 0!==a.key?"Shift"===a.key||"Meta"===a.key||"Control"===a.key||"Alt"===a.key:a.keyCode===b.Key.SHIFT||a.keyCode===b.Key.CTRL||a.keyCode===b.Key.ALT||a.keyCode===b.Key.MAC_META_LEFT||a.keyCode===b.Key.MAC_META_RIGHT||a.keyCode===b.Key.WIN_META_RIGHT}Va(a){return a.keyCode===b.Key.UP_ARROW||a.keyCode===b.Key.DOWN_ARROW||a.keyCode===b.Key.LEFT_ARROW||a.keyCode===b.Key.RIGHT_ARROW}N(){$(document).on("keydown.CanvasListenerImpl",(a)=>{this.ha(a)});
$(document).on("keypress.CanvasListenerImpl",(a)=>{this.ha(a)});$(document).on("keyup.CanvasListenerImpl",(a)=>{this.ha(a)})}ka(){$(document).off(".CanvasListenerImpl")}ha(a){this.J.push(a?a:window.event)}addComponentFocusStream(a){this.m.plug(a)}addNonEditedTextInFocusStream(a){this.Ba.plug(a)}getKeyboardUpStream(){return this.getKeyboardStream().filter((a)=>"keyup"===a.type)}getKeyboardStream(){return this.va}getKeyboardEventStream(){return this.Wa.getKeyboardEventStream()}getMouseStream(){return this.aa.getMouseStream()}getMouseInteractionStream(){return this.ea.getMouseInteractionStream()}getFocusStream(){return this.ea.getFocusStream()}dispose(){this.aa.dispose();
this.ea.dispose()}getKeyStream(a){return this.va.filter((b)=>("keydown"===b.type||"keyup"===b.type)&&b.keyCode===a).map((a)=>"keydown"===a.type)}getIsTouchpadInUseStream(){return this.ya.getIsTouchpadInUseStream()}addDoTouchpadDeciding(a){this.ya.addDoTouchpadDeciding(a)}Ka(a,c){return a.key!==c.key&&a.keyCode!==c.keyCode&&a.shiftKey!==c.shiftKey&&a.altKey!==c.altKey&&a.metaKey!==c.metaKey&&a.ctrlKey!==c.ctrlKey&&a.code!==c.code?!1:a.type===b.KeyboardEventType.KEYDOWN&&(c.type===b.KeyboardEventType.KEYPRESS||
c.type===b.KeyboardEventType.KEYUP)||a.type===b.KeyboardEventType.KEYPRESS&&(c.type===b.KeyboardEventType.KEYDOWN||c.type===b.KeyboardEventType.KEYUP)?!0:!1}};var b={};Object.defineProperty(b,"__esModule",{value:!0});(function(a){a.MouseUp="MouseUp";a.MouseRightUp="MouseRightUp";a.MouseDown="MouseDown";a.MouseRightDown="MouseRightDown";a.MouseMove="MouseMove";a.MouseScroll="MouseScroll";a.ContextMenu="ContextMenu"})(b.MouseAction||(b.MouseAction={}));(function(a){a.NONE=0;a.LEFT=1;a.RIGHT=2;a.MIDDLE=
4})(b.MouseButtons||(b.MouseButtons={}));(function(a){a.DragMove="DragMove";a.DragEnd="DragEnd";a.DragMoveRight="DragMoveRight";a.DragEndRight="DragEndRight";a.HoverMove="HoverMove";a.Click="Click";a.Scroll="Scroll";a.DoubleClick="DoubleClick";a.TripleClick="TripleClick";a.ContextMenu="ContextMenu";a.MouseDown="MouseDown";a.MouseUp="MouseUp";a.MouseDownRight="MouseDownRight";a.MouseUpRight="MouseUpRight"})(b.MouseInteractionType||(b.MouseInteractionType={}));(function(a){a.BACKSPACE=8;a.TAB=9;a.ENTER=
13;a.SHIFT=16;a.CTRL=17;a.ALT=18;a.ESC=27;a.MAC_META_LEFT=91;a.MAC_META_RIGHT=93;a.WIN_META_RIGHT=92;a.SPACE=32;a.PAGE_UP=33;a.PAGE_DOWN=34;a.END=35;a.HOME=36;a.LEFT_ARROW=37;a.UP_ARROW=38;a.RIGHT_ARROW=39;a.DOWN_ARROW=40;a.DELETE=46;a.AT=64;a.A=65;a.B=66;a.C=67;a.D=68;a.E=69;a.F=70;a.G=71;a.H=72;a.I=73;a.P=80;a.R=82;a.S=83;a.T=84;a.V=86;a.X=88;a.Y=89;a.Z=90;a.a=97;a.b=98;a.F5=116})(b.Key||(b.Key={}));(function(a){a.KEYDOWN="keydown";a.KEYUP="keyup";a.KEYPRESS="keypress"})(b.KeyboardEventType||(b.KeyboardEventType=
{}));(function(a){a[a.SAVE=0]="SAVE";a[a.NEXT_TOPIC=1]="NEXT_TOPIC";a[a.PREVIOUS_TOPIC=2]="PREVIOUS_TOPIC";a[a.POPUP_CLOSE=3]="POPUP_CLOSE";a[a.GO_TO_EDIT_MODE=4]="GO_TO_EDIT_MODE";a[a.SELECT_ALL=5]="SELECT_ALL";a[a.UNDO=6]="UNDO";a[a.REDO=7]="REDO";a[a.STOP_COVEREDITING=8]="STOP_COVEREDITING";a[a.START_COVEREDITING=9]="START_COVEREDITING";a[a.COPY=10]="COPY";a[a.CUT=11]="CUT";a[a.PASTE=12]="PASTE";a[a.CUSTOM=13]="CUSTOM"})(b.ShortcutAction||(b.ShortcutAction={}));(function(a){a.createCanvasListener=
function(a,b){return new w.Ea(a,b)}})(b.CanvasListenerModule||(b.CanvasListenerModule={}));return b});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_canvas_listener",["require","prezi.geometry","prezi_bacon","prezi_editor_store_focus","prezi_featureswitcher","prezi_uaparser"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_canvas_listener.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_bacon"),require("prezi_editor_store_focus"),require("prezi_featureswitcher"),require("prezi_uaparser"));}else{this["prezi_canvas_listener"]=__factory(this["prezi.geometry"],this["prezi_bacon"],this["prezi_editor_store_focus"],this["prezi_featureswitcher"],this["prezi_uaparser"]);}}).call(this);