;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_textstyleprovider";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_logger":dependencies[2],"prezi_plugin_api":dependencies[3],"prezi_service_fontcatalogue":dependencies[4],"prezi_utils":dependencies[5]}};})());};})(arguments);var moduleImpl=(function(){return module(function(f){var p=f.dependencies.prezi_cet_model_editor,B=f.dependencies.prezi_logger,C=f.dependencies.prezi_service_fontcatalogue,y=f.dependencies.prezi_utils,q={},x=this&&q.w||function(a,b,c,d){function g(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,n){function l(a){try{h(d.next(a))}catch(k){n(k)}}function e(a){try{h(d["throw"](a))}catch(k){n(k)}}function h(a){a.done?c(a.value):g(a.value).then(l,e)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(q,
"__esModule",{value:!0});q.v=class{constructor(a){this.service=a}getCustomTextStyles(){return x(this,void 0,void 0,function*(){return yield this.service.read("GET",[],{"custom-font-allowed":"true"})})}saveCustomTextStyle(a){return x(this,void 0,void 0,function*(){return y.Utils.isEmptyString(a.id)?yield this.service.access("POST",[],{},a):yield this.service.access("PUT",[a.id],{},a)})}deleteCustomTextStyle(a){return x(this,void 0,void 0,function*(){return yield this.service.read("DELETE",[a],{})})}};
q.v.baseUrl=["api","v4","usersettings","text_schemes"];var t={},D=this&&t.w||function(a,b,c,d){function g(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function l(a){try{h(d.next(a))}catch(k){e(k)}}function n(a){try{h(d["throw"](a))}catch(k){e(k)}}function h(a){a.done?c(a.value):g(a.value).then(l,n)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});t.la=class{constructor(){this.ja=new Map}get(a,b){return D(this,void 0,
void 0,function*(){var c=this.ja.get(a.fontFamily);if(c)return c;c=this.downloadFont(a,b);this.ja.set(a.fontFamily,c);return c})}isBuiltinFont(a){return C.isBuiltinFont(a)}downloadFont(a,b){let c=b.document.progressiveAssetManager.getFontDescription(a.fontFamily);if(null==c){if(!a.isCustom)throw Error(`Font '${a.fontFamily}' cannot be downloaded`);c=b.document.progressiveAssetManager.createFontDescription(a.fontFamily,a.customKegProperties.normalKeg,a.customKegProperties.boldKeg,a.customKegProperties.italicKeg,
a.customKegProperties.boldItalicKeg)}return b.document.progressiveAssetManager.downloadFont(c)}};var u={},z=this&&u.w||function(a,b,c,d){function g(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function l(a){try{h(d.next(a))}catch(k){e(k)}}function n(a){try{h(d["throw"](a))}catch(k){e(k)}}function h(a){a.done?c(a.value):g(a.value).then(l,n)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0});u.na=class{constructor(a){this.u=
a}drawTextStyleThumbnail(a,b,c){return z(this,void 0,void 0,function*(){var d=A.get(a.fontFamily);d=d?d.ca:"Title";var g=A.get(b.fontFamily);g=g?g.$:"Body text";const e=151.2/g.length;d=yield this.ga(d,a,75.6,48.6,0,Math.min(43.2,189/d.length),!0,c);g=yield this.ga(g,b,86.4,27,54,e,!1,c);return y.Utils.svgToUrl(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0, 0, ${108}, ${108}" width="${108}" height="${108}">
<path d="${d}"/>
<path d="${g}"/>
</svg>`)})}ga(a,b,c,d,g,e,n,m){return z(this,void 0,void 0,function*(){var l=yield this.u.get(b,m);l=yield l.getDrawer(b.hasBold&&l.hasBold?p.base.FontWeight.Bold:p.base.FontWeight.Normal,b.hasItalic&&l.hasItalic?p.base.FontStyle.Italic:p.base.FontStyle.Normal);let h=!1,r=e,k=0;for(var f=0;!h;)f=l.getPath(a,0,0,r).getBoundingBox(),k=Math.abs(f.x2-f.x1),f=Math.abs(f.y2-f.y1),k<c&&f<d?h=!0:(r-=5,0>r&&(r=1,h=!0));return l.getPath(a,(108-k)/2,n?g+54:g+54-(54-f)/2*1.4,r).drawIntoSvgPath()})}};const A=
new Map([{fontFamily:"DFScreenMing-A",ca:"\u6a19\u984c",$:"\u4e3b\u9ad4"},{fontFamily:"NanumGothic",ca:"\uc81c\ubaa9",$:"\ubcf8\ubb38 \ud14d\uc2a4\ud2b8"},{fontFamily:"NotoSansJP",ca:"\u30bf\u30a4\u30c8\u30eb",$:"\u672c\u6587\u30c6\u30ad\u30b9\u30c8"}].map((a)=>[a.fontFamily,a]));var v={};Object.defineProperty(v,"__esModule",{value:!0});v.ka=[{id:"preset-1",fontScheme:{title:{fontFamily:"Arimo",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Arimo",hasBold:!0,hasItalic:!1,hasBackground:!1},
subtitle2:{fontFamily:"Arimo",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-2",fontScheme:{title:{fontFamily:"NotoSans",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"NotoSans",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"NotoSans",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,
hasBackground:!1},body2:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-3",fontScheme:{title:{fontFamily:"WorkSans",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-4",fontScheme:{title:{fontFamily:"Questrial",
hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-5",fontScheme:{title:{fontFamily:"Oswald",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Oswald",hasBold:!1,hasItalic:!1,hasBackground:!1},
subtitle2:{fontFamily:"Oswald",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-6",fontScheme:{title:{fontFamily:"Titillium",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Titillium",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"Titillium",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Titillium",hasBold:!1,
hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Titillium",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-7",fontScheme:{title:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-8",
fontScheme:{title:{fontFamily:"FreeSerif",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"FreeSerif",hasBold:!0,hasItalic:!0,hasBackground:!1},subtitle2:{fontFamily:"FreeSerif",hasBold:!0,hasItalic:!0,hasBackground:!1},body:{fontFamily:"FreeSerif",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"FreeSerif",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-9",fontScheme:{title:{fontFamily:"KGEmpireofDirt",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"KGEmpireofDirt",
hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"KGEmpireofDirt",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-10",fontScheme:{title:{fontFamily:"GreatVibes",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"GreatVibes",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"GreatVibes",hasBold:!1,hasItalic:!1,
hasBackground:!1},body:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-11",fontScheme:{title:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"DFScreenMing-A",
hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-12",fontScheme:{title:{fontFamily:"NanumGothic",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"NanumGothic",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"NanumGothic",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"NanumGothic",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"NanumGothic",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-13",fontScheme:{title:{fontFamily:"NotoSansJP",
hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"NotoSansJP",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"NotoSansJP",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"NotoSansJP",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"NotoSansJP",hasBold:!1,hasItalic:!1,hasBackground:!1}}}].map((a)=>Object.assign(Object.assign({},a),{title:a.id,isCustom:!1}));var e={};Object.defineProperty(e,"__esModule",{value:!0});e.f=class{static ea(a){const {id:b,
title:c,fontScheme:d}=a;a={body:e.f.j(d.body),body2:e.f.j(d.body2),subtitle:e.f.j(d.subtitle),subtitle2:e.f.j(d.subtitle2),title:e.f.j(d.title)};return{id:b,title:c,isCustom:!0,fontScheme:a}}static oa(a){const {id:b,title:c,fontScheme:d}=a;a={body:e.f.i(d.body),body2:e.f.i(d.body2),subtitle:e.f.i(d.subtitle),subtitle2:e.f.i(d.subtitle2),title:e.f.i(d.title)};return{id:b,title:c,fontScheme:a}}static i(a){if(a.isCustom){const b=a.customKegProperties.normalKeg.origin;return Object.assign(Object.assign({},
a),{origin:b,customKegProperties:e.f.qa(a.customKegProperties)})}return{fontFamily:a.fontFamily,hasBackground:a.hasBackground,hasBold:a.hasBold,hasItalic:a.hasItalic,isCustom:!1,origin:"prezi"}}static j(a){var b;return a.isCustom?Object.assign(Object.assign({},a),{customKegProperties:e.f.pa(a.customKegProperties,null!==(b=a.origin)&&void 0!==b?b:"prezi")}):{fontFamily:a.fontFamily,hasBackground:a.hasBackground,hasBold:a.hasBold,hasItalic:a.hasItalic,isCustom:!1}}static pa(a,b){if(null==a)return null;
if("prezi"===b)b=p.base.FontOrigin.prezi;else if("brandKit"===b)b=p.base.FontOrigin.brandKit;else throw Error("Invalid font origin");return{normalKeg:{origin:b,source:a.normalKeg},boldItalicKeg:null!=a.boldItalicKeg?{origin:b,source:a.boldItalicKeg}:null,boldKeg:null!=a.boldKeg?{origin:b,source:a.boldKeg}:null,italicKeg:null!=a.italicKeg?{origin:b,source:a.italicKeg}:null}}static qa(a){if(null==a)return null;const b={normalKeg:a.normalKeg.source};null!=a.boldItalicKeg&&(b.boldItalicKeg=a.boldItalicKeg.source);
null!=a.italicKeg&&(b.italicKeg=a.italicKeg.source);null!=a.boldKeg&&(b.boldKeg=a.boldKeg.source);return b}};var w={},m=this&&w.w||function(a,b,c,d){function g(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function f(a){try{h(d.next(a))}catch(k){e(k)}}function l(a){try{h(d["throw"](a))}catch(k){e(k)}}function h(a){a.done?c(a.value):g(a.value).then(f,l)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(w,"__esModule",{value:!0});w.ma=class{constructor(a){this.u=
new t.la;this.logger=B.LoggerModule.getLoggerManager().createLogger("TextStyleProviderImpl");this.o=a.service(q.v.baseUrl,(a)=>new q.v(a));this.ba=new u.na(this.u)}getPresetTextStyles(a){return m(this,void 0,void 0,function*(){this.da||(this.da=this.aa(v.ka,a).then(()=>this.ha(v.ka,a)));return this.da})}getCustomTextStyles(a){return m(this,void 0,void 0,function*(){var b=yield this.o.getCustomTextStyles();b=this.fa(b);b=yield this.aa(b,a);return this.ha(b,a)})}saveCustomTextStyle(a,b){return m(this,
void 0,void 0,function*(){var c=e.f.oa(a);c=yield this.o.saveCustomTextStyle(c);const d=e.f.ea(c);return this.aa([d],b).then(()=>this.ia(d,b))})}deleteCustomTextStyle(a){return m(this,void 0,void 0,function*(){yield this.o.deleteCustomTextStyle(a.id)})}deleteAllCustomTextStyles(){return m(this,void 0,void 0,function*(){var a=yield this.o.getCustomTextStyles();a=this.fa(a);for(const b of a)yield this.o.deleteCustomTextStyle(b.id)})}isBuiltinFont(a){return this.u.isBuiltinFont(a)}drawTextStyleThumbnail(a,
b,c){return m(this,void 0,void 0,function*(){return yield this.ba.drawTextStyleThumbnail(a,b,c)})}convertFontSchemeToTextStyle(a,b,c,d){return m(this,void 0,void 0,function*(){const g=yield this.ba.drawTextStyleThumbnail(a.title,a.body,d);return{id:b,title:c,fontScheme:a,isCustom:!1,thumbnailUrl:g}})}fa(a){const b=[];for(const c of Object.keys(a)){const d=e.f.ea(a[c]);b.push(d)}return b}aa(a,b){return m(this,void 0,void 0,function*(){const c=new Set,d=new Map;a.forEach((a)=>{d.set(a.fontScheme.title.fontFamily,
a.fontScheme.title);d.set(a.fontScheme.subtitle.fontFamily,a.fontScheme.subtitle);d.set(a.fontScheme.subtitle2.fontFamily,a.fontScheme.subtitle2);d.set(a.fontScheme.body.fontFamily,a.fontScheme.body);d.set(a.fontScheme.body2.fontFamily,a.fontScheme.body2)});for(const a of d.values())try{yield this.u.get(a,b)}catch(l){this.logger.error({action:"failed_to_load_resource",object:"text_style_provider",trigger:"machine",payload:{message:`Error while downloading font '${a.fontFamily}'`,error:l.toString()}}),
c.add(a.fontFamily)}return 0<c.size?a.filter((a)=>!c.has(a.fontScheme.title.fontFamily)&&!c.has(a.fontScheme.subtitle.fontFamily)&&!c.has(a.fontScheme.subtitle2.fontFamily)&&!c.has(a.fontScheme.body.fontFamily)&&!c.has(a.fontScheme.body2.fontFamily)):a})}ha(a,b){return m(this,void 0,void 0,function*(){const c=[];a.forEach((a)=>{a=this.ia(a,b);c.push(a)});return Promise.all(c)})}ia(a,b){return m(this,void 0,void 0,function*(){return this.ba.drawTextStyleThumbnail(a.fontScheme.title,a.fontScheme.body,
b).then((b)=>Object.assign(Object.assign({},a),{thumbnailUrl:b}))})}};f={};Object.defineProperty(f,"__esModule",{value:!0});(function(a){let b;a.getTextStyleProvider=function(a){null==b&&(b=new w.ma(a));return b}})(f.TextStyleProviderModule||(f.TextStyleProviderModule={}));return f});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_textstyleprovider",["require","prezi_cet_model_editor","prezi_featureswitcher","prezi_logger","prezi_plugin_api","prezi_service_fontcatalogue","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_textstyleprovider.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_service_fontcatalogue"),require("prezi_utils"));}else{this["prezi_textstyleprovider"]=__factory(this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_service_fontcatalogue"],this["prezi_utils"]);}}).call(this);