;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_assets";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_cet_renderer":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_editor_error":dependencies[3],"prezi_editor_store_mode":dependencies[4],"prezi_externalassetprovider":dependencies[5],"prezi_featureswitcher":dependencies[6],"prezi_i18n":dependencies[7],"prezi_logger":dependencies[8],"prezi_plugin_api":dependencies[9],"prezi_plugin_meta":dependencies[10],"prezi_replacer":dependencies[11],"prezi_utils":dependencies[12]}};})());};})(arguments);var moduleImpl=(function(){return module(function(v){function W(a){return`<svg xmlns="http://www.w3.org/2000/svg"
				viewBox="${[-60,-60,120,120]}"
				width="${120}" height="${120}">
				${a}
			</svg>`}function aa(a,b,c){b=c/b;return`<rect
		fill="${a}"
		x="${-c/2}"
		y="${-b/2}"
		width="${c}"
		height="${b}"
		/>`}function ba(a,b,c,d,f,l,k,A,ca){if(f)return c.lock({tooltipText:g.I18n.ts("Unlock"),src:{url:b.thumbnail_url},title:null===k||void 0===k?void 0:k.tooltip,onClick:()=>l.dialog.showBuiltIn(e.BuiltinDialog.upgradeLicenseImageSearch)});f=null==k||r.Utils.isEmptyString(k.text)&&r.Utils.isEmptyString(k.tooltip)&&r.Utils.isEmptyString(k.url)?null:k;k=(a)=>{l.setState({selectedItemKey:d});A(a,b)};const h=(a,c)=>{const {mode:d}=l.getState();"replace"===d&&l.setState({mode:"insert",selectedItemKey:null});
ca(a,b,c)};switch(a){case "replace":return c.image({id:d,src:{url:b.thumbnail_url},info:f,onClick:k});case "insert":return c.droppableImage({src:{url:b.thumbnail_url},info:f,onDrop:h});default:r.Utils.assertNever(a)}}var da=v.dependencies.prezi_editor_error,I=v.dependencies.prezi_editor_store_mode,x=v.dependencies.prezi_replacer,B=v.dependencies.prezi_cet_model_editor,J=v.dependencies.prezi_featureswitcher,g=v.dependencies.prezi_i18n,h=v.dependencies.prezi_logger,e=v.dependencies.prezi_plugin_api,
R=v.dependencies.prezi_cet_renderer,q=v.dependencies.prezi_editor_commander,m=v.dependencies.prezi_plugin_meta,P=v.dependencies.prezi_externalassetprovider,r=v.dependencies.prezi_utils,M={generateFixedAspectImageUrl:function(a){return{url:r.Utils.svgToUrl(W(aa("#929AA3",a,100)))}},generateCustomAspectImageUrl:function(){return{url:r.Utils.svgToUrl(W('<rect\n\t\tstroke="#929AA3"\n\t\tstroke-width="2"\n\t\tstroke-dasharray="3"\n\t\tstroke-dashoffset="1"\n\t\tstroke-linejoin="round"\n\t\tstroke-linecap="butt"\n\t\tfill="#ffffff"\n\n\t\tx="-50"\n\t\ty="-50"\n\t\twidth="100"\n\t\theight="100"\n\t\t/>'))}}};
Object.defineProperty(M,"__esModule",{value:!0});var C={createImageListInitialState:function(){return{mode:"insert",selectedItemKey:null}}};Object.defineProperty(C,"__esModule",{value:!0});var S;(function(a){a.two_column="two_column";a.three_column="three_column"})(S=C.ListLayout||(C.ListLayout={}));C.createImageList=function(a){const {listLayout:b,sidebarUi:c,triggerPaywall:d,images:f,shouldRequestAdditionalItems:l,progress:k,uiRoot:A,getImageInfo:g}=a,{mode:h,selectedItemKey:X}=A.getState();let m;
switch(b){case S.two_column:m={itemLayout:e.ListItemLayout.dynamic,itemType:e.ListItemType.large};break;case S.three_column:m={itemLayout:e.ListItemLayout.fixed,itemType:e.ListItemType.small};break;default:r.Utils.assertNever(b)}return[c.simpleList((b)=>Object.assign(Object.assign({id:"asset-list",activeId:X,items:null!=f?f.map((c,l)=>{var f=c.url;f=null!=f?f.substring(Math.max(0,f.length-32),f.length):null;return ba(h,c,b,`${l}-${f}`,d,A,g(c),a.replace,a.insert)}):[]},m),{requestAdditionalItems:a.requestAdditionalItems,
progress:l?k:null,flexGrow:l?1:null}))]};var u={},T=this&&u.__awaiter||function(a,b,c,d){function f(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,k){function l(a){try{g(d.next(a))}catch(t){k(t)}}function e(a){try{g(d["throw"](a))}catch(t){k(t)}}function g(a){a.done?c(a.value):f(a.value).then(l,e)}g((d=d.apply(a,b||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0});var H;(function(a){a.fullFeature="fullFeature";a.searchButNoInsert="searchButNoInsert";
a.noSearch="noSearch"})(H=u.PaywallFeatures||(u.PaywallFeatures={}));class ea{constructor(a,b,c,d,f,l,k,e,g,h){this.headerText=a;this.logSearch=b;this.listLayout=c;this.searchAssetProvider=d;this.getImageInfo=f;this.replace=l;this.insert=k;this.getSearchState=e;this.setSearchState=g;this.filterArgs=h}static createInitialState(a=null){return{term:null,page:0,images:[],hasError:!1,searchText:"",recommendedImages:null,progress:e.ListProgress.idle,features:H.noSearch,selectedFilter:a}}setPaywallFeatures(a){this.setSearchState({features:a})}canUserSearch(a){switch(a){case H.fullFeature:case H.searchButNoInsert:return!0;
case H.noSearch:return!1;default:r.Utils.assertNever(a)}}init(a){const b=this.getSearchState();!b.recommendedImages&&this.canUserSearch(b.features)&&this.searchForImages(a)}createSearchUI(a,b){const c=g.I18n.ts("Search..."),d=(a,c)=>{this.canUserSearch(this.getSearchState().features)?this.searchForImages(b,c,0,this.getSearchState().selectedFilter):b.dialog.showBuiltIn(e.BuiltinDialog.upgradeLicenseImageSearch)};return[a.sectionHeader({content:this.headerText}),a.searchField({id:"search-input-field",
onSearchButtonClick:(a)=>d(a,this.getSearchState().searchText),onEnter:(a)=>d(a,this.getSearchState().searchText),onValueChange:(a,b)=>{this.setSearchState({searchText:b});r.Utils.isEmptyString(b)&&this.canUserSearch(this.getSearchState().features)&&d(a,null)},placeholderText:c,value:this.getSearchState().searchText,autofocus:b.getState().autoOpen}),this.createFilter(b,a),...this.createResultList(a,this.getSearchState(),b)]}createFilter(a,b){if(null==this.filterArgs)return null;const {selectedFilter:c}=
this.getSearchState(),d=[];this.filterArgs.labels.forEach((a,b)=>d.push({id:b,title:a}));return b.containerWithColoredBackground({content:[b.dropdown({id:"icon-filter-select",activeId:c,options:d,onChange:(b,c)=>T(this,void 0,void 0,function*(){this.filterArgs.onFilterChange(c);this.searchForImages(a,this.getSearchState().term,0,c)})})]})}createResultList(a,b,c){if(this.getSearchState().features===H.noSearch)return[];const d=[];if(b.progress!==e.ListProgress.working||0!==b.page)null!=b.term?d.push(a.sectionHeader({content:g.I18n.ts("Results")})):
d.push(a.sectionHeader({content:g.I18n.ts("Recommended")}));return d.concat(this.createImageResult(a,c,b.images,!0))}createImageResult(a,b,c,d){const {term:f,progress:l,hasError:k,features:A,selectedFilter:h}=this.getSearchState();return k?this.createErrorResult(a,()=>{this.searchForImages(b,f,0,h)}):this.shouldNoResultBeShown()?[a.illustration(g.I18n.ts("No results"),e.IllustrationLargeLightId.NoResults)]:[...C.createImageList({sidebarUi:a,triggerPaywall:null!=f&&A===H.searchButNoInsert,images:c,
shouldRequestAdditionalItems:d,listLayout:this.listLayout,progress:l,getImageInfo:(a)=>this.getImageInfo(a),insert:(a,b,c)=>this.insert(a,b,c),replace:(a,b)=>this.replace(a,b),uiRoot:b,requestAdditionalItems:()=>this.requestAdditionalItems(b)})]}createErrorResult(a,b){return[a.illustration(g.I18n.ts("Something went wrong"),e.IllustrationLargeLightId.Error),a.button(e.ButtonSize.Small,e.ButtonAlign.Center,(a)=>[a.button({id:"image-search-try-again",color:e.ButtonColor.Ghost,content:{text:g.I18n.ts("Try again")},
onClick:b})])]}shouldNoResultBeShown(){const {progress:a,images:b}=this.getSearchState();return a===e.ListProgress.working?!1:null==b||0===b.length}requestAdditionalItems(a){return T(this,void 0,void 0,function*(){const {term:b,page:c,selectedFilter:d}=this.getSearchState();this.searchForImages(a,b,c+1,d)})}searchForImages(a,b=null,c=0,d=null){return T(this,void 0,void 0,function*(){b=null!=b?b.trim():null;const {recommendedImages:f,images:l,selectedFilter:k}=this.getSearchState();var A=0===c?[]:
l;this.setSearchState({term:b,page:c,images:A,progress:e.ListProgress.working,hasError:!1});a.setState({selectedItemKey:null});let g,h=!1;try{r.Utils.isEmptyString(b)?null!=f&&0<f.length&&0===c&&d===k?g=f:(g=(yield this.searchAssetProvider.getDefaultAssets(c,d)).assets,0===c&&this.setSearchState({recommendedImages:g})):(this.logSearch(b),g=(yield this.searchAssetProvider.searchAssets(b,c,d)).assets)}catch(X){h=!0,g=[]}A=A.concat(g);this.setSearchState({images:A,progress:0===g.length?e.ListProgress.finished:
e.ListProgress.idle,hasError:h,selectedFilter:d})})}}u.SearchComponent=ea;var n={};Object.defineProperty(n,"__esModule",{value:!0});var N;(function(a){a.All="all";a.BlueUi="blueui";a.CircleBubbles="circlebubbles";a.Color="color";a.CuteColor="cutecolor";a.Doodle="doodle";a.Filled="filled";a.Infographic="infographic";a.Outlined="outlined"})(N=n.IconStyle||(n.IconStyle={}));var U;(function(a){a.ICONS8="icons8";a.PREZI="prezi"})(U=n.IconProviders||(n.IconProviders={}));var K;(function(a){a.general="general";
a.search="search"})(K||(K={}));class fa{constructor(a,b){this.hasIconLicense=b;this.mapIcons8Assets=(a)=>({url:a.url,style:a.style,provider:U.ICONS8,isPremium:a.is_premium,thumbnail_url:a.thumbnail_url,loggingName:a.logging_name,originalId:a.id});this.mapPreziIconsAssets=(a)=>({url:a.url,provider:U.PREZI,isPremium:!1,thumbnail_url:a.thumbnail_url,style:N.Color,loggingName:a.logging_name});this.iconDataCache=null;this.icons8Service=a.service(["api","v1","assets","icons8"],(a)=>({getFreeIcons(){return a.read("GET",
[],{})},searchIcons(b,c){return a.read("GET",[],{term:b,limit:"1000",styles:"filled,outlined,color,blueui,infographic,circlebubbles,doodle,cutecolor",license:c?"paid":"free"})}}));this.preziIconsService=a.service(["api","v1","assets","prezi-icons"],(a)=>({getAllIcons(){return a.read("GET",[],{limit:"1000"})},searchIcons(b){return a.read("GET",[],{term:b,limit:"1000"})}}))}setHasIconLicense(a){this.hasIconLicense=a}getPage(a,b){return b.slice(50*a,50*(a+1))}getDefaultAssets(a,b){return null==this.iconDataCache||
this.iconDataCache.kind!==K.general||this.iconDataCache.filterStyle!==b?this.getDefaultAssetsI(b).then((c)=>{this.iconDataCache={kind:K.general,iconDatas:c,filterStyle:b};return{assets:this.getPage(a,c)}}):Promise.resolve({assets:this.getPage(a,this.iconDataCache.iconDatas)})}getDefaultAssetsI(a){const b=this.icons8Service.getFreeIcons().then((a)=>a.assets.map(this.mapIcons8Assets).sort(this.sortFilledIconFirst)).catch(()=>null),c=this.preziIconsService.getAllIcons().then((a)=>a.assets.map(this.mapPreziIconsAssets)).catch(()=>
null);return this.getAssets(b,c,a)}searchAssets(a,b,c){return null==this.iconDataCache||this.iconDataCache.kind!==K.search||this.iconDataCache.term!==a||this.iconDataCache.filterStyle!==c?this.searchAssetsI(a,c).then((d)=>{this.iconDataCache={kind:K.search,term:a,iconDatas:d,filterStyle:c};return{assets:this.getPage(b,d)}}):Promise.resolve({assets:this.getPage(b,this.iconDataCache.iconDatas)})}searchAssetsI(a,b){const c=this.icons8Service.searchIcons(a,this.hasIconLicense).then((a)=>a.assets.map(this.mapIcons8Assets)).catch(()=>
null);a=this.preziIconsService.searchIcons(a).then((a)=>a.assets.map(this.mapPreziIconsAssets)).catch(()=>null);return this.getAssets(c,a,b)}getAssets(a,b,c){return new Promise((d,f)=>Promise.all([a,b]).then((a)=>{null==a[0]&&null==a[1]&&f("Both icons8 icons and prezi icons requests failed.");a=[...null!=a[0]?a[0]:[],...null!=a[1]?a[1]:[]];null==c||c===N.All?d(a):d(a.filter((a)=>a.style===c))}))}sortFilledIconFirst(a,b){a=a.style===N.Filled;b=b.style===N.Filled;return a&&!b?-1:!a&&b?1:0}}n.IconProvider=
fa;var D={initialPdfAssetListState:function(){return{selectedListIds:[],pdfThumbnails:[],pdfResults:[],pdfListProgress:e.ListProgress.finished}}},ha=this&&D.__awaiter||function(a,b,c,d){function f(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,k){function l(a){try{g(d.next(a))}catch(t){k(t)}}function e(a){try{g(d["throw"](a))}catch(t){k(t)}}function g(a){a.done?c(a.value):f(a.value).then(l,e)}g((d=d.apply(a,b||[])).next())})};Object.defineProperty(D,"__esModule",
{value:!0});D.pdfAssetListPageId="pdfAssetListPageId";D.PdfAssetListPage=class{constructor(a,b,c){this.uiRoot=a;this.session=b;this.controller=c}createPage(a,b){return{title:g.I18n.ts("Pages"),content:[a.multiSelectList((a)=>({itemType:e.ListItemType.numbered,itemLayout:e.ListItemLayout.dynamic,selectedIds:b.selectedListIds,onSelectionChange:(a)=>this.uiRoot.setState({selectedListIds:a.selectedIds}),items:b.pdfThumbnails.map((b,c)=>a.droppableImage({id:`${c}`,src:{url:b},dataLookup:`pdf-slide-thumbnail-${c}`})),
requestAdditionalItems:()=>ha(this,void 0,void 0,function*(){var a=b.pdfThumbnails.length;const c=Math.min(a+10,b.pdfResults.length);a>=c?this.uiRoot.setState({pdfListProgress:e.ListProgress.finished}):(this.uiRoot.setState({pdfListProgress:e.ListProgress.working}),a=b.pdfResults.slice(a,c).map((a)=>a.pdfPageInfo.thumbnail()),a=b.pdfThumbnails.concat(yield Promise.all(a)),this.uiRoot.setState({pdfListProgress:b.pdfResults.length<=a.length?e.ListProgress.finished:e.ListProgress.idle,pdfThumbnails:a}))}),
flexGrow:1,progress:b.pdfListProgress,onDrop:(a,c)=>{this.session.document.executeApiCommand(a,{name:"drop",run:(d)=>{const f=c.draggedIds.map((a)=>b.pdfResults[parseInt(a,10)].pdfAsset);this.controller.bulkInsertPdfAssets(a,d,f,c.stageX,c.stageY).forEach((a)=>h.avro.Avro.createDefaultLogger().logInsertPdfPage({object_id:a,insert_method:"DRAG"}));this.uiRoot.setState({mode:"insert"})}})}})),a.separator(),a.button(e.ButtonSize.Small,e.ButtonAlign.Center,(a)=>[a.button({id:"insert-all-pages-button",
color:e.ButtonColor.Ghost,content:{text:g.I18n.ts("Insert all pages")},onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"insert all pages",run:(c)=>{h.avro.Avro.createDefaultLogger().logInsertAllPdfPages();const d=b.pdfResults.map((a)=>a.pdfAsset);this.controller.bulkInsertPdfAssets(a,c,d,null,null);this.uiRoot.setState({mode:"insert"})}})}})])]}}};var L={};Object.defineProperty(L,"__esModule",{value:!0});var O;(function(a){a.pdf="pdf";a.icon="icon"})(O=L.InsertPdfOrIconKind||(L.InsertPdfOrIconKind=
{}));class ia{constructor(a,b){this.session=a;this.uiRoot=b;this.logger=h.LoggerModule.getLoggerManager().createLogger("ImageInsertPlugin")}insertAsset(a,b,c,d,f){"application/pdf"===this.getMimeType(b)?this.insertPdfOrIcon(a,{stageX:c,stageY:d},b,O.pdf):this.insertImageFromURLOrFile(a,b,c,d,f,p.ImageSourceType.unknown)}insertImageFromURLOrFile(a,b,c,d,f,l){return this.session.document.executeApiCommand(a,{name:"insert image",run:(k)=>{const e=this.session.insertTarget.getSimpleObjectParent(k),g=
this.session.positionFinder.findLayoutBox(e,42,42,c,d),m=this.uploadAsset(b,l),n=m.asset,t=n.token.kind===B.base.AssetKind.animatedImage?e.add.animatedImage(n.token):n.token.kind===B.base.AssetKind.image?e.add.image(n.token):r.Utils.assertNever(n.token);t.fitInto(g);h.avro.Avro.createDefaultLogger().logNewObject({object_type:t,topic_relationship:t,parent_type:e.is(B.base.ObjectKind.overview)?"OVERVIEW":"TOPIC",object_id:t.id});this.uiRoot.setState({maskImageButtonState:p.ButtonState.hidden});this.session.selection.setSelection(a,
[t]);h.avro.Avro.createDefaultLogger().logInsertImage({image_type:m.imageTypeForLog,image_destination:"CANVAS",image_source:f});const q=k.intent.userIntentId;k=n.finished;k.then((a)=>{this.logger.info({action:"media_insert",object:"media",trigger:"machine",payload:Object.assign(Object.assign({},a),{type:"IMAGE",user_intent_id:q,duration:0})})}).catch(()=>{});return k}})}replaceAsset(a,b,c){"application/pdf"===this.getMimeType(b)?this.replacePdf(a,b):this.replaceImageFromURLOrFile(a,b,c,p.ImageSourceType.unknown)}replaceImageFromURLOrFile(a,
b,c,d){const {replaceable:f}=this.uiRoot.getState();if(f.kind===x.ReplaceableKind.none)return this.logger.error({action:"replace",object:"image",trigger:"machine",payload:{error:"not a replacable object (image, anitated image, pdf, swf) is selected"}}),Promise.reject("Invalid selection");const l=this.uploadAsset(b,d);b=l.asset;const k=b.token;d=this.session.document.executeApiCommand(a,{name:"Replace Image",run:(a)=>{const b=f.kind===x.ReplaceableKind.image&&a.lookup.resolve(f.ref).isPlaceholder?
f.ref:null;x.replaceObject(a,f,k.kind===B.base.AssetKind.animatedImage?{kind:x.ReplaceKind.animatedImage,source:x.ReplaceSource.asset,asset:k}:{kind:x.ReplaceKind.image,source:x.ReplaceSource.asset,asset:k});h.avro.Avro.createDefaultLogger().logInsertImage({image_type:l.imageTypeForLog,image_destination:"CANVAS",image_source:c});return b}});this.uiRoot.setState({selectedPlaceholder:p.SelectedPlaceholder.nonPlaceholder});null!=d&&this.toggleMaskEditing(d,!0,a);return b.finished}isImageBeingMasked(a,
b){a=a.toDecorator(b);b=R.CetRendererModule.getImageMaskEditingStateComponentKey();return a.get(b)}insertIcon(a,b,c){h.avro.Avro.createDefaultLogger().logInsertSymbol({asset_name:c.loggingName,asset_oid:c.loggingName,asset_provider:c.provider===n.IconProviders.ICONS8?"ICONS_EIGHT":"PREZI_ICONS",premium_content_flag:c.isPremium,symbol_source:b.dropKind===e.DropKind.click?"SINGLE_CLICK":"DRAG_DROP"});return this.insertPdfOrIcon(a,b,c.url,O.icon)}replaceIcon(a,b){h.avro.Avro.createDefaultLogger().logInsertSymbol({asset_name:b.loggingName,
asset_oid:b.loggingName,asset_provider:b.provider===n.IconProviders.ICONS8?"ICONS_EIGHT":"PREZI_ICONS",premium_content_flag:b.isPremium,symbol_source:"SINGLE_CLICK"});this.replacePdf(a,b.url)}replacePdf(a,b){this.session.document.executeApiCommand(a,{name:"replace icon",run:(a)=>{const c=this.uiRoot.getState().replaceable;if(c.kind!==x.ReplaceableKind.none){var f=this.session.document.progressiveAssetManager.uploadPdf(b),l=a.lookup.resolve(c.ref),k=h.LoggerModule.getAvroLoggerHelper(),e=l.id,g=k.getLogObjectType(l);
l=k.getLogTopicRelationship(l);x.replaceObject(a,c,{kind:x.ReplaceKind.pdf,source:x.ReplaceSource.asset,asset:f.token});h.avro.Avro.createDefaultLogger().logModifiedObject({modify_action:"REPLACE",object_id:e,object_type:g,topic_relationship:l});this.openPdfAssetPageIfNeeded(f.finished)}}})}insertPdfI(a,b,c,d,f){c=c.add.pdf(b);c.fitInto(d);h.avro.Avro.createDefaultLogger().logNewObject({object_type:c,topic_relationship:c,parent_type:c,object_id:c.id});this.logger.info({action:"create",object:"pdf",
trigger:"machine",payload:{user_intent_id:a.intent.userIntentId,object_id:c.id,page_number:b.page,length_in_pages:f}});return c}insertPdfOrIcon(a,b,c,d){const f=this.session.document.executeApiCommand(a,{name:"insert icon",run:(d)=>{const f=this.session.document.progressiveAssetManager.uploadPdf(c),l=this.session.insertTarget.getSimpleObjectParent(d),e=this.session.positionFinder.findLayoutBox(l,42,42,b.stageX,b.stageY);d=this.insertPdfI(d,f.token,l,e,1);this.session.selection.setSelection(a,[d]);
return{id:d.id,finished:f.finished}}});switch(d){case O.pdf:f.finished.then((a)=>h.avro.Avro.createDefaultLogger().logInsertPdf({object_id:f.id,pdf_page_count:a.length}));break;case O.icon:break;default:r.Utils.assertNever(d)}this.openPdfAssetPageIfNeeded(f.finished);return f.id}openPdfAssetPageIfNeeded(a){a.then((a)=>{if(1<a.length){this.uiRoot.setState({pdfThumbnails:[],pdfResults:a,pdfListProgress:e.ListProgress.working,activePageId:D.pdfAssetListPageId,selectedListIds:[]});this.uiRoot.sidebar.open(p.AssetInsertSidebarId,
D.pdfAssetListPageId);const b=a.slice(0,Math.min(10,a.length));Promise.all(b.map((a)=>a.pdfPageInfo.thumbnail())).then((b)=>{this.uiRoot.setState({pdfListProgress:a.length<=b.length?e.ListProgress.finished:e.ListProgress.idle,pdfThumbnails:b})})}})}bulkInsertPdfAssets(a,b,c,d,f){const l=this.session.insertTarget.getSimpleObjectParent(b);d=this.session.positionFinder.findLayoutBoxes(l,c.map(()=>({width:42,height:42})),d,f).map((a,d)=>this.insertPdfI(b,c[d],l,a,c.length));this.session.selection.setSelection(a,
d);return d.map((a)=>a.id)}getMimeType(a){return"string"===typeof a?r.Utils.getMimeTypeFromExtension((new URL(a)).pathname):a.type}uploadAsset(a,b){switch(b){case p.ImageSourceType.gif:return{asset:this.session.document.progressiveAssetManager.uploadAnimatedImage(a),imageTypeForLog:"GIF"};case p.ImageSourceType.sticker:return{asset:this.session.document.progressiveAssetManager.uploadAnimatedImage(a),imageTypeForLog:"STICKER"};case p.ImageSourceType.image:return{asset:this.session.document.progressiveAssetManager.uploadImage(a),
imageTypeForLog:"IMAGE"};case p.ImageSourceType.unknown:return"image/gif"===this.getMimeType(a)?{asset:this.session.document.progressiveAssetManager.uploadAnimatedImage(a),imageTypeForLog:"USER_ANIMATED_IMAGE"}:{asset:this.session.document.progressiveAssetManager.uploadImage(a),imageTypeForLog:"USER_IMAGE"};default:r.Utils.assertNever(b)}}toggleMaskEditing(a,b,c){const d=this.session.document.read((c)=>{const d=c.lookup.resolve(a);return d.is(B.base.ObjectKind.image)?this.getNewMaskingMode(d,this.isImageBeingMasked(c,
d),b):{kind:I.MaskingModeKind.off}});this.session.document.executeApiCommand(c,{name:"set-masking-in-progress",run:(c)=>{var d=c.lookup.resolve(a);if(d.is(B.base.ObjectKind.image)){c=c.toDecorator(d);d=R.CetRendererModule.getImageMaskEditingStateComponentKey();var f=c.get(d);f=null==f?!0:!f;c.set(d,f);f?this.uiRoot.setState({maskImageButtonState:p.ButtonState.checked}):this.uiRoot.setState({maskImageButtonState:p.ButtonState.enabled});f&&h.avro.Avro.createDefaultLogger().logOpenImageMaskingMode(b?
{open_image_masking_source:"PLACEHOLDER_ICON"}:{open_image_masking_source:"EDIT_MASK"})}}});const f=this.session.applicationMode.editMode;f.isActive()&&(d.kind===I.MaskingModeKind.off?f.setNormalMode(c):f.setMaskEditingMode(c,d.maskedImageId,d.target,d.isFixedAspect))}getNewMaskingMode(a,b,c){if(!0===b)return{kind:I.MaskingModeKind.off};b=this.uiRoot.getState().maskAspectRatiosByObjectIds.get(a.id);return{kind:I.MaskingModeKind.on,maskedImageId:a.id,target:!c&&this.isFullImageMasked(a)?I.MaskEditTarget.mask:
I.MaskEditTarget.image,isFixedAspect:null!=b&&b!==q.MaskAspectRatio.custom}}isFullImageMasked(a){const b=a.imageAsset;a=a.mask;return 2>Math.abs(b.width-a.width)&&2>Math.abs(b.height-a.height)}}L.AssetController=ia;var Q={},Y=this&&Q.__awaiter||function(a,b,c,d){function f(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function l(a){try{g(d.next(a))}catch(t){e(t)}}function k(a){try{g(d["throw"](a))}catch(t){e(t)}}function g(a){a.done?c(a.value):f(a.value).then(l,
k)}g((d=d.apply(a,b||[])).next())})};Object.defineProperty(Q,"__esModule",{value:!0});Q.ImageEffectsServiceProvider=class{constructor(a){this.imageBackgroundRemovalService=a.service(["api","v1","prezigram","removeImageBackgroundURL"],(a)=>({removeBackground(b){return Y(this,void 0,void 0,function*(){return J.isActive("js-for-test-prezidomain-image-background-removal-error")?a.access("POST",[],{},{url:"testURL_forError.jpg"}):a.access("POST",[],{},{url:b})})}}))}getImageWithRemovedBackground(a){return Y(this,
void 0,void 0,function*(){return this.imageBackgroundRemovalService.removeBackground(a).then((a)=>a.url)})}};var p={},Z=this&&p.__awaiter||function(a,b,c,d){function f(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function k(a){try{g(d.next(a))}catch(t){e(t)}}function l(a){try{g(d["throw"](a))}catch(t){e(t)}}function g(a){a.done?c(a.value):f(a.value).then(k,l)}g((d=d.apply(a,b||[])).next())})};Object.defineProperty(p,"__esModule",{value:!0});var G=B.base.ObjectKind,
ja=B.base.isRefInstanceOf,w;(function(a){a.hidden="hidden";a.disabled="disabled";a.enabled="enabled";a.checked="checked"})(w=p.ButtonState||(p.ButtonState={}));var E;(function(a){a.image="image";a.gif="gif";a.sticker="sticker";a.unknown="unknown"})(E=p.ImageSourceType||(p.ImageSourceType={}));var F;(function(a){a.noShow="noShow";a.showImage="showImage";a.showGif="showGif";a.showIcon="showIcon"})(F||(F={}));const ka=new Map([[n.IconStyle.All,g.I18n.ts("All categories")],[n.IconStyle.BlueUi,g.I18n.ts("Blue UI")],
[n.IconStyle.CircleBubbles,g.I18n.ts("Circle Bubbles")],[n.IconStyle.Color,g.I18n.ts("Color")],[n.IconStyle.CuteColor,g.I18n.ts("Cute Color")],[n.IconStyle.Doodle,g.I18n.ts("Doodle")],[n.IconStyle.Filled,g.I18n.ts("Filled")],[n.IconStyle.Infographic,g.I18n.ts("Infographic")],[n.IconStyle.Outlined,g.I18n.ts("Outlined")]]);var z;(function(a){a[a.placeholder=0]="placeholder";a[a.nonPlaceholder=1]="nonPlaceholder";a[a.none=2]="none"})(z=p.SelectedPlaceholder||(p.SelectedPlaceholder={}));p.AssetInsertSidebarId=
"sidebar-asset-insert";class y{constructor(){this.imageMaskingCommander=q.EditorCommander.createImageMaskingCommander()}processMessage(a){this.openAssetSidebar(a.insertMode,a.activeTabId,!1)}init(a){this.externalAssetProvider=P.ExternalAssetProviderModule.getExternalAssetProvider(a);this.imageEffectServiceProvider=new Q.ImageEffectsServiceProvider(a);this.replacableTracker=x.createReplacableTracker(a,this.session);this.createAssetSearchComponents(a);a.onURLDrop((a,{data:c,stageX:d,stageY:f})=>{c=
c.url;return-1<["jpg","jpeg","gif","png","pdf"].indexOf(c.pathname.split(".").pop().toLowerCase())?(this.controller.insertAsset(a,c.toString(),d,f,"DRAG_DROP"),!0):!1});a.onFileDrop({allowImage:!0,allowPdf:!0},(a,{data:c,stageX:d,stageY:f})=>Z(this,void 0,void 0,function*(){this.controller.insertAsset(a,c.file,d,f,c.source)}));a.onLicenseChange((a)=>this.handleLicenceChange(a));a.onNetworkStatusChange((a)=>{this.uiRoot.setState({networkStatus:a})});this.uiRoot=a.declareUI(Object.assign(Object.assign({sidebarOpen:!1,
selection:[],mode:"insert",selectedItemKey:null,showReplaceImage:F.noShow,selectedPlaceholder:z.none,maskImageButtonState:w.hidden,maskAspectRatiosByObjectIds:new Map,networkStatus:e.NetworkStatus.Online,imageSearchState:u.SearchComponent.createInitialState(),gifSearchState:u.SearchComponent.createInitialState(),stickerSearchState:u.SearchComponent.createInitialState(),iconSearchState:u.SearchComponent.createInitialState(n.IconStyle.All),hasIconLicense:!1,autoOpen:!1,activeSearchComponent:null,replaceable:{kind:x.ReplaceableKind.none}},
D.initialPdfAssetListState()),{activePageId:null,backgroundRemovalButtonState:w.hidden}),(a,c)=>{this.createInsertContextMenuItem(c,a);this.createTopBarMenuItems(c);c.createSidebar(p.AssetInsertSidebarId,(a)=>this.createSidebar(a));this.createUploadPdfFileDialog(c);this.createImageSpecificButtons(a,c);this.createReplaceAssetButtonsMenuItems(a,c);this.createSetPlaceholderMenuItem(c)});this.controller=new L.AssetController(this.session,this.uiRoot);this.pdfAssetListPage=new D.PdfAssetListPage(this.uiRoot,
this.session,this.controller);this.replacableTracker.onReplaceableChange((a)=>{this.handleReplaceableChange(a)});a.onSelectionChange((a)=>{this.handleSelectionChange(a)});a.onDocumentChange(()=>{this.setImageSpecificOnSelectionChange()})}handleReplaceableChange(a){switch(a.kind){case x.ReplaceableKind.image:this.uiRoot.setState({showReplaceImage:F.showImage,replaceable:a});break;case x.ReplaceableKind.animatedImage:this.uiRoot.setState({showReplaceImage:F.showGif,replaceable:a});break;case x.ReplaceableKind.pdf:this.uiRoot.setState({showReplaceImage:F.showIcon,
replaceable:a});break;case x.ReplaceableKind.none:this.uiRoot.setState({showReplaceImage:F.noShow,replaceable:a});break;default:r.Utils.assertNever(a)}}handleSelectionChange(a){const b=a.allObjects,{mode:c}=this.uiRoot.getState(),d=this.getSelectedPlaceholder(b);"replace"===c&&this.uiRoot.sidebar.close(p.AssetInsertSidebarId);this.uiRoot.setState({mode:"insert",selection:b,selectedItemKey:null,selectedPlaceholder:d});this.setImageSpecificOnSelectionChange();this.handleSetPlaceholderOnSelectionChange(d,
a)}setImageSpecificOnSelectionChange(){const {selection:a,maskAspectRatiosByObjectIds:b}=this.uiRoot.getState();let c={backgroundRemovalButtonState:w.hidden,maskImageButtonState:w.hidden};1===a.length?this.session.document.read((d)=>{const f=d.lookup.resolve(a[0]);if(f.is(B.base.ObjectKind.image)&&!f.locked){let c=w.disabled;this.controller.isImageBeingMasked(d,f)?c=w.checked:f.isPlaceholder||(c=w.enabled);this.uiRoot.setState({maskImageButtonState:c,maskAspectRatiosByObjectIds:b.has(a[0].id)?b:(new Map(b)).set(a[0].id,
q.MaskAspectRatio.custom),backgroundRemovalButtonState:null==f.imageAsset.url||f.isPlaceholder?w.disabled:w.enabled})}else this.uiRoot.setState(c)}):this.uiRoot.setState(c)}handleSetPlaceholderOnSelectionChange(a,b){if(a===z.placeholder){a=m.ActiveTabId.image;b=b.allObjects[0].kind;if(b===G.pdf||b===G.swf)a=m.ActiveTabId.icon;this.openAssetSidebar("replace",a,!0)}}handleLicenceChange(a){let b;b=J.isActive("js-image-insert-plugin-force-paywall")?!1:a.featureSet.pitchImageIntegration;a=J.isActive("js-icon-insert-plugin-force-paywall")?
!1:a.featureSet.pitchIconIntegration;this.imageSearchComponent.setPaywallFeatures(b?u.PaywallFeatures.fullFeature:u.PaywallFeatures.noSearch);this.gifSearchComponent.setPaywallFeatures(b?u.PaywallFeatures.fullFeature:u.PaywallFeatures.searchButNoInsert);this.stickerSearchComponent.setPaywallFeatures(b?u.PaywallFeatures.fullFeature:u.PaywallFeatures.searchButNoInsert);this.iconSearchComponent.setPaywallFeatures(a?u.PaywallFeatures.fullFeature:u.PaywallFeatures.searchButNoInsert);this.uiRoot.getState().hasIconLicense!==
a&&(this.uiRoot.setState({hasIconLicense:a}),this.iconProvider.setHasIconLicense(a),this.iconSearchComponent.searchForImages(this.uiRoot,null,0,this.uiRoot.getState().iconSearchState.selectedFilter))}createSetPlaceholderMenuItem(a){if(this.shouldShowTogglePlaceholder()){const {selectedPlaceholder:b}=this.uiRoot.getState();a.createMenuItem({kind:e.MenuItemKind.context,id:"toggle-image-as-placeholder",title:"DEV: "+(b===z.placeholder?g.I18n.ts("Unset placeholder"):g.I18n.ts("Set as placeholder")),weight:100,
onClick:(a)=>{this.toggleSelectedPlaceholder(a)},enabled:!0})}}createReplaceAssetButtonsMenuItems(a,b){if(a.showReplaceImage!==F.noShow){let c=null;switch(a.showReplaceImage){case F.showGif:c=m.ActiveTabId.gif;break;case F.showImage:c=m.ActiveTabId.image;break;case F.showIcon:c=m.ActiveTabId.icon;break;default:r.Utils.assertNever(a.showReplaceImage)}b.createMenuItem({kind:e.MenuItemKind.context,id:"replace-asset-context-menu-item",title:g.I18n.ts("Replace\u2026"),weight:66,onClick:()=>this.openAssetSidebar("replace",
c,!1),enabled:!0});b.createPropertyBarItem((a)=>a.button({id:"asset-replace-property-bar-item",groupWeight:0,weight:0,enabled:!0,icon:e.IconSmallId.Replace,tooltip:g.I18n.ts("Replace"),onClick:()=>{this.openAssetSidebar("replace",c,!1)}}))}}createImageSpecificButtons(a,b){a=a.selection;ja(a[0],G.image)&&(this.createImageBackgroundRemovalButton(b,a[0]),this.createImageMaskingSpecificButtons(b,a[0]))}createImageBackgroundRemovalButton(a,b){let {backgroundRemovalButtonState:c}=this.uiRoot.getState();
c!==w.hidden&&(this.uiRoot.getState().networkStatus===e.NetworkStatus.Offline&&(c=w.disabled),a.createPropertyBarItem((a)=>a.button({id:"remove-image-background",groupWeight:1,weight:6.5,tooltip:g.I18n.ts("Remove background"),enabled:c===w.enabled,icon:e.IconSmallId.BackgroundRemove,onClick:(a)=>{h.avro.Avro.createDefaultLogger().logRemoveImageBackground();this.session.document.executeApiCommand(a,{name:"IMAGE_BACKGROUND_REMOVAL",run:(a)=>{var c=this.session.document.progressiveAssetManager;a=a.lookup.resolve(b);
const d=c.rewriteUrl(a.imageAsset.url);c=c.uploadImage(this.transparentBackgroundPromise(d)).token;a.imageAsset=c}})}})))}transparentBackgroundPromise(a){return Z(this,void 0,void 0,function*(){try{return yield this.imageEffectServiceProvider.getImageWithRemovedBackground(a)}catch(b){return console.error("There was a problem during image background removal process with this error: ",b),this.uiRoot.dialog.showBuiltInError(da.EditorErrorCase.IMAGE_BACKGROUND_REMOVAL_FAILED,!1),a}})}createAssetSearchComponents(a){this.iconProvider=
new n.IconProvider(a,!0);this.imageSearchComponent=this.createImageSearchComponent(g.I18n.ts("Images by Unsplash"),"PHOTOS",{getDefaultAssets:(a)=>this.externalAssetProvider.getRelevantImages(P.Usecase.NEXT_IMAGE,a),searchAssets:(a,c)=>this.externalAssetProvider.search(a,c)},()=>this.uiRoot.getState().imageSearchState,(a)=>this.uiRoot.setState({imageSearchState:a}),E.image);this.gifSearchComponent=this.createImageSearchComponent(g.I18n.ts("GIFs by Giphy"),"GIFS",{getDefaultAssets:(a)=>this.externalAssetProvider.getRelevantAnimations(P.Usecase.NEXT_ANIMATED,
a,!1),searchAssets:(a,c)=>this.externalAssetProvider.animationSearch(a,c,!1)},()=>this.uiRoot.getState().gifSearchState,(a)=>this.uiRoot.setState({gifSearchState:a}),E.gif);this.stickerSearchComponent=this.createImageSearchComponent(g.I18n.ts("Stickers by Giphy"),"STICKERS",{getDefaultAssets:(a)=>this.externalAssetProvider.getRelevantAnimations(P.Usecase.NEXT_ANIMATED_STICKER,a,!0),searchAssets:(a,c)=>this.externalAssetProvider.animationSearch(a,c,!0)},()=>this.uiRoot.getState().stickerSearchState,
(a)=>this.uiRoot.setState({stickerSearchState:a}),E.sticker);this.iconSearchComponent=this.createIconSearchComponent(g.I18n.ts("Icon search"),this.iconProvider,()=>this.uiRoot.getState().iconSearchState,(a)=>this.uiRoot.setState({iconSearchState:a}))}createImageSearchComponent(a,b,c,d,f,e){return new u.SearchComponent(a,(a)=>{h.avro.Avro.createDefaultLogger().logSearchImage({search_asset_type:b,search_term:a})},C.ListLayout.two_column,c,(a)=>this.externalAssetProvider.generateImageInfo(a),(a,b)=>
{a=this.controller.replaceImageFromURLOrFile(a,b.url,"SIDEBAR_SEARCH",e);this.registerAsset(b,a,this.session.document.preziMetaData.preziOid)},(a,b,c)=>{a=this.controller.insertImageFromURLOrFile(a,b.url,c.stageX,c.stageY,"SIDEBAR_SEARCH",e);e!==E.gif&&e!==E.image&&e!==E.sticker||this.registerAsset(b,a,this.session.document.preziMetaData.preziOid)},d,(a)=>{const b=d();a=Object.assign(Object.assign({},b),a);f(a)},null)}createIconSearchComponent(a,b,c,d){return new u.SearchComponent(a,(a)=>{h.avro.Avro.createDefaultLogger().logSearchSymbol({search_term:a})},
C.ListLayout.three_column,b,(a)=>J.isActive("js-report-icons")&&a.originalId?{icon:e.IconSmallId.Icon,text:a.originalId.toString(),url:`data://:iconID:${a.originalId.toString()}`}:null,(a,b)=>{this.controller.replaceIcon(a,b)},(a,b,c)=>{this.controller.insertIcon(a,c,b)},c,(a)=>{const b=c();a=Object.assign(Object.assign({},b),a);d(a)},{labels:ka,onFilterChange:(a)=>this.logIconStyleOptionChange(a)})}logIconStyleOptionChange(a){let b;switch(a){case n.IconStyle.All:b="ALL";break;case n.IconStyle.BlueUi:b=
"BLUEUI";break;case n.IconStyle.CircleBubbles:b="CIRCLE_BUBBLES";break;case n.IconStyle.Color:b="COLORED";break;case n.IconStyle.CuteColor:b="CUTE_COLOR";break;case n.IconStyle.Doodle:b="DOODLE";break;case n.IconStyle.Filled:b="FILLED";break;case n.IconStyle.Infographic:b="INFOGRAPHIC";break;case n.IconStyle.Outlined:b="OUTLINED";break;default:r.Utils.assertNever(a)}b&&h.avro.Avro.createDefaultLogger().logSelectIconStyleOption({icon_style_filter_selection:b})}setActiveSearchTab(a){if(a!==this.uiRoot.getState().activeSearchComponent)switch(this.uiRoot.setState({activeSearchComponent:a}),
a){case m.ActiveTabId.image:h.avro.Avro.createDefaultLogger().logOpenedPhotosTab();break;case m.ActiveTabId.gif:h.avro.Avro.createDefaultLogger().logOpenedGifsTab();break;case m.ActiveTabId.sticker:h.avro.Avro.createDefaultLogger().logOpenedStickersTab();break;case m.ActiveTabId.icon:h.avro.Avro.createDefaultLogger().logOpenedIconTab();break;default:r.Utils.assertNever(a)}}createImageMaskingSpecificButtons(a,b){const {maskImageButtonState:c,maskAspectRatiosByObjectIds:d}=this.uiRoot.getState();if(c!==
w.hidden){var f=(a)=>a.simpleList((a)=>({items:[a.image({id:y.MASK_ASPECT_RATIO_IDS.get(q.MaskAspectRatio.fix1By1),src:M.generateFixedAspectImageUrl(1),title:"1:1",dataLookup:"mask-aspect-1-1",onClick:(a)=>this.updateMaskAspectRatio(a,b,q.MaskAspectRatio.fix1By1)}),a.image({id:y.MASK_ASPECT_RATIO_IDS.get(q.MaskAspectRatio.fix16By9),src:M.generateFixedAspectImageUrl(16/9),title:"16:9",dataLookup:"mask-aspect-16-9",onClick:(a)=>this.updateMaskAspectRatio(a,b,q.MaskAspectRatio.fix16By9)}),a.image({id:y.MASK_ASPECT_RATIO_IDS.get(q.MaskAspectRatio.fix4By3),
src:M.generateFixedAspectImageUrl(4/3),title:"4:3",dataLookup:"mask-aspect-4-3",onClick:(a)=>this.updateMaskAspectRatio(a,b,q.MaskAspectRatio.fix4By3)}),a.image({id:y.MASK_ASPECT_RATIO_IDS.get(q.MaskAspectRatio.custom),src:M.generateCustomAspectImageUrl(),title:"Custom",dataLookup:"mask-aspect-custom",onClick:(a)=>this.updateMaskAspectRatio(a,b,q.MaskAspectRatio.custom)})],itemLayout:e.ListItemLayout.fixed,itemType:e.ListItemType.large,flexGrow:1,activeId:y.MASK_ASPECT_RATIO_IDS.get(d.get(b.id)),
showTitle:!0}));a.createPropertyBarItem((a)=>a.toggleComboButton((a)=>({id:"mask-image",groupWeight:1,weight:7,tooltipText:g.I18n.ts("Crop"),pushed:c===w.checked,disabled:!(c===w.enabled||c===w.checked),color:e.ButtonColor.Green,content:{icon:e.IconSmallId.Crop},popupHeader:[a.sectionHeader({content:g.I18n.ts("Crop Image")})],popupContent:[f(a)],onClick:(a)=>this.controller.toggleMaskEditing(b,!1,a)})))}}updateMaskAspectRatio(a,b,c){h.avro.Avro.createDefaultLogger().logSelectImageAspectRatio({image_aspect_ratio_option:y.MASK_ASPECT_RATIO_LOG_PROPS.get(c)});
const d=this.uiRoot.getState().maskAspectRatiosByObjectIds;if(d.get(b.id)!==c){this.session.document.executeApiCommand(a,{name:"Change Mask Aspect Ratio",run:(a)=>{var e=a.lookup.resolve(b);if(e.is(B.base.ObjectKind.image)){a=a.toDecorator(e);e=this.imageMaskingCommander.updateMaskAspectRatio(a.mask,c,a.imageAsset);const f=this.imageMaskingCommander.getLayoutBoxForNewMask(a.mask,e,a.layoutBox);a.mask=e;a.fitInto(f);e=R.CetRendererModule.getImageMaskEditingStateComponentKey();a.set(e,!0);this.uiRoot.setState({maskAspectRatiosByObjectIds:(new Map(d)).set(b.id,
c),maskImageButtonState:w.checked})}}});var f=this.session.applicationMode.editMode;f.isActive()&&f.setMaskEditingMode(a,b.id,e.MaskEditTarget.mask,null!=c&&c!==q.MaskAspectRatio.custom)}}createUploadPdfFileDialog(a){return a.dialog.small((a)=>({id:"uploadPdfFileDialog",title:g.I18n.ts("Upload PDF file"),align:e.DialogAlign.center,content:[a.droparea({text:g.I18n.ts("**Drag and drop** your .pdf file here or upload one from your computer."),illustration:e.IllustrationSmallId.Pdf,filter:{allowPdf:!0},
onFileSelected:(a,b)=>{this.uiRoot.dialog.hide("uploadPdfFileDialog");this.controller.insertPdfOrIcon(a,{stageX:null,stageY:null},b.file,L.InsertPdfOrIconKind.pdf)},color:e.ButtonColor.Blue})],onCloseButtonClicked:()=>{this.uiRoot.dialog.hide("uploadPdfFileDialog")}}))}createTopBarMenuItems(a){const b=e.TopMenuId.Media;a.createTopMenuItem(b,{kind:e.MenuItemKind.largeButton,enabled:!0,icon:e.IconSmallId.Image,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"IMAGE"});
this.toggleAssetInsertSidebar(m.ActiveTabId.image)},weight:1,id:"topmenu-insert-item-image",title:g.I18n.ts("Image"),categoryWeight:0,defaultSelected:!0});a.createTopMenuItem(b,{kind:e.MenuItemKind.largeButton,enabled:!0,icon:e.IconSmallId.Gif,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"GIF"});this.toggleAssetInsertSidebar(m.ActiveTabId.gif)},weight:3,categoryWeight:0,id:"topmenu-insert-item-gif",title:g.I18n.ts("GIF")});a.createTopMenuItem(b,{kind:e.MenuItemKind.largeButton,
enabled:!0,icon:e.IconSmallId.Sticker,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"STICKER"});this.toggleAssetInsertSidebar(m.ActiveTabId.sticker)},weight:4,categoryWeight:0,id:"topmenu-insert-item-sticker",title:g.I18n.ts("Sticker")});a.createTopMenuItem(b,{kind:e.MenuItemKind.largeButton,enabled:!0,icon:e.IconSmallId.Icon,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"ICON"});this.toggleAssetInsertSidebar(m.ActiveTabId.icon)},
weight:5,categoryWeight:0,id:"topmenu-insert-item-icon",title:g.I18n.ts("Icon")});a.createTopMenuItem(b,{kind:e.MenuItemKind.largeButton,enabled:!0,icon:e.IconSmallId.PdfFile,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"PDF"});this.uiRoot.dialog.show("uploadPdfFileDialog")},weight:9,categoryWeight:0,id:"topmenu-insert-item-pdf",title:g.I18n.ts("PDF")})}createInsertContextMenuItem(a,b){0===b.selection.length&&a.createMenuItem({kind:e.MenuItemKind.context,enabled:!0,
onClick:()=>{this.toggleAssetInsertSidebar(m.ActiveTabId.image)},weight:129,id:y.CONTEXT_MENU_ID,title:g.I18n.ts("Insert image")})}openAssetSidebar(a,b,c){const d=this.uiRoot.getState();d.sidebarOpen&&null==d.activePageId?d.mode!==a&&this.uiRoot.setState({mode:a}):(h.avro.Avro.createDefaultLogger().logShowImageInsertOptions(),this.setActiveSearchTab(b),this.uiRoot.setState({mode:a,selectedItemKey:null,sidebarOpen:!0,autoOpen:c,activePageId:null}),this.imageSearchComponent.init(this.uiRoot),this.gifSearchComponent.init(this.uiRoot),
this.stickerSearchComponent.init(this.uiRoot),this.iconSearchComponent.init(this.uiRoot),this.uiRoot.sidebar.open(p.AssetInsertSidebarId))}toggleAssetInsertSidebar(a){const {sidebarOpen:b,mode:c,activeSearchComponent:d}=this.uiRoot.getState(),e=b&&"insert"===c&&d===a;e?h.avro.Avro.createDefaultLogger().logCloseImageSidebar():b||h.avro.Avro.createDefaultLogger().logShowImageInsertOptions();this.uiRoot.setState({mode:"insert",selectedItemKey:null});e?(this.uiRoot.sidebar.toggle(p.AssetInsertSidebarId),
this.uiRoot.setState({sidebarOpen:!1})):(this.setActiveSearchTab(a),this.imageSearchComponent.init(this.uiRoot),this.gifSearchComponent.init(this.uiRoot),this.stickerSearchComponent.init(this.uiRoot),this.iconSearchComponent.init(this.uiRoot),this.uiRoot.sidebar.open(p.AssetInsertSidebarId),this.uiRoot.setState({sidebarOpen:!0}))}createSidebar(a){const b=this.uiRoot.getState();var c=[...this.createTopBar(a)];c.push(a.tabMenuButtons({activeId:b.activeSearchComponent,onChange:(a,b)=>this.setActiveSearchTab(b),
options:[{kind:e.TabMenuItemKind.icon,id:m.ActiveTabId.image,icon:e.IconSmallId.Image,tooltipText:g.I18n.ts("Photos")},{kind:e.TabMenuItemKind.icon,id:m.ActiveTabId.gif,icon:e.IconSmallId.Gif,tooltipText:g.I18n.ts("GIFs")},{kind:e.TabMenuItemKind.icon,id:m.ActiveTabId.sticker,icon:e.IconSmallId.Sticker,tooltipText:g.I18n.ts("Stickers",{context:"animated images with transparent background"})},{kind:e.TabMenuItemKind.icon,id:m.ActiveTabId.icon,icon:e.IconSmallId.Icon,tooltipText:g.I18n.ts("Icons")}]}),
...this.createSearchUi(a,b.activeSearchComponent));this.uiRoot.getState().imageSearchState.features===u.PaywallFeatures.noSearch&&b.activeSearchComponent===m.ActiveTabId.image&&(c=c.concat(a.sectionHeader({content:g.I18n.ts("Free images")}),this.createFreeImagesList(a),a.sectionHeader({content:g.I18n.ts("Premium images")}),this.createPremiumImagesList(a)));var d=b.activeSearchComponent===m.ActiveTabId.gif||b.activeSearchComponent===m.ActiveTabId.sticker?[a.image({src:v.getResourceUrl("giphy.png"),
id:"powered-by-giphy"})]:[];c={title:"insert"===b.mode?g.I18n.ts("Insert"):g.I18n.ts("Replace"),content:c,footer:d};d={};d[D.pdfAssetListPageId]=this.pdfAssetListPage.createPage(a,b);return{root:c,pages:d,onClose:()=>{this.uiRoot.setState({sidebarOpen:!1});b.activePageId===D.pdfAssetListPageId&&h.avro.Avro.createDefaultLogger().logClosePdfSidebar()},onCloseButtonClicked:()=>{h.avro.Avro.createDefaultLogger().logCloseImageSidebar()},onPageBack:()=>{const a=this.uiRoot.getState();a.activePageId===D.pdfAssetListPageId&&
h.avro.Avro.createDefaultLogger().logClosePdfSidebar();this.uiRoot.setState({activePageId:null});this.openAssetSidebar(a.mode,m.ActiveTabId.icon,!1)}}}createSearchUi(a,b){if(null==b)return[];switch(b){case m.ActiveTabId.image:return this.imageSearchComponent.createSearchUI(a,this.uiRoot);case m.ActiveTabId.gif:return this.gifSearchComponent.createSearchUI(a,this.uiRoot);case m.ActiveTabId.sticker:return this.stickerSearchComponent.createSearchUI(a,this.uiRoot);case m.ActiveTabId.icon:return this.iconSearchComponent.createSearchUI(a,
this.uiRoot);default:r.Utils.assertNever(b)}}createLibrarySection(a){return this.uiRoot.getState().networkStatus===e.NetworkStatus.Online?[a.sectionHeader({content:g.I18n.ts("My Library")}),a.button(e.ButtonSize.Large,e.ButtonAlign.Start,(a)=>[a.button({id:"open-my-library-button",color:e.ButtonColor.Blue,content:{text:g.I18n.ts("Add from my library")},onClick:()=>{const a=this.uiRoot.getState().activeSearchComponent;let b;switch(a){case m.ActiveTabId.gif:b="gif";break;case m.ActiveTabId.sticker:b=
"sticker";break;case m.ActiveTabId.image:b="image";break;case m.ActiveTabId.icon:b="icon";break;default:r.Utils.assertNever(a)}this.pluginAccess.send(m.favorites,m.createOpenFavoritesFromAnotherSidebarMessage(b,this.uiRoot.getState().mode))}})]),a.separator()]:[]}createTopBar(a){return[...J.isActive("js-hide-library-sidebar-button")?[]:this.createLibrarySection(a),a.sectionHeader({content:g.I18n.ts("Upload your file")}),a.button(e.ButtonSize.Large,e.ButtonAlign.Start,(a)=>[a.upload({id:"image-upload",
color:e.ButtonColor.Gray,content:{text:g.I18n.ts("Upload")},fileFilter:{allowImage:!0,allowPdf:!0},onFileSelected:(a,{file:b,source:e})=>{const c=this.uiRoot.getState().mode;switch(c){case "insert":this.controller.insertAsset(a,b,null,null,e);break;case "replace":this.controller.replaceAsset(a,b,e);break;default:r.Utils.assertNever(c)}}}),a.button({id:"upload-info",color:e.ButtonColor.Ghost,content:{icon:e.IconSmallId.Info},onClick:()=>{const a=g.I18n.ts("https://prez.is/l97qcl1/");window.open(a,
"_blank_info")},tooltipText:g.I18n.ts("Supported image formats")})]),a.separator()]}createFreeImagesList(a){const {hostname:b,protocol:c,origin:d}=window.location;let f="localhost"===b?d+"/":c;const g=[...Array(y.FREE_IMAGE_COUNT)].map((a,b)=>({id:`free-image-${b}`,thumbnail_url:v.getResourceUrl(`free-images-thumbnails/${b}.jpeg`),url:`${f}${v.getResourceUrl(`free-images/${b}.jpeg`)}`}));return C.createImageList({sidebarUi:a,triggerPaywall:!1,images:g,shouldRequestAdditionalItems:!1,progress:0!==
g.length?e.ListProgress.finished:e.ListProgress.working,listLayout:C.ListLayout.two_column,getImageInfo:()=>null,insert:(a,b,c)=>this.controller.insertImageFromURLOrFile(a,b.url,c.stageX,c.stageY,"SIDEBAR_SEARCH",E.image),replace:(a,b)=>this.controller.replaceImageFromURLOrFile(a,b.url,"SIDEBAR_SEARCH",E.image),uiRoot:this.uiRoot,requestAdditionalItems:()=>{}})}createPremiumImagesList(a){const b=[...Array(y.PREMIUM_IMAGE_COUNT)].map((a,b)=>({id:`premium-image-${b}`,thumbnail_url:v.getResourceUrl(`premium-images/${b}.jpg`),
url:v.getResourceUrl(`premium-images/${b}.jpg`)}));return C.createImageList({sidebarUi:a,triggerPaywall:!0,images:b,shouldRequestAdditionalItems:!1,progress:0!==b.length?e.ListProgress.finished:e.ListProgress.working,listLayout:C.ListLayout.two_column,getImageInfo:()=>null,insert:(a,b,e)=>this.controller.insertImageFromURLOrFile(a,b.url,e.stageX,e.stageY,"SIDEBAR_SEARCH",E.image),replace:(a,b)=>this.controller.replaceImageFromURLOrFile(a,b.url,"SIDEBAR_SEARCH",E.image),uiRoot:this.uiRoot,requestAdditionalItems:()=>
{}})}getSelectedPlaceholder(a){return 1!==a.length?z.none:this.session.document.read((b)=>{b=b.lookup.resolve(a[0]);return null==b?z.none:b.is(G.image)||b.is(G.pdf)||b.is(G.swf)?b.isPlaceholder?z.placeholder:z.nonPlaceholder:z.none})}shouldShowTogglePlaceholder(){return J.isActive("js-developer-features")&&this.uiRoot.getState().selectedPlaceholder!==z.none}toggleSelectedPlaceholder(a){const {selection:b}=this.uiRoot.getState();if(1===b.length)try{this.session.document.executeApiCommand(a,{name:"toggle image placeholder",
run:(a)=>{a=a.lookup.resolve(b[0]);if(a.is(G.image)||a.is(G.pdf)||a.is(G.swf))a.isPlaceholder=!a.isPlaceholder,this.uiRoot.setState({selectedPlaceholder:a.isPlaceholder?z.placeholder:z.nonPlaceholder})}})}catch(c){}}registerAsset(a,b,c){null!=a.provider&&b.then((b)=>{this.externalAssetProvider.registerAsset({provider:a.provider,assetId:a.id,mediaUrl:b.kind===B.base.AssetKind.image?b.url:b.mediaAssetId,preziOid:c}).catch(()=>!0)})}}p.AssetPlugin=y;y.CONTEXT_MENU_ID="context-menu-asset-insert";y.FREE_IMAGE_COUNT=
15;y.PREMIUM_IMAGE_COUNT=16;y.MASK_ASPECT_RATIO_IDS=new Map([[q.MaskAspectRatio.fix1By1,"mask-aspect-1-1"],[q.MaskAspectRatio.fix16By9,"mask-aspect-16-9"],[q.MaskAspectRatio.fix4By3,"mask-aspect-4-3"],[q.MaskAspectRatio.custom,"mask-aspect-custom"]]);y.MASK_ASPECT_RATIO_LOG_PROPS=new Map([[q.MaskAspectRatio.fix1By1,"ONE_BY_ONE"],[q.MaskAspectRatio.fix16By9,"SIXTEEN_BY_NINE"],[q.MaskAspectRatio.fix4By3,"FOUR_BY_THREE"],[q.MaskAspectRatio.custom,"CUSTOM"]]);var V={};Object.defineProperty(V,"__esModule",
{value:!0});V.lazyModule={createPlugin(){return new p.AssetPlugin}};return V});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_assets",["require","prezi_cet_model_editor","prezi_cet_renderer","prezi_editor_commander","prezi_editor_error","prezi_editor_store_mode","prezi_externalassetprovider","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_replacer","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_assets.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_editor_commander"),require("prezi_editor_error"),require("prezi_editor_store_mode"),require("prezi_externalassetprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_replacer"),require("prezi_utils"));}else{this["prezi_assets"]=__factory(this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_editor_commander"],this["prezi_editor_error"],this["prezi_editor_store_mode"],this["prezi_externalassetprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_replacer"],this["prezi_utils"]);}}).call(this);