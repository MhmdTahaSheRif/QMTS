;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_brand_colors";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_i18n":dependencies[3],"prezi_image_color_thief":dependencies[4],"prezi_logger":dependencies[5],"prezi_plugin_api":dependencies[6],"prezi_plugin_meta":dependencies[7],"prezi_styleschemeprovider":dependencies[8],"prezi_widgets":dependencies[9]}};})());};})(arguments);var moduleImpl=(function(){return module(function(f){function y(a){return new Promise((b,c)=>{const e=new Image;e.onload=()=>b(e);e.onerror=c;e.src=a})}function z(a){return new Promise((b,c)=>{const e=new FileReader;e.onload=()=>b(e.result);e.onerror=(a)=>c(a);e.readAsDataURL(a)})}function A(a,b,c){var e=a.overview.contentChildren.find((a)=>a.is(m.base.ObjectKind.pdf)||a.is(m.base.ObjectKind.image));if(null!=e){var d=a.overview.topicChildren,g=d[d.length-1];d=e.layoutBox;e.delete();c=c(a);e=a.overview.contentChildren.find((a)=>a.is(m.base.ObjectKind.shape));
null!=e?(d=a.lookup.shape(e.id),a=d.width,g=Math.min(e.layoutBox.size.height*b,g.layoutBox.topLeft.x-e.layoutBox.topLeft.x),d.width=g,d.position={x:d.position.x-(a-g)/2,y:d.position.y},d=d.layoutBox.scaleToHeight(.9*d.layoutBox.size.height)):(b=d.topLeft,a=d.bottomLeft,g=g.layoutBox.topLeft.x-d.topLeft.x,d.size.height*c.layoutBox.size.width/c.layoutBox.size.height>g&&(g=c.layoutBox.size.height*g/c.layoutBox.size.width,a=d.topLeft.y+(d.size.height-g)/2,b=d.topLeft.translate({x:0,y:a-d.topLeft.y}),
a=d.bottomLeft.translate({x:0,y:a+g-d.bottomLeft.y})),d=c.layoutBox.align(m.base.AnchorPoint.topLeft,m.base.AnchorPoint.bottomLeft,b,a));c.fitInto(d)}}function n(a){return p.Geometry.colorFromRGBA(a.r/255,a.g/255,a.b/255,a.a)}function u(a){return{backgroundColor:n(a[0]),topicAColor:n(a[1]),topicBColor:n(a[2]),borderColor:n(a[3]),extraColor:n(a[4]),primaryTextColor:p.Geometry.colorFromRGB(0,0,0),secondaryTextColor:p.Geometry.colorFromRGB(1,1,1)}}var q=f.dependencies.prezi_image_color_thief,p=f.dependencies["prezi.geometry"],
v=f.dependencies.prezi_editor_commander,k=f.dependencies.prezi_i18n,B=f.dependencies.prezi_logger,h=f.dependencies.prezi_plugin_api,r=f.dependencies.prezi_plugin_meta,w=f.dependencies.prezi_styleschemeprovider,l=f.dependencies.prezi_widgets,m=f.dependencies.prezi_cet_model_editor,x={uploadAndReturnThumbnail:function(a,b,c,e){let d;if("application/pdf"===c.type){const b=a.document.progressiveAssetManager.uploadPdf(c);c=b.finished.then((a)=>a[0].pdfPageInfo.thumbnail());d=(a,c)=>a.overview.add.pdf(Object.assign(Object.assign({},
b.token),{width:c.width,height:c.height}))}else{const b=a.document.progressiveAssetManager.uploadImage(c);c=z(c);d=(a,c)=>a.overview.add.image(Object.assign(Object.assign({},b.token),{width:c.width,height:c.height}))}b.doAsync(c.then(y),(c,b)=>{c.isValid()&&a.document.executeApiCommand(c,{name:"replace logo",run:(a)=>{A(a,b.width/b.height,(a)=>d(a,b));e(a,b)}})})}};Object.defineProperty(x,"__esModule",{value:!0});var t={};Object.defineProperty(t,"__esModule",{value:!0});const C=f.getResourceUrl("default_logo.png");
t.BrandColorsPlugin=class{constructor(){this.renderUi=(a,b)=>{b.createSidebar("brand-colors-sidebar",(c)=>({root:{title:k.I18n.ts("Brand"),content:[...this.createLogoSection(a,c),c.separator(),this.createColorPicker(a,c),c.separator(),this.createEditPresentationButton(a,c)],footer:[this.createSkipButton(a,c)]},onOpen:()=>this.glassboxLogger.logShowBrandWizardOptions(),onClose:()=>this.glassboxLogger.logCloseBrandWizardSidebar()}));null!=a.spotlightArgs&&a.isSidebarOpen&&(b.spotlight(a.spotlightArgs),
setTimeout(()=>this.uiRoot.spotlight.open("brand-spotlight"),301))};this.updateColors=(a,b)=>{var c=w.StyleSchemeProviderModule.createColorPalette("branding_sidebar_palette_id",u(b));b=v.EditorCommander.createColorMixCommander();c=b.createMapping(c);b.applyPalette(a,this.session.document.progressiveAssetManager,c,"branding_sidebar_palette_id")};this.onEditPresentation=()=>{this.glassboxLogger.logNextOnBrandWizard();this.uiRoot.spotlight.close("brand-spotlight");this.uiRoot.sidebar.close("brand-colors-sidebar");
this.styleSchemeProvider.saveCustomStyleScheme({id:"",title:k.I18n.ts("Brand colors"),isCustom:!0,colorScheme:u(this.uiRoot.getState().generatedColors),fontScheme:this.session.document.read((a)=>v.EditorCommander.createTextStyleCommander().getFontScheme(a.styleSheet)),thumbnailUrl:""}).then(()=>{this.pluginAccess.send(r.style,{kind:r.StyleMessageKind.simple,value:r.StyleMessageValue.editBrandScheme})})};this.onFileInsert=(a,b)=>{this.glassboxLogger.logFilePickedForLogoUpload({file_name:b.name,file_size:b.size});
x.uploadAndReturnThumbnail(this.session,a,b,(a,b)=>{this.uiRoot.setState({logoSrc:b.src,defaultLogoChanged:!0});b=q.ColorThiefTool.getPalette(b,5,1).map((a)=>({r:a[0],g:a[1],b:a[2],a:1}));const c=q.generateFiveFromLogo(b[0]);this.uiRoot.setState({logoColors:b,solidColor:b[0],generatedColors:c});this.updateColors(a,c)})}}init(a){this.styleSchemeProvider=w.StyleSchemeProviderModule.getStyleSchemeProvider(a);const b={solidColor:{r:255,g:255,b:255,a:1},logoSrc:C,logoColors:[],generatedColors:[],defaultLogoChanged:!1,
spotlightArgs:this.getSpotlight(1),isSidebarOpen:!1};this.uiRoot=a.declareUI(b,this.renderUi);this.glassboxLogger=B.avro.Avro.createDefaultLogger()}processMessage(a){"requestOpen"===a&&(this.uiRoot.sidebar.open("brand-colors-sidebar"),this.uiRoot.setState({isSidebarOpen:!0}))}getSpotlight(a){const b=[{around:{uiElementId:"brand-colors-sidebar"},shape:l.HoleShape.rect,strict:!0,callout:null}];1===a?b.push({around:{uiElementId:"upload-logo-button"},shape:l.HoleShape.rect,strict:!0,callout:{anchor:"left",
text:k.I18n.ts("Click here to upload your logo")}}):2===a&&b.push({around:{uiElementId:"brand-color-picker-color-picker-popup"},shape:l.HoleShape.rect,strict:!0,callout:null});return{id:"brand-spotlight",overlay:{opacity:0,color:"",holes:b},highlights:null}}onSkip(){this.glassboxLogger.logSkipBrandWizard();this.uiRoot.spotlight.close("brand-spotlight");this.uiRoot.sidebar.close("brand-colors-sidebar")}createSkipButton(a,b){return b.button(h.ButtonSize.Large,h.ButtonAlign.End,(a)=>[a.button({id:"skip",
color:h.ButtonColor.Ghost,content:{text:k.I18n.ts("Skip")},onClick:()=>this.onSkip()})])}createEditPresentationButton(a,b){return b.button(h.ButtonSize.Large,h.ButtonAlign.End,(a)=>[a.button({id:"edit-presentation",color:h.ButtonColor.Gray,content:{text:k.I18n.ts("Edit presentation")},onClick:this.onEditPresentation})])}createLogoSection(a,b){const c=this.uiRoot.getState().defaultLogoChanged?k.I18n.ts("Replace logo"):k.I18n.ts("Upload logo");return[b.simpleList((b)=>({itemType:h.ListItemType.full,
itemLayout:h.ListItemLayout.fixed,items:[b.image({src:{url:a.logoSrc}})]})),b.button(h.ButtonSize.Large,h.ButtonAlign.End,(a)=>[a.upload({color:h.ButtonColor.Gray,id:"upload-logo-button",content:{text:c},fileFilter:{allowImage:!0,allowPdf:!0},onClick:()=>{this.uiRoot.setState({spotlightArgs:this.getSpotlight(0)});this.uiRoot.getState().defaultLogoChanged?this.glassboxLogger.logOpenReplaceLogoDialog():this.glassboxLogger.logOpenUploadLogoDialog()},onFileSelected:(a,{file:b})=>{this.onFileInsert(a,
b)}})])]}createColorPicker(a,b){return b.colorPicker({id:"brand-color-picker",label:k.I18n.ts("Brand color"),fills:{solidFill:{fillKind:l.FillKind.solid,color:a.solidColor},current:l.FillKind.solid,hasAlpha:!1},showThemeColors:!1,showColorWheel:!0,customColors:0<a.logoColors.length?[{title:k.I18n.ts("LOGO COLORS"),id:"logo-colors",weight:0,colors:a.logoColors}]:[],onChange:(a,{fills:b,isFinal:d})=>{const c=q.generateFiveFromLogo(b.solidFill.color);this.uiRoot.setState({solidColor:b.solidFill.color,
generatedColors:c});d&&(this.glassboxLogger.logChangeBrandColor({color_hexcode:l.toCssColorIgnoreAlpha(b.solidFill.color)}),a.doAsync(Promise.resolve(c),(a,b)=>{a.isValid()&&this.session.document.executeApiCommand(a,{name:"update colors",run:(a)=>{this.updateColors(a,b)}})}))},onShowPopup:()=>{this.glassboxLogger.logShowBrandColorOptions();this.uiRoot.setState({spotlightArgs:this.getSpotlight(2)});return!0}})}};f={};Object.defineProperty(f,"__esModule",{value:!0});f.lazyModule={createPlugin:()=>new t.BrandColorsPlugin};
return f});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_brand_colors",["require","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_i18n","prezi_image_color_thief","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_styleschemeprovider","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_brand_colors.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_i18n"),require("prezi_image_color_thief"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_styleschemeprovider"),require("prezi_widgets"));}else{this["prezi_brand_colors"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_i18n"],this["prezi_image_color_thief"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_styleschemeprovider"],this["prezi_widgets"]);}}).call(this);