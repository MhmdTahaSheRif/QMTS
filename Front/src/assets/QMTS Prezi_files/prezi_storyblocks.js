;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_storyblocks";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_featureswitcher":dependencies[3],"prezi_i18n":dependencies[4],"prezi_libraryprovider":dependencies[5],"prezi_logger":dependencies[6],"prezi_plugin_api":dependencies[7],"prezi_plugin_meta":dependencies[8],"prezi_select":dependencies[9],"prezi_service_data":dependencies[10],"prezi_utils":dependencies[11],"prezi_widgets":dependencies[12]}};})());};})(arguments);var moduleImpl=(function(){return module(function(n){function L(a,b,c,d){const e=B.EditorCommander.createLayoutQuery();b=a.layout.add.planet(b,null==d?void 0:d);b.simpleChildren(q.base.ChildVisibilityKind.all).filter((a)=>!e.isTopicShapeObject(a)).forEach((a)=>a.delete());d=b.cover.add.text("subtitle_2");d.setText(c.title);d.isPlaceholder=!1;d.wrap(.75,!1);d.setAllParagraphProps({alignment:q.base.TextAlignment.Center});var f=b.simpleChildren(q.base.ChildVisibilityKind.outsideAndInside).filter((a)=>e.isTopicShapeObject(a));0<f.length&&
(c=H(d.layoutBox,D.onCover),f=f[0].createLayoutGroupWith(f.slice(1)).layoutBox,d.fitInto(f.scale(c)));a.layout.adjust([b]);return b}function M(a){let b;for(const c of a)a=c.is(g.text)?c.textBox:c.layoutBox,b=b?b.union(a):a;return b}function N(a,b){if(a.is(g.planetTopic)){const e=B.EditorCommander.createLayoutQuery();var c=a.simpleChildren(q.base.ChildVisibilityKind.outsideAndInside).filter((a)=>e.isTopicShapeObject(a));if(0<c.length){var d=H(b);c=c[0].createLayoutGroupWith(c.slice(1)).layoutBox;d=
O(c,a.zoomLayoutBox).scale(d)}}null==d&&(d=a.zoomLayoutBox.scale(D.inZoom));d=d.rotateRad(b.rotationRad);return b.fitIntoOther(d)}function H(a,b=D.inCircle){a=a.size;a=Math.max(a.height,a.width)/Math.min(a.height,a.width);return a/Math.sqrt(1+a*a)*b}function P(a){(a.is(g.planetTopic)||a.is(g.overview)||a.is(g.page))&&a.contentChildren.forEach((a)=>{(a.is(g.text)||a.is(g.image))&&a.isPlaceholder&&a.delete()})}function E(a,b,c){if(l.isActive("js-no-topic-storyblocks")&&!a.is(g.page)){b=b.insert().simpleObjects;
if(0===b.length)return{kind:m.Objects,editors:b};var d=b.sort((a,b)=>Math.abs(a.rotationRad)-Math.abs(b.rotationRad));d=d[0].createLayoutGroupWith(d.slice(1));c=c.positionFinder.findLayoutBox(a,d.layoutBox.size.width,d.layoutBox.size.height);d.fitInto(c);return 1<b.length?(a=a.add.group(b),{kind:m.Group,groupEditor:a}):{kind:m.Objects,editors:b}}{P(a);c=b.insert().simpleObjects;b=M(c);d=N(a,b);const e=c[0].createLayoutGroupWith(c.slice(1));e.fitInto(e.layoutBox.align(b.topLeft,b.topRight,d.topLeft,
d.topRight));return l.isActive("js-no-topic-storyblocks")&&1<c.length?(a=a.add.group(c),{kind:m.Group,groupEditor:a}):{kind:m.Objects,editors:c}}}function O(a,b){var c=b.union(a);if(c=c.size.width===b.size.width&&c.size.height===b.size.height)return a;if(a.intersects(b)){c=Math.max(b.topLeft.x,a.topLeft.x);var d=Math.max(a.topLeft.y,b.topLeft.y),e=Math.min(a.bottomRight.x,b.bottomRight.x),f=Math.min(a.bottomRight.y,b.bottomRight.y);b={width:Math.abs(e-c),height:Math.abs(f-d)};c=a.referenceFrame.point({x:c+
(e-c)/2,y:d+(f-d)/2});return a.referenceFrame.layoutBox(c,b)}return b}function Q(a,b,c,d,e){null==d&&(d=a.getThemeIdForNewSubtopic(c,q.base.ObjectKind.planetTopic));var f=a.getLayoutIdForNewSubtopic(c);b=a.layout.add.inserter(b);if(b.isValid()&&(c=b.insert(c).topics[0])){c.is(g.planetTopic)&&(R(c)&&null!=d&&c.applyTheme(d),c.applyLayout(f));if(l.isActive("js-no-topic-storyblocks")){d=[];c.is(g.planetTopic)?(f=c.contentChildren,d.push(...f),f=c.topicChildren,d.push(...f)):c.is(g.stackTopic)&&null!=
c.pageChildren[0]&&(f=c.pageChildren[0].contentChildren,d.push(...f),f=[]);f=c.simpleChildren(q.base.ChildVisibilityKind.outsideAndInside);d.push(...f);if(0===d.length)return{kind:m.Topic,topicEditor:c};d.forEach((b)=>b.parent=a);c.delete();c=d.sort((a,b)=>Math.abs(a.rotationRad)-Math.abs(b.rotationRad));c=c[0].createLayoutGroupWith(c.slice(1));e=e.positionFinder.findLayoutBox(a,c.layoutBox.size.width,c.layoutBox.size.height);c.fitInto(e);e=d.filter((a)=>a.kind!==g.stackTopic&&a.kind!==g.planetTopic);
return 1<e.length&&(c=a.layout.add.group(e),e.length===d.length)?{kind:m.Group,groupEditor:c}:{kind:m.Objects,editors:d}}return{kind:m.Topic,topicEditor:c}}return null}function R(a){return[...a.visual.contentChildren,...a.is(g.planetTopic)?a.surface.contentChildren:[]].some((a)=>q.CetModelEditor.isTopicShapeObjectKILLME(a))}function S(a,b){if(b.is(g.planetTopic)){const b=B.EditorCommander.createLayoutQuery();a.visual.contentChildren.filter((a)=>b.isTopicShapeObject(a)).forEach((a)=>{a.is(g.shape)?
a.shapeStyle===I.Poly2&&(a.shapeStyle=I.Poly3):(a.is(g.pdf)||a.is(g.image))&&a.filterStyle===q.base.ShapelikeFilterStyle.Filter2&&(a.filterStyle=q.base.ShapelikeFilterStyle.Filter3)})}}var J=n.dependencies.prezi_service_data,q=n.dependencies.prezi_cet_model_editor,B=n.dependencies.prezi_editor_commander,l=n.dependencies.prezi_featureswitcher,k=n.dependencies.prezi_i18n,t=n.dependencies.prezi_libraryprovider,r=n.dependencies.prezi_logger,h=n.dependencies.prezi_plugin_api,K=n.dependencies.prezi_plugin_meta,
F=n.dependencies.prezi_utils,u=n.dependencies.prezi_widgets,A={};Object.defineProperty(A,"__esModule",{value:!0});var T=l.FeatureSwitcher.isActive;A.RecentlyUsedStorage=class{constructor(a){this.cache=[];this.localStorageKey="recenttopics."+a;this.storage=T("js-force-session-storage-for-recently-used")?window.sessionStorage:window.localStorage;this.cache=this.getLocalStorageItem()}getStoryblockGuids(){return[...this.cache].reverse()}addStoryblockGuid(a){a&&(this.cache=this.cache.filter((b)=>b!==a),
this.cache.push(a),this.cache=this.cache.slice(this.cache.length-A.RecentlyUsedStorage.MAX_LENGTH),this.setLocalStorageItem(this.cache))}cleanStoryblockGuids(){this.cache=[];this.removeLocalStorageItem()}setLocalStorageItem(a){try{this.storage.setItem(this.localStorageKey,JSON.stringify(a))}catch(b){}}getLocalStorageItem(){try{return JSON.parse(this.storage.getItem(this.localStorageKey)||"[]")}catch(a){return[]}}removeLocalStorageItem(){this.storage.removeItem(this.localStorageKey)}};A.RecentlyUsedStorage.MAX_LENGTH=
10;var v={};Object.defineProperty(v,"__esModule",{value:!0});v.StoryblockOnboarding=class{static initUi(a,b){a.spotlight({id:"insert-topic-button-spotlight-id",overlay:null,highlights:[{around:{uiElementId:"add-button-button"},shape:u.HoleShape.rounded,pulse:!0}]});a.spotlight({id:"default-topic-button-spotlight-id",overlay:null,highlights:[{around:{uiElementId:"storyblocks/snippet/Default"},shape:u.HoleShape.rect,pulse:!0,callout:{text:k.I18n.ts("Click here to insert a default topic into your presentation"),
onClose:()=>{v.StoryblockOnboarding.closeDefaultTopicSpotlight(b)}}}]});a.spotlight({id:"storyblock-insert-spotlight-id",overlay:null,highlights:[{around:{uiElementId:"selection-zoom-in-button"},shape:u.HoleShape.rounded,pulse:!0}]})}static initSpotlightState(a){a=l.isActive("js-force-storyblock-onboarding")||a&&!a.getBoolean(J.UserSettingBooleanKeys.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN);return{shouldSpotligthInsertedTopic:!l.isActive("js-unique-differentiation")&&a}}static openInsertedTopicSpotlightIfActive(a,
b,c){const {onboardingState:d}=b.getState();d.shouldSpotligthInsertedTopic&&(b.setState({onboardingState:Object.assign(Object.assign({},d),{shouldSpotligthInsertedTopic:!1}),insertedTopicSpotlightElementId:a}),c.setBoolean(J.UserSettingBooleanKeys.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN,!0),b.spotlight.close("default-topic-button-spotlight-id"),b.spotlight.open("storyblock-insert-spotlight-id"))}static closeDefaultTopicSpotlight(a){a.spotlight.close("default-topic-button-spotlight-id")}static closeInsertedTopicSpotlight(a){a.setState({insertedTopicSpotlightElementId:null});
a.spotlight.close("storyblock-insert-spotlight-id")}};var z={},w=this&&z.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{g(d.next(a))}catch(G){h(G)}}function C(a){try{g(d["throw"](a))}catch(G){h(G)}}function g(a){a.done?c(a.value):e(a.value).then(f,C)}g((d=d.apply(a,b||[])).next())})};Object.defineProperty(z,"__esModule",{value:!0});var g=q.base.ObjectKind,I=q.base.ShapeStyle,p;(function(a){a.Overview=
"overview";a.Planet="planet";a.Stack="stack"})(p=z.ParentType||(z.ParentType={}));var m;(function(a){a.Topic="topic";a.Group="group";a.Objects="objects"})(m||(m={}));var y;(function(a){a[a.Force=0]="Force";a[a.OnlyIfError=1]="OnlyIfError"})(y||(y={}));class x{constructor(){this.toggleSidebar=()=>{const {isSidebarOpen:a,searchTerm:b}=this.uiRoot.getState();a?r.avro.Avro.createDefaultLogger().logCloseLibrarySidebar({library_sidebar_mode:null==b?"MAIN":"RESULTS"}):r.avro.Avro.createDefaultLogger().logInsertFromLibrary({library_sidebar_mode:null==
b?"MAIN":"RESULTS",library_sidebar_trigger:"TOPMENU"});this.uiRoot.sidebar.toggle(x.SIDEBAR_ID)};this.logger=r.LoggerModule.getLoggerManager().createLogger("prezi_storyblocks.StoryblocksPlugin")}init(a){this.libraryProvider=t.LibraryProviderModule.getLibraryProvider(a);this.recentlyUsedStorage=new A.RecentlyUsedStorage(this.userSettings.getUserId());a.onCurrentTopicChange((a)=>{switch(this.session.document.read((b)=>{b=b.lookup.base(a);return null!=b?b.kind:"overview"})){case "planetTopic":var b=
p.Planet;break;case "page":b=p.Stack;break;case "overview":b=p.Overview;break;default:b=p.Overview}this.uiRoot.setState({parentType:b});var {insertedTopicSpotlightElementId:b}=this.uiRoot.getState();b&&v.StoryblockOnboarding.closeInsertedTopicSpotlight(this.uiRoot)});this.uiRoot=a.declareUI({canUsePremium:!1,defaultStoryblocksDataState:{kind:"none"},foldersDataState:{kind:"none"},insertedTopicSpotlightElementId:null,isNetworkOffline:!1,isSidebarOpen:!1,onboardingState:v.StoryblockOnboarding.initSpotlightState(this.userSettings),
parentType:p.Overview,recentlyUsedSnippets:[],recommendedStoryblocksDataState:{kind:"none"},resultSnippets:null,searchTerm:null,stackStoryblocksDataState:{kind:"none"},storyblocksDataState:{kind:"none"},storyblocksEnabled:!1,supportedGenerations:[],supportedTypes:[t.SnippetType.Static,t.SnippetType.Animated]},(a,c)=>{v.StoryblockOnboarding.initUi(c,this.uiRoot);c.createTopMenuItem(h.TopMenuId.Other,{id:"topmenu-insert-item-story-blocks",kind:h.MenuItemKind.largeButton,enabled:!a.isNetworkOffline,
weight:0,categoryWeight:0,title:k.I18n.ts("Story block"),tooltip:k.I18n.ts("Add Story block"),icon:h.IconSmallId.Storyblocks,color:void 0,onClick:()=>{r.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"STORY_BLOCKS"});this.toggleSidebar("TOP_MENU")}});c.createSidebar(x.SIDEBAR_ID,(b)=>this.createSidebarArgs(a,b))});a.onLicenseChange((a)=>{a=a.featureSet.pitchExtraStoryblocks||l.isActive("js-storyblocks-plugin-force-premium");this.uiRoot.setState({canUsePremium:a})});a.onSelectionChange((a)=>
{const {insertedTopicSpotlightElementId:b}=this.uiRoot.getState();!b||1===a.allObjects.length&&b===a.allObjects[0].id||v.StoryblockOnboarding.closeInsertedTopicSpotlight(this.uiRoot)});a.onNetworkStatusChange((a)=>{this.uiRoot.setState({isNetworkOffline:a===h.NetworkStatus.Offline});this.uiRoot.getState().isSidebarOpen&&this.loadAllData(y.OnlyIfError)})}createSidebarArgs(a,b){const {isNetworkOffline:c}=this.uiRoot.getState();return c?null:{root:this.createRootPage(a,b),pages:this.createPages(a,b),
onOpen:()=>{const a=this.session.document.read((a)=>a.meta.getSupportedGenerations());this.uiRoot.setState({isSidebarOpen:!0,supportedGenerations:a});this.loadAllData(y.Force)},onClose:()=>{this.uiRoot.setState({isSidebarOpen:!1})},onCloseButtonClicked:()=>{r.avro.Avro.createDefaultLogger().logCloseLibrarySidebar({library_sidebar_mode:null==this.uiRoot.getState().searchTerm?"MAIN":"RESULTS"})},onPageBack:()=>{r.avro.Avro.createDefaultLogger().logBackFromLibraryResults()}}}loadAllData(a){const {isNetworkOffline:b}=
this.uiRoot.getState();b||(this.loadFolders(a),this.loadStoryblocks(a),l.isActive("js-no-topic-storyblocks")||this.loadRecommendedStoryblocks(a));l.isActive("js-no-topic-storyblocks")||this.loadDefaultStoryblocks(a);this.loadStackStoryblocks(a)}createRootPage(a,b){return{title:k.I18n.ts("Story blocks"),header:[],content:this.createRootPageContent(a,b)}}createLibrarySection(a){return[a.sectionHeader({content:k.I18n.ts("My Library")}),a.button(h.ButtonSize.Large,h.ButtonAlign.Start,(a)=>[a.button({id:"open-my-library-button",
color:h.ButtonColor.Blue,content:{text:k.I18n.ts("Add from my library")},onClick:()=>{this.pluginAccess.send(K.favorites,K.createOpenFavoritesFromAnotherSidebarMessage("storyblocks","insert"))}})]),a.separator()]}createRootPageContent(a,b){return a.parentType===p.Stack?this.createStackRootPageContent(a,b):this.createStandardRootPageContent(a,b)}createStandardRootPageContent(a,b){const c=a.defaultStoryblocksDataState;return"loading"===a.foldersDataState.kind&&"loading"===c.kind?[b.spinner(h.SpinnerColor.neutral,
u.SpinnerSize.l)]:[...l.isActive("js-hide-library-sidebar-button")?[]:this.createLibrarySection(b),this.createSearchField(b),...l.isActive("js-no-topic-storyblocks")?[]:this.createDefaultStoryblockSection(a,b),...this.createMainAndRecommendationSection(a,b)]}createStackRootPageContent(a,b){return l.isActive("js-show-2-pages-in-stack-section")?"loading"===a.stackStoryblocksDataState.kind?[b.spinner(h.SpinnerColor.neutral,u.SpinnerSize.l)]:[...[b.label(k.I18n.ts("There are a wide variety of topic types available in addition to \u201cstack\u201d topic structures.")),
b.button(h.ButtonSize.Small,h.ButtonAlign.Start,(a)=>[a.button({id:"stack-learn-more-button",color:h.ButtonColor.Gray,content:{text:k.I18n.ts("Learn more")},onClick:()=>{r.avro.Avro.createDefaultLogger().logStackLearnMoreClicked();window.open("https://prez.is/9pbst46/","_blank")}})])],...this.createSectionWithSeparator(this.createRootPageStoryblockList(a.stackStoryblocksDataState,b,"storyblocks/stack"),b)]:this.createStandardRootPageContent(a,b)}createMainAndRecommendationSection(a,b){switch(a.foldersDataState.kind){case "loading":return[b.spinner(h.SpinnerColor.neutral,
u.SpinnerSize.m)];case "success":return[...this.createRootMainResults(a,b),...l.isActive("js-no-topic-storyblocks")?[]:this.createRootRecommendation(b)];case "error":return[b.illustration(k.I18n.ts("Something went wrong"),h.IllustrationLargeLightId.Error)];default:return[]}}createDefaultStoryblockSection(a,b){return null!=a.resultSnippets?[]:this.createSectionWithSeparator(this.createRootPageStoryblockList(a.parentType===p.Stack?a.stackStoryblocksDataState:a.defaultStoryblocksDataState,b),b)}createRootPageStoryblockList(a,
b,c){switch(a.kind){case "loading":return[b.spinner(h.SpinnerColor.neutral,u.SpinnerSize.m)];case "success":return[...this.createStoryblockList(b,a.data,c)];case "error":return[b.illustration(k.I18n.ts("Something went wrong"),h.IllustrationLargeLightId.Error)];default:return[]}}createRootMainResults(a,b){return null!=a.resultSnippets?this.createSectionWithSeparator(this.createSnippetResultsBlock(b,a.resultSnippets),b):[...this.createRootRecentlyUsed(b),...this.createSectionWithSeparator(this.createFolderList(b,
this.getFolders()),b)]}createRootRecommendation(a){const b=this.getRecommendedStoryblocks();return this.createSnippetResultsBlock(a,b,k.I18n.ts("Recommended"),"storyblocks/recommended",!0)}createRootRecentlyUsed(a){const {recentlyUsedSnippets:b}=this.uiRoot.getState();return this.createSectionWithSeparator(this.createSnippetResultsBlock(a,b,k.I18n.ts("Recently used"),"storyblocks/recentlyused",!0),a)}createPages(a,b){const c={};this.getFolders().forEach((d)=>{c[d.key]=this.createPage(a,b,d.key)});
return c}createPage(a,b,c){const d=this.getFolders().find((a)=>a.key===c);return null==d?{title:"",content:null}:{title:d.title,content:this.createPageContent(a,b,d)}}createPageContent(a,b,c){switch(a.storyblocksDataState.kind){case "loading":return[b.spinner(h.SpinnerColor.neutral,u.SpinnerSize.l)];case "error":return[b.illustration(k.I18n.ts("Something went wrong"),h.IllustrationLargeLightId.Error)];case "success":return null==a.resultSnippets?this.createPageWithAllResults(b,c):this.createPageWithSearchResults(a,
b,c);default:return null}}createPageWithAllResults(a,b){const {parentType:c}=this.uiRoot.getState();let d=this.getStoryblocks().filter((a)=>a.folderKey===b.key);c===p.Stack&&(d=d.filter((a)=>a.snippetType!==t.SnippetType.Animated));this.uiRoot.getState().canUsePremium||(d=d.sort(this.compareFreeItemFirst));return b?0<d.length?[this.createSearchField(a),...this.createStoryblockList(a,d)]:[a.illustration(c===p.Stack?k.I18n.ts("This category of storyblocks is only available on the overview and within planet topic types."):
k.I18n.ts("No story blocks in this folder"),h.IllustrationLargeLightId.NoResults)]:null}createSectionWithSeparator(a,b){return a&&0!==a.length?[...a,b.separator()]:[]}createPageWithSearchResults(a,b,c){const d=[],e=[];if(a.resultSnippets)for(const b of a.resultSnippets)b.folderKey===c.key?d.push(b):e.push(b);a=[this.createSearchField(b)];a=a.concat(this.createSnippetResultsBlock(b,d,k.I18n.tsFormatKeys("In {title}",{title:c.title})));0<e.length?a=a.concat(this.createSnippetResultsBlock(b,e,k.I18n.ts("In other folders"))):
l.isActive("js-no-topic-storyblocks")||(c=this.getRecommendedStoryblocks(),0<c.length&&(a=a.concat(this.createSnippetResultsBlock(b,c,k.I18n.ts("Recommended"),"storyblocks/recommended",!0))));return a}createSnippetResultsBlock(a,b,c,d,e=!1){let f=[];const g=this.uiRoot.getState().storyblocksDataState.kind;c&&(e&&"loading"!==g&&"error"!==g&&0===b.length||(f=f.concat(a.sectionHeader({content:c}))));if(0===b.length)switch(g){case "loading":f=f.concat(a.spinner(h.SpinnerColor.neutral,u.SpinnerSize.l));
break;case "success":e||(f=f.concat(a.illustration(k.I18n.tsFormatKeys("No results for {search_term}",{search_term:this.uiRoot.getState().searchTerm}),h.IllustrationLargeLightId.NoResults)));break;case "error":f=f.concat(a.illustration(k.I18n.ts("Something went wrong"),h.IllustrationLargeLightId.Error))}else f=f.concat(this.createStoryblockList(a,b,d,e));return f}processMessage(a){return w(this,void 0,void 0,function*(){switch(a.kind){case "openStoryblocksSidebar":this.uiRoot.sidebar.open(x.SIDEBAR_ID);
this.search(a.searchTerm,!1);r.avro.Avro.createDefaultLogger().logInsertFromLibrary({library_sidebar_mode:a.searchTerm?"RESULTS":"MAIN",library_sidebar_trigger:"DEEPLINK"});break;default:F.Utils.assertNever(a.kind)}})}createFolderList(a,b){const c=[];c.push(a.sectionHeader({content:k.I18n.ts("Explore")}));const d=b.filter((a)=>"basic-layout"!==a.key);0<d.length?(a=a.simpleList((a)=>({items:d.map((b)=>a.folder({src:{url:b.thumbnail},title:b.title,onClick:()=>{this.uiRoot.sidebar.open(x.SIDEBAR_ID,
b.key);v.StoryblockOnboarding.closeDefaultTopicSpotlight(this.uiRoot);r.avro.Avro.createDefaultLogger().logSelectLibraryCategory({library_category_id:b.key})},dataLookup:`storyblocks/folder/${b.key}`})),itemType:h.ListItemType.large,itemLayout:h.ListItemLayout.dynamic,showTitle:!0,id:"storyblocks/folderlist"})),c.push(a)):c.push(a.illustration(k.I18n.ts("No results"),h.IllustrationLargeLightId.NoResults));return c}createStoryblockList(a,b,c="storyblocks/snippetlist",d=!1){const {canUsePremium:e,parentType:f}=
this.uiRoot.getState();let g=b;f===p.Stack&&(g=g.filter((a)=>a.snippetType!==t.SnippetType.Animated));return 0<g.length?(b=[],b.push(a.simpleList((a)=>({items:g.map((b)=>this.createStoryblockItem(a,b,e)),itemType:h.ListItemType.full,itemLayout:h.ListItemLayout.dynamic,showTitle:!0,id:c}))),b):d?[]:[a.illustration(k.I18n.ts("No results"),h.IllustrationLargeLightId.NoResults)]}createStoryblockItem(a,b,c){if(b.isPremium&&!c)return a.lock({src:{url:b.thumbnail},title:b.title,tooltipText:k.I18n.ts("Unlock"),
dataLookup:"storyblocks/snippet",onClick:()=>this.openPaywallModal()});c={src:{url:b.thumbnail},onDrop:(a,c)=>{this.insertSnippet(a,b,c.dropKind)},title:b.title,dataLookup:`storyblocks/snippet/${b.title}`,disabled:this.uiRoot.getState().parentType===p.Stack&&b.snippetType===t.SnippetType.Animated};l.isActive("js-no-topic-storyblocks")||null==b.video||(c.hoverContent={type:h.HoverContentType.video,url:b.video});return a.droppableImage(c)}openPaywallModal(){this.uiRoot.dialog.showBuiltIn(h.BuiltinDialog.upgradeLicenseStoryblocks)}withCopyData(a){return w(this,
void 0,void 0,function*(){let b=null;b="url"===a.content.kind?yield fetch(a.content.dataUrl).then((a)=>a.text()):a.content.data;return Object.assign(Object.assign({},a),{copyData:yield this.session.document.parseCopyDataAsync(b)})})}insertSnippet(a,b,c){a.doAsync(this.withCopyData(b),(a,b)=>{a.isValid()&&this.session.document.executeApiCommand(a,{name:"insertSnippet",run:(d)=>{let e=this.session.insertTarget.getSimpleObjectParent(d),f=!1;e.is(g.planetTopic)||e.is(g.overview)?f=this.insertPlanetTopicSnippet(a,
d,e,b):e.is(g.page)&&(e=e.parent.add.page(e.index+1),e.simpleChildren(q.base.ChildVisibilityKind.all).forEach((a)=>a.delete()),this.session.navigation.focusTo(a,e),f=this.insertStackTopicSnippet(a,d,e,b));d=this.getLoggerTopicType(e);f&&null!=d&&r.avro.Avro.createDefaultLogger().logInsertLibraryStoryblock({insert_method:c===h.DropKind.drag?"DRAG":"SINGLE_CLICK",library_storyblock_id:`${b.folderKey}.${b.title}`,target_object_id:e.id,topic_type:d});f&&this.updateRecentlyUsedStoryblocks(b.guid)}})})}updateRecentlyUsedStoryblocks(a){a&&
this.recentlyUsedStorage.addStoryblockGuid(a);a=this.processRecentlyUsedStoryblocks();this.uiRoot.setState({recentlyUsedSnippets:a})}processRecentlyUsedStoryblocks(){var a=this.recentlyUsedStorage.getStoryblockGuids(),b=this.getStoryblocks(),c=this.getDefaultStoryblocks();const d=this.getRecommendedStoryblocks();b=[...b,...c,...d];c=[];for(let d of a)if((a=b.find((a)=>a.guid===d))&&c.push(a),c.length>=x.RECENTLY_USED_MAX_LENGHT)break;return c}insertPlanetTopicSnippet(a,b,c,d){let e=null,f=!1;b=(b=
this.session.selection.getSelectionInfo(b).allObjects.find((a)=>a.is(g.topic)))?b.index+1:c.topicChildren.length;d.snippetType===t.SnippetType.Static?l.isActive("js-no-topic-storyblocks")?(d=c.layout.add.inserter(d.copyData),d.isValid()&&(e=E(c,d,this.session),f=!0)):(e={kind:m.Topic,topicEditor:L(c,b,d,null)},d=e.topicEditor.add.inserter(d.copyData),d.isValid()&&e.topicEditor.is(g.planetTopic)&&(E(e.topicEditor,d,this.session),f=!0)):d.snippetType===t.SnippetType.Animated&&c.is(g.topicParent)&&(e=
Q(c,d.copyData,b,null,this.session),f=null!=e);if(f&&e)switch(e.kind){case m.Group:this.session.selection.setSelection(a,[e.groupEditor]);break;case m.Topic:S(e.topicEditor,c);this.session.selection.setSelection(a,[e.topicEditor]);v.StoryblockOnboarding.openInsertedTopicSpotlightIfActive(e.topicEditor.id,this.uiRoot,this.userSettings);break;case m.Objects:this.session.selection.setSelection(a,e.editors);break;default:F.Utils.assertNever(e)}return f}insertStackTopicSnippet(a,b,c,d){if(d.snippetType===
t.SnippetType.Static&&(b=c.add.inserter(d.copyData),b.isValid())){c=E(c,b,this.session);switch(c.kind){case m.Group:this.session.selection.setSelection(a,[c.groupEditor]);break;case m.Topic:this.session.selection.setSelection(a,[c.topicEditor]);break;case m.Objects:this.session.selection.setSelection(a,c.editors);break;default:F.Utils.assertNever(c)}return!0}return!1}createSearchField(a){const b=()=>{const a=this.uiRoot.getState().searchTerm;this.search(a,!0)};return a.searchField({id:"search-input-field",
onSearchButtonClick:b,onEnter:b,onValueChange:(a,b)=>{""===b?(r.avro.Avro.createDefaultLogger().logBackFromTopicResults({topic_search_cleared_trigger:"FIELDCLEARED"}),this.uiRoot.setState({resultSnippets:null,searchTerm:null})):this.uiRoot.setState({searchTerm:b})},value:this.uiRoot.getState().searchTerm,placeholderText:k.I18n.ts("Search"),autofocus:!0})}search(a,b){if(null!=a&&""!==a){const c=this.getSearchResults(a,this.getStoryblocks());this.uiRoot.setState({resultSnippets:c,searchTerm:a});b&&
r.avro.Avro.createDefaultLogger().logSearchInLibrary({search_term:a})}}getRecommendedStoryblocks(){const {recommendedStoryblocksDataState:a,parentType:b}=this.uiRoot.getState();let c=[];"success"===a.kind&&(c=a.data.filter((a)=>!(b===p.Stack&&a.snippetType===t.SnippetType.Animated)));return c}normalizeSearchTerm(a){return a.toLowerCase().trim()}getSearchResults(a,b){if(null==b)return[];const c=this.normalizeSearchTerm(a),d=(a)=>a.find((a)=>0<=a.indexOf(c));a=b.filter((a)=>0<=a.title.toLowerCase().indexOf(c)||
d(a.keywords));this.uiRoot.getState().canUsePremium||(a=a.sort(this.compareFreeItemFirst));return a}compareFreeItemFirst(a,b){return a.isPremium===b.isPremium?0:a.isPremium?1:-1}getLoggerTopicType(a){switch(a.kind){case g.overview:return"TOPIC_PLANET";case g.planetTopic:switch(a.parent.kind){case g.overview:return"TOPIC_PLANET";default:return"SUBTOPIC_PLANET"}case g.page:return"SUBTOPIC_PAGE";default:return null}}loadFolders(a){return w(this,void 0,void 0,function*(){const {foldersDataState:b}=this.uiRoot.getState();
if(a!==y.OnlyIfError||"success"!==b.kind){this.uiRoot.setState({foldersDataState:{kind:"loading"}});try{const a=(yield this.libraryProvider.getFolders()).map((a)=>({key:a.key,thumbnail:a.thumbnailUrl,title:a.title}));this.uiRoot.setState({foldersDataState:{kind:"success",folderData:a}})}catch(c){this.uiRoot.setState({foldersDataState:{kind:"error"}}),l.isActive("js-library-mock-throw-exception")||this.logger.error({action:"error",object:"storyblocks-load",trigger:"machine",payload:{error:`${c}`}})}}})}loadStoryblocks(a){return w(this,
void 0,void 0,function*(){var {storyblocksDataState:b}=this.uiRoot.getState();if(a!==y.OnlyIfError||"success"!==b.kind){this.uiRoot.setState({storyblocksDataState:{kind:"loading"}});var {supportedGenerations:b,supportedTypes:c}=this.uiRoot.getState();try{const a=(yield this.libraryProvider.getStoryblocksV2(b,c)).map(this.convertSnippetApiModelV2ToSnippetData);this.uiRoot.setState({storyblocksDataState:{kind:"success",data:a}});this.updateRecentlyUsedStoryblocks();const {searchTerm:e}=this.uiRoot.getState();
this.search(e,!1)}catch(d){this.uiRoot.setState({storyblocksDataState:{kind:"error"}}),l.isActive("js-library-mock-throw-exception")||this.logger.error({action:"error",object:"storyblocks-load",trigger:"machine",payload:{error:`${d}`}})}}})}loadDefaultStoryblocks(a){return w(this,void 0,void 0,function*(){this.loadStoryblocksWithStatus(()=>this.libraryProvider.getDefaultTopics(),"defaultStoryblocksDataState","default",!1,a)})}loadRecommendedStoryblocks(a){return w(this,void 0,void 0,function*(){const {canUsePremium:b,
supportedGenerations:c,supportedTypes:d}=this.uiRoot.getState();this.loadStoryblocksWithStatus(()=>this.libraryProvider.getRecommendedTopicsV2(c,d),"recommendedStoryblocksDataState","recommended",!b,a)})}loadStackStoryblocks(a){return w(this,void 0,void 0,function*(){this.loadStoryblocksWithStatus(()=>this.libraryProvider.getStackTopics(),"stackStoryblocksDataState","stack",!1,a)})}loadStoryblocksWithStatus(a,b,c,d=!1,e){return w(this,void 0,void 0,function*(){const f=this.uiRoot.getState()[b].kind;
if(e!==y.OnlyIfError||"success"!==f){this.uiRoot.setState({[b]:{kind:"loading"}});try{const c=(yield a()).map((a)=>this.convertSnippetApiModelV2ToSnippetData(a));this.uiRoot.setState({[b]:{kind:"success",data:d?c.sort(this.compareFreeItemFirst):c}})}catch(C){this.uiRoot.setState({[b]:{kind:"error"}}),l.isActive("js-library-mock-throw-exception")||this.logger.error({action:"error",object:`${c}-storyblocks-load`,trigger:"machine",payload:{error:`${C}`}})}}})}getDefaultStoryblocks(){const a=this.uiRoot.getState().defaultStoryblocksDataState;
return"success"===a.kind?a.data:[]}getStoryblocks(){const a=this.uiRoot.getState().storyblocksDataState;return"success"===a.kind?a.data:[]}getFolders(){const a=this.uiRoot.getState().foldersDataState;return"success"===a.kind?a.folderData:[]}convertSnippetApiModelV2ToSnippetData(a){return{guid:a.guid,content:{kind:"url",dataUrl:a.data.dataUrl},thumbnail:a.data.thumbnailUrl,keywords:a.keywords,title:a.title,folderKey:0<a.folderKey.length?a.folderKey[0]:null,isPremium:!a.isFree,video:a.data.videoThumbnailUrl,
snippetType:a.snippetType}}}z.StoryblocksPlugin=x;x.SIDEBAR_ID="storyblocks-sidebar";x.RECENTLY_USED_MAX_LENGHT=3;const D={inCircle:.9,inZoom:.8,onCover:.8};n={};Object.defineProperty(n,"__esModule",{value:!0});n.lazyModule={createPlugin(){return new z.StoryblocksPlugin}};return n});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_storyblocks",["require","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_i18n","prezi_libraryprovider","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_select","prezi_service_data","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_storyblocks.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_libraryprovider"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_select"),require("prezi_service_data"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_storyblocks"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_libraryprovider"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_select"],this["prezi_service_data"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);