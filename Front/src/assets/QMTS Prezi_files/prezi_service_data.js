;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_service_data";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi_bacon":dependencies[1],"prezi_editor_error":dependencies[2],"prezi_editor_store_ui":dependencies[3],"prezi_externalserviceprovider":dependencies[4],"prezi_featureswitcher":dependencies[5],"prezi_logger":dependencies[6],"prezi_nativeapitypes":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(g){var l=g.dependencies["prezi.engine.dom"],f=g.dependencies.prezi_bacon,x=g.dependencies.prezi_editor_error,v=g.dependencies.prezi_externalserviceprovider,p=g.dependencies.prezi_featureswitcher,w=g.dependencies.prezi_logger,m=g.dependencies.prezi_nativeapitypes,k={};Object.defineProperty(k,"__esModule",{value:!0});k.J=class{constructor(a,b){this.v=a;this.ha=b;this.logger=w.LoggerModule.getLoggerManager().createLogger("PreziLoaderLogger");this.W=f.Bacon.newBus();this.f=null}getLoaderStream(){return this.W}j(a,
b){a(b);this.W.push(b)}$(a,b){this.f=b;b=this.f.getMetadata();k.J.ea(b);this.j(a,{type:c.PreziLoaderEventType.MetaDataLoaded,payload:b})}U(a,b,d){this.j(a,{type:c.PreziLoaderEventType.StartLoading});this.v.loadPrezi(b,(b)=>{this.$(a,b);d()},(b)=>{this.j(a,{type:c.PreziLoaderEventType.MetaDataLoadError,payload:{errorCase:x.EditorErrorCase.METADATA_LOAD_ERROR,parameters:{message:b}}})})}loadPreziMetaData(a){let b=f.Bacon.newBus();this.U((a)=>{b.plug(f.Bacon.later(0,a))},a,()=>{});return b}loadPrezi(a){let b=
f.Bacon.newBus(),d=(a)=>{b.plug(f.Bacon.later(0,a))};this.U(d,a,()=>{this.f.loadPreziXml((a)=>{this.fa(d,a)},(a)=>{this.j(d,{type:c.PreziLoaderEventType.PreziXMLLoadError,payload:a})})});return b}savePreview(a){if(null==this.f)throw Error("prezi is not created yet");const b=f.Bacon.newBus();this.f.savePreviewImages(a,(a)=>{b.push(a)});return b}saveSession(a){if(null==this.f)throw Error("prezi is not created yet");const b=l.DOM.saveXml(a.getPrezi());a=a.getSessionState();const d=f.Bacon.newBus();this.f.savePreziXml(b,
a,(a)=>{d.push({saveResult:a,storageRevision:null})});return d}savePreviewToLocalStore(a){if(null==this.f)throw Error("prezi is not created yet");const b=f.Bacon.newBus();this.f.savePreviewImagesToLocalStore(a,(a)=>{b.push(a)});return b}saveSessionToLocalStore(a){if(null==this.f)throw Error("prezi is not created yet");const b=l.DOM.saveXml(a.getPrezi());a=a.getSessionState();const d=f.Bacon.newBus();this.f.savePreziXmlToLocalStore(b,a,(a)=>{d.push(a)});return d}savePreziTitle(a){if(null==this.f)throw Error("prezi is not created yet");
return this.f.savePreziTitle(a)}savePreziLogoType(a){if(null==this.f)throw Error("prezi is not created yet");return this.f.savePreziLogoType(a)}createPreziInLocalStore(a,b,d,e,c){return this.M(a,b,d,e,c,(a,b,d,e,c,h)=>{this.v.createPreziInLocalStore(a,b,d,e,c,h)},(a)=>this.saveSessionToLocalStore(a).map((a)=>({saveResult:a,storageRevision:null})))}createPrezi(a,b,d,e,c){return this.M(a,b,d,e,c,(a,b,d,c,e,h)=>{this.v.createPrezi(a,b,d,c,e,h)},(a)=>this.saveSession(a))}M(a,b,d,e,h,g,k){const n=f.Bacon.newBus();
g(a,b,e,h,(a)=>{this.$(()=>{},a);const b=l.DOM.createOfflineSession(d,()=>{},null);a=k(b);a.onError(()=>n.push({result:m.SaveResult.Error,session:null,metadata:null}));a.onValue((a)=>{const c=a.saveResult;switch(a.saveResult){case m.SaveResult.Error:case m.SaveResult.ErrorExternalEdit:n.push({result:c,session:null,metadata:null});this.logger.error({action:"create_error",object:"document",trigger:"machine"});break;case m.SaveResult.Success:n.push({result:c,session:b,metadata:this.f.getMetadata()});
let e;(a=d.getTemplateInfo())&&(e={template_name:a.getBaseId(),theme_name:a.getThemeId()});w.LoggerModule.getLoggerManager().setPreziId(this.f.getMetadata().oid);this.logger.info({action:"create_success",object:"document",trigger:"machine",payload:e})}})},(a)=>{this.j(()=>{},{type:c.PreziLoaderEventType.PreziCreationError,payload:a});this.ha.createPreziError(this.logger,"PreziLoader",a);let b=void 0;try{b="NOT_ALLOWED_LIMIT_REACHED"===JSON.parse(a).code}catch(y){}n.push({result:m.SaveResult.Error,
session:null,metadata:null,creationLimitReached:b})});return n}static ea(a){"privacy"in a||(a.privacy=v.PreziPrivacy.Public);"logo_type"in a||(a.logo_type=v.PreziLogoType.Watermark)}fa(a,b){var d=b.preziXml;const e=d.match(/<new-prezi( )?\/>/),h=d.match(/<zuiprezi>/);e?this.j(a,{type:c.PreziLoaderEventType.NewPrezi}):!h||p.isActive("js-allow-convert-core-prezi")?(d=l.DOM.loadXml(d),b=l.DOM.createOfflineSession(d,()=>{},b.locallyStoredSessionState),this.j(a,{type:c.PreziLoaderEventType.PdomSessionCreated,
payload:b})):(this.logger.error({action:"illegal_conversion",object:"prezi_loader",trigger:"machine"}),this.j(a,{type:c.PreziLoaderEventType.PreziConversionNotAllowedError}))}getPreziProvider(){return this.f}};var q={};Object.defineProperty(q,"__esModule",{value:!0});q.ba=class{static createPreziLoader(a,b){return new k.J(a,b)}};var r={};Object.defineProperty(r,"__esModule",{value:!0});r.ca=class{constructor(a){this.ka=a}loadLicense(){return new Promise((a)=>{this.ka.loadUserLicense((b)=>a(this.getUserLicenseInformation(b)))})}getUserLicenseInformation(a){const b=
a.pitch.feature_set,d=b.pitch_privacy_private;var c=a.pitch.organization;const h=null!=c?c.organization_id:null,f=null!=c?c.is_admin:!1;c=null!=c&&null!=c.admins?c.admins.map((a)=>({userId:a.user_id,email:a.email})):[];return{userId:a.user_id,organizationId:h,isAdmin:f,admins:c,featureSet:{analyticsEnabled:b.pitch_analytics,editChart:b.pitch_edit_charts,isDefaultLicense:!1,isTeam:!a.pitch.is_single_user,licenseTypeOid:a.pitch.license_type_oid,pitchAudio:b.pitch_audio,pitchBackgroundImageIntegration:b.pitch_background_image_integration,
pitchComment:b.pitch_comment,pitchCreate:b.pitch_create,pitchCustomSchemes:b.pitch_custom_schemes,pitchExtraStoryblocks:b.pitch_extra_storyblocks,pitchIconIntegration:b.pitch_icon_integration,pitchImageIntegration:b.pitch_image_integration,pitchPrivacyPrivate:b.pitch_privacy_private,presenterView:b.pitch_presenter_view,remotePresent:b.pitch_remote_present,unlimitedViewlinks:b.pitch_unlimited_viewlinks,videoUpload:b.pitch_video_upload,ownPreziLogo:b.own_prezi_logo,noWatermark:b.pitch_no_watermark,
customLogo:b.pitch_custom_logo,pitchDesktop:b.pitch_desktop,pitchPdfExport:b.pitch_pdf_export,hasCoreLicense:null!=a.core,isPaidLicense:d,brandKit:1===b.brand_kit}}}};var t={};Object.defineProperty(t,"__esModule",{value:!0});t.da=class{constructor(a){null!=a&&(this.m=a,this.w=f.Bacon.newBus(),this.i=this.ga(),this.L=f.Bacon.newBus(),this.K=this.L.toProperty(this.i),this.K.onValue(()=>{}),this.reloadUserSettings())}ga(){const a={desktop_full:!1,registration_date:void 0,boolean_settings:{}};a.boolean_settings[c.UserSettingBooleanKeys.JS_PATH_STEP_ANIMATION_ONBOARDING_SHOWN]=
!1;return a}reloadUserSettings(){this.m.loadUserSettings().then((a)=>{null!=a.desktop_full&&(this.i.desktop_full=a.desktop_full);null!=a.registration_date&&(this.i.registration_date=a.registration_date);if(null!=a.boolean_settings){this.i.boolean_settings=a.boolean_settings;for(let a of Object.keys(this.i.boolean_settings))this.w.push({key:a,value:this.i.boolean_settings[a]})}this.L.push(this.i)})}getUserSettingsStream(){return this.w}getAllUserSettingsStream(){return this.K}getBoolean(a){return this.containsKey(a)?
this.i.boolean_settings[a]:!1}setBoolean(a,b){const c=this.getBoolean(a);c!==b&&(this.i.boolean_settings[a]=b,this.m.setUserSetting(a,b).then((d)=>{d?this.w.push({key:a,value:b}):this.i.boolean_settings[a]=c}))}containsKey(a){return a in this.i.boolean_settings}getObject(a){return this.m.loadUserSettingObject(a)}setObject(a,b){return this.m.setUserSettingObject(a,b)}};var u={};Object.defineProperty(u,"__esModule",{value:!0});u.aa=class{constructor(a){this.userId=a;this.u=f.Bacon.newBus();a=this.ia();
this.o=p.isActive("js-unique-differentiation")&&null!=a?a:{kind:c.InteractionKind.mouse,autoSwitchEnabled:!1};this.u.push(this.o);this.O=null!=a?!0:!1}setInteractionMode(a){this.ja(a);this.O=!0;this.o=a;this.u.push(a)}getInteractionMode(){return this.o}getInteractionModeStream(){return this.u}isInteractionModeInitialized(){return this.O}ja(a){a=JSON.stringify(a);window.localStorage.setItem(this.N(),a)}N(){return`ds-${this.userId}-${"interactionMode"}`}ia(){if(p.isActive("js-for-test-empty-localstorage"))return null;
const a=window.localStorage.getItem(this.N());return JSON.parse(a)}};var c={};Object.defineProperty(c,"__esModule",{value:!0});(function(a){a[a.StartLoading=0]="StartLoading";a[a.MetaDataLoadError=1]="MetaDataLoadError";a[a.MetaDataLoaded=2]="MetaDataLoaded";a[a.PreziXMLLoadError=3]="PreziXMLLoadError";a[a.PreziLoaded=4]="PreziLoaded";a[a.NewPrezi=5]="NewPrezi";a[a.AssetLoadError=6]="AssetLoadError";a[a.AllAssetsLoaded=7]="AllAssetsLoaded";a[a.MetaDataUpdated=8]="MetaDataUpdated";a[a.PreziCreationError=
9]="PreziCreationError";a[a.TemplateChooserLoaded=10]="TemplateChooserLoaded";a[a.EditorStartEventForPrezipage=11]="EditorStartEventForPrezipage";a[a.PreziConversionNotAllowedError=15]="PreziConversionNotAllowedError";a[a.PdomSessionCreated=16]="PdomSessionCreated";a[a.PdomSessionCreationError=17]="PdomSessionCreationError";a[a.EditorInit=18]="EditorInit";a[a.ConversionStarted=19]="ConversionStarted";a[a.CetSessionCreated=20]="CetSessionCreated";a[a.PreziConversionFailedError=21]="PreziConversionFailedError";
a[a.FeaturePreviewModeWithSaveDisabled=22]="FeaturePreviewModeWithSaveDisabled"})(c.PreziLoaderEventType||(c.PreziLoaderEventType={}));(function(a){a.JS_PATH_STEP_ANIMATION_ONBOARDING_SHOWN="JS_PATH_STEP_ANIMATION_ONBOARDING_SHOWN";a.REMOTE_PRESENTATION_ONBOARDING_SHOWN="REMOTE_PRESENTATION_ONBOARDING_SHOWN";a.CONCEPT_ONBOARDING_SHOWN="CONCEPT_ONBOARDING_SHOWN";a.MULTI_PRODUCT_FORCE_SHOW_PITCH_ONBOARDING="MULTI_PRODUCT_FORCE_SHOW_PITCH_ONBOARDING";a.MULTI_PRODUCT_PITCH_ONBOARDING_SHOWN="MULTI_PRODUCT_PITCH_ONBOARDING_SHOWN";
a.AUDIO_ONBOARDING_UPLOAD_SHOWN="AUDIO_ONBOARDING_UPLOAD_SHOWN";a.AUDIO_ONBOARDING_PLAY_SHOWN="AUDIO_ONBOARDING_PLAY_SHOWN";a.AUDIO_ONBOARDING_MUTE_SHOWN="AUDIO_ONBOARDING_MUTE_SHOWN";a.AUDIO_ONBOARDING_PRESENT_SHOWN="AUDIO_ONBOARDING_PRESENT_SHOWN";a.EDITOR_SEEN="EDITOR_SEEN";a.BROWSER_NOTIFICATION_PERMISSION_DENIED="BROWSER_NOTIFICATION_PERMISSION_DENIED";a.JS_EDITOR_PPT_ONBOARDING="JS_EDITOR_PPT_ONBOARDING";a.JS_EDITOR_CONTENT_LAYOUT_ONBOARDING="JS_EDITOR_CONTENT_LAYOUT_ONBOARDING";a.JS_EDITOR_VIDEO_ONBOARDING_SHOWN=
"JS_EDITOR_VIDEO_ONBOARDING_SHOWN";a.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN="STORYBLOCKS_TOPIC_ONBOARDING_SHOWN";a.MY_LIBRARY_FAVORITES_ONBOARDING_SHOWN="MY_LIBRARY_FAVORITES_ONBOARDING_SHOWN";a.MY_LIBRARY_NON_NATIVE_ONBOARDING_SHOWN="MY_LIBRARY_NON_NATIVE_ONBOARDING_SHOWN";a.TOPIC_GROUPING_ONBOARDING_SHOWN="TOPIC_GROUPING_ONBOARDING_SHOWN";a.JS_EDITOR_PREZI_VIDEO_ONBOARDING="JS_EDITOR_PREZI_VIDEO_ONBOARDING";a.JS_EDITOR_CLASSIC_TO_NEXT_ONBOARDING_FOR_CLASSIC_SHOWN="JS_EDITOR_CLASSIC_TO_NEXT_ONBOARDING_FOR_CLASSIC_SHOWN";
a.JS_EDITOR_CLASSIC_TO_NEXT_ONBOARDING_FOR_NEXT_SHOWN="JS_EDITOR_CLASSIC_TO_NEXT_ONBOARDING_FOR_NEXT_SHOWN";a.BRANDKIT_ONBOARDING_SHOWN="BRANDKIT_ONBOARDING_SHOWN"})(c.UserSettingBooleanKeys||(c.UserSettingBooleanKeys={}));(function(a){a.mouse="mouse";a.touchpad="touchpad"})(c.InteractionKind||(c.InteractionKind={}));(function(a){let b,c,e;a.createPreziLoader=function(a,b){return q.ba.createPreziLoader(a,b)};a.createUserSettingsStore=function(a){b||(b=new t.da(a));return b};a.createUserLicenseStore=
function(a){c||(c=new r.ca(a));return c};a.createDeviceSettings=function(a){null==e&&(e=new u.aa(a));return e}})(c.DataServiceModule||(c.DataServiceModule={}));return c});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_service_data",["require","prezi.engine.dom","prezi_bacon","prezi_editor_error","prezi_editor_store_ui","prezi_externalserviceprovider","prezi_featureswitcher","prezi_logger","prezi_nativeapitypes"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_service_data.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi_bacon"),require("prezi_editor_error"),require("prezi_editor_store_ui"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_logger"),require("prezi_nativeapitypes"));}else{this["prezi_service_data"]=__factory(this["prezi.engine.dom"],this["prezi_bacon"],this["prezi_editor_error"],this["prezi_editor_store_ui"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_logger"],this["prezi_nativeapitypes"]);}}).call(this);