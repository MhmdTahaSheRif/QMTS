;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_cet_model_editor";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.engine.dom.converter.xpdom2":dependencies[1],"prezi.geometry":dependencies[2],"prezi_app_utils":dependencies[3],"prezi_bacon":dependencies[4],"prezi_cet":dependencies[5],"prezi_cet_model":dependencies[6],"prezi_cet_renderer":dependencies[7],"prezi_editor_error":dependencies[8],"prezi_externalserviceprovider":dependencies[9],"prezi_featureswitcher":dependencies[10],"prezi_i18n":dependencies[11],"prezi_logger":dependencies[12],"prezi_nativeapitypes":dependencies[13],"prezi_ppt_service":dependencies[14],"prezi_service_assetloader":dependencies[15],"prezi_service_data":dependencies[16],"prezi_service_fontcatalogue":dependencies[17],"prezi_service_media":dependencies[18],"prezi_templateservice":dependencies[19],"prezi_textmodel":dependencies[20],"prezi_utils":dependencies[21]}};})());};})(arguments);var moduleImpl=(function(){return module(function(J){function Xc(){return Mb(this,void 0,void 0,function*(){return new Promise((a)=>require([J.getResourceUrl("opentype.min.js")],a))})}function Yc(a){return Mb(this,void 0,void 0,function*(){return(yield(yield fetch(a)).arrayBuffer()).slice(16)})}function Zc(a){let b=tc[a];null==b&&(b=Promise.all([Xc(),Yc(a)]).then(([a,b])=>a.parse(b)),tc[a]=b);return b}function Pa(a){if(a===k.DOM.ENUMS().FONT_ORIGIN().BRAND_KIT())return d.base.FontOrigin.brandKit;if(a===k.DOM.ENUMS().FONT_ORIGIN().PREZI())return d.base.FontOrigin.prezi;
throw Error("Invalid font origin");}function uc(a){return null==a?null:{boldItalicKeg:null!=a.boldItalicKeg?{source:a.boldItalicKeg.source,origin:Pa(a.boldItalicKeg.origin)}:null,normalKeg:null!=a.normalKeg?{source:a.normalKeg.source,origin:Pa(a.normalKeg.origin)}:null,boldKeg:null!=a.boldKeg?{source:a.boldKeg.source,origin:Pa(a.boldKeg.origin)}:null,italicKeg:null!=a.italicKeg?{source:a.italicKeg.source,origin:Pa(a.italicKeg.origin)}:null,fontFamily:a.fontFamily,hasBold:a.hasBold,hasBoldItalic:a.hasBoldItalic,
hasItalic:a.hasItalic,hasNormal:a.hasNormal}}function vc(a){"default"===a&&(a="Arimo");return uc(U.getBuiltinFontDescriptionByFamily(a))}function wc(a,b){a=a.getFontClasses().iterator();let c="default",e=d.base.FontWeight.Normal,h=d.base.FontStyle.Normal;for(;a.hasNext();){const d=a.next();if(d.getName()===b){c=d.getFontFamily();e=d.getFontWeight();h=d.getFontStyle();break}}return{family:c,weight:e,style:h}}function kb(a,b){if(null==b)return null;var c=l.Cet.createHierarchyQuery(a).getParentOrOverview(b.getEntity());
c=a.getEntityById(c);null!=c&&c.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER)&&(c=c.getMutableWrapper(f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic(),c=null==c?null:c.getEntity());const e=l.Cet.createTopicChildrenQuery(a);return xc(a,c,(a)=>{a=a.designator.kind;switch(a){case V.content:return e.hasBehavior(b.getId(),l.TopicChildBehavior.Content);case V.cover:return e.hasBehavior(b.getId(),l.TopicChildBehavior.Cover);case V.visual:return e.hasBehavior(b.getId(),l.TopicChildBehavior.Visual);case V.master:return e.hasBehavior(b.getId(),
l.TopicChildBehavior.Master);case V.surface:return e.hasBehavior(b.getId(),l.TopicChildBehavior.Surface);default:n.Utils.assertNever(a)}})}function za(a,b){if(null==b)return null;const c=b.getEntity().getOwner();return xc(a,c,(a)=>0<=a.groups.indexOf(b))}function xc(a,b,c){if(null==b)return null;var e=[];if(b.isDef(f.CetModel.ID.HAS_CONTENT_GROUPS)){const a=b.getMutableWrapperChecked(f.CetModel.ID.HAS_CONTENT_GROUPS.W);e.push({kind:V.content,wrapper:a})}b.isDef(f.CetModel.ID.HAS_TOPIC_GROUPS)&&(b=
b.getMutableWrapperChecked(f.CetModel.ID.HAS_TOPIC_GROUPS.W),e.push({kind:V.cover,wrapper:b}),e.push({kind:V.visual,wrapper:b}),e.push({kind:V.surface,wrapper:b}),e.push({kind:V.master,wrapper:b}));for(const b of e)if(e=new Nb(a,b),null!=e.groups&&c(e))return e;return null}function na(a){a=a.getPreziW();l.Cet.pathKludge.assertEditorPathV2(a);return a.getMutableEditorPath().getMutableSteps()}function $c(a){a=a.getPreziW();l.Cet.pathKludge.assertEditorPathV2(a);return a.getEditorPath().getSteps()}function ad(){return new class{constructor(){this.BACKGROUND=
-1;this.NEXT_PATH_STEP=-2;this.NEXT_ZOOM=-3}copier(){null==this._copier&&(this._copier=k.DOM.IPreziCopy());return this._copier}createPlaybackPathStepFrom(a){const b=this.copier();let c;if(a.is(f.CetModel.ID.FLY_TO_OBJECT_EP))c=k.DOM.createFlyToObject(a.getTarget());else if(a.is(f.CetModel.ID.FLY_TO_OVERVIEW_EP))c=k.DOM.createFlyToOverview();else throw Error();c.setActions(k.DOM.createArrayPathAction([...a.getActions()].map((a)=>this.createPlaybackPathActionFrom(a))));c.setComingFrom(null==a.getComingFrom()?
null:b.copyComingFrom(a.getComingFrom().toIPdom()));c.setNarrative(null==a.getNarrative()?null:b.copyNarrative(a.getNarrative().toIPdom()));c.setStartPointToken(a.getStartPointToken());c.setSound(null==a.getSound()?null:b.copySound(a.getSound().toIPdom()));c.setPathSounds(k.DOM.createArrayPathSound([...a.getPathSounds()].map((a)=>this.copyPathSound(a))));return c}createPlaybackPathActionFrom(a){const b=this.copier();let c;if(a.is(f.CetModel.ID.ZOOM_TO_OVERVIEW_EP))c=k.DOM.createZoomToOverview();else if(a.is(f.CetModel.ID.ZOOM_TO_OBJECT_EP))c=
k.DOM.createZoomToObject(a.getTarget());else if(a.is(f.CetModel.ID.FADE_IN_OBJECT_EP))c=k.DOM.createFadeInObject(a.getTarget());else if(a.is(f.CetModel.ID.FADE_IN_OBJECTS_EP))c=k.DOM.createFadeInObjects().setTargets(k.DOM.createArrayRef([...a.getTargets().items()])).setTargetGroups(k.DOM.createArrayRef([...a.getTargetGroups().items()]));else if(a.is(f.CetModel.ID.FADE_OUT_OBJECT_EP))c=k.DOM.createFadeOutObject(a.getTarget());else if(a.is(f.CetModel.ID.FADE_OUT_OBJECTS_EP))c=k.DOM.createFadeOutObjects().setTargets(k.DOM.createArrayRef([...a.getTargets().items()])).setTargetGroups(k.DOM.createArrayRef([...a.getTargetGroups().items()]));
else throw Error();c.setNarrative(null==a.getNarrative()?null:b.copyNarrative(a.getNarrative().toIPdom()));c.setStartPointToken(a.getStartPointToken());c.setPathSounds(k.DOM.createArrayPathSound([...a.getPathSounds()].map((a)=>this.copyPathSound(a))));return c}copyPathSound(a){const b=k.DOM.createPathSound();b.setAssetSourceFilename(a.getAssetSourceFilename());b.setAudioType(a.getAudioType());b.setLoop(a.getLoop());b.setMediaLength(a.getMediaLength());b.setOfflineAssetId(a.getOfflineAssetId());b.setOnlineAssetId(a.getOnlineAssetId());
b.setOnlineAssetUrl(a.getOnlineAssetUrl());a=a.getPlaybackLengthUserIntent();a.is(f.CetModel.ID.BACKGROUND_SOUND)?b.setPathLength(this.BACKGROUND):a.is(f.CetModel.ID.NEXT_PATH_STEP)?b.setPathLength(this.NEXT_PATH_STEP):a.is(f.CetModel.ID.NEXT_ZOOM)&&b.setPathLength(this.NEXT_ZOOM);return b}postProcessPath(a){const b=a.length+a.map((a)=>a.getActions().length()).reduce((a,b)=>a+b,0),c=(a,c,d)=>{for(let e=0;e<a.length();e++){const h=a.get(e);if(h.getPathLength()===this.BACKGROUND)h.setPathLength(b);
else if(h.getPathLength()===this.NEXT_PATH_STEP)h.setPathLength(c.getActions().length()-d);else if(h.getPathLength()===this.NEXT_ZOOM){let a=d+1;for(;a<c.getActions().length();a++){const b=c.getActions().get(a);if(b.getObjectType()===k.PathActionType.ZOOM_TO_OVERVIEW||b.getObjectType()===k.PathActionType.ZOOM_TO_OBJECT)break}h.setPathLength(a-d)}else throw Error("Invalid path sound length");}};for(let b of a)for(c(b.getPathSounds(),b,-1),a=0;a<b.getActions().length();a++)c(b.getActions().get(a).getPathSounds(),
b,a)}}}function Wa(a,b){var c,e;b="toIPdom"in b?b.toIPdom():b;const h=b.getComingFrom();return{targetId:null!==(e=null===(c=k.DOM.RuntimeTypeInfo().safeCastToHasTarget(b))||void 0===c?void 0:c.getTarget())&&void 0!==e?e:a.getPreziW().getOverview().getId(),comingFrom:(null===h||void 0===h?void 0:h.getObjectType())===k.ComingFromType.TOPIC_REF?h.getTarget():null}}function bd(a,b,c){Ob(a,b,c,!1,(a)=>a.getPlaybackLengthUserIntent().is(f.CetModel.ID.NEXT_PATH_STEP),()=>k.DOM.createNextPathStep())}function cd(a){return[...a.getPathSounds()].find((a)=>
a.getPlaybackLengthUserIntent().is(f.CetModel.ID.NEXT_PATH_STEP))}function dd(a,b,c){Ob(a,b,c,!0,(a)=>a.getPlaybackLengthUserIntent().is(f.CetModel.ID.BACKGROUND_SOUND),()=>k.DOM.createBackgroundSound())}function ed(a){return[...a.getPathSounds()].find((a)=>a.getPlaybackLengthUserIntent().is(f.CetModel.ID.BACKGROUND_SOUND))}function fd(a,b,c){Ob(a,b,c,!1,()=>!0,()=>k.DOM.createNextZoom())}function gd(a){return[...a.getPathSounds()].find((a)=>a.getPlaybackLengthUserIntent().is(f.CetModel.ID.NEXT_ZOOM))}
function Ob(a,b,c,e,h,d){for(let b=a.getMutablePathSounds().length()-1;0<=b;b--)h(a.getPathSounds().getAt(b))&&a.getMutablePathSounds().removeAt(b);null!=c&&(g.Check.audio("sound",c),h=k.DOM.createEditorPathSound(),h.setOnlineAssetUrl(c.url),h.setAudioType(c.audioType),h.setMediaLength(c.mediaLengthMilliSecs),h.setOfflineAssetId(c.offlineAssetId),h.setOnlineAssetId(c.onlineAssetId),h.setAssetSourceFilename(c.assetSourceFilename),h.setPlaybackLengthUserIntent(d()),h.setLoop(e),a.getMutablePathSounds().add(f.CetModel.ID.EDITOR_PATH_SOUND.inflate(b,
h)))}function L(a){if(null!==a)return a}function hd(a){switch(a){case d.base.FillKind.linear:return f.FillType.Linear;case d.base.FillKind.radial:return f.FillType.Radial;case d.base.FillKind.solid:return f.FillType.Solid;default:return null}}function id(a){switch(a){case f.FillType.Linear:return d.base.FillKind.linear;case f.FillType.Radial:return d.base.FillKind.radial;case f.FillType.Solid:return d.base.FillKind.solid;default:return null}}function yc(a,b){return a.transform(q.Geometry.transform2dIdentity().scaleAroundPoint(a.getCenter(),
b))}function zc(a,b){if(!a.containsPoint(b.getCenter())||b.containsRect(q.Geometry.obbFromRect(a.getBounds().getData())))return!1;if(!yc(b,.75).getVertices().some((b)=>!a.containsPoint(b)))return!0;const c=yc(b,.5).getVertices();b=b.getVertices();for(let e=0;4>e;e++)if(a.containsPoint(b[(e+0)%4])&&a.containsPoint(b[(e+1)%4])&&a.containsPoint(c[(e+2)%4])&&a.containsPoint(c[(e+3)%4]))return!0;return!1}function jd(a){switch(a){case X.Alignment.RIGHT:return d.base.TextAlignment.Right;case X.Alignment.LEFT:return d.base.TextAlignment.Left;
case X.Alignment.CENTER:return d.base.TextAlignment.Center;case X.Alignment.JUSTIFY:return d.base.TextAlignment.Justify;default:throw Error("Unexpected object: "+a);}}function kd(a){switch(a){case d.base.TextAlignment.Right:return X.Alignment.RIGHT;case d.base.TextAlignment.Left:return X.Alignment.LEFT;case d.base.TextAlignment.Center:return X.Alignment.CENTER;case d.base.TextAlignment.Justify:return X.Alignment.JUSTIFY;default:n.Utils.assertNever(a)}}function ld(a){switch(a){case d.base.TextListType.Bullet:return X.ListType.BULLET;
case d.base.TextListType.None:return X.ListType.NONE;default:n.Utils.assertNever(a)}}function Ac(a){const b=new Map;a=[...a.getSteps()];var c=a[0];n.Utils.assert(c.is(f.CetModel.ID.FLY_TO_OVERVIEW_EP),"First step should be a FlyToOverview");c={kind:R.Root,wrapper:c,children:[],indexToStep:[]};b.set(c.wrapper.getId(),c);let e=c,h=c.wrapper;const d=(a)=>{b.set(a.wrapper.getId(),a);e.children.push(a);e.indexToStep.push(h)},r=(a)=>{a.getActions().forEach((b)=>{d({kind:R.Free,parent:e,wrapper:b,step:a})})};
r(c.wrapper);for(let c=1;c<a.length;c++){var D=a[c];if(null==D.getComingFrom())n.Utils.assert(D.is(f.CetModel.ID.FLY_TO_OBJECT_EP),"Step should be FlyToObject or have comingFrom"),D={kind:R.Visit,parent:e,children:[],back:null,indexToStep:[],wrapper:D},d(D),e=D,h=D.wrapper,r(D.wrapper);else{D={kind:R.BackToParent,parent:e,wrapper:D};n.Utils.assert(e.kind!==R.Root,"Coming back from rootnode?");const a=e;b.set(D.wrapper.getId(),D);a.back=D;a.indexToStep.push(h);e=a.parent;h=D.wrapper;r(D.wrapper)}}c.indexToStep.push(h);
return b}function Pb(a){throw Error(`parent.kind = ${a.kind}`);}function Bc(a,b){return 1===b.length&&0===a.length?y.I18n.ts("Group"):0<b.length?y.I18n.ts("Multiple objects"):1===a.length?(a=a[0],a.is(d.base.ObjectKind.topic)?(b=d.CetModelEditor.calculatePageOrTopicTitle(a),a.parent.is(d.base.ObjectKind.overview)?null==b?y.I18n.ts("Topic"):y.I18n.tsFormatKeys("Topic \u2018{title}\u2019",{title:b}):null==b?y.I18n.ts("Subtopic"):y.I18n.tsFormatKeys("Subtopic \u2018{title}\u2019",{title:b})):a.is(d.base.ObjectKind.page)?
(a=d.CetModelEditor.calculatePageOrTopicTitle(a),null==a?y.I18n.ts("Page"):y.I18n.tsFormatKeys("Page \u2018{title}\u2019",{title:a})):md(a)):1<a.length?y.I18n.ts("Multiple objects"):""}function md(a){if(a.is(d.base.ObjectKind.arrow))return y.I18n.ts("Arrow");if(a.is(d.base.ObjectKind.line))return y.I18n.ts("Line");if(a.is(d.base.ObjectKind.bracketFrame))return y.I18n.ts("Bracket");if(a.is(d.base.ObjectKind.chart))return y.I18n.ts("Chart");if(a.is(d.base.ObjectKind.image))return y.I18n.ts("Image");
if(a.is(d.base.ObjectKind.animatedImage))return y.I18n.ts("Animated image");if(a.is(d.base.ObjectKind.marker))return y.I18n.ts("Marker");if(a.is(d.base.ObjectKind.pdf))return y.I18n.ts("PDF");if(a.is(d.base.ObjectKind.shape))switch(a=a.shapeKind,a){case "circle":return y.I18n.ts("Circle");case "triangle":return y.I18n.ts("Triangle");case "rectangle":return y.I18n.ts("Rectangle");default:n.Utils.assertNever(a)}else{if(a.is(d.base.ObjectKind.slide))return y.I18n.ts("Slide");if(a.is(d.base.ObjectKind.swf))return y.I18n.ts("Image");
if(a.is(d.base.ObjectKind.text))return a.isPlaceholder?y.I18n.ts("Text"):`"${a.getText().trim()}"`;if(a.is(d.base.ObjectKind.unknownObject))return"";if(a.is(d.base.ObjectKind.video))return y.I18n.ts("Video");if(a.is(d.base.ObjectKind.zoomArea))return Fa.isActive("js-unique-differentiation")?y.I18n.ts("Frame"):y.I18n.ts("Area");n.Utils.assertNever(a)}}function*Cc(a){for(const b of a.getSteps()){yield{kind:Ga.step,value:b};for(const a of b.getActions())yield{kind:Ga.action,value:a}}}function Dc(a,b){return[...Cc(b)].filter((b)=>
b.kind===Ga.action?!0:!(0,C.shouldSkipStep)(a,b.value))}function Ec(a,b){return Dc(a,b).filter((a)=>a.kind===Ga.step||a.value.is(f.CetModel.ID.ZOOM_TO_OBJECT_EP)||a.value.is(f.CetModel.ID.ZOOM_TO_OVERVIEW_EP))}function Fc(a,b,c){const e={create:(e)=>{for(let a of b)if(e.isDef(a.getDef()))return e=e.getMutableWrapper(a),c(e);return a.create(e)},add:(a,b)=>Fc(e,Array.isArray(a)?a:[a],b)};return e}function nd(a){return Y(this,void 0,void 0,function*(){return new Promise((b,c)=>{a.getFontsLoadedProperty().filter((a)=>
a).take(1).onValue(()=>{b()});a.getFontLoadErrorPropery().filter((a)=>null!=a).take(1).onValue((a)=>{a.error.type!==lb.AssetLoadErrorType.NotFound&&a.error.type!==lb.AssetLoadErrorType.AssetProcessingError&&c(a.error)})})})}function od(a){return Y(this,void 0,void 0,function*(){yield a.getMediaAssetInfoStatusProperty().filter((a)=>a).toPromise()})}function mb(a){return Math.trunc(Math.round(2E3*a)/100)/20}function pd(a){return!Gc(a)&&null!=k.DOM.RuntimeTypeInfo().safeCastToHasChildrenDeprecated(a)}
var qd=null,rd=J.dependencies["prezi.engine.dom"],sd=J.dependencies["prezi.engine.dom.converter.xpdom2"],td=J.dependencies["prezi.geometry"],ud=J.dependencies.prezi_app_utils,Qb=J.dependencies.prezi_bacon,vd=J.dependencies.prezi_cet_model,F=J.dependencies.prezi_cet_renderer,nb=J.dependencies.prezi_editor_error,wd=J.dependencies.prezi_externalserviceprovider,xd=J.dependencies.prezi_featureswitcher,yd=J.dependencies.prezi_i18n,Q=J.dependencies.prezi_logger,ob=J.dependencies.prezi_nativeapitypes,M=J.dependencies.prezi_service_data,
zd=J.dependencies.prezi_service_fontcatalogue,Hc=J.dependencies.prezi_service_media,Rb=J.dependencies.prezi_templateservice,Ad=J.dependencies.prezi_utils,X=J.dependencies.prezi_textmodel,l=J.dependencies.prezi_cet,Xa={isKindDescendantOf:function(a,b){switch(b){case d.base.ObjectKind.animatedImage:return a===d.base.ObjectKind.animatedImage;case d.base.ObjectKind.arc:return a===d.base.ObjectKind.arrow||a===d.base.ObjectKind.line;case d.base.ObjectKind.arrow:return a===d.base.ObjectKind.arrow;case d.base.ObjectKind.backToParent:return a===
d.base.ObjectKind.backToParent;case d.base.ObjectKind.background:return a===d.base.ObjectKind.background;case d.base.ObjectKind.backgroundLayer:return a===d.base.ObjectKind.backgroundLayer;case d.base.ObjectKind.base:return a===d.base.ObjectKind.animatedImage||a===d.base.ObjectKind.arrow||a===d.base.ObjectKind.backToParent||a===d.base.ObjectKind.background||a===d.base.ObjectKind.backgroundLayer||a===d.base.ObjectKind.bracketFrame||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.cover||a===d.base.ObjectKind.fadeIn||
a===d.base.ObjectKind.fadeOut||a===d.base.ObjectKind.group||a===d.base.ObjectKind.image||a===d.base.ObjectKind.line||a===d.base.ObjectKind.marker||a===d.base.ObjectKind.master||a===d.base.ObjectKind.overview||a===d.base.ObjectKind.page||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.planetTopic||a===d.base.ObjectKind.shape||a===d.base.ObjectKind.slide||a===d.base.ObjectKind.stackTopic||a===d.base.ObjectKind.structuredPath||a===d.base.ObjectKind.surface||a===d.base.ObjectKind.swf||a===d.base.ObjectKind.text||
a===d.base.ObjectKind.unknownObject||a===d.base.ObjectKind.video||a===d.base.ObjectKind.visitOverview||a===d.base.ObjectKind.visitPage||a===d.base.ObjectKind.visitPlanet||a===d.base.ObjectKind.visitStack||a===d.base.ObjectKind.visual||a===d.base.ObjectKind.zoom||a===d.base.ObjectKind.zoomArea;case d.base.ObjectKind.bracketFrame:return a===d.base.ObjectKind.bracketFrame;case d.base.ObjectKind.chart:return a===d.base.ObjectKind.chart;case d.base.ObjectKind.cover:return a===d.base.ObjectKind.cover;case d.base.ObjectKind.fadeIn:return a===
d.base.ObjectKind.fadeIn;case d.base.ObjectKind.fadeOut:return a===d.base.ObjectKind.fadeOut;case d.base.ObjectKind.freePathChild:return a===d.base.ObjectKind.fadeIn||a===d.base.ObjectKind.fadeOut||a===d.base.ObjectKind.zoom;case d.base.ObjectKind.group:return a===d.base.ObjectKind.group;case d.base.ObjectKind.hyperlink:return a===d.base.ObjectKind.animatedImage||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.image||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.shape||a===d.base.ObjectKind.slide||
a===d.base.ObjectKind.swf;case d.base.ObjectKind.image:return a===d.base.ObjectKind.image;case d.base.ObjectKind.line:return a===d.base.ObjectKind.line;case d.base.ObjectKind.lockable:return a===d.base.ObjectKind.animatedImage||a===d.base.ObjectKind.arrow||a===d.base.ObjectKind.bracketFrame||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.image||a===d.base.ObjectKind.line||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.shape||a===d.base.ObjectKind.slide||a===d.base.ObjectKind.swf||a===d.base.ObjectKind.text||
a===d.base.ObjectKind.video;case d.base.ObjectKind.marker:return a===d.base.ObjectKind.marker;case d.base.ObjectKind.master:return a===d.base.ObjectKind.master;case d.base.ObjectKind.object:return a===d.base.ObjectKind.animatedImage||a===d.base.ObjectKind.arrow||a===d.base.ObjectKind.bracketFrame||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.image||a===d.base.ObjectKind.line||a===d.base.ObjectKind.marker||a===d.base.ObjectKind.page||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.planetTopic||
a===d.base.ObjectKind.shape||a===d.base.ObjectKind.slide||a===d.base.ObjectKind.stackTopic||a===d.base.ObjectKind.swf||a===d.base.ObjectKind.text||a===d.base.ObjectKind.unknownObject||a===d.base.ObjectKind.video||a===d.base.ObjectKind.zoomArea;case d.base.ObjectKind.overview:return a===d.base.ObjectKind.overview;case d.base.ObjectKind.page:return a===d.base.ObjectKind.page;case d.base.ObjectKind.pathChild:return a===d.base.ObjectKind.fadeIn||a===d.base.ObjectKind.fadeOut||a===d.base.ObjectKind.visitPage||
a===d.base.ObjectKind.visitPlanet||a===d.base.ObjectKind.visitStack||a===d.base.ObjectKind.zoom;case d.base.ObjectKind.pathElement:return a===d.base.ObjectKind.backToParent||a===d.base.ObjectKind.fadeIn||a===d.base.ObjectKind.fadeOut||a===d.base.ObjectKind.visitOverview||a===d.base.ObjectKind.visitPage||a===d.base.ObjectKind.visitPlanet||a===d.base.ObjectKind.visitStack||a===d.base.ObjectKind.zoom;case d.base.ObjectKind.pathParent:return a===d.base.ObjectKind.visitOverview||a===d.base.ObjectKind.visitPage||
a===d.base.ObjectKind.visitPlanet||a===d.base.ObjectKind.visitStack;case d.base.ObjectKind.pdf:return a===d.base.ObjectKind.pdf;case d.base.ObjectKind.planetTopic:return a===d.base.ObjectKind.planetTopic;case d.base.ObjectKind.shape:return a===d.base.ObjectKind.shape;case d.base.ObjectKind.simpleObject:return a===d.base.ObjectKind.animatedImage||a===d.base.ObjectKind.arrow||a===d.base.ObjectKind.bracketFrame||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.image||a===d.base.ObjectKind.line||a===
d.base.ObjectKind.marker||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.shape||a===d.base.ObjectKind.slide||a===d.base.ObjectKind.swf||a===d.base.ObjectKind.text||a===d.base.ObjectKind.unknownObject||a===d.base.ObjectKind.video||a===d.base.ObjectKind.zoomArea;case d.base.ObjectKind.simpleObjectParent:return a===d.base.ObjectKind.cover||a===d.base.ObjectKind.master||a===d.base.ObjectKind.overview||a===d.base.ObjectKind.page||a===d.base.ObjectKind.planetTopic||a===d.base.ObjectKind.surface||a===
d.base.ObjectKind.visual;case d.base.ObjectKind.slide:return a===d.base.ObjectKind.slide;case d.base.ObjectKind.stackTopic:return a===d.base.ObjectKind.stackTopic;case d.base.ObjectKind.structuredPath:return a===d.base.ObjectKind.structuredPath;case d.base.ObjectKind.styled:return a===d.base.ObjectKind.arrow||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.image||a===d.base.ObjectKind.line||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.shape||a===d.base.ObjectKind.swf||a===d.base.ObjectKind.text;
case d.base.ObjectKind.surface:return a===d.base.ObjectKind.surface;case d.base.ObjectKind.swf:return a===d.base.ObjectKind.swf;case d.base.ObjectKind.text:return a===d.base.ObjectKind.text;case d.base.ObjectKind.topic:return a===d.base.ObjectKind.planetTopic||a===d.base.ObjectKind.stackTopic;case d.base.ObjectKind.topicParent:return a===d.base.ObjectKind.overview||a===d.base.ObjectKind.planetTopic;case d.base.ObjectKind.transformedObject:return a===d.base.ObjectKind.animatedImage||a===d.base.ObjectKind.arrow||
a===d.base.ObjectKind.bracketFrame||a===d.base.ObjectKind.chart||a===d.base.ObjectKind.image||a===d.base.ObjectKind.line||a===d.base.ObjectKind.marker||a===d.base.ObjectKind.pdf||a===d.base.ObjectKind.planetTopic||a===d.base.ObjectKind.shape||a===d.base.ObjectKind.slide||a===d.base.ObjectKind.stackTopic||a===d.base.ObjectKind.swf||a===d.base.ObjectKind.text||a===d.base.ObjectKind.unknownObject||a===d.base.ObjectKind.video||a===d.base.ObjectKind.zoomArea;case d.base.ObjectKind.unknownObject:return a===
d.base.ObjectKind.unknownObject;case d.base.ObjectKind.video:return a===d.base.ObjectKind.video;case d.base.ObjectKind.visitOverview:return a===d.base.ObjectKind.visitOverview;case d.base.ObjectKind.visitPage:return a===d.base.ObjectKind.visitPage;case d.base.ObjectKind.visitPlanet:return a===d.base.ObjectKind.visitPlanet;case d.base.ObjectKind.visitStack:return a===d.base.ObjectKind.visitStack;case d.base.ObjectKind.visitTopic:return a===d.base.ObjectKind.visitPlanet||a===d.base.ObjectKind.visitStack;
case d.base.ObjectKind.visual:return a===d.base.ObjectKind.visual;case d.base.ObjectKind.zoom:return a===d.base.ObjectKind.zoom;case d.base.ObjectKind.zoomArea:return a===d.base.ObjectKind.zoomArea;default:throw Error("invalid object kind "+a);}}};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.EditorCacheBase=class{animatedImage(a){return this.lookupI(a,d.base.ObjectKind.animatedImage)}arc(a){return this.lookupI(a,d.base.ObjectKind.arc)}arrow(a){return this.lookupI(a,d.base.ObjectKind.arrow)}backToParent(a){return this.lookupI(a,
d.base.ObjectKind.backToParent)}background(a){return this.lookupI(a,d.base.ObjectKind.background)}backgroundLayer(a){return this.lookupI(a,d.base.ObjectKind.backgroundLayer)}base(a){return this.lookupI(a,d.base.ObjectKind.base)}bracketFrame(a){return this.lookupI(a,d.base.ObjectKind.bracketFrame)}chart(a){return this.lookupI(a,d.base.ObjectKind.chart)}cover(a){return this.lookupI(a,d.base.ObjectKind.cover)}fadeIn(a){return this.lookupI(a,d.base.ObjectKind.fadeIn)}fadeOut(a){return this.lookupI(a,
d.base.ObjectKind.fadeOut)}freePathChild(a){return this.lookupI(a,d.base.ObjectKind.freePathChild)}group(a){return this.lookupI(a,d.base.ObjectKind.group)}hyperlink(a){return this.lookupI(a,d.base.ObjectKind.hyperlink)}image(a){return this.lookupI(a,d.base.ObjectKind.image)}line(a){return this.lookupI(a,d.base.ObjectKind.line)}lockable(a){return this.lookupI(a,d.base.ObjectKind.lockable)}marker(a){return this.lookupI(a,d.base.ObjectKind.marker)}master(a){return this.lookupI(a,d.base.ObjectKind.master)}object(a){return this.lookupI(a,
d.base.ObjectKind.object)}overview(a){return this.lookupI(a,d.base.ObjectKind.overview)}page(a){return this.lookupI(a,d.base.ObjectKind.page)}pathChild(a){return this.lookupI(a,d.base.ObjectKind.pathChild)}pathElement(a){return this.lookupI(a,d.base.ObjectKind.pathElement)}pathParent(a){return this.lookupI(a,d.base.ObjectKind.pathParent)}pdf(a){return this.lookupI(a,d.base.ObjectKind.pdf)}planetTopic(a){return this.lookupI(a,d.base.ObjectKind.planetTopic)}shape(a){return this.lookupI(a,d.base.ObjectKind.shape)}simpleObject(a){return this.lookupI(a,
d.base.ObjectKind.simpleObject)}simpleObjectParent(a){return this.lookupI(a,d.base.ObjectKind.simpleObjectParent)}slide(a){return this.lookupI(a,d.base.ObjectKind.slide)}stackTopic(a){return this.lookupI(a,d.base.ObjectKind.stackTopic)}structuredPath(a){return this.lookupI(a,d.base.ObjectKind.structuredPath)}styled(a){return this.lookupI(a,d.base.ObjectKind.styled)}surface(a){return this.lookupI(a,d.base.ObjectKind.surface)}swf(a){return this.lookupI(a,d.base.ObjectKind.swf)}text(a){return this.lookupI(a,
d.base.ObjectKind.text)}topic(a){return this.lookupI(a,d.base.ObjectKind.topic)}topicParent(a){return this.lookupI(a,d.base.ObjectKind.topicParent)}transformedObject(a){return this.lookupI(a,d.base.ObjectKind.transformedObject)}unknownObject(a){return this.lookupI(a,d.base.ObjectKind.unknownObject)}video(a){return this.lookupI(a,d.base.ObjectKind.video)}visitOverview(a){return this.lookupI(a,d.base.ObjectKind.visitOverview)}visitPage(a){return this.lookupI(a,d.base.ObjectKind.visitPage)}visitPlanet(a){return this.lookupI(a,
d.base.ObjectKind.visitPlanet)}visitStack(a){return this.lookupI(a,d.base.ObjectKind.visitStack)}visitTopic(a){return this.lookupI(a,d.base.ObjectKind.visitTopic)}visual(a){return this.lookupI(a,d.base.ObjectKind.visual)}zoom(a){return this.lookupI(a,d.base.ObjectKind.zoom)}zoomArea(a){return this.lookupI(a,d.base.ObjectKind.zoomArea)}};var n=Ad,k=rd,q=td,f=vd,lb=wd,Aa={};Object.defineProperty(Aa,"__esModule",{value:!0});Aa.NoBehaviorExtensions=class{constructor(){this.planetLayouter=new class{isValid(){return!1}apply(){return!1}};
this.topicThemeApplicator=new class{apply(){return!1}};this.overviewLayouter=new class{isValid(){return!1}apply(){return!1}};this.contentLayouter=new class{isValid(){return!1}apply(){return!1}};this.stackLayouter=new class{isValid(){return!1}apply(){return!1}}}};var Ba={},Bd=this&&Ba.__awaiter||function(a,b,c,e){function h(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,d){function p(a){try{f(e.next(a))}catch(t){d(t)}}function r(a){try{f(e["throw"](a))}catch(t){d(t)}}
function f(a){a.done?c(a.value):h(a.value).then(p,r)}f((e=e.apply(a,b||[])).next())})};Object.defineProperty(Ba,"__esModule",{value:!0});class Ic{constructor(a,b){this.mscene=b;this.intent=a.intent;this.mscene=b}}class Cd extends Ic{constructor(a,b,c,e){super(b,c);this.documentUpdater=a;this.token=b;this.createApi=e;this.lscene=c}commit(){this.lscene.commit(this.token)}applyStyleDefinition(a){this.lscene.applyStyleDefinition(this.token,a)}documentMerge(a,b){this.lscene.documentMerge(this.token,a,
b)}updateWithIPrezi(a){return Bd(this,void 0,void 0,function*(){yield this.documentUpdater.updateWithIPrezi(a)})}get api(){null==this._api&&(this._api=this.createApi());return this._api}kill(){null!=this._api&&(this._api.kill(),this._api=null)}}Ba.NoMediaAssetPatcher=class{createId(){throw Error("Method not implemented.");}addOfflineOnlinePatch(){}setNewAssetId(){throw Error("Method not implemented.");}addPatch(a){return a}addPatchFromTransaction(a){return a}addError(a){return a}getRecentAssetId(){return null}};
Ba.RunnerImpl=class{constructor(a,b,c,e=new Aa.NoBehaviorExtensions,h=new Ba.NoMediaAssetPatcher){this.documentUpdater=a;this.scene=b;this.assetLoaderProvider=c;this.behaviorExtensions=e;this.mediaAssetPatcher=h;this.logger=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.RunnerImpl")}beginAsyncApiCommand(a,b){const c=this.scene.beginTransaction(this.scene.createIntent(a),b);return{execute:(a)=>{let b=null;this.scene.executeInTransaction(c,(e)=>{b=this.runWithApi(c,e,(b)=>a(b))});
return b},end:()=>this.scene.endTransaction(c),rollback:()=>this.scene.rollbackTransaction(c)}}createApi(a,b){return new Z.BasePluginApiImpl(new Ic(a,b),l.Cet.createImagePatcher(this.mediaAssetPatcher),l.Cet.createChartPatcher(this.mediaAssetPatcher),l.Cet.createPdfPatcher(this.mediaAssetPatcher),this.behaviorExtensions,this.assetLoaderProvider)}runWithApi(a,b,c){a=this.createApi(a,b);try{return c(a)}finally{a.kill()}}executeApiCommand(a,b){return this.executeI((b,e)=>this.runWithApi(e,b,(b)=>a.run(b)),
a.name,b)}executeLegacyCommand(a,b){return this.executeI((b,e)=>{const c=new Cd(this.documentUpdater,e,b,()=>this.createApi(e,b));try{return a.runLegacy(c)}finally{c.kill()}},a.name,b)}initIntent(a,b){if(null==a.name||""===a.name){if(null==b||""===b)throw Error("Intent name should not be null");a.name=b}null==a.trigger&&(a.trigger="machine")}executeI(a,b,c){let e=null;e=null==c?this.scene.createIntent():this.scene.createIntent(c);this.initIntent(e,b);let h=null;this.scene.execute(e,(b,c)=>{h=a(b,
c)});return h}read(a){let b;this.scene.read((c,e)=>{c=this.createApi(e,c);try{b=a(c)}finally{c.kill()}});return b}};var y=yd,U=zd,pb={createFontDrawer:function(a,b){return Mb(this,void 0,void 0,function*(){const c=yield Zc(a.getFontUrl(b.fileWithOrigin));return new Dd(c)})}},Mb=this&&pb.__awaiter||function(a,b,c,e){function h(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,d){function p(a){try{f(e.next(a))}catch(t){d(t)}}function r(a){try{f(e["throw"](a))}catch(t){d(t)}}
function f(a){a.done?c(a.value):h(a.value).then(p,r)}f((e=e.apply(a,b||[])).next())})};Object.defineProperty(pb,"__esModule",{value:!0});const tc={};class Dd{constructor(a){this.font=a}getPath(a,b,c,e){return new Ed(this.font.getPath(a,b,c,e))}}class Ed{constructor(a){this.path=a}drawSvg(a=3){const b=this.getBoundingBox(),c=b.x2-b.x1,e=b.y2-b.y1;return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${[b.x1,b.y1,c,e]}" width="${c}" height="${e}">
			${this.path.toSVG(a)}
		</svg>`}drawIntoSvgPath(a=3){return this.path.toPathData(a)}drawIntoCanvasRenderingContext2D(a){this.path.draw(a)}getBoundingBox(){const a=this.path.getBoundingBox();return{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2}}}var K={};Object.defineProperty(K,"__esModule",{value:!0});K.FontDefinitionCache=class{static createlookupFontInfoFromScene(a){return(b)=>{b=wc(a.getPreziW().getDocumentStyle().toIPdom(),b);return{description:this.lookupFontDescription(a,b.family),weight:b.weight,style:b.style}}}static lookupFontDescription(a,
b){let c=vc(b);if(null!=c)return c;c=this.getFontDescriptionFromCache(a,b);if(null!=c)return c;this.buildFontFamilyMap(a);return this.getFontDescriptionFromCache(a,b)}static buildFontFamilyMap(a){this.entityIdByFontFamilyAndScene.set(a,new Map);const b=this.entityIdByFontFamilyAndScene.get(a);for(const c of a.getPreziW().getDocumentStyle().getFontFamilies())b.set(c.getName(),c.getId())}static getFontDescriptionFromCache(a,b){if(this.entityIdByFontFamilyAndScene.has(a)&&this.entityIdByFontFamilyAndScene.get(a).has(b)){const c=
this.entityIdByFontFamilyAndScene.get(a).get(b);a=a.lookup(c,f.CetModel.ID.FONT_FAMILY.W);if(null!=a&&a.getName()===b)return K.FontUtils.getFontDescriptionFromFontFamily(a.toIPdom())}return null}};K.FontDefinitionCache.entityIdByFontFamilyAndScene=new Map;K.FontUtils=class{static getFontClassName(a,b,c){return a+("bold"===b?"_B":"")+("italic"===c?"_I":"")}static getFontDescriptionFromFontFamily(a){const b=Array.from(n.Utils.toIterable(a.getFontFaces()));var c=(a,c)=>{var e=b.find((b)=>b.getFontStyle()===
a&&b.getFontWeight()===c);if(null==e)return null;e=e.getFontSrcWithOrigin();return{origin:Pa(e.getOrigin()),source:e.getSource()}};const e=c(U.FontStyle.Normal,U.FontWeight.Normal),h=c(U.FontStyle.Normal,U.FontWeight.Bold),d=c(U.FontStyle.Italic,U.FontWeight.Normal);c=c(U.FontStyle.Italic,U.FontWeight.Bold);return{fontFamily:a.getName(),hasItalic:null!=d,hasBold:null!=h,hasNormal:null!=e,hasBoldItalic:null!=c,boldItalicKeg:c,italicKeg:d,boldKeg:h,normalKeg:e}}static listDownloadableFontDescriptions(a){const b=
new Map(U.getBuiltinFontDescriptionsOrderedByName().map((a)=>[a.fontFamily,uc(a)]));if(null!=a)for(const c of a.getPreziW().getDocumentStyle().getFontFamilies())b.has(c.getName())||b.set(c.getName(),this.getFontDescriptionFromFontFamily(c.toIPdom()));a=[...b.values()];a.sort((a,b)=>a.fontFamily.localeCompare(b.fontFamily));return a}static createFont(a,b){const c=(a=U.FontWeight.Normal,c=U.FontStyle.Normal)=>{a=l.Cet.selectBestMatchingFontFace({fontWeight:a,fontStyle:c},U.getFontFaces(b).map((a)=>
({fontWeight:a.weight,fontStyle:a.style,fontFace:a})));if(null==a)throw new g.IllegalArgumentException("Font variation not supported");return a.fontFace};return Object.assign(Object.assign({},b),{downloaded:!0,getDrawer:(b,h)=>{const e=c(b,h);if(e.weight!==b||e.style!==h)throw new g.IllegalArgumentException("Font variation not supported");return pb.createFontDrawer(a,e)},getCompatibleDrawer:(b,h)=>pb.createFontDrawer(a,c(b,h))})}static createLookupFontInfoFromPreziData(a){return(b)=>{b=wc(a.getDocumentStyle(),
b);a:{var c=b.family;const h=vc(c);if(null!=h)var e=h;else{for(e of n.Utils.toIterable(a.getDocumentStyle().getFontFamilies()))if(e.getName()===c){e=K.FontUtils.getFontDescriptionFromFontFamily(e);break a}e=null}}return{description:e,style:b.style,weight:b.weight}}}static ensureFontFamily(a,b){const c=a.getPreziW().getMutableDocumentStyle().getMutableFontFamilies();if(!Array.from(c).find((a)=>a.getName()===b.fontFamily)){var e=U.getFontFaces(b).map((a)=>{const b=k.DOM.createFontFace(a.fileWithOrigin.source);
b.setFontStyle(a.style);b.setFontWeight(a.weight);a=k.DOM.createFontSourceWithOrigin(a.fileWithOrigin.origin,a.fileWithOrigin.source);b.setFontSrcWithOrigin(a);return b});K.FontUtils.getFontFamilyIndicesWithSameKeg(c,b).sort((a,b)=>b-a).forEach((a)=>c.removeAt(a));e=k.DOM.createFontFamily(k.DOM.createArrayFontFace(e));e.setName(b.fontFamily);c.add(f.CetModel.ID.FONT_FAMILY.inflate(a,e))}}static getFontFamilyIndicesWithSameKeg(a,b){const c=[b.normalKeg,b.italicKeg,b.boldKeg,b.boldItalicKeg].filter((a)=>
null!=a),e=[];Array.from(a).forEach((a,b)=>{for(let h of a.getFontFaces()){const a=null!=h.getFontSrcWithOrigin()?{source:h.getFontSrcWithOrigin().getSource(),origin:Pa(h.getFontSrcWithOrigin().getOrigin())}:{source:h.getFontSrc(),origin:d.base.FontOrigin.prezi};if(null!=c.find((b)=>K.FontUtils.isFontSoruceWithOriginEql(b,a))){e.push(b);break}}});return e}static isFontSoruceWithOriginEql(a,b){return a.origin===b.origin&&a.source===b.source}};var N={};Object.defineProperty(N,"__esModule",{value:!0});
N.StyleEditorImpl=class{constructor(a){this.mscene=a;this.logger=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.StyleEditorImpl")}static createStyleEditor(a){return new N.StyleEditorImpl(a)}static createStyleQuery(a){return new N.StyleEditorImpl(a)}setFontDescription(a,b){if(null!=a&&null!=b){this.fixInvariants();var c=this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontClasses(),e=l.Cet.shapedText(a.getEntity()),h=e.getBaseStyle();e=m.CetModelEditorInternal.createStyleQuery(this.mscene).getCharacterStyle(e,
0,this.findParagraphNumberFromOffset(e,0));var d=e.getFontWeightWithFallback(h),f=e.getFontStyleWithFallback(h),D=null,g=[];this.mscene.getPreziW().getDocumentStyle().getFontFamilies().forEach((a)=>{g.push(a.getName())});c.forEachMutable((a)=>{a.getFontFamily()===b.fontFamily&&a.getFontWeight()===d&&a.getFontStyle()===f&&(0>g.indexOf(b.fontFamily)?this.logger.error({action:"fontStyleSelected",object:"text",trigger:"user",payload:{missingFontFamily:b.fontFamily}}):D=a.getName())});null==D&&(D=K.FontUtils.getFontClassName(b.fontFamily,
d,f),this.addFontClass(D,b,d,f));a.setFontClass(D);this.removeUnusedClassesFamilies();this.removeDuplicatedFontFaces();this.logDuplicatedFontClassNames()}}addFontClass(a,b,c,e){K.FontUtils.ensureFontFamily(this.mscene,b);a=k.DOM.createFontClass(a);a.setFontFamily(b.fontFamily);e&&a.setFontStyle(e);c&&a.setFontWeight(c);this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontClasses().add(f.CetModel.ID.FONT_CLASS.inflate(this.mscene,a))}removeInvalidFontFaces(){const a=["null",null,""];let b=
!1;this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontFamilies().forEachMutable((c)=>{if(!c.getEntity().hasComponent(f.CetModel.PENDING_INSERT())){var e=[];c=c.getMutableFontFaces();var h=0;c.forEachMutable((b)=>{b=b.getFontSrcWithOrigin().getSource();0<=a.indexOf(b)&&e.push(h);++h});for(let a=e.length-1;0<=a;a--)c.removeAt(e[a]),b=!0}});return b?"removeInvalidFontFaces":null}fixInvariants(){const a=[this.removeInvalidFontFaces()].filter((a)=>null!=a);0<a.length&&this.logger.error({action:"fix-style-invariants",
object:"document",trigger:"setFontFamily",payload:{fixedInvariantDescriptions:a}})}getFontFamily(a){if(null==a)return null;a=this.getFontClassWForEntity(a);return null==a?null:a.getFontFamily()}getFontClassWForEntity(a){const b=this.mscene.getPreziW().getDocumentStyle().getFontClasses(),c=a.getFontClass();return[...b].find((a)=>c===a.getName())}removeUnusedClassesFamilies(){let a=[],b=!1;const c=new Set([...this.getFontClassesInTexts(this.mscene),...this.getFontClassesInStyles(this.mscene)]);let e=
0;var h=this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontClasses();h.forEachMutable((b)=>{null==b.getName()||c.has(b.getName())||a.push(e);e++});for(var d=a.length-1;0<=d;d--)h.removeAt(a[d]),b=!0;const f=[];h.forEachMutable((a)=>{null!=a.getFontFamily()&&f.push(a.getFontFamily())});e=0;a=[];h=this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontFamilies();h.forEachMutable((b)=>{b=b.getName();null!=b&&-1===f.indexOf(b)&&U.isBuiltinFont(b)&&a.push(e);e++});for(d=a.length-
1;0<=d;d--)h.removeAt(a[d]),b=!0;return b?"removeUnusedClassesFamilies":null}findThemeFontClassesInStyles(a){return[...this.getFontClassesInStyles(a)]}getFontClassesInStyles(a){const b=a.getPreziW().getDocumentStyle().getStyleDeclarations(),c=new Set;b.forEach((b)=>{const e=b.getStyleSelector().toString().split(".");2===e.length&&e[0]===f.CetModel.textKludge.getStyleSheetTypeName(a.getPreziW().toIPdom())&&(b=b.getStyleBlock().getFontClass())&&c.add(b)});return c}getFontClassesInTexts(a){const b=new Set;
a.getEntityList().forEach((a)=>{f.CetModel.textKludge.isEntityText(a)&&(a=a.getWrapper(f.CetModel.ID.HAS_FONT.W),null!=a&&null!=a.getFontClass()&&b.add(a.getFontClass()))});return b}getUsedFontFamilies(a){if(null==a||null==a.getPrezi())return[];const b=a.getPreziW().getDocumentStyle().getFontClasses(),c=new Set([...this.getFontClassesInTexts(a),...this.getFontClassesInStyles(a)]),e=[];b.forEach((a)=>{c.has(a.getName())&&e.push(a.getFontFamily())});return e}getCharacterStyle(a,b,c){c=null!=c?c:this.findParagraphNumberFromOffset(a,
b);if(null==a||null==b||null==c)return null;const e=b-a.getParagraphStartOffset(c),h=a.getParagraph(c);return 0<e?h.getCharacterStylesAt(e-1):0<h.getAllCharacterStyles().length?h.getAllCharacterStyles()[0]:0===b?a.getBaseStyle():this.getCharacterStyle(a,b-1,c-1)}removeIdStyleClasses(a){const b=this.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations();a=this.findIdStyleIndexes(a);for(let c=a.length-1;0<=c;c--)b.removeAt(a[c])}findIdStyleIndexes(a){let b=0;const c=[];this.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations().forEachMutable((e)=>
{e=e.getStyleSelector().toString();0===e.indexOf("#")&&(null!=a?-1!==a.indexOf(e.substr(1))&&c.push(b):c.push(b));b++});return c}findMatchingDeclarationsStrongerFirst(a,b){const c=a.getComponent(f.CetModel.ID.STYLED.STYLE_CLASSES),e=a.getDef().getName(),h=e.charAt(0).toLowerCase().concat(e.substr(1)),d=[];this.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations().forEachMutable((e)=>{const p=e.getStyleSelector().toString();b&&p==="#"+a.getId()&&d.push({decl:e,specificity:5});
for(const a of c.items())p===h+"."+a&&d.push({decl:e,specificity:4}),p==="*."+a&&d.push({decl:e,specificity:3});p===h&&d.push({decl:e,specificity:2});"*"===p&&d.push({decl:e,specificity:1})});return d.sort((a,b)=>a.specificity>b.specificity?-1:1).map((a)=>a.decl)}copyStyleProperties(a,b){f.CetModel.createStyleResolver().copyStyleProperties(this.mscene.getPreziW(),a,b);f.CetModel.textKludge.isEntityText(a)&&this.copyTextStyleToBlock(a.getWrapper(f.CetModel.ID.HAS_FONT.W),b)}copyTextStyleToBlock(a,
b){var c=l.Cet.shapedText(a.getEntity());a=this.getFontClassWForEntity(a);c=this.getCharacterStyle(c,0,0);c=c.setFontFamily(null==a?"default":a.getFontFamily());c.getFontWeight()||(c=c.setFontWeight(null==a?f.FontWeight.Normal:a.getFontWeight()));c.getFontStyle()||(c=c.setFontStyle(null==a?f.FontStyle.Normal:a.getFontStyle()));a=b.getStyleBlock();a=this.mscene.getEntityById(a.getId());if(null!=c.getColor()){var e=q.Geometry.colorFromRGBInt(c.getColor().asInt());a.set(f.CetModel.ID.HAS_COLOR.COLOR,
e)}a=b.getStyleSelector().toString().split(".")[1];(e=this.findFontClassByName(a))?(null!=c.getFontFamily()&&e.setFontFamily(c.getFontFamily()),null!=c.getFontStyle()&&e.setFontStyle(c.getFontStyle()),null!=c.getFontWeight()&&e.setFontWeight(c.getFontWeight())):this.addFontClass(a,K.FontDefinitionCache.lookupFontDescription(this.mscene,c.getFontFamily()),c.getFontWeight(),c.getFontStyle());this.findMutableStyleDeclaration(b.getId()).getMutableStyleBlock().setFontClass(a);this.removeUnusedClassesFamilies();
this.removeDuplicatedFontFaces();this.logDuplicatedFontClassNames()}removeDuplicatedFontFaces(){const a=this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontFamilies(),b={};let c=0;const e=[];a.forEachMutable((a)=>{if(-1===a.getId().indexOf("pending")){let h=0;const d=[];let f=a.getMutableFontFaces();f.forEachMutable((a)=>{a=`${a.getFontSrcWithOrigin().getOrigin()}-${a.getFontSrcWithOrigin().getSource()}-${a.getFontStyle()}-${a.getFontWeight()}`;b[a]?d.unshift(h):b[a]=!0;h++});d.forEach((a)=>
{f.removeAt(a)});f.length()||e.unshift(c)}c++});e.forEach((b)=>{a.removeAt(b)})}logDuplicatedFontClassNames(){const a=this.mscene.getPreziW().getDocumentStyle().getFontClasses(),b=new Set,c=new Set;a.forEach((a)=>{a=a.getName();b.has(a)?c.add(a):b.add(a)});0<c.size&&this.logger.warn({action:"duplicate-font-class-name",object:"document",trigger:"machine",payload:{fontClassNames:Array.from(c)}})}findFontClassByName(a){let b=null;this.mscene.getPreziW().getMutableDocumentStyle().getMutableFontClasses().forEachMutable((c)=>
{c.getName()===a&&(b=c)});return b}findMutableStyleDeclaration(a){let b=null;this.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations().forEachMutable((c)=>{c.getId()===a&&(b=c)});return b}getDefaultChapterStyle(){return null!=this.mscene.getPreziW().getDocumentStyle().getColorPaletteInfo()?N.StyleEditorImpl.DEFAULT_CHAPTER_STYLE_AFTER_STYLE_SCHEMES:N.StyleEditorImpl.DEFAULT_CHAPTER_STYLE_BEFORE_STYLE_SCHEMES}getDefaultSubChapterStyle(){return null!=this.mscene.getPreziW().getDocumentStyle().getColorPaletteInfo()?
N.StyleEditorImpl.DEFAULT_SUBCHAPTER_STYLE_AFTER_STYLE_SCHEMES:N.StyleEditorImpl.DEFAULT_SUBCHAPTER_STYLE_BEFORE_STYLE_SCHEMES}updateFontToSupportCurrentLanguage(a){const b=this.getFontFamily(a),c=y.I18n.getFontFamiliesForCurrentLanguage();return 0<c.length&&-1===c.indexOf(b)?(this.setFontDescription(a,K.FontDefinitionCache.lookupFontDescription(this.mscene,c[0])),!0):!1}resolveStyleForMatchingEntities(a,b){return f.CetModel.createStyleResolver().resolveStyleForMatchingEntities(a,b)}resolveStyleForEntity(a){f.CetModel.createStyleResolver().resolveStyleForEntity(this.mscene.getPreziW(),
a)}findParagraphNumberFromOffset(a,b){const c=a.getParagraphs();let e;for(let h=c.length,d=0;d<h;d++)b>=a.getParagraphStartOffset(d)&&(e=d);return e}};N.StyleEditorImpl.DEFAULT_CHAPTER_STYLE_BEFORE_STYLE_SCHEMES="frame1";N.StyleEditorImpl.DEFAULT_SUBCHAPTER_STYLE_BEFORE_STYLE_SCHEMES="frame2";N.StyleEditorImpl.DEFAULT_CHAPTER_STYLE_AFTER_STYLE_SCHEMES="poly2";N.StyleEditorImpl.DEFAULT_SUBCHAPTER_STYLE_AFTER_STYLE_SCHEMES="poly3";var ka={};Object.defineProperty(ka,"__esModule",{value:!0});var Qa;(function(a){a[a.TITLE=
0]="TITLE";a[a.SUBTITLE=1]="SUBTITLE";a[a.BODY=2]="BODY";a[a.UNKNOWN=3]="UNKNOWN"})(Qa=ka.TextStyle||(ka.TextStyle={}));ka.DEFAULT_DIAGONAL=25;ka.SIDE_RATIO=16/9;class Sb{constructor(a){this.scene=a}static getTopicFromContainer(a){var b;if(!a.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER))throw Error(`Entity with ID:${a.getId()} is not a Z_TOPIC_CONTAINER`);return null===(b=a.getWrapper(f.CetModel.ID.Z_TOPIC_CONTAINER.W).getTopic())||void 0===b?void 0:b.getEntity()}isTopic(a){return a.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER)}getInternalLayoutId(a){a=
this.scene.getEntityById(a);if(null==a||!this.isTopic(a))return null;a=Sb.getTopicFromContainer(a);if(null==a||!a.isDef(f.CetModel.ID.PLANET_CHAPTER))return null;a=a.getWrapper(f.CetModel.ID.PLANET_CHAPTER.W).getInternalLayoutInfo();return null!=a&&a.is(f.CetModel.ID.INTERNAL_LAYOUT_BY_ID)?a.getInternalLayoutId():null}getTopicKind(a){if(a===this.scene.getPreziW().getOverview().getId())return d.TopicKind.Overview;a=this.scene.getEntityById(a);if(null==a||!a.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER))return d.TopicKind.None;
a=Sb.getTopicFromContainer(a);return null==a?d.TopicKind.None:a.isDef(f.CetModel.ID.PLANET_CHAPTER)?d.TopicKind.Planet:a.isDef(f.CetModel.ID.STACK_CHAPTER)?d.TopicKind.Stack:a.isDef(f.CetModel.ID.PAGE)?d.TopicKind.Page:d.TopicKind.None}getChildTopics(a){var b=this.getTopicKind(a);switch(b){case d.TopicKind.Stack:return m.CetModelEditorInternal.getPagesOfChapter(a,this.scene);case d.TopicKind.Planet:case d.TopicKind.Overview:return b=m.CetModelEditorInternal.createEntityQuery(this.scene).getSmartStructure(a),
null==b?m.CetModelEditorInternal.getPagesInSubTree(a,this.scene):this.scene.getEntityById(b).getWrapper(f.CetModel.ID.SMART_STRUCTURE.W).getChildren().items().map((a)=>m.CetModelEditorInternal.isPlanetOrStack(a,this.scene)?a:null).filter((a)=>null!=a);case d.TopicKind.Page:case d.TopicKind.None:throw Error(`Cannot get children of topic with kind ${d.TopicKind[b]}, entity with id: ${a}`);default:throw Error(`${b}`);}}selectCover(a){const b=l.Cet.createTopicChildrenQuery(this.scene);let c=this.collectCandidates([...b.getChildrenIds(a.getId(),
l.TopicChildBehavior.Cover),...b.getChildrenIds(a.getId(),l.TopicChildBehavior.Visual),...b.getChildrenIds(a.getId(),l.TopicChildBehavior.Surface)]);0===c.length&&(c=this.collectCandidates(b.getChildrenIds(a.getId(),l.TopicChildBehavior.Content)));0===c.length&&(c=this.collectCandidates(b.getChildrenIds(a.getId(),l.TopicChildBehavior.Master)));return 0<c.length?(this.sortCandidates(c),{coverId:c[0].id,isPlaceholderText:c[0].isPlaceholder,isLoaded:c[0].isLoaded}):{coverId:null,isPlaceholderText:!1,
isLoaded:!0}}getBestCoverCandidateFromList(a){a=this.collectCandidates(a);return 0<a.length?(this.sortCandidates(a),a[0].id):null}collectCandidates(a){const b=[];for(let e=0;e<a.length;++e){const h=this.scene.getEntityById(a[e]);var c=l.Cet.hasShapedText(h);const d=F.CetRendererModule.isLoaded(h);c&&(c=h.getWrapper(f.CetModel.ID.STYLED.W).getStyleClasses().items().map((a)=>a),b.push({isPlaceholder:m.CetModelEditorInternal.createTextHelper().isPlaceholder(h),textStyleClass:0<c.length?this.textStyleFromString(c[0]):
Qa.UNKNOWN,height:l.Cet.shapedText(h).getLineMetrics(0).height*l.Cet.transform(h).getLocalToWorld().getScale(),id:h.getId(),isLoaded:d}))}return b}sortCandidates(a){const b=this.makeWeightedSorter(2,(a,b)=>(a.isPlaceholder?1:0)-(b.isPlaceholder?1:0)),c=this.makeWeightedSorter(0,(a,b)=>b.height-a.height);a.sort((a,h)=>b(a,h)+c(a,h))}makeWeightedSorter(a,b){return(c,e)=>this.sign(b(c,e))*Math.pow(2,a)}sign(a){return 0===a||isNaN(a)?a:0<a?1:-1}textStyleFromString(a){switch(a){case "title":return Qa.TITLE;
case "subtitle":return Qa.SUBTITLE;case "body":return Qa.BODY;default:return Qa.UNKNOWN}}getTitleCandidateText(a){let b=null;var c=this.scene.getEntityById(a);if(d.CetModelEditor.isSubChapter(a,this.scene)||!d.CetModelEditor.isPlanet(a,this.scene))a=d.CetModelEditor.getPagesOfChapter(a,this.scene)[0],null!=a&&(c=this.scene.getEntityById(a));c=this.selectCover(c);null==c.coverId||c.isPlaceholderText||(c=this.scene.getEntityById(c.coverId),null!=c&&(b=l.Cet.shapedText(c).getRawText()));return b}getTitle(a){if(null==
a)return null;var b=this.getTitleCandidateText(a);if(null!==b)return{title:b,origin:d.TitleOrigin.content};b=null;switch(this.getTopicKind(a)){case d.TopicKind.Overview:b=y.I18n.ts("Overview");break;case d.TopicKind.Planet:case d.TopicKind.Stack:b=m.CetModelEditorInternal.isSubChapter(a,this.scene)?y.I18n.tsFormatKeys("Subtopic {index}",{index:this.calculateStepIndex(a)}):y.I18n.tsFormatKeys("Topic {index}",{index:this.calculateStepIndex(a)});break;case d.TopicKind.Page:b=this.calculateStepIndex(a),
1===b?(a=this.scene.getEntityById(a),a=l.Cet.createHierarchyQuery(this.scene).getParentId(a),b=m.CetModelEditorInternal.isSubChapter(a,this.scene)?y.I18n.tsFormatKeys("Subtopic {index}",{index:this.calculateStepIndex(a)}):y.I18n.tsFormatKeys("Topic {index}",{index:this.calculateStepIndex(a)})):b=y.I18n.tsFormatKeys("Page {index}",{index:b})}return null!=b?{title:b,origin:d.TitleOrigin.structure}:null}calculateStepIndex(a){var b=this.scene.getEntityById(a);b=l.Cet.createHierarchyQuery(this.scene).getParentId(b)||
this.getRootTopic();return this.getChildTopics(b).indexOf(a)+1}getRootTopic(){var a;return null===(a=this.scene.getPreziW().getOverview())||void 0===a?void 0:a.getId()}isContainerTopic(a){a=this.getTopicKind(a);switch(a){case d.TopicKind.Overview:case d.TopicKind.Planet:case d.TopicKind.Stack:return!0;case d.TopicKind.Page:case d.TopicKind.None:return!1;default:throw Error(`${a}`);}}getReachableEntities(a,b=l.VisualBackgroundReachLevel.ALL_VISUALS){return l.Cet.createHierarchyQuery(this.scene).getReachableEntities(a,
b)}getTopicsWhereReachable(a,b=l.VisualBackgroundReachLevel.ALL_VISUALS){let c=[];const e=l.Cet.createTopicChildrenQuery(this.scene);var h=l.Cet.createHierarchyQuery(this.scene);if(b===l.VisualBackgroundReachLevel.ALL_VISUALS_AND_BACKGROUND&&(a.isDef(f.CetModel.ID.BACKGROUND_LAYER)||a.isDef(f.CetModel.ID.BACKGROUND)))return this.scene.getPrezi().getComponent(f.CetModel.ID.PREZI.Z_OBJECTS).items().filter((a)=>{a=this.scene.getEntityById(a);return this.isTopic(a)}).concat(this.scene.getPreziW().getOverview().getId());
if(e.hasBehavior(a.getId(),l.TopicChildBehavior.Visual)||e.hasBehavior(a.getId(),l.TopicChildBehavior.Surface)||e.hasBehavior(a.getId(),l.TopicChildBehavior.Master)){const d=this.scene.getEntityById(e.getChildReferer(a.getId()));if(null!=d){b>=l.VisualBackgroundReachLevel.OWN_VISUAL&&c.push(d.getId());const p=h.getParentOrOverview(d);null==p||e.hasBehavior(a.getId(),l.TopicChildBehavior.Master)||c.push(p);b>=l.VisualBackgroundReachLevel.ALL_VISUALS&&!e.hasBehavior(a.getId(),l.TopicChildBehavior.Surface)&&
(c=c.concat(h.getDescendantEntities([d.getId()]).filter((a)=>{a=this.scene.getEntityById(a);return null!=a?this.isTopic(a):!1})))}return c}b=e.getBehaviorReferer(a.getId(),l.TopicChildBehavior.Cover);if(null!=b)return a=this.scene.getEntityById(b),null!=a&&(h=h.getParentOrOverview(a),null!=h&&c.push(h)),c;if(d.CetModelEditor.createTopicQuery(this.scene).isTopic(a))return c.push(a.getId()),h=h.getParentOrOverview(a),null!=h&&c.push(h),c;h=h.getParentOrOverview(a);null!=h&&c.push(h);return c}}ka.TopicQueryImpl=
Sb;var H={};Object.defineProperty(H,"__esModule",{value:!0});var V;(function(a){a.master="master";a.surface="surface";a.content="content";a.cover="cover";a.visual="visual"})(V=H.GroupOwnerKind||(H.GroupOwnerKind={}));class Nb{constructor(a,b){this.mscene=a;this.designator=b;switch(b.kind){case V.content:this.groups=b.wrapper.getMutableContentGroups();break;case V.cover:this.groups=b.wrapper.getMutableCoverGroups();break;case V.visual:this.groups=b.wrapper.getMutableVisualGroups();break;case V.master:this.groups=
b.wrapper.getMutableMasterGroups();break;case V.surface:this.groups=b.wrapper.getMutableSurfaceGroups();break;default:n.Utils.assertNever(b)}}equals(a){return this.designator.wrapper.getEntity()===a.designator.wrapper.getEntity()&&this.groups.fieldKey===a.groups.fieldKey}removeAndCleanupReferences(a){const b=this.groups.indexOf(a);if(0<=b){var c=a.getEntity().get(f.CetModel.ID.HAS_TARGET_GROUPS.TARGET_GROUPS_PARENT);0<(null===c||void 0===c?void 0:c.length)&&(a=[a.getId()],E.createPathManager(this.mscene).removeReferencesFromPathAction(c,
[],a));this.groups.removeAt(b)}}getAllGroupMembers(a){const b=[],c=[];if(null!=a){const e=a.getEntity().get(f.CetModel.ID.Z_OBJECT.GROUP_ID_PARENT);null!=e&&e.map((a)=>this.mscene.lookup(a,f.CetModel.ID.Z_OBJECT.W)).forEach((e)=>{const h=kb(this.mscene,e);this.isValidMember(e,h,a)?b.push(e):c.push(e)})}2>b.length&&(b.forEach((a)=>c.push(a)),b.splice(0));return{validMembers:b,invalidMembers:c}}isValidMember(a,b,c){return null!=b&&this.equals(b)&&a.getGroupId()===c.getId()}}H.GroupOwner=Nb;H.getGroupOwnerFromZObject=
kb;class Fd{generateGroupId(){return k.DOM.generateId()}createGroup(a,b,c=null){return aa.doAndFix(a,()=>{g.Check.notNull("entities",b);g.Check.assert(b.length===this.unique(b).length,"zObject list should not contain repeated members");g.Check.range("entities.length",b.length,2,Infinity);const e=b.map((b)=>kb(a,b)).reduce((a,b)=>null!=a&&a.equals(b)?a:null);null==e&&g.Check.failure("objects should be under the same parent");null==c&&(c=this.generateGroupId());e.groups.addFromPdomData(f.CetModel.ID.GROUP,
k.DOM.createGroup(c));b.forEach((b)=>{if(c===b.getGroupId())b.setGroupId(null),b.setGroupId(c);else{this.setGroupId(a,b,null);b.setGroupId(c);var e=b.getEntity().get(f.CetModel.ID.HAS_TARGET.TARGET_PARENT);if(null!=e){var h=[b.getId()];E.createPathManager(a).removeReferencesFromPathAction(e,h,[])}e=b.getEntity().get(f.CetModel.ID.HAS_TARGETS.TARGETS_PARENT);null!=e&&(b=[b.getId()],E.createPathManager(a).removeReferencesFromPathAction(e,b,[]))}});a.getPreziW().setGrouping(f.Grouping.On);return c})}removeGroup(a,
b){return aa.doAndFix(a,()=>{g.Check.notNull("groupId",b);const c=a.lookup(b,f.CetModel.ID.GROUP.W);if(null!=c){[...c.getEntity().get(f.CetModel.ID.Z_OBJECT.GROUP_ID_PARENT)].forEach((c)=>{c=a.lookup(c,f.CetModel.ID.Z_OBJECT.W);null!=c&&c.getGroupId()===b&&c.setGroupId(null)});var e=za(a,c);null!=e&&e.removeAndCleanupReferences(c)}})}moveGroupUnderParent(a,b,c){return aa.doAndFix(a,()=>{var e=a.lookup(b,f.CetModel.ID.GROUP.W);const h=za(a,e),d=h.getAllGroupMembers(e);h.groups.removeAt(h.groups.indexOf(e));
e=this.generateGroupId();c.groups.addFromPdomData(f.CetModel.ID.GROUP,k.DOM.createGroup(e));for(let a of d.validMembers)a.setGroupId(e);for(let a of d.invalidMembers)a.setGroupId(e);E.createPathManager(a).changeGroupId(b,e)})}setGroupId(a,b,c){return aa.doAndFix(a,()=>{g.Check.notNull("zObjectW",b);var e=b.getGroupId();if(e!==c){try{if(b.setGroupId(c),null!=c){var h=a.lookup(c,f.CetModel.ID.GROUP.W),d=za(a,h);g.Check.assert(null!=d,"groupId is not valid");const e=kb(a,b);g.Check.assert(d.isValidMember(b,
e,h),"groupId is not valid")}}catch(r){throw b.setGroupId(e),r;}null!=e&&(h=a.lookup(e,f.CetModel.ID.GROUP.W),d=za(a,h),null!=d&&(e=d.getAllGroupMembers(h),e.invalidMembers.forEach((a)=>a.setGroupId(null)),0===e.validMembers.length&&d.removeAndCleanupReferences(h)))}})}getGroupDesignator(a,b){a=za(a,a.lookup(b,f.CetModel.ID.GROUP.W));return null==a?null:a.designator}getGroupId(a,b){g.Check.notNull("iZObjectW",b);const c=b.getGroupId();return null==c?null:0<=this.getGroupMembers(a,c).indexOf(b)?c:
null}getGroupIdFromEntity(a,b){return b.isDef(f.CetModel.ID.Z_OBJECT)?this.getGroupId(a,b.getWrapper(f.CetModel.ID.Z_OBJECT.W)):null}getGroupIdFromEntityId(a,b){b=a.getEntityById(b);return null==b?null:this.getGroupIdFromEntity(a,b)}getGroupMembers(a,b){g.Check.notNull("groupId",b);b=a.lookup(b,f.CetModel.ID.GROUP.W);return this.getValidMembersWithCheck(za(a,b),b)}getGroupsUnder(a,b){const c=new Nb(a,b),e=[];c.groups.forEachMutable((a)=>{0<this.getValidMembersWithCheck(c,a).length&&e.push(a.getId())});
return e}getValidMembersWithCheck(a,b){if(null==a)return[];a=a.getAllGroupMembers(b);0<a.invalidMembers.length&&aa.setInvariantsFailed();return a.validMembers}unique(a){return a.filter((b,c)=>a.indexOf(b)===c)}}H.GroupManager=Fd;class aa{static doAndFix(a,b){try{aa.guarding++;const c=b();1===aa.guarding&&aa.invariantsFailed&&(aa.fixInvariants(a),aa.invariantsFailed=!1);return c}finally{aa.guarding--}}static setInvariantsFailed(){aa.invariantsFailed=!0}static fixInvariants(a){for(let b of this.findGroups(a)){const c=
za(a,b);if(null!=c){const a=c.getAllGroupMembers(b);a.invalidMembers.forEach((a)=>a.setGroupId(null));0===a.validMembers.length&&c.removeAndCleanupReferences(b)}}}static findGroups(a){const b=[];a.getEntityList().forEachMutable((a)=>{a.isDef(f.CetModel.ID.GROUP)&&b.push(a.getMutableWrapperChecked(f.CetModel.ID.GROUP.W))});return b}static checkInvariants_ForTest(a){let b=!0;a.getEntityList().forEachMutable((c)=>{if(c.isDef(f.CetModel.ID.GROUP)){c=c.getMutableWrapperChecked(f.CetModel.ID.GROUP.W);const e=
za(a,c);null!=e&&0<e.getAllGroupMembers(c).invalidMembers.length&&(b=!1)}});return b}}H.GroupFixer=aa;aa.invariantsFailed=!1;aa.guarding=0;var qb={};Object.defineProperty(qb,"__esModule",{value:!0});const Jc={allowRemoveBaseline:!1,allowRemoveChainlink:!1,allowRemoveVisual:!1};qb.EntityEditorImpl=class{constructor(a){this.scene=a;this.groupManager=new H.GroupManager;this.logger=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.EntityEditorImpl");this.pathManager=E.createPathManager(a)}setConnectorTail(a,
b){a=a.getMutableWrapper(f.CetModel.ID.CONNECTOR.W);null==b?a.setConnectorTail(null):null==a.getConnectorTail()?a.setConnectorTail(f.CetModel.ID.CONNECTOR_END.inflate(this.scene,k.DOM.createConnectorEnd(b))):a.getMutableConnectorTail().setTarget(b);return this}setConnectorHead(a,b){a=a.getMutableWrapper(f.CetModel.ID.CONNECTOR.W);null==b?a.setConnectorHead(null):null==a.getConnectorHead()?a.setConnectorHead(f.CetModel.ID.CONNECTOR_END.inflate(this.scene,k.DOM.createConnectorEnd(b))):a.getMutableConnectorHead().setTarget(b);
return this}transformSubtree(a,b,c){var e=this.scene.getEntityById(a);e=l.Cet.transform(e).getLocalToWorld();b=this.getDeltaTransform(e,b);e=l.Cet.createHierarchyQuery(this.scene).getDescendantEntities([a]);e.push(a);return this.transformWithDelta(a,e,b,c)}transformWithDelta(a,b,c,e){b.forEach((a)=>{a=this.scene.getEntityById(a);var b=a.getChild(f.CetModel.ID.Z_TOPIC_CONTAINER.TOPIC);if(null==b||!b.isDef(f.CetModel.ID.HAS_POSITION)||!b.getWrapper(f.CetModel.ID.HAS_POSITION.W).getPosition().getEntity().isDef(f.CetModel.ID.WRAP_CHILDREN_NO_BASELINE)){b=
this.scene.getTweener();b.removeTweens(a.getId());var h=l.Cet.transform(a).getLocalToWorld(),d=h.concat(c);l.Cet.updateTransform(a).setLocalToWorld(d);if(0<e){const c=l.Cet.createTweenFactory();h=l.Cet.createTransformTween("EntityEditor-transformWithDelta",e,h,d);h.setEase(c.createQuadInOut());b.addTween(a.getId(),h)}}});return this}getDeltaTransform(a,b){return a.invert().concat(b)}getConnectorEnd(a,b){a=a.getChild(b?f.CetModel.ID.CONNECTOR.CONNECTOR_TAIL:f.CetModel.ID.CONNECTOR.CONNECTOR_HEAD);
return null!=a?a.get(f.CetModel.ID.CONNECTOR_END.TARGET):null}getConnectorHead(a){return this.getConnectorEnd(a,!1)}getConnectorTail(a){return this.getConnectorEnd(a,!0)}moveUnderParentInternal(a,b,c=null){if(null!=a&&!a.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER)&&!a.isDef(f.CetModel.ID.OVERVIEW))throw Error(`Parent doesn't have the correct type with id: ${a.getId()}`);if(!b)return this;var e=l.Cet.createHierarchyQuery(this.scene);if(null!=a&&(-1!==e.getAncestorEntities(a.getId()).indexOf(b)||a.getId()===
b))return this.logger.print("circular hierarchy warning, parent:"+a.getId()+": child:"+b),this;var h=this.scene.getEntityById(b);e=e.getParentId(h);e=this.scene.getEntityById(e);null!=e&&this.removeChild(e,h);a=null!=a?a.getChild(f.CetModel.ID.Z_TOPIC_CONTAINER.TOPIC):null;null!=a&&(a.isDef(f.CetModel.ID.HAS_CHILDREN)?(c=a.getComponent(f.CetModel.ID.HAS_CHILDREN.CHILDREN),null!=c&&(0!==c.items().filter((a)=>a===b).length?this.logger.print("hierarchy child add duplication"):a.getMutableComponent(f.CetModel.ID.HAS_CHILDREN.CHILDREN).add(b))):
a.isDef(f.CetModel.ID.HAS_TOPIC_CHILDREN)&&(h=a.getComponent(f.CetModel.ID.HAS_TOPIC_CHILDREN.TOPIC_CHILDREN),null!=h&&(0!==h.items().filter((a)=>{a=this.scene.getEntityById(a).get(f.CetModel.ID.TOPIC_CHILD.CHILD);return b===a}).length?this.logger.print("hierarchy child add duplication"):(h=null,null==c?h=k.DOM.createContent():c.is(f.CetModel.ID.CONTENT)?h=k.DOM.createContent():c.is(f.CetModel.ID.COVER)?h=k.DOM.createCover():c.is(f.CetModel.ID.VISUAL)&&(h=k.DOM.createVisual()),c=k.DOM.createTopicChild(h,
b),c=this.scene.inflate(f.CetModel.ID.TOPIC_CHILD,c),a.getMutableComponent(f.CetModel.ID.HAS_TOPIC_CHILDREN.TOPIC_CHILDREN).add(c.getId())))));return this}removeChild(a,b,c=null){if(!a||!b)return this;const e=a.getChild(f.CetModel.ID.Z_TOPIC_CONTAINER.TOPIC);if(null==e)return this;if(e.isDef(f.CetModel.ID.PAGE)){var h=e.getComponent(f.CetModel.ID.HAS_CHILDREN.CHILDREN);if(null!=h)for(var d=h.length()-1;0<=d;d--)if(h.getAt(d)===b.getId()){e.getMutableComponent(f.CetModel.ID.HAS_CHILDREN.CHILDREN).removeAt(d);
break}}else if(h=e.getComponent(f.CetModel.ID.HAS_TOPIC_CHILDREN.TOPIC_CHILDREN),null!=h)for(d=h.length()-1;0<=d;d--){var r=this.scene.getEntityById(h.getAt(d));r=null!=r?r.get(f.CetModel.ID.TOPIC_CHILD.CHILD):null;if(null!=r&&r===b.getId()){e.getMutableComponent(f.CetModel.ID.HAS_TOPIC_CHILDREN.TOPIC_CHILDREN).removeAt(d);b.set(f.CetModel.ID.TOPIC_CHILD.CHILD_PARENT,null);break}}null!=c&&this.forEachChildOfTopic(b,(b,e)=>{-1===c.indexOf(b.getId())&&this.moveUnderParentInternal(a,b.getId(),e)});return this}forEachChildOfTopic(a,
b){a=a.getChild(f.CetModel.ID.Z_TOPIC_CONTAINER.TOPIC);if(null==a)return this;a.isDef(f.CetModel.ID.HAS_CHILDREN)?a.forEachRef(f.CetModel.ID.HAS_CHILDREN.CHILDREN,(a)=>{b(a,null)}):a.isDef(f.CetModel.ID.HAS_TOPIC_CHILDREN)&&a.forEachChild(f.CetModel.ID.HAS_TOPIC_CHILDREN.TOPIC_CHILDREN,(a)=>{const c=a.getChild(f.CetModel.ID.TOPIC_CHILD.BEHAVIOUR).getWrapper(f.CetModel.ID.TOPIC_CHILD_BEHAVIOUR.W);a=a.get(f.CetModel.ID.TOPIC_CHILD.CHILD);b(this.scene.getEntityById(a),c)});return this}moveUnderParent(a,
b,c=!1){if(null!=this.scene.getEntityById(b)){var e=l.Cet.createHierarchyQuery(this.scene).getParentId(this.scene.getEntityById(b));c&&null!=e||(a=this.scene.getEntityById(a),this.moveUnderParentInternal(a,b))}}collectBaselines(a){const b=[];for(let c of a)a=this.getSmartStructure(c),null!=a&&(a=this.scene.getEntityById(a).getWrapper(f.CetModel.ID.LINEAR_SMART_STRUCTURE.W).getBaseline(),null!=a&&b.push(a));return b}filterSmartStructureElements(a,b){b.allowRemoveBaseline||(a=a.filter((a)=>null==m.CetModelEditorInternal.getSmartStructureIdForBaseLine(a,
this.scene)));b.allowRemoveChainlink||(a=a.filter((a)=>null==m.CetModelEditorInternal.getSmartStructureIdForChainLink(a,this.scene)));return a.concat(this.collectBaselines(a))}updateConnectors(a){a=this.scene.getEntityList().getEntityById(a).get(f.CetModel.ID.CONNECTOR_END.TARGET_PARENT);null!=a&&a.forEach((a)=>{a=this.scene.getEntityList().getEntityById(a);if(null!=a){var b=a.getOwner().getMutableWrapper(f.CetModel.ID.CONNECTOR.W);null!=b.getConnectorHead()&&b.getConnectorHead().getId()===a.getId()?
b.setConnectorHead(null):null!=b.getConnectorTail()&&b.getConnectorTail().getId()===a.getId()&&b.setConnectorTail(null)}})}removeFromSmartStructures(a){var b=this.scene.getEntityById(a);if(null!=b&&(b=b.get(f.CetModel.ID.SMART_STRUCTURE.CHILDREN_PARENT),null!=b))for(let c=0;c<b.length;c++){const e=this.scene.getEntityById(b[c]).getMutableWrapper(f.CetModel.ID.SMART_STRUCTURE.W),h=e.getChildren().items().indexOf(a);0<=h&&e.getMutableChildren().removeAt(h)}}removeZObjects(a,b){b=b||Jc;b=Object.assign(Object.assign({},
Jc),b);var c=a.filter((a)=>null!=this.scene.getEntityById(a));a=l.Cet.createHierarchyQuery(this.scene);b=a.getSubTrees(this.filterSmartStructureElements(c,b));c=new Set;for(var e of b)c.add(e);for(let h of[...c])e=this.scene.getEntityById(h),null!=e&&e.isDef(f.CetModel.ID.Z_OBJECT)&&this.groupManager.setGroupId(this.scene,e.getMutableWrapper(f.CetModel.ID.Z_OBJECT.W),null),c=this.scene.getEntityById(a.getParentId(e)),null!=c&&-1===b.indexOf(c.getId())&&this.removeChild(c,e,b),this.updateConnectors(h),
this.removeFromSmartStructures(h);this.deleteZObjectsFromPrezi(b);N.StyleEditorImpl.createStyleEditor(this.scene).removeIdStyleClasses(b);return this}deleteZObjectsFromPrezi(a){let b=[],c=0;this.pathManager.removeStepsAndActionsPointingToTargets(a);this.scene.getPrezi().forEachChild(f.CetModel.ID.PREZI.Z_OBJECTS,(e)=>{0<=a.indexOf(e.getId())&&b.push(c);c++});let e=b.length-1;for(;0<=e;)this.scene.getPrezi().getComponent(f.CetModel.ID.PREZI.Z_OBJECTS).getAt(b[e]),this.scene.getPrezi().removeChildAt(f.CetModel.ID.PREZI.Z_OBJECTS,
b[e]),e--;this.scene.deleteEntitiesById(a)}moveInZOrder(a,b,c){b=[...b];b.sort((a,b)=>m.CetModelEditorInternal.findZObject(a,this.scene)<m.CetModelEditorInternal.findZObject(b,this.scene)?-1:1);const e=(a,c)=>{c=m.CetModelEditorInternal.findZObject(b[c],this.scene);-1!==c&&m.CetModelEditorInternal.moveZObject(c,a,this.scene)};switch(c){case 0:for(c=0;c<b.length;c++)if(b[c]!==a){var h=null==a?-1:m.CetModelEditorInternal.findZObject(a,this.scene);e(h,c)}else{h=m.CetModelEditorInternal.findZObject(b[c],
this.scene);const e=this.scene.getPrezi().getComponent(f.CetModel.ID.PREZI.Z_OBJECTS);h<e.length()-1&&(a=e.getAt(h+1))}break;case 1:for(c=b.length-1;0<=c;c--)b[c]!==a?(h=null==a?-1:m.CetModelEditorInternal.findZObject(a,this.scene),-1!==h&&h++,e(h,c)):(h=m.CetModelEditorInternal.findZObject(b[c],this.scene),0<h&&(a=this.scene.getPrezi().getComponent(f.CetModel.ID.PREZI.Z_OBJECTS).getAt(h-1)));break;case 2:for(a=b.length-1;0<=a;a--)e(0,a);break;case 3:for(a=0;a<b.length;a++)e(-1,a)}}createShape(a,
b,c,e){a=k.DOM.createZShape(this.scene.generateEntityId(),a);null!=e&&a.setStyleClasses(k.DOM.createArrayToken([e]));e=f.CetModel.ID.Z_SHAPE.inflate(this.scene,a);e.setWidth(c.width);e.setHeight(c.height);e.setLocalToWorld(b);this.scene.getPreziW().getMutableZObjects().add(e);return e}getSmartStructure(a){const b=m.CetModelEditorInternal.createTopicQuery(this.scene).getTopicKind(a);return b===d.TopicKind.Overview?(a=this.scene.getPreziW().getOverview().getSmartStructure(),null==a?null:a.getId()):
b===d.TopicKind.Planet?(a=this.scene.getEntityById(a),ka.TopicQueryImpl.getTopicFromContainer(a).getWrapper(f.CetModel.ID.PLANET_CHAPTER.W).getSmartStructure().getId()):null}};var Tb={};Object.defineProperty(Tb,"__esModule",{value:!0});Tb.TopicChildrenEditorImpl=class{constructor(a){this.mscene=a;this.tcq=l.Cet.createTopicChildrenQuery(a)}getChildrenIds(a,b){return this.tcq.getChildrenIds(a,b)}getChildrenIdsVisibleOutside(a){return this.tcq.getChildrenIdsVisibleOutside(a)}getChildrenIdsVisibleInside(a){return this.tcq.getChildrenIdsVisibleInside(a)}getChildrenIdsVisibleBelow(a){return this.tcq.getChildrenIdsVisibleBelow(a)}getChildrenIdsVisibleOutsideAndInside(a){return this.tcq.getChildrenIdsVisibleOutsideAndInside(a)}hasBehavior(a,
b){return this.tcq.hasBehavior(a,b)}getBehavior(a){return this.tcq.getBehavior(a)}getBehaviorReferer(a,b){return this.tcq.getBehaviorReferer(a,b)}getChildReferer(a){return this.tcq.getChildReferer(a)}add(a,b,c){-1===this.getChildrenIds(b,c).indexOf(a)&&this.addItem(a,b,this.getBehaviorWrapper(c))}remove(a,b,c){b=this.mscene.getEntityById(b);null!=b&&this.removeItem(a,b,c)}getBehaviorWrapper(a){switch(a){case l.TopicChildBehavior.Cover:return f.CetModel.ID.COVER.inflate(this.mscene,k.DOM.createCover());
case l.TopicChildBehavior.Content:return f.CetModel.ID.CONTENT.inflate(this.mscene,k.DOM.createContent());case l.TopicChildBehavior.Visual:return f.CetModel.ID.VISUAL.inflate(this.mscene,k.DOM.createVisual());case l.TopicChildBehavior.Surface:return f.CetModel.ID.SURFACE.inflate(this.mscene,k.DOM.createSurface());case l.TopicChildBehavior.Master:return f.CetModel.ID.MASTER.inflate(this.mscene,k.DOM.createMaster());default:n.Utils.assertNever(a)}}isVisibleOutside(a){return this.tcq.isVisibleOutside(a)}isVisibleInside(a){return this.tcq.isVisibleInside(a)}isVisibleBelow(a){return this.tcq.isVisibleBelow(a)}isVisibleOutsideAndInside(a){return this.tcq.isVisibleOutsideAndInside(a)}addVisual(a,
b,c){-1===this.getChildrenIds(b,l.TopicChildBehavior.Visual).indexOf(a)&&(this.addItem(a,b,f.CetModel.ID.VISUAL.inflate(this.mscene,k.DOM.createVisual())),c&&this.ensureVisualZOrder(a,b))}addSurface(a,b,c){-1===this.getChildrenIds(b,l.TopicChildBehavior.Surface).indexOf(a)&&(this.addItem(a,b,f.CetModel.ID.SURFACE.inflate(this.mscene,k.DOM.createSurface())),c&&this.ensureVisualZOrder(a,b))}addItem(a,b,c){m.CetModelEditorInternal.createEntityEditor(this.mscene).moveUnderParent(b,a);const e=this.mscene.getEntityById(a).get(f.CetModel.ID.TOPIC_CHILD.CHILD_PARENT);
e&&e.length&&this.mscene.getEntityById(e[0]).getMutableWrapper(f.CetModel.ID.TOPIC_CHILD.W).setBehaviour(c);a=m.CetModelEditorInternal.findZObject(a,this.mscene);a<m.CetModelEditorInternal.findZObject(b,this.mscene)&&m.CetModelEditorInternal.moveZObject(a,-1,this.mscene)}removeItem(a,b,c){const e=this.mscene.getEntityById(a),h=b.getChild(f.CetModel.ID.Z_TOPIC_CONTAINER.TOPIC).getMutableWrapper(f.CetModel.ID.HAS_TOPIC_CHILDREN.W),d=(a)=>{switch(c){case l.TopicChildBehavior.Cover:return a.is(f.CetModel.ID.COVER);
case l.TopicChildBehavior.Content:return a.is(f.CetModel.ID.CONTENT);case l.TopicChildBehavior.Visual:return a.is(f.CetModel.ID.VISUAL);case l.TopicChildBehavior.Surface:return a.is(f.CetModel.ID.SURFACE);case l.TopicChildBehavior.Master:return a.is(f.CetModel.ID.MASTER);default:n.Utils.assertNever(c)}};let r=0;for(;r<h.getTopicChildren().length();){const c=h.getMutableTopicChildren().getMutableAt(r);if(c.getChild()===a&&d(c.getBehaviour())){(new qb.EntityEditorImpl(this.mscene)).removeChild(b,e,
[]);break}r+=1}}ensureVisualZOrder(a,b){var c=(a)=>m.CetModelEditorInternal.findZObject(a,this.mscene);const e=c(a);b=l.Cet.sortInZOrder([...this.getChildrenIds(b,l.TopicChildBehavior.Content),...this.getChildrenIds(b,l.TopicChildBehavior.Master),...this.getChildrenIds(b,l.TopicChildBehavior.Cover)].filter((b)=>b!==a).map((a)=>this.mscene.getEntityById(a)));0<b.length&&(c=c(b[0].getId()),e>c&&m.CetModelEditorInternal.moveZObject(e,c,this.mscene))}};var Ha={};Object.defineProperty(Ha,"__esModule",
{value:!0});Ha.EditorPathQueryImpl=class{constructor(a,b){this.scene=a;this.pathQueryHelper=this.pathQueryHelper=b;Ha.EditorPathQueryImpl.initLogger()}static initLogger(){null==Ha.EditorPathQueryImpl.LOGGER&&(Ha.EditorPathQueryImpl.LOGGER=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.PathManager"))}getPath(){return l.Cet.createEditorPath(this.scene)}getPathComponent(){return l.Cet.pathKludge.getEditorPathComponent(this.scene)}getStepIndexForPathStepId(a){return this.pathQueryHelper.getStepIndexForPathStepId(this.getPathComponent(),
a)}getStepIdForStepIndex(a){return this.pathQueryHelper.getStepIdForStepIndex(this.getPathComponent(),a)}getStepTargetId(a){return this.pathQueryHelper.getStepTargetId(a)}getStepIndexesForEntityId(a){return this.pathQueryHelper.getStepIndexesForEntityId(this.getPathComponent(),a)}getPathTargetIds(){return this.pathQueryHelper.getPathTargetIds(this.getPathComponent())}getPathStepTargetId(a){return this.pathQueryHelper.getPathStepTargetId(this.getPathComponent(),a)}getActionsForStepAndTarget(a,b){return this.pathQueryHelper.getActionsForStepAndTarget(a,
b)}getActionsForStep(a){return this.pathQueryHelper.getActionsForStep(a)}getActionIdsForStep(a){return this.getActionsForStep(a).map((a)=>a.getEntity().getId())}getActionIndexById(a,b){return this.pathQueryHelper.getActionIndexById(a,b)}getActionType(a,b){return this.pathQueryHelper.getActionType(a,b)}getTargetEntitiesForActionById(a){return this.pathQueryHelper.getTargetEntitiesForActionById(a)}getStartPoint(){return this.pathQueryHelper.getStartPoint(this.getPath())}hasCustomStartPoint(){return this.pathQueryHelper.hasCustomStartPoint(this.getPath())}isStartPoint(a,
b){return this.pathQueryHelper.isStartPoint(this.getPath(),this.getPathComponent(),a,b)}idsToPathPosition(a,b){return this.pathQueryHelper.idsToPathPosition(this.getPath(),this.getPathComponent(),a,b)}pathPositionToIds(a){return this.pathQueryHelper.pathPositionToIds(this.getPathComponent(),a)}sortByPathPosition(a){const b=this.findFirstStepIndexForEachTarget(a);return a.map((a,e)=>({id:a,pos:-1!==b[e]?b[e]:Number.MAX_VALUE})).sort((a,b)=>a.pos<b.pos?-1:a.pos===b.pos?0:1).map((a)=>a.id)}getPathStepIdForAction(a){var b=
l.Cet.pathKludge.getEditorPathComponent(this.scene);for(const c of b.items()){b=l.Cet.pathKludge.getISomeEditorPathStepW(this.scene.getEntityById(c));for(const e of b.getActions())if(e.getId()===a)return c}return null}findPathActionOnPlaybackPath(a){const b=this.scene.getPreziW();l.Cet.pathKludge.assertEditorPathV2(b);return E.findPathActionOnPlaybackPath(b,this.scene,a)}isLegalPathAction(a,b,c,e){if(null!=b&&0<b.length){if(c!==d.ActionType.FADE_IN&&c!==d.ActionType.FADE_OUT)return!1;if(null==a||
0===a.length)return!0}b=null!=a?a.map((a)=>this.scene.getEntityById(a).getDef()):[];return null!=b&&0<b.length&&c===d.ActionType.ZOOM_TO&&(1<b.length||m.CetModelEditorInternal.createTopicQuery(this.scene).getTopicKind(a[0])!==d.TopicKind.None)?!1:c===d.ActionType.ZOOM_BACK?e:null==b||0===b.length?c===d.ActionType.ZOOM_AREA:null!=b&&0<b.length&&b[0]===f.CetModel.ID.Z_ZOOM_AREA?c===d.ActionType.ZOOM_TO:!0}sortByDistanceFromEntity(a,b){const c=l.Cet.createHierarchyQuery(this.scene);a=a.slice(0);a.sort((a,
h)=>{if(null==a.__dis__){var e=this.getStepTargetId(this.getStepIdForStepIndex(a.getStep()));a.__dis__=c.getEntityDistance(e,b)}null==h.__dis__&&(e=this.getStepTargetId(this.getStepIdForStepIndex(h.getStep())),h.__dis__=c.getEntityDistance(e,b));return a.__dis__<h.__dis__?-1:a.__dis__>h.__dis__?1:a.getStep()<h.getStep()?-1:a.getStep()>h.getStep()?1:0});a.forEach((a)=>{a.__dis__=void 0});return a}forEachEditorPathStep(a,b){a=a.getPreziW();l.Cet.pathKludge.assertEditorPathV2(a);a.getEditorPath().getSteps().forEach((a)=>
b(a.getEntity()))}findStepsPointingToTargets(a){const b=[];if(null==this.scene.getPrezi())return b;this.forEachEditorPathStep(this.scene,(c)=>{const e=c.get(f.CetModel.ID.HAS_TARGET.TARGET);null!=e&&-1!==a.indexOf(e)&&b.push(c.getId())});return b}findFirstStepIndexForEachTarget(a){let b=[],c=0;this.forEachEditorPathStep(this.scene,(e)=>{e=e.get(f.CetModel.ID.HAS_TARGET.TARGET);e=a.indexOf(e);-1!==e&&void 0===b[e]&&(b[e]=c);c++});for(let c=b.length;c<a.length;c++)b[c]=void 0;return b=b.map((a)=>void 0===
a?-1:a)}findPathInsertPosition(a){if(null==this.scene.getEntityById(a))return this.logPathInsertError(),-1;const b=this.scene.getPrezi().getChild(f.CetModel.ID.PREZI.OVERVIEW),c=l.Cet.pathKludge.getEditorPathComponent(this.scene);if(a===b.getId())return c.length();a=this.getStepIndexesInSubtree(a);if(0<a.length)return a[a.length-1]+1;this.logPathInsertError();return-1}getStepIndexesInSubtree(a){return l.Cet.createHierarchyQuery(this.scene).getSubTrees([a]).map((a)=>this.getStepIndexesForEntityId(a)).filter((a)=>
0<a.length).map((a)=>a[a.length-1]).sort((a,c)=>a-c)}logPathInsertError(){Ha.EditorPathQueryImpl.LOGGER.warn({action:"findPathInsertPosition",object:"path",trigger:"machine",payload:{description:"Insert position not found"}})}};var Ub={};Object.defineProperty(Ub,"__esModule",{value:!0});Ub.StageQueryStrategyFactoryImpl=class{constructor(a,b){this.applicationMode=a;this.topicStageQueryStrategyFactory=b}compareBounds(a,b){a=l.Cet.world(a).getWorldBounds();b=l.Cet.world(b).getWorldBounds();a=a.getWidth()*
a.getHeight();b=b.getWidth()*b.getHeight();return a<b?-1:a>b?1:0}compareZoomAreas(a,b){if(!a.is(d.HitTag.ZOOM_AREA)||!b.is(d.HitTag.ZOOM_AREA))return 0;const c=a.is(d.HitTag.SMALLER_ZOOM_AREA);a=this.compareBounds(a.getData().entity,b.getData().entity);return c?-1*a:a}general(a=!1){return(b)=>{const c=(a)=>a.is(d.HitTag.REACHABLE_IN_DOCUMENT)&&(!a.is(d.HitTag.Z_TOPIC_CONTAINER)||a.is(d.HitTag.Z_TOPIC_CONTAINER_WITHOUT_COVER_AND_VISUAL))&&!a.is(d.HitTag.TOO_SMALL)&&(!a.is(d.HitTag.TOO_LARGE)||this.applicationMode===
d.ApplicationMode.View||!a.is(d.HitTag.LINE_ARROW)&&a.is(d.HitTag.CLICKED_IN_BORDER_AREA))&&!a.is(d.HitTag.EXTERNAL_OBJECT_INTERSECTING_COVER_EDIT_BOUNDS)&&(a.is(d.HitTag.CLICKED_PRECISELY)||!a.is(d.HitTag.LINE_ARROW)&&!a.is(d.HitTag.TRIANGLE)&&(!a.is(d.HitTag.ZOOM_AREA)||this.applicationMode===d.ApplicationMode.View)&&a.is(d.HitTag.CLICKED_IN_WORLD_BOUNDS));b=b.filter((a)=>{var b;if(b=!a.is(d.HitTag.PAGE)&&a.is(d.HitTag.CLICKED_ENCLOSELY))b=!a.is(d.HitTag.HAS_PDOM_COMPONENT)&&a.is(d.HitTag.CLICKED_PRECISELY)&&
a.is(d.HitTag.INTERACTIVE_DECORATOR)||c(a);return b});const e=b.every((a)=>a.is(d.HitTag.ENCLOSING_ZOOM_AREA));return b.filter((b)=>a||e||!b.is(d.HitTag.ENCLOSING_ZOOM_AREA)).sort((a,b)=>a.compare(b)).sort((a,b)=>this.compareZoomAreas(a,b))}}prioritizeTopic(a,b,c=()=>!1){return(e)=>{if(0<e.length&&c(e[0].getData().entity))return e;const h=d.CetModelEditor.createTopicQuery(b),p=l.Cet.createHierarchyQuery(b);for(let b=0;b<e.length;++b){const c=e[b],d=c.getData().entity;if(h.isTopic(d)&&p.getParentOrOverview(d)===
a)return[c].concat(e.slice(0,b)).concat(e.slice(b+1))}return e}}entitiesInArea(a,b=!1){return(c)=>c.filter((a)=>(a.is(d.HitTag.REACHABLE_IN_DOCUMENT)||a.is(d.HitTag.INTERACTIVE_DECORATOR))&&!a.is(d.HitTag.CONTAINS_WORLD_AREA)&&(!b||a.is(d.HitTag.COVER_OF_COVER_EDITED_TOPIC)||a.is(d.HitTag.VISUALLIKE_OF_COVER_EDITED_TOPIC))).map((b)=>this.topicStageQueryStrategyFactory.replaceNonEditedVisibleOutsidesWithTopic(b,a))}entitiesIntersectingArea(){return(a)=>a.filter((a)=>!a.is(d.HitTag.INTERSECT_WORLD_AREA))}entityIfCloseToBorder(){return(a)=>
a.filter((a)=>a.is(d.HitTag.HAS_PDOM_COMPONENT)&&!a.is(d.HitTag.LINE_ARROW)).slice(0,1).filter((a)=>a.is(d.HitTag.CLICKED_IN_BORDER_AREA))}replaceCoverWithTopic(a){return(b)=>b.map((b)=>this.topicStageQueryStrategyFactory.replaceNonEditedVisibleOutsidesWithTopic(b,a))}excludeEntitiesOnLogoLayer(){return(a)=>a.filter((a)=>!a.is(d.HitTag.LOGO))}};var Vb={};Object.defineProperty(Vb,"__esModule",{value:!0});Vb.TopicImpl=class{getParentId(a,b){return l.Cet.createHierarchyQuery(b).getParentId(a)}isSubChapter(a,
b){if(!m.CetModelEditorInternal.isPlanetOrStack(a,b))return!1;a=b.getEntityById(a);a=l.Cet.createHierarchyQuery(b).getParentId(a);return m.CetModelEditorInternal.createTopicQuery(b).getTopicKind(a)===d.TopicKind.Planet}isChapter(){throw Error("Deprecated, use TopicQuery.getTopicKind instead");}isTopic(){throw Error("Deprecated, use TopicQuery.getTopicKind instead");}};var Wb={};Object.defineProperty(Wb,"__esModule",{value:!0});Wb.TopicStageQueryStrategyFactoryImpl=class{replaceNonEditedVisibleOutsidesWithTopic(a,
b){if(a.is(d.HitTag.COVER_OF_COVER_EDITED_TOPIC)||a.is(d.HitTag.VISUALLIKE_OF_COVER_EDITED_TOPIC)||a.is(d.HitTag.VISUALLIKE_OF_CURRENT_TOPIC))return a;const c=a.getData().entity,e=l.Cet.createTopicChildrenQuery(b);return e.isVisibleOutside(c.getId())?(a=b.getEntityById(e.getChildReferer(c.getId())),m.CetModelEditorInternal.createEntityHit({entity:a,hitTags:[d.HitTag.MAPPED],zIndex:l.Cet.zOrder(a).getZIndex(),layerIndex:F.CetRendererModule.calcLayerInt(l.Cet.zOrder(a).getZLayer())})):a}};var sa={};
Object.defineProperty(sa,"__esModule",{value:!0});sa.EditorFactory=class{static createTopic(){return new Vb.TopicImpl}static createTopicChildrenEditor(a){return new Tb.TopicChildrenEditorImpl(a)}static createEntityEditor(a){return new qb.EntityEditorImpl(a)}static createTopicQuery(a){return new ka.TopicQueryImpl(a)}static createStageQueryStrategyFactory(a,b){a=new Wb.TopicStageQueryStrategyFactoryImpl;return new Ub.StageQueryStrategyFactoryImpl(b,a)}static createPathQuery(a){return new Ha.EditorPathQueryImpl(a,
d.CetModelEditor.createPathQueryHelper(a))}};var E={findPathActionOnPlaybackPath:function(a,b,c){l.Cet.pathKludge.assertEditorPathV2(a);return rb.findPathActionOnPlaybackPath(a,b,c)},createEntityIdToPlaybackPathPositionMap:function(a,b){l.Cet.pathKludge.assertEditorPathV2(a);return rb.getDesiredPlaybackPath(a,b,{editorPathElementIdToPlaybackPathPosition:new Map}).editorPathElementIdToPlaybackPathPosition},createPathManager:function(a){l.Cet.pathKludge.assertEditorPathV2(a.getPreziW());return new E.PathManager(a)}};
Object.defineProperty(E,"__esModule",{value:!0});E.PathManager=class{constructor(a){this.mscene=a;null==E.PathManager.logger&&(E.PathManager.logger=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.PathManager"));this.editorPathQuery=sa.EditorFactory.createPathQuery(a)}getAudio(a){a=this.mscene.lookup(a.getId(),f.CetModel.ID.EDITOR_PATH_STEP.W);a=cd(a);return null==a?null:this.soundWToAsset(a)}setBackgroundAudio(a,b){this.editPath(()=>{const c=this.mscene.lookup(a.getId(),f.CetModel.ID.EDITOR_PATH_STEP.W);
dd(c,this.mscene,b)})}getBackgroundAudio(a){a=this.mscene.lookup(a.getId(),f.CetModel.ID.EDITOR_PATH_STEP.W);a=ed(a);return null==a?null:this.soundWToAsset(a)}setPathActionAudio(a,b){this.editPath(()=>{const c=this.mscene.lookup(a.getId(),f.CetModel.ID.EDITOR_PATH_ACTION.W);fd(c,this.mscene,b)})}getPathActionAudio(a){a=this.mscene.lookup(a.getId(),f.CetModel.ID.EDITOR_PATH_ACTION.W);a=gd(a);return null==a?null:this.soundWToAsset(a)}setAudio(a,b){this.editPath(()=>{const c=this.mscene.lookup(a.getId(),
f.CetModel.ID.EDITOR_PATH_STEP.W);bd(c,this.mscene,b)})}soundWToAsset(a){return{kind:d.base.AssetKind.audio,url:a.getOnlineAssetUrl(),audioType:a.getAudioType(),mediaLengthMilliSecs:a.getMediaLength(),offlineAssetId:a.getOfflineAssetId(),onlineAssetId:a.getOnlineAssetId(),assetSourceFilename:a.getAssetSourceFilename()}}setNarrativeOnPathStep(a,b){this.editPath(()=>{a.toMutable(this.mscene).setNarrative(null==b?null:f.CetModel.ID.PLAIN_TEXT_NARRATIVE.inflate(this.mscene,k.DOM.createPlainTextNarrative(b)))})}setNarrativeOnAction(a,
b){this.editPath(()=>{a.toMutable(this.mscene).setNarrative(null==b?null:f.CetModel.ID.PLAIN_TEXT_NARRATIVE.inflate(this.mscene,k.DOM.createPlainTextNarrative(b)))})}removeAnimation(a,b){this.editPath(()=>{const c=a.toMutable(this.mscene),e=b.getId();if(null!=this.mscene.getEntityById(e)){var d=this.getPosForId(c.getMutableActions(),e);-1!==d?c.getMutableActions().removeAt(d):E.PathManager.logger.error({action:"animation-delete",object:e,trigger:"machine"})}})}moveAnimations(a){this.editPath(()=>
{for(let {actionIds:h,toIPathStep:r,toIndex:g}of a)if(0!==h.length){var b=this.mscene.getEntityById(h[0]).getOwner();if(b.getId()===r.getId()){var c=r.toMutable(this.mscene).getMutableActions();for(var e=0;e<h.length;e++){if(this.mscene.getEntityById(h[e]).getOwner()!==b)throw Error("not a child");var d=this.getPosForId(c,h[e]);if(-1===d)throw Error("action not in list");c.move(d,g);g<=d&&g++}}else{b=r.toMutable(this.mscene);c=h.map((a)=>this.mscene.getEntityById(a));e=this.mscene.dup(c);for(d=0;d<
h.length;d++)b.getMutableActions().insert(g+d,e[d].getMutableWrapper(f.CetModel.ID.EDITOR_PATH_ACTION.W));c.forEach((a)=>{const b=a.getOwner().getMutableWrapper(f.CetModel.ID.EDITOR_PATH_STEP.W);b.getMutableActions().removeAt(this.getPosForId(b.getMutableActions(),a.getId()))})}}})}moveAnimation(a,b,c,e){this.moveAnimations([{toIndex:e,actionIds:[b],toIPathStep:c}])}insertAnimation(a,b,c,e,d){return this.editPath(()=>{var h=c.toMutable(this.mscene);const f=this.createAnimationObjectI(a,b,e);if(null!=
f)if(h=h.getMutableActions(),null!=d){const a=this.getPosForId(h,d);-1!==a&&h.insert(a,f)}else h.add(f);return f})}changeGroupId(a,b){this.editPath(()=>{na(this.mscene).forEachMutable((c)=>{c.getMutableActions().forEachMutable((c)=>{if(c.is(f.CetModel.ID.FADE_OUT_OBJECTS_EP)||c.is(f.CetModel.ID.FADE_IN_OBJECTS_EP)){c=c.getMutableTargetGroups();for(let e=0;e<c.length();e++)c.getAt(e)===a&&(c.removeAt(e),c.insert(e,b))}})})})}parentForAnimations(a){return a.is(d.base.ObjectKind.stackTopic)?a.pageChildren[0]:
a.is(d.base.ObjectKind.master)||a.is(d.base.ObjectKind.visual)||a.is(d.base.ObjectKind.cover)||a.is(d.base.ObjectKind.surface)?a.parent.is(d.base.ObjectKind.stackTopic)?a.parent.pageChildren[0]:a.parent:a}moveAnimationsToTargetsUnderNewParent(a,b,c,e){this.editPath(()=>{var d=this.parentForAnimations(a).id,p=this.parentForAnimations(b).id,r=this.editorPathQuery.getStepIndexesForEntityId(d);d=this.editorPathQuery.getStepIndexesForEntityId(p);if(0!==r.length&&0!==d.length){var g=na(this.mscene);p=[];
for(var k of r.reverse()){r=g.getMutableAt(k);for(let a=r.getMutableActions().length()-1;0<=a;a--){var l=r.getMutableActions().getMutableAt(a);if(l.is(f.CetModel.ID.FADE_OUT_OBJECT_EP)||l.is(f.CetModel.ID.FADE_IN_OBJECT_EP)||l.is(f.CetModel.ID.ZOOM_TO_OBJECT_EP))0<=c.indexOf(l.getTarget())&&(l=l.getEntity(),p.push(this.mscene.dup([l])[0].getMutableWrapper(f.CetModel.ID.EDITOR_PATH_ACTION.W)),r.getMutableActions().removeAt(a));else if(l.is(f.CetModel.ID.FADE_OUT_OBJECTS_EP)||l.is(f.CetModel.ID.FADE_IN_OBJECTS_EP)){var x=
l.getTargets().items().filter((a)=>0<=c.indexOf(a));const b=l.getTargetGroups().items().filter((a)=>0<=e.indexOf(a));if(0<x.length||0<b.length){var t=l.getEntity();t=this.mscene.dup([t])[0].getMutableWrapper(f.CetModel.ID.EDITOR_PATH_ACTION.W);if(t.is(f.CetModel.ID.FADE_OUT_OBJECTS_EP)||t.is(f.CetModel.ID.FADE_IN_OBJECTS_EP)){var m=t.getMutableTargets(),n=l.getMutableTargets();for(let a=m.length()-1;0<=a;a--)0>x.indexOf(m.getAt(a))?m.removeAt(a):n.removeAt(a);x=t.getMutableTargetGroups();m=l.getMutableTargetGroups();
for(n=x.length()-1;0<=n;n--)0>b.indexOf(x.getAt(n))?x.removeAt(n):m.removeAt(n);0===l.getMutableTargets().length()&&0===l.getMutableTargetGroups().length()&&r.getMutableActions().removeAt(a)}p.push(t)}}}}k=g.getMutableAt(d[0]);for(d=p.length-1;0<=d;d--)k.getMutableActions().add(p[d])}})}moveToWithDescendants(a,b){this.editPath(()=>{-1===b&&(b=l.Cet.pathKludge.getEditorPathComponent(this.mscene).length());let c=[];var e=this.editorPathQuery.getStepIndexesForEntityId(a);if(0<e.length){var h=Math.min(...e);
for(e=Math.max(...e);h<=e;h++)c.push(h);d.CetModelEditor.isPlanetOrStack(a,this.mscene)&&c.push(e+1)}for(h=0;h<c.length;h++){this.movePathStepI(c[h],b);for(e=h+1;e<c.length;e++)if(c[e]>c[h]&&c[e]<b||c[e]<c[h]&&c[e]>b)c[h]<b?c[e]--:c[e]++;c[h]>=b&&b++}})}importPath(a,b,c){this.editPath(()=>{const e=this.parentForAnimations(b).id;let h=d.CetModelEditor.createEditorPathQuery(this.mscene).findPathInsertPosition(null!==c&&void 0!==c?c:e);const p=[];l.Cet.pathKludge.assertEditorPathV2(a);var r=a.getEditorPath().getSteps();
const g=na(this.mscene);for(const a of f.CetModel.pdomIterable(r))if(a.getDomType()===k.DomType.FLY_TO_OVERVIEW_EP){r=d.CetModelEditor.createEditorPathQuery(this.mscene).getStepIndexesForEntityId(e)[0];var w=a;r=na(this.mscene).getMutableAt(r);for(let a of f.CetModel.pdomIterable(w.getActions())){w=a;w=k.DOM.RuntimeTypeInfo().safeCastToEditorPathAction(w);if(null!=w)w=k.DOM.IPreziCopy().copyEditorPathAction(w);else throw Error("invalid pathAction");w.setStartPointToken(null);r.getMutableActions().add(f.CetModel.ID.EDITOR_PATH_ACTION.inflate(this.mscene,
w))}}else{r=a;w=a;w=k.DOM.RuntimeTypeInfo().safeCastToEditorPathStep(w);if(null!=w)w=k.DOM.IPreziCopy().copyEditorPathStep(w);else throw Error("invalid pathstep");w.setStartPointToken(null);for(let a of f.CetModel.pdomIterable(w.getActions()))a.setStartPointToken(null);r=f.CetModel.ID.FLY_TO_OBJECT_EP.inflate(this.mscene,r);for(const a of g)if(w=a,w.is(f.CetModel.ID.FLY_TO_OBJECT_EP)&&w.getTarget()===r.getTarget()&&w.getComingFrom()===r.getComingFrom()){p.push(w);break}null==h?na(this.mscene).add(r):
na(this.mscene).insert(h++,r)}for(const a of p)g.removeAt(g.indexOf(a))})}removeStepsAndActionsPointingToTargets(a){this.editPath(()=>{let b=[];const c=na(this.mscene);c.forEachMutable((c,d)=>{c.is(f.CetModel.ID.FLY_TO_OBJECT_EP)&&0<=a.indexOf(c.getTarget())&&b.push(d);const e=[];c.getMutableActions().forEachMutable((b,c)=>{if(b.is(f.CetModel.ID.FADE_OUT_OBJECT_EP)||b.is(f.CetModel.ID.FADE_IN_OBJECT_EP)||b.is(f.CetModel.ID.ZOOM_TO_OBJECT_EP))0<=a.indexOf(b.getTarget())&&e.push(c);else if(b.is(f.CetModel.ID.FADE_OUT_OBJECTS_EP)||
b.is(f.CetModel.ID.FADE_IN_OBJECTS_EP)){for(let c of a){const a=[...b.getTargets().items()].indexOf(c);0<=a&&b.getMutableTargets().removeAt(a)}0===b.getTargets().length()&&0===b.getTargetGroups().length()&&e.push(c)}});for(d=e.length-1;0<=d;d--)c.getMutableActions().removeAt(e[d]),Q.avro.Avro.createDefaultLogger().logDeletedObject({object_type:"ANIMATION",topic_relationship:"CONTENT",delete_type:null,object_id:null})});for(let a=b.length-1;0<=a;a--)c.removeAt(b[a])})}removeReferencesFromPathAction(a,
b,c){this.editPath(()=>{for(let d of[...a]){const a=this.mscene.lookup(d,f.CetModel.ID.EDITOR_PATH_ACTION.W);if(null==a||a.is(f.CetModel.ID.ZOOM_TO_OBJECT_EP))continue;const h=this.mscene.lookup(d,f.CetModel.ID.HAS_TARGETS.W),g=this.mscene.lookup(d,f.CetModel.ID.HAS_TARGET.W),k=this.mscene.lookup(d,f.CetModel.ID.HAS_TARGET_GROUPS.W);b.forEach((a)=>{null!=g&&g.getTarget()===a&&g.setTarget(null);if(null!=h){const b=h.getMutableTargets();for(let c=b.length()-1;0<=c;c--)b.getAt(c)===a&&b.removeAt(c)}});
c.forEach((a)=>{if(null!=k){const b=k.getMutableTargetGroups();for(let c=b.length()-1;0<=c;c--)b.getAt(c)===a&&b.removeAt(c)}});if(!(null!=g&&null!=g.getTarget()||null!=h&&0!==h.getTargets().length()||null!=k&&0!==k.getTargetGroups().length())){var e=a.getEntity().getOwner();null!=e&&e.isDef(f.CetModel.ID.EDITOR_PATH_STEP)&&(e=e.getMutableWrapperChecked(f.CetModel.ID.EDITOR_PATH_STEP.W),e.getMutableActions().removeAt(e.getMutableActions().indexOf(a)))}}})}setStartPoint(a){this.editPath(()=>{var b=
l.Cet.pathKludge.getEditorPathComponent(this.mscene).items();for(var c=0;c<b.length;c++){var e=this.mscene.getEntityById(b[c]).getMutableWrapper(f.CetModel.ID.EDITOR_PATH_STEP.W);null!=e.getStartPointToken()&&e.setStartPointToken(null);e=e.getMutableActions();for(let a=0;a<e.length();a++){const b=e.getMutableAt(a);null!=b.getStartPointToken()&&b.setStartPointToken(null)}}null!=a?(b=this.mscene.getEntityById(a),g.Check.notNull("startPoint",b),c=f.CetModel.ID.PATH_START_POINT_TOKEN.inflate(this.mscene,
k.DOM.createPathStartPointToken(k.DOM.generateId())),this.mscene.getPreziW().setPathStartPointToken(c),b.getMutableWrapper(f.CetModel.ID.POSSIBLY_START_POINT.W).setStartPointToken(c.getId())):this.mscene.getPreziW().setPathStartPointToken(null)})}fixPath(){this.createPathFixer().run()}movePathStepI(a,b){const c=na(this.mscene);b=-1===b?c.length():b;c.move(a,b)}insertFlyToOverview(a){this.editPath(()=>{this.insertFlyToOverview_DONTFIX(a)})}insertFlyToObject(a,b){this.editPath(()=>{this.insertFlyToObject_DONTFIX(a,
b)})}insertFlyToOverview_DONTFIX(a=null,b=null){const c=k.DOM.createFlyToOverviewEp();null!=b&&c.setComingFrom(k.DOM.createTopicRef(b));this.insertPathStep_DONTFIX(f.CetModel.ID.FLY_TO_OVERVIEW_EP.inflate(this.mscene,c),a)}insertFlyToObject_DONTFIX(a,b=null,c=null){a=k.DOM.createFlyToObjectEp(a);null!=c&&a.setComingFrom(k.DOM.createTopicRef(c));this.insertPathStep_DONTFIX(f.CetModel.ID.FLY_TO_OBJECT_EP.inflate(this.mscene,a),b)}insertPathStep_DONTFIX(a,b){null==b?na(this.mscene).add(a):na(this.mscene).insert(b,
a)}createPathFixer_FORTEST(){return this.createPathFixer()}setPlaybackPathGenerationStrategy(a){g.Check.notNull("playbackPathGenerationStrategy",a);const b=this.mscene.getPreziW();l.Cet.pathKludge.assertEditorPathV2(b);this.editPath(()=>{switch(a){case d.base.PlaybackPathGenerationStrategy.OverviewAfterLastChild_TopicAfterEachChild:b.getMutableEditorPath().setPathGenerationStrategy(f.CetModel.ID.VISIT_PARENT.inflate(this.mscene,k.DOM.createVisitParent()));break;case d.base.PlaybackPathGenerationStrategy.OverviewAfterEachChild_TopicAfterEachChild:b.getMutableEditorPath().setPathGenerationStrategy(f.CetModel.ID.VISIT_OVERVIEW_AND_PARENT.inflate(this.mscene,
k.DOM.createVisitOverviewAndParent()));break;case d.base.PlaybackPathGenerationStrategy.OverviewAfterEachChild_TopicAfterLastChild:b.getMutableEditorPath().setPathGenerationStrategy(f.CetModel.ID.VISIT_OVERVIEW.inflate(this.mscene,k.DOM.createVisitOverview()));break;case d.base.PlaybackPathGenerationStrategy.OverviewAfterLastChild_TopicAfterLastChild:b.getMutableEditorPath().setPathGenerationStrategy(f.CetModel.ID.VISIT_NONE.inflate(this.mscene,k.DOM.createVisitNone()));break;case d.base.PlaybackPathGenerationStrategy.OverviewAfterEachChild:b.getMutableEditorPath().setPathGenerationStrategy(f.CetModel.ID.LEGACY.inflate(this.mscene,
k.DOM.createLegacy()));break;case d.base.PlaybackPathGenerationStrategy.OverviewAfterLastChild:b.getMutableEditorPath().setPathGenerationStrategy(f.CetModel.ID.LEGACY_FINISH_ON_OVERVIEW.inflate(this.mscene,k.DOM.createLegacyFinishOnOverview()));break;default:n.Utils.assertNever(a)}})}editPath(a){a=a();this.createPathFixer().run();return a}createAnimationObjectI(a,b,c){switch(c){case d.ActionType.FADE_IN:if(1===a.length&&0===b.length)return f.CetModel.ID.FADE_IN_OBJECT_EP.inflate(this.mscene,k.DOM.createFadeInObjectEp(a[0]));
var e=f.CetModel.ID.FADE_IN_OBJECTS_EP.inflate(this.mscene,k.DOM.createFadeInObjectsEp());for(var h of a)this.mscene.getEntityById(h).isDef(f.CetModel.ID.Z_ZOOM_AREA)||e.getMutableTargets().add(h);for(let a of b)e.getMutableTargetGroups().add(a);return e;case d.ActionType.FADE_OUT:if(1===a.length&&0===b.length)return f.CetModel.ID.FADE_OUT_OBJECT_EP.inflate(this.mscene,k.DOM.createFadeOutObjectEp(a[0]));h=f.CetModel.ID.FADE_OUT_OBJECTS_EP.inflate(this.mscene,k.DOM.createFadeOutObjectsEp());for(e of a)this.mscene.getEntityById(e).isDef(f.CetModel.ID.Z_ZOOM_AREA)||
h.getMutableTargets().add(e);for(let a of b)h.getMutableTargetGroups().add(a);return h;case d.ActionType.ZOOM_TO:case d.ActionType.ZOOM_BACK:case d.ActionType.ZOOM_AREA:return a[0]===this.mscene.getPreziW().getOverview().getId()?f.CetModel.ID.ZOOM_TO_OVERVIEW_EP.inflate(this.mscene,k.DOM.createZoomToOverviewEp()):f.CetModel.ID.ZOOM_TO_OBJECT_EP.inflate(this.mscene,k.DOM.createZoomToObjectEp(a[0]))}return null}getPosForId(a,b){return a.indexOf(this.mscene.lookup(b,f.CetModel.ID.EDITOR_PATH_ACTION.W))}createPathFixer(){const a=
this.mscene.getPreziW();l.Cet.pathKludge.assertEditorPathV2(a);return new rb(a,this.mscene,na(this.mscene))}};class rb{constructor(a,b,c){this.document=a;this.mscene=b;this.editorPath=c;this.overviewId=this.document.getOverview().getId();this.playbackPath=this.document.getMutablePath()}structureTsto(){const a=m.CetModelEditorInternal.createTopicQuery(this.mscene),b=(c)=>{let e=null;var h=[],p=a.getTopicKind(c);switch(p){case d.TopicKind.Stack:h=m.CetModelEditorInternal.getPagesOfChapter(c,this.mscene);
e="stack";h=[...h];break;case d.TopicKind.Planet:case d.TopicKind.Overview:{e=p===d.TopicKind.Planet?"planet":"overview";let a=null;p===d.TopicKind.Planet?(p=this.mscene.lookup(c,f.CetModel.ID.Z_TOPIC_CONTAINER.W).getTopic(),a=null!=p&&p.is(f.CetModel.ID.PLANET_CHAPTER)?p.getSmartStructure():null):a=this.mscene.lookup(c,f.CetModel.ID.OVERVIEW.W).getSmartStructure();if(null!=a)for(let c of a.getChildren().items())h.push(b(c));break}case d.TopicKind.Page:case d.TopicKind.None:e="????";break;default:n.Utils.assertNever(p)}return e+
" "+c+"\n"+h.join("\n").split("\n").map((a)=>"    "+a).join("\n")};return b(this.mscene.getPreziW().getOverview().getId())}fixSmartStructure(){let a=new Set,b=!1;this.mscene.getEntityList().forEach((c)=>{if(c.isDef(f.CetModel.ID.SMART_STRUCTURE)){b=!0;c=c.getMutableWrapper(f.CetModel.ID.SMART_STRUCTURE.W);let e=0,d=c.getChildren();for(;e<d.length();)a.has(d.getAt(e))?c.getMutableChildren().removeAt(e):(a.add(d.getAt(e)),e++)}});return b}run(){this.fixSmartStructure()&&(this.generateEditorPath(),this.generatePlaybackPath())}static findPathActionOnPlaybackPath(a,
b,c){b=this.getDesiredPlaybackPath(a,b,{playbackPathActionIndex:new Map}).playbackPathActionIndex.get(c);c=0;for(const e of a.getPath())for(const a of e.getActions()){if(b===c)return a;c++}return null}generateEditorPath(){const a=this.generatePsidsForDesiredEditorPath();this.cleanupEditorPath(this.editorPath,a);let b=0;for(let c of a){const a=this.findIpathByPsid(c,b);0>a?this.addToEditorPath(b,c):a!==b&&this.editorPath.move(a,b);b++}n.Utils.assert(this.editorPath.length()===a.length,"generateEditorPath failed")}cleanupEditorPath(a,
b){b=[...b];for(let d=0;d<a.length();){const h=Wa(this.mscene,a.getAt(d));var c=b.findIndex((a)=>this.equals(h,a));if(0>c){c=a.getMutableAt(d);if(0<c.getActions().length())for(var e=d-1;0<=e;e--)if(Wa(this.mscene,a.getAt(e)).targetId===h.targetId){e=a.getMutableAt(e);for(let a of c.getMutableActions())c=this.mscene.dup([a.getEntity()])[0].getMutableWrapper(f.CetModel.ID.EDITOR_PATH_ACTION.W),e.getMutableActions().add(c);break}a.removeAt(d)}else b.splice(c,1),d++}}cleanupPlaybackPath(a,b){b=[...b];
for(let c=0;c<a.length();){const e=Wa(this.mscene,a.getAt(c)),d=b.findIndex((a)=>this.equals(e,a));0>d?a.removeAt(c):(b.splice(d,1),c++)}}equals(a,b){return a.targetId===b.targetId&&a.comingFrom===b.comingFrom}createFlyToWithNoActions(a){let b;b=a.targetId===this.overviewId?k.DOM.createFlyToOverviewEp():k.DOM.createFlyToObjectEp(a.targetId);null!=a.comingFrom&&b.setComingFrom(k.DOM.createTopicRef(a.comingFrom));return b}findIpathByPsid(a,b){for(;b<this.editorPath.length();b++)if(this.equals(Wa(this.mscene,
this.editorPath.getAt(b)),a))return b;return-1}generatePsidsForDesiredEditorPath(){const a=m.CetModelEditorInternal.createTopicQuery(this.mscene),b=(c,h)=>{const e=a.getTopicKind(c);switch(e){case d.TopicKind.Stack:var r=m.CetModelEditorInternal.getPagesOfChapter(c,this.mscene);if(0<r.length){h.push({targetId:c,comingFrom:null});for(var g of r)h.push({targetId:g,comingFrom:null}),h.push({targetId:c,comingFrom:g});return!0}return!1;case d.TopicKind.Planet:case d.TopicKind.Overview:e===d.TopicKind.Planet?
(g=this.mscene.lookup(c,f.CetModel.ID.Z_TOPIC_CONTAINER.W).getTopic(),g=null!=g&&g.is(f.CetModel.ID.PLANET_CHAPTER)?g.getSmartStructure():null):g=this.mscene.lookup(c,f.CetModel.ID.OVERVIEW.W).getSmartStructure();if(null!=g){h.push({targetId:c,comingFrom:null});for(r of g.getChildren().items())b(r,h)&&h.push({targetId:c,comingFrom:r});return!0}return!1;case d.TopicKind.Page:case d.TopicKind.None:return!1;default:n.Utils.assertNever(e)}},c=[];b(this.document.getOverview().getId(),c);return c}generatePlaybackPath(){const a=
k.DOM.IPreziCopy(),b=rb.getDesiredPlaybackPath(this.document,this.mscene,{playbackPath:[]}).playbackPath;this.cleanupPlaybackPath(this.playbackPath,b.map((a)=>Wa(this.mscene,a)));for(let c=0;c<b.length;c++){const e=b[c],d=c<this.playbackPath.length()?a.copyPathStep(this.playbackPath.getAt(c).toIPdom()):null;if(null==d||!k.DOM.comparePathStep(e,d)){let a=!1;if(null!=d&&e.getActions().length()===d.getActions().length()+1){const b=e.getActions().get(e.getActions().length()-1);d.getActions().append(b);
k.DOM.comparePathStep(e,d)&&(this.playbackPath.getAt(c).toMutable(this.mscene).getMutableActions().addFromPdomData(f.CetModel.ID.PATH_ACTION,b),a=!0)}a||this.playbackPath.insertFromPdomData(c,f.CetModel.ID.PATH_STEP,e)}}for(;this.playbackPath.length()>b.length;)this.playbackPath.removeAt(this.playbackPath.length()-1)}addToEditorPath(a,b){b.targetId===this.overviewId?this.editorPath.insertFromPdomData(a,f.CetModel.ID.FLY_TO_OVERVIEW_EP,this.createFlyToWithNoActions(b)):this.editorPath.insertFromPdomData(a,
f.CetModel.ID.FLY_TO_OBJECT_EP,this.createFlyToWithNoActions(b))}static getDesiredPlaybackPath(a,b,c){const e=ad(),h=a.getOverview().getId(),p=(a)=>a.is(f.CetModel.ID.FLY_TO_OBJECT_EP)?a.getTarget():h,r=(a,c,e,p)=>{if(d.CetModelEditor.isStack(c,b))return!1;if(a.is(f.CetModel.ID.LEGACY))return e||c===h;if(a.is(f.CetModel.ID.LEGACY_FINISH_ON_OVERVIEW))return e||c===h&&p;if(a.is(f.CetModel.ID.VISIT_NONE))return e||p;if(a.is(f.CetModel.ID.VISIT_OVERVIEW))return e||p||c===h;if(a.is(f.CetModel.ID.VISIT_OVERVIEW_AND_PARENT))return!0;
if(a.is(f.CetModel.ID.VISIT_PARENT))return e||p||c!==h;throw Error("unknown strategy");};a=a.getEditorPath().getPathGenerationStrategy();var g=[...$c(b)];const k=new Map,l=new Map;for(var x of g){var t=p(x);k.has(t)||k.set(t,x.getId());l.set(t,x.getId())}let m=0,n=-1,q=0;for(let b of g)if(x=p(b),g=k.get(x)===b.getId(),t=l.get(x)===b.getId(),r(a,x,g,t))n++,q=0,null!=c.playbackPath&&(x=e.createPlaybackPathStepFrom(b),c.playbackPath.push(x)),null!=c.editorPathElementIdToPlaybackPathPosition&&c.editorPathElementIdToPlaybackPathPosition.set(b.getId(),
{step:n,action:0}),b.getActions().forEach((a)=>{null!=c.playbackPathActionIndex&&c.playbackPathActionIndex.set(a,m);++q;null!=c.editorPathElementIdToPlaybackPathPosition&&c.editorPathElementIdToPlaybackPathPosition.set(a.getId(),{step:n,action:q});++m});else{const a=null!=c.playbackPath?c.playbackPath[c.playbackPath.length-1]:null;b.getActions().forEach((b)=>{if(null!=a){const c=e.createPlaybackPathActionFrom(b);a.getActions().append(c)}null!=c.playbackPathActionIndex&&c.playbackPathActionIndex.set(b,
m);++q;null!=c.editorPathElementIdToPlaybackPathPosition&&c.editorPathElementIdToPlaybackPathPosition.set(b.getId(),{step:n,action:q});++m})}null!=c.playbackPath&&e.postProcessPath(c.playbackPath);return c}}var Ca={};Object.defineProperty(Ca,"__esModule",{value:!0});Ca.AnimatedLayoutableEditorImpl=class{constructor(a,b){this.ctx=a;this.layoutable=b;this.tweener=null;this.isLayoutGroupEditor(this.layoutable)?this.rootEntityIds=this.layoutable.items.map((a)=>a.id):this.rootEntityIds=[this.layoutable.id];
this.tweener=this.ctx.mscene.getTweener();this.tweenFact=l.Cet.createTweenFactory()}snapshot(a={}){const b=this.getEntityStates(a.skipContent);return{animateToPlace:()=>{this.removeTweens(b);this._animate(b,a)}}}getEntityStates(a){return(()=>{if(null!=a&&a){const a=l.Cet.createTopicChildrenQuery(this.ctx.mscene);return[...this.rootEntityIds,...this.rootEntityIds.reduce((b,e)=>{b.push(...a.getChildrenIdsVisibleOutside(e));return b},[])]}return[...this.rootEntityIds,...l.Cet.createHierarchyQuery(this.ctx.mscene).getDescendantEntities(this.rootEntityIds)]})().map((a)=>
this.getEntityState(a))}getEntityState(a){var b=this.ctx.mscene.getEntityById(a),c=this.ctx.mscene.getAnimationScene().getEntityById(a);c=null!=c?l.Cet.transform(c).getLocalToWorld():l.Cet.transform(b).getLocalToWorld();return b.isDef(f.CetModel.ID.BACKGROUND_LAYER)?(b=b.getWrapper(f.CetModel.ID.BACKGROUND_LAYER.W),{id:a,transform:c,depth:b.getDepth(),fadeScale:b.getFadeScale()}):{id:a,transform:c,depth:null,fadeScale:null}}fitInto(a,b={}){const c=this.getEntityStates(b.skipContent);this.removeTweens(c);
this.layoutable.fitInto(a);this._animate(c,b)}fitZoomAreaIntoLayoutBox(a,b={}){const c=this.getEntityStates(b.skipContent);if(this.isTopicEditor(this.layoutable))this.layoutable.fitZoomAreaIntoLayoutBox(a);else throw"fitZoomAreaIntoLayoutBox is only available on decorated topic editors";this._animate(c,b)}_animate(a,b={}){b=null!=b.duration?b.duration:500;for(const c of a){a=this.getEntityState(c.id);const e=()=>this.tweenFact.createQuadInOut();this.setupTransformTween(c.id,"fitInto",e(),b,c.transform,
a.transform);null!=c.fadeScale&&this.setupTween(c.id,this.tweenFact.createBackgroundFadeScaleTween("fitIntoFadeScale",b,c.fadeScale,a.fadeScale),e());null!=c.depth&&this.setupTween(c.id,this.tweenFact.createBackgroundDepthTween("fitIntoDepth",b,c.depth,a.depth),e())}}setupTransformTween(a,b,c,e,d,p){b=this.tweenFact.createTransformTween(`AnimatedLayoutableEditorImpl:${b}`,e,d,p);this.setupTween(a,b,c)}setupTween(a,b,c){b.setEase(c);b.setUseUserStartTime(!0);b.setFillBeforeStart(!0);this.tweener.addTween(a,
b)}dropIn(a={}){var b=this.getEntityStates(a.skipContent);const c=null!=a.duration?a.duration:600;a=null!=a.scale?a.scale:1.2;const e=this.ctx.mscene.getTweener().createVisibilityAnimationHelper("EditAppearVisibility");this.removeTweens(b);for(const d of b){b=this.ctx.mscene.getEntityById(d.id);const h=d.transform,f=h.scaleAroundPoint(h.getTranslation(),a);e.hide(b);e.fadeIn(b,{delay:0,duration:c/2});this.setupTransformTween(d.id,"dropIn",this.tweenFact.createElasticOut(h.getScale()/2,300),c,f,h)}}bounce(a=
{}){var b=this.getEntityStates(a.skipContent);const c=null!=a.duration?a.duration:600;a=null!=a.scale?a.scale:1.2;this.removeTweens(b);for(const e of b){b=e.transform;const d=b.scaleAroundPoint(b.getTranslation(),a);this.setupTransformTween(e.id,"bounce",this.tweenFact.createElasticOut(b.getScale()/2,300),c,d,b)}}removeTweens(a){const b=this.ctx.mscene.getTweener();a.forEach((a)=>{b.removeTweens(a.id)})}isTopicEditor(a){return"is"in a&&a.is(d.base.ObjectKind.topic)}isLayoutGroupEditor(a){return!("is"in
a)}};var sb={};Object.defineProperty(sb,"__esModule",{value:!0});sb.DefaultColorHelperImpl=class{constructor(){this.defaultChartStyle={light:{background:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#000000")),axis:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#FFFFFF")),label:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#FFFFFF")),data1:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#DF4840")),
data2:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#EFCF1C")),data3:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#279B69")),data4:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#187EDA")),data5:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#66C7C9"))},dark:{background:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#FFFFFF")),axis:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#000000")),
label:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#000000")),data1:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#DF4840")),data2:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#EFCF1C")),data3:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#279B69")),data4:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#187EDA")),data5:m.CetModelEditorInternal.colorToStyleColor(q.Geometry.colorFromRGBString("#66C7C9"))}};
this.themeColorDefaults={};this.themeColorDefaults.color1=q.Geometry.colorFromRGBString("#D0021B");this.themeColorDefaults.color2=q.Geometry.colorFromRGBString("#F5A623");this.themeColorDefaults.color3=q.Geometry.colorFromRGBString("#7ED321");this.themeColorDefaults.color4=q.Geometry.colorFromRGBString("#4A90E2");this.themeColorDefaults.color5=q.Geometry.colorFromRGBString("#205081")}getDefaultChartStyle(){return this.defaultChartStyle}getLegacyOrDefaultColor(a,b){return this.getLegacyThemeColor(a,
b)||this.getDefaultThemeColor(a)}getDefaultThemeColor(a){return this.themeColorDefaults[a]}getLegacyThemeColor(a,b){const c=/^\*\.line[0-9]{1}$/,e=[];if(null==b)return null;for(const a of n.Utils.toIterable(b)){if(null==a)continue;b=a.getStyleSelector();const d=a.getStyleBlock();null!=b&&c.test(b.toString())&&null!=d&&null!=d.getColor()&&e.push(d.getColor())}switch(a){case "color1":return e[0];case "color2":return e[1];case "color3":return e[2];case "color4":return e[3];case "color5":return e[4];
default:throw Error("getThemeColor: Invalid color type");}}};var ta={};Object.defineProperty(ta,"__esModule",{value:!0});ta.SnippetEditorImpl=class{constructor(a){this.scene=a}getDocumentFromSnippet(a){switch(a){case d.TopicKind.Page:return this.getPageDocumentFromSnippet();case d.TopicKind.Stack:return this.getStackDocumentFromSnippet();case d.TopicKind.Planet:return this.getPlanetDocumentFromSnippet();default:throw Error(`Cannot insert topic with kind ${d.TopicKind[a]}`);}}hasSnippetForTopicType(){return null!=
this.scene.getPreziW().getDocumentStyle().getTopicSnippets()}getPlanetSnippet(){const a=this.scene.getPreziW().getDocumentStyle().getTopicSnippets();return null!=a&&a.is(f.CetModel.ID.STACK_AND_PLANET)?a.getPlanetChapter():k.DOM.loadXml('<prezi version="2" xmlns="http://prezi.com/schema/prezi/2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://prezi.com/schema/prezi/2 http://prezi.com/schema/prezi/2"><xFields><xField name="grouping"><xEnum type="Grouping" value="on"/></xField><xField name="topicType"><xEnum type="TopicType" value="ChainAllowedInTopics"/></xField></xFields><documentStyle><documentStyle><xFields><xField name="topicSnippets"><xJust><xConstructor type="topicSnippets" name="stackAndPlanet"><xField name="planetChapter"><xRecord type="topicPlanetChapterSnippet"><xField name="zObjects"><xArray><xConstructor type="zObject" name="zShape"><xField name="id"><xString value="24D3409827C071670E0EBB70ED4FC60F"/></xField><xField name="shapeType"><xEnum type="ShapeType" value="oval"/></xField><xField name="width"><xDouble value="600"/></xField><xField name="height"><xDouble value="600"/></xField><xField name="styleClasses"><xArray><xToken value="frame1"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858766" y="-0.6399999763920735" scale="0.0018962962962962959" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="46F65469A92867A4601996921FEA7B9B"/></xField><xField name="text"><xText><width>233.45424107142858</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858757" y="-0.9327252615897375" scale="0.0029160167494904584" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="6913012C1C6372DCD4170ACB06B836E0"/></xField><xField name="text"><xText><width>466.90848214285717</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="body"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858757" y="-0.7040529722017105" scale="0.0014580083747452292" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="D82130C2535ADFAB2191495582C01B56"/></xField><xField name="text"><xText><width>121</width><p align="center"><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858762" y="-0.6399999763920731" scale="0.006777756949723657" rotation="0"/></xField></xConstructor></xArray></xField><xField name="internalLayoutInfo"><xJust><xConstructor type="internalLayoutInfo" name="internalLayoutById"><xField name="internalLayoutId"><xString value="OverviewLayoutArc"/></xField></xConstructor></xJust></xField><xField name="smartStructure"><xConstructor type="smartStructure" name="unifiedSmartStructure"><xField name="id"><xString value="1D85CE67B73111C98A130E02F5C1F7E4"/></xField></xConstructor></xField><xField name="topicChildren"><xArray><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="content"/></xField><xField name="child"><xRef value="6913012C1C6372DCD4170ACB06B836E0"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="content"/></xField><xField name="child"><xRef value="46F65469A92867A4601996921FEA7B9B"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="cover"/></xField><xField name="child"><xRef value="D82130C2535ADFAB2191495582C01B56"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="visual"/></xField><xField name="child"><xRef value="24D3409827C071670E0EBB70ED4FC60F"/></xField></xRecord></xArray></xField><xField name="position"><xConstructor type="position" name="absolute"><xField name="localToWorld"><xTransform2D x="-0.9709068720858733" y="-0.6399999763920716" scale="0.12641975308641984" rotation="0"/></xField></xConstructor></xField></xRecord></xField><xField name="stackChapter"><xRecord type="topicStackChapterSnippet"><xField name="zObjects"><xArray><xConstructor type="zObject" name="zShape"><xField name="id"><xString value="DD0D706BB99BBD9EA941B61EFBEE6648"/></xField><xField name="shapeType"><xEnum type="ShapeType" value="oval"/></xField><xField name="width"><xDouble value="600"/></xField><xField name="height"><xDouble value="600"/></xField><xField name="styleClasses"><xArray><xToken value="frame1"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6399999763920738" scale="0.001896296296296296" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zTopicContainer"><xField name="id"><xString value="8B4358BF6FDD408E33F28D88043CE905"/></xField><xField name="topic"><xConstructor type="topic" name="page"><xField name="children"><xArray><xRef value="C3C5E431B422EBD8711080968753B134"/><xRef value="282D1FE349325EAB74FE87CABCAE8D99"/></xArray></xField></xConstructor></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="282D1FE349325EAB74FE87CABCAE8D99"/></xField><xField name="text"><xText><width>448.043492965368</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.7641927969048943" scale="0.0012371611305709547" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="C3C5E431B422EBD8711080968753B134"/></xField><xField name="text"><xText><width>896.086985930736</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="body"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6671753610074584" scale="0.0006185805652854774" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="8211CBD13E476C374051860DBF04811F"/></xField><xField name="text"><xText><width>121</width><p align="center"><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6399999763920738" scale="0.006777756949723714" rotation="0"/></xField></xConstructor></xArray></xField><xField name="topicChildren"><xArray><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="content"/></xField><xField name="child"><xRef value="8B4358BF6FDD408E33F28D88043CE905"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="cover"/></xField><xField name="child"><xRef value="8211CBD13E476C374051860DBF04811F"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="visual"/></xField><xField name="child"><xRef value="DD0D706BB99BBD9EA941B61EFBEE6648"/></xField></xRecord></xArray></xField><xField name="position"><xConstructor type="position" name="absolute"><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6399999763920738" scale="0.03792592592592592" rotation="0"/></xField></xConstructor></xField></xRecord></xField></xConstructor></xJust></xField></xFields><styleDeclarations><array><styleDeclaration><styleBlock><styleBlock><alpha><double value="0"/></alpha><fillType><fillType value="solid"/></fillType></styleBlock></styleBlock><styleSelector><simpleSelector value="*.baseLine"/></styleSelector></styleDeclaration></array></styleDeclarations></documentStyle></documentStyle></prezi>').getDocumentStyle().getTopicSnippets().getPlanetChapter()}getStackSnippet(){const a=
this.scene.getPreziW().getDocumentStyle().getTopicSnippets();return null!=a&&a.is(f.CetModel.ID.STACK_AND_PLANET)?a.getStackChapter():k.DOM.loadXml('<prezi version="2" xmlns="http://prezi.com/schema/prezi/2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://prezi.com/schema/prezi/2 http://prezi.com/schema/prezi/2"><xFields><xField name="grouping"><xEnum type="Grouping" value="on"/></xField><xField name="topicType"><xEnum type="TopicType" value="ChainAllowedInTopics"/></xField></xFields><documentStyle><documentStyle><xFields><xField name="topicSnippets"><xJust><xConstructor type="topicSnippets" name="stackAndPlanet"><xField name="planetChapter"><xRecord type="topicPlanetChapterSnippet"><xField name="zObjects"><xArray><xConstructor type="zObject" name="zShape"><xField name="id"><xString value="24D3409827C071670E0EBB70ED4FC60F"/></xField><xField name="shapeType"><xEnum type="ShapeType" value="oval"/></xField><xField name="width"><xDouble value="600"/></xField><xField name="height"><xDouble value="600"/></xField><xField name="styleClasses"><xArray><xToken value="frame1"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858766" y="-0.6399999763920735" scale="0.0018962962962962959" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="46F65469A92867A4601996921FEA7B9B"/></xField><xField name="text"><xText><width>233.45424107142858</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858757" y="-0.9327252615897375" scale="0.0029160167494904584" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="6913012C1C6372DCD4170ACB06B836E0"/></xField><xField name="text"><xText><width>466.90848214285717</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="body"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858757" y="-0.7040529722017105" scale="0.0014580083747452292" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="D82130C2535ADFAB2191495582C01B56"/></xField><xField name="text"><xText><width>121</width><p align="center"><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-0.9709068720858762" y="-0.6399999763920731" scale="0.006777756949723657" rotation="0"/></xField></xConstructor></xArray></xField><xField name="internalLayoutInfo"><xJust><xConstructor type="internalLayoutInfo" name="internalLayoutById"><xField name="internalLayoutId"><xString value="OverviewLayoutArc"/></xField></xConstructor></xJust></xField><xField name="smartStructure"><xConstructor type="smartStructure" name="unifiedSmartStructure"><xField name="id"><xString value="1D85CE67B73111C98A130E02F5C1F7E4"/></xField></xConstructor></xField><xField name="topicChildren"><xArray><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="content"/></xField><xField name="child"><xRef value="6913012C1C6372DCD4170ACB06B836E0"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="content"/></xField><xField name="child"><xRef value="46F65469A92867A4601996921FEA7B9B"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="cover"/></xField><xField name="child"><xRef value="D82130C2535ADFAB2191495582C01B56"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="visual"/></xField><xField name="child"><xRef value="24D3409827C071670E0EBB70ED4FC60F"/></xField></xRecord></xArray></xField><xField name="position"><xConstructor type="position" name="absolute"><xField name="localToWorld"><xTransform2D x="-0.9709068720858733" y="-0.6399999763920716" scale="0.12641975308641984" rotation="0"/></xField></xConstructor></xField></xRecord></xField><xField name="stackChapter"><xRecord type="topicStackChapterSnippet"><xField name="zObjects"><xArray><xConstructor type="zObject" name="zShape"><xField name="id"><xString value="DD0D706BB99BBD9EA941B61EFBEE6648"/></xField><xField name="shapeType"><xEnum type="ShapeType" value="oval"/></xField><xField name="width"><xDouble value="600"/></xField><xField name="height"><xDouble value="600"/></xField><xField name="styleClasses"><xArray><xToken value="frame1"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6399999763920738" scale="0.001896296296296296" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zTopicContainer"><xField name="id"><xString value="8B4358BF6FDD408E33F28D88043CE905"/></xField><xField name="topic"><xConstructor type="topic" name="page"><xField name="children"><xArray><xRef value="C3C5E431B422EBD8711080968753B134"/><xRef value="282D1FE349325EAB74FE87CABCAE8D99"/></xArray></xField></xConstructor></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="282D1FE349325EAB74FE87CABCAE8D99"/></xField><xField name="text"><xText><width>448.043492965368</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.7641927969048943" scale="0.0012371611305709547" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="C3C5E431B422EBD8711080968753B134"/></xField><xField name="text"><xText><width>896.086985930736</width><p><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="body"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6671753610074584" scale="0.0006185805652854774" rotation="0"/></xField></xConstructor><xConstructor type="zObject" name="zText"><xField name="id"><xString value="8211CBD13E476C374051860DBF04811F"/></xField><xField name="text"><xText><width>121</width><p align="center"><span><![CDATA[Double click to edit]]\x3e</span></p></xText></xField><xField name="isPlaceholder"><xBool value="true"/></xField><xField name="styleClasses"><xArray><xToken value="subtitle"/></xArray></xField><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6399999763920738" scale="0.006777756949723714" rotation="0"/></xField></xConstructor></xArray></xField><xField name="topicChildren"><xArray><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="content"/></xField><xField name="child"><xRef value="8B4358BF6FDD408E33F28D88043CE905"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="cover"/></xField><xField name="child"><xRef value="8211CBD13E476C374051860DBF04811F"/></xField></xRecord><xRecord type="topicChild"><xField name="behaviour"><xConstructor type="topicChildBehaviour" name="visual"/></xField><xField name="child"><xRef value="DD0D706BB99BBD9EA941B61EFBEE6648"/></xField></xRecord></xArray></xField><xField name="position"><xConstructor type="position" name="absolute"><xField name="localToWorld"><xTransform2D x="-2.2399996052645292" y="-0.6399999763920738" scale="0.03792592592592592" rotation="0"/></xField></xConstructor></xField></xRecord></xField></xConstructor></xJust></xField></xFields><styleDeclarations><array><styleDeclaration><styleBlock><styleBlock><alpha><double value="0"/></alpha><fillType><fillType value="solid"/></fillType></styleBlock></styleBlock><styleSelector><simpleSelector value="*.baseLine"/></styleSelector></styleDeclaration></array></styleDeclarations></documentStyle></documentStyle></prezi>').getDocumentStyle().getTopicSnippets().getStackChapter()}updatePlanetSnippet(a,
b){if(0<d.CetModelEditor.createTopicQuery(a).getChildTopics(b).length)throw Error("Planet topic snippet cannot have subtopic");let c=k.DOM.copyObjects(a.getPreziW().toIPdom(),[b]);var e=c.getZObjects(),h=-1;for(let a=0;a<e.length();a++)if(e.get(a).getId()===b){h=a;break}c=a.regenerateIDs(c);e=c.getZObjects();for(b=0;b<e.length();b++)e.get(b).getId(),e.get(b);b=e.get(h).getTopic();e.remove(h);h=k.DOM.IPreziCopy().copySmartStructure(b.getSmartStructure());h=k.DOM.createTopicPlanetChapterSnippet(k.DOM.IPreziCopy().copyPosition(b.getPosition()),
h);h.setZObjects(e);h.setTopicChildren(k.DOM.IPreziCopy().copyArrayTopicChild(b.getTopicChildren()));this.copyGroupData(b,h);e=b.getInternalLayoutInfo();null!=e&&h.setInternalLayoutInfo(k.DOM.IPreziCopy().copyInternalLayoutInfo(e));a.getPreziW().getMutableDocumentStyle().setTopicSnippets(f.CetModel.ID.STACK_AND_PLANET.inflate(a,k.DOM.createStackAndPlanet(h,k.DOM.IPreziCopy().copyTopicStackChapterSnippet(this.getStackSnippet()))))}updateStackSnippet(a,b){let c=k.DOM.copyObjects(a.getPreziW().toIPdom(),
[b]),e=c.getZObjects();var d=-1;for(let a=0;a<e.length();a++)if(e.get(a).getId()===b){d=a;break}c=a.regenerateIDs(c);e=c.getZObjects();b=e.get(d).getTopic();e.remove(d);d=k.DOM.createTopicStackChapterSnippet(k.DOM.IPreziCopy().copyPosition(b.getPosition()));d.setZObjects(e);d.setTopicChildren(k.DOM.IPreziCopy().copyArrayTopicChild(b.getTopicChildren()));this.copyGroupData(b,d);a.getPreziW().getMutableDocumentStyle().setTopicSnippets(f.CetModel.ID.STACK_AND_PLANET.inflate(a,k.DOM.createStackAndPlanet(k.DOM.IPreziCopy().copyTopicPlanetChapterSnippet(this.getPlanetSnippet()),
d)))}createPreziDataFromPage(a,b){var c=k.DOM.createLocalSession(this.emptySnippet(),()=>{}).generateObjectId();a=k.DOM.IPreziCopy().copyPage(a);c=k.DOM.createZTopicContainer(c,a);a=this.emptySnippet();a.setZObjects(k.DOM.IPreziCopy().copyArrayZObject(b));a.getZObjects().insert(0,c);return a}createPreziDataFromStackSnippet(a){var b=k.DOM.createLocalSession(this.emptySnippet(),()=>{}).generateObjectId(),c=k.DOM.createStackChapter(k.DOM.IPreziCopy().copyPosition(a.getPosition()));c.setTopicChildren(k.DOM.IPreziCopy().copyArrayTopicChild(a.getTopicChildren()));
this.copyGroupData(a,c);b=k.DOM.createZTopicContainer(b,c);c=this.emptySnippet();c.setZObjects(k.DOM.IPreziCopy().copyArrayZObject(a.getZObjects()));c.getZObjects().insert(0,b);return c}getStackDocumentFromSnippet(){return this.createPreziDataFromStackSnippet(this.getStackSnippet())}getPlanetDocumentFromSnippet(){return this.createPreziDataFromPlanetSnippet(this.getPlanetSnippet())}getPageDocumentFromSnippet(){var a=this.getStackDocumentFromSnippet().getZObjects(),b=a.iterator();let c=null;for(;b.hasNext()&&
null==c;){var e=b.next();e.getObjectType()===k.ZObjectType.Z_TOPIC_CONTAINER&&e.getTopic().getObjectType()===k.TopicType.PAGE&&(c=e.getTopic())}b=c.getChildren().iterator();for(e=[];b.hasNext();)e.push(b.next());const d=[];for(b=a.iterator();b.hasNext();)a=b.next(),0<=e.indexOf(a.getId())&&d.push(a);return this.createPreziDataFromPage(c,k.DOM.createArrayZObject(d))}createPreziDataFromPlanetSnippet(a){var b=k.DOM.createLocalSession(this.emptySnippet(),()=>{}).generateObjectId(),c=k.DOM.IPreziCopy().copyPosition(a.getPosition()),
e=k.DOM.IPreziCopy().copySmartStructure(a.getSmartStructure());c=k.DOM.createPlanetChapter(c,e);null!=a.getInternalLayoutInfo()&&(e=k.DOM.IPreziCopy().copyInternalLayoutInfo(a.getInternalLayoutInfo()),c.setInternalLayoutInfo(e));null!=a.getCoverLayoutInfo()&&(e=k.DOM.IPreziCopy().copyCoverLayoutInfo(a.getCoverLayoutInfo()),c.setCoverLayoutInfo(e));c.setTopicChildren(k.DOM.IPreziCopy().copyArrayTopicChild(a.getTopicChildren()));this.copyGroupData(a,c);b=k.DOM.createZTopicContainer(b,c);c=this.emptySnippet();
c.setZObjects(k.DOM.IPreziCopy().copyArrayZObject(a.getZObjects()));c.getZObjects().insert(0,b);return c}emptySnippet(){return k.DOM.emptyPrezi()}copyGroupData(a,b){b.setContentGroups(k.DOM.IPreziCopy().copyArrayGroup(a.getContentGroups()));b.setVisualGroups(k.DOM.IPreziCopy().copyArrayGroup(a.getVisualGroups()));b.setCoverGroups(k.DOM.IPreziCopy().copyArrayGroup(a.getCoverGroups()));b.setSurfaceGroups(k.DOM.IPreziCopy().copyArrayGroup(a.getSurfaceGroups()));b.setMasterGroups(k.DOM.IPreziCopy().copyArrayGroup(a.getMasterGroups()))}};
var oa={selectorStringToStyleSelector:function(a){if(1<=a.length&&"#"===a.charAt(0))throw Error("id selector");var b=a.indexOf(".");a=0>b?{elementString:a,classString:null}:{elementString:a.substr(0,b),classString:a.substr(b+1)};if(null!=a.classString&&0===a.classString.length)throw Error("empty class name");b=0===a.elementString.length||"*"===a.elementString?null:a.elementString;return{className:a.classString,styledObjectKind:(0,oa.elementSelectorToObjectKind)(b),rawTypeName:b}},elementSelectorToObjectKind:function(a){if(null==
a)return null;switch(a){case f.getObjectTypeFromDomType(k.DomType.Z_ARROW):return d.base.ObjectKind.arrow;case f.getObjectTypeFromDomType(k.DomType.Z_LINE):return d.base.ObjectKind.line;case f.getObjectTypeFromDomType(k.DomType.Z_CHART_PDF):return d.base.ObjectKind.chart;case f.getObjectTypeFromDomType(k.DomType.Z_IMAGE):return d.base.ObjectKind.image;case f.getObjectTypeFromDomType(k.DomType.Z_PDF):return d.base.ObjectKind.pdf;case f.getObjectTypeFromDomType(k.DomType.Z_SHAPE):return d.base.ObjectKind.shape;
case f.getObjectTypeFromDomType(k.DomType.Z_SWF_GRAPHICS):return d.base.ObjectKind.swf;case f.getObjectTypeFromDomType(k.DomType.Z_TEXT):case f.getObjectTypeFromDomType(k.DomType.Z_RICH_TEXT):return d.base.ObjectKind.text;default:return d.base.ObjectKind.unknownObject}},styleSelectorToString:function(a,b){a=null==a?"*":a;return null==b?a:`${a}.${b}`},objectKindToElementSelector:function(a,b){switch(a){case d.base.ObjectKind.arrow:return f.getObjectTypeFromDomType(k.DomType.Z_ARROW);case d.base.ObjectKind.line:return f.getObjectTypeFromDomType(k.DomType.Z_LINE);
case d.base.ObjectKind.chart:return f.getObjectTypeFromDomType(k.DomType.Z_CHART_PDF);case d.base.ObjectKind.image:return f.getObjectTypeFromDomType(k.DomType.Z_IMAGE);case d.base.ObjectKind.pdf:return f.getObjectTypeFromDomType(k.DomType.Z_PDF);case d.base.ObjectKind.shape:return f.getObjectTypeFromDomType(k.DomType.Z_SHAPE);case d.base.ObjectKind.swf:return f.getObjectTypeFromDomType(k.DomType.Z_SWF_GRAPHICS);case d.base.ObjectKind.text:return f.CetModel.textKludge.getStyleSheetTypeName(b);default:n.Utils.assertNever(a)}}};
Object.defineProperty(oa,"__esModule",{value:!0});var wa={colorFromData:function(a,b){g.Check.rgba(a,b);return q.Geometry.colorFromRGBInt((b.r<<16)+(b.g<<8)+b.b)}};Object.defineProperty(wa,"__esModule",{value:!0});var G={createEmptyStyleBlock:function(){return{fill:{color:void 0,alpha:void 0,fillKind:void 0,gradientStartAlpha:void 0,gradientStartColor:void 0,gradientEndAlpha:void 0,gradientEndColor:void 0},border:{alpha:void 0,color:void 0,thickness:void 0},text:{background:{alpha:void 0,color:void 0,
display:void 0,padding:void 0,cornerRadius:void 0},font:void 0},arc:{connectorAttachPadding:void 0},rectangleCornerRadius:void 0,thickness:void 0,padding:void 0,colorFilter:void 0}},styleBlockFromPdom:function(a,b){var c={color:L(b.hasColor()?v.StyleSheetEditorImpl.toStyleColor(b.getColor()):null),alpha:L(b.hasAlpha()?b.getAlpha():null),fillKind:L(b.hasFillType()?id(b.getFillType()):null),gradientStartAlpha:L(b.hasGradStartAlpha()?b.getGradStartAlpha():null),gradientStartColor:L(b.hasGradStartColor()?
v.StyleSheetEditorImpl.toStyleColor(b.getGradStartColor()):null),gradientEndAlpha:L(b.hasGradEndAlpha()?b.getGradEndAlpha():null),gradientEndColor:L(b.hasGradEndColor()?v.StyleSheetEditorImpl.toStyleColor(b.getGradEndColor()):null)},e={alpha:L(b.hasBorderAlpha()?b.getBorderAlpha():null),color:L(b.hasBorderColor()?v.StyleSheetEditorImpl.toStyleColor(b.getBorderColor()):null),thickness:L(b.hasBorderThickness()?b.getBorderThickness():null)};a={background:{alpha:L(b.hasBackgroundAlpha()?b.getBackgroundAlpha():
null),color:L(b.hasBackgroundColor()?v.StyleSheetEditorImpl.toStyleColor(b.getBackgroundColor()):null),display:L(b.hasDisplayBackground()?b.getDisplayBackground():null),padding:L(b.hasBackgroundPadding()?b.getBackgroundPadding():null),cornerRadius:L(b.hasBackgroundCornerRadius()?b.getBackgroundCornerRadius():null)},font:L(b.hasFontClass()?a(b.getFontClass()):null)};var d={connectorAttachPadding:L(b.hasAttachPadding()?b.getAttachPadding():null)},f=L(b.hasCornerRadius()?b.getCornerRadius()/2:null),
r=L(b.hasThickness()?b.getThickness():null),g=L(b.hasPadding()?b.getPadding():null);b=L(b.hasColorFilter()?b.getColorFilter():null);b=void 0===b?void 0:(0,G.colorFilterFromPdom)(b);return{fill:c,border:e,text:a,arc:d,rectangleCornerRadius:f,thickness:r,padding:g,colorFilter:b}},colorFilterToPdom:function(a){g.Check.notNull("colorFilter",a);return a.kind===d.base.ColorFilterKind.solidColorBlend?(g.Check.rgba("colorData",a.color),k.DOM.createImmutableSolidColorBlend(a.color.a,wa.colorFromData("colorData",
a.color))):k.DOM.createNoColorFilter()},colorFilterFromPdom:function(a){if(a.getObjectType()===k.ColorFilterType.NO_COLOR_FILTER)return{kind:d.base.ColorFilterKind.noColorFilter};if(a.getObjectType()===k.ColorFilterType.SOLID_COLOR_BLEND)return{kind:d.base.ColorFilterKind.solidColorBlend,color:Object.assign(Object.assign({},v.StyleSheetEditorImpl.toStyleColor(a.getBlendColor())),{a:a.getBlendAlpha()})};throw g.Check.failure("invalid color transform");},setStyleBlock_Internal:function(a,b,c,e){g.Check.styleBlock("styledeclaration:styleblock",
c);const h=b.getMutableStyleBlock();null!=c.fill.color&&h.setColor(v.StyleSheetEditorImpl.toColor(c.fill.color));null!=c.fill.alpha&&h.setAlpha(c.fill.alpha);null!=c.fill.fillKind&&h.setFillType(hd(c.fill.fillKind));null!=c.fill.gradientStartAlpha&&h.setGradStartAlpha(c.fill.gradientStartAlpha);null!=c.fill.gradientStartColor&&h.setGradStartColor(d.CetModelEditor.styleColorToColor(c.fill.gradientStartColor));null!=c.fill.gradientEndAlpha&&h.setGradEndAlpha(c.fill.gradientEndAlpha);null!=c.fill.gradientEndColor&&
h.setGradEndColor(d.CetModelEditor.styleColorToColor(c.fill.gradientEndColor));null!=c.border.alpha&&h.setBorderAlpha(c.border.alpha);null!=c.border.color&&h.setBorderColor(d.CetModelEditor.styleColorToColor(c.border.color));null!=c.border.thickness&&h.setBorderThickness(c.border.thickness);null!=c.text.background.alpha&&h.setBackgroundAlpha(c.text.background.alpha);null!=c.text.background.color&&h.setBackgroundColor(d.CetModelEditor.styleColorToColor(c.text.background.color));null!=c.text.background.display&&
h.setDisplayBackground(c.text.background.display);null!=c.text.background.padding&&h.setBackgroundPadding(c.text.background.padding);null!=c.text.background.cornerRadius&&h.setBackgroundCornerRadius(c.text.background.cornerRadius);null!=c.rectangleCornerRadius&&h.setCornerRadius(2*c.rectangleCornerRadius);if(null!=c.text.font){const d=c.text.font;null==h.getFontClass()&&(b=b.getStyleSelector().toString(),b=b.startsWith("#")?K.FontUtils.getFontClassName(d.description.fontFamily,d.weight,d.style):oa.selectorStringToStyleSelector(b).className,
h.setFontClass(b));b=h.getFontClass();a:{for(p of a.getPreziW().getMutableDocumentStyle().getMutableFontClasses())if(p.getName()===b){var p=[p,!1];break a}p=f.CetModel.ID.FONT_CLASS.inflate(a,k.DOM.createFontClass(b));a.getPreziW().getMutableDocumentStyle().getMutableFontClasses().add(p);p=[p,!0]}const [g,l]=p;if(l||!e)null!=d.description&&(g.setFontFamily(d.description.fontFamily),K.FontUtils.ensureFontFamily(a,d.description)),null!=d.weight&&g.setFontWeight(d.weight),null!=d.style&&g.setFontStyle(d.style)}null!=
c.arc.connectorAttachPadding&&h.setAttachPadding(c.arc.connectorAttachPadding);null!=c.thickness&&h.setThickness(c.thickness);null!=c.padding&&h.setPadding(c.padding);c.colorFilter&&h.setColorFilter((0,G.colorFilterToPdom)(c.colorFilter))}};Object.defineProperty(G,"__esModule",{value:!0});var v={};Object.defineProperty(v,"__esModule",{value:!0});class Kc{constructor(a,b){this.lookupFontInfo=a;this.getIPrezi=b}getFontDescriptions(){const a=[];for(const b of f.CetModel.pdomIterable(this.getIPrezi().getDocumentStyle().getFontFamilies()))a.push(K.FontUtils.getFontDescriptionFromFontFamily(b));
return a}matchStyle(a,b,c){return a.styledObjectKind===c&&a.className===b}lookup(a,b=null){return this.getStyleSheets().find((c)=>this.matchStyle(c,a,b))}getStyleSheets(){const a=[];for(const b of n.Utils.toIterable(this.getIPrezi().getDocumentStyle().getStyleDeclarations())){if(b.getStyleSelector().toString().startsWith("#"))continue;const c=oa.selectorStringToStyleSelector(b.getStyleSelector().toString());a.push({className:c.className,styledObjectKind:c.styledObjectKind,rawTypeName:c.rawTypeName,
styleBlock:G.styleBlockFromPdom(this.lookupFontInfo,b.getStyleBlock())})}return a}resolve(a){g.Check.notNull("selectors",a);for(const b of a)g.Check.notNull("selector",b),g.Check.notNull("selector.classNames",b.classNames),b.classNames.forEach((a,b)=>{g.Check.notNull(`selector.classNames[${b}]`,a)});return f.CetModel.createStyleResolver().getMatchingStyleBlockWithoutIdSpecificStyles(this.getIPrezi(),a.map((a)=>({objectType:oa.objectKindToElementSelector(a.styledObjectKind,this.getIPrezi()),styleClasses:a.classNames}))).map((a)=>
G.styleBlockFromPdom(this.lookupFontInfo,a))}getThemeColors(){var a=this.getIPrezi().getDocumentStyle().getThemeColors();if(null==a){a=d.CetModelEditor.createDefaultColorHelper();const b=this.getIPrezi().getDocumentStyle().getStyleDeclarations();return{color1:v.StyleSheetEditorImpl.toStyleColor(a.getLegacyOrDefaultColor("color1",b)),color2:v.StyleSheetEditorImpl.toStyleColor(a.getLegacyOrDefaultColor("color2",b)),color3:v.StyleSheetEditorImpl.toStyleColor(a.getLegacyOrDefaultColor("color3",b)),color4:v.StyleSheetEditorImpl.toStyleColor(a.getLegacyOrDefaultColor("color4",
b)),color5:v.StyleSheetEditorImpl.toStyleColor(a.getLegacyOrDefaultColor("color5",b))}}return{color1:v.StyleSheetEditorImpl.toStyleColor(a.getColor1()),color2:v.StyleSheetEditorImpl.toStyleColor(a.getColor2()),color3:v.StyleSheetEditorImpl.toStyleColor(a.getColor3()),color4:v.StyleSheetEditorImpl.toStyleColor(a.getColor4()),color5:v.StyleSheetEditorImpl.toStyleColor(a.getColor5())}}getChartStyle(){let a=this.getIPrezi().getDocumentStyle().getChartStyle();return null==a?(new sb.DefaultColorHelperImpl).getDefaultChartStyle():
{light:this.toChartColors(a.getLightStyle()),dark:this.toChartColors(a.getDarkStyle())}}getColorPaletteId(){const a=this.getIPrezi().getDocumentStyle().getColorPaletteInfo();return null!=a&&a.getObjectType()===k.ColorPaletteInfoType.COLOR_PALETTE_BY_ID?a.getColorPaletteId():null}toChartColors(a){return{background:v.StyleSheetEditorImpl.toStyleColor(a.getBackgroundColor()),axis:v.StyleSheetEditorImpl.toStyleColor(a.getAxisColor()),data1:v.StyleSheetEditorImpl.toStyleColor(a.getDataColor1()),data2:v.StyleSheetEditorImpl.toStyleColor(a.getDataColor2()),
data3:v.StyleSheetEditorImpl.toStyleColor(a.getDataColor3()),data4:v.StyleSheetEditorImpl.toStyleColor(a.getDataColor4()),data5:v.StyleSheetEditorImpl.toStyleColor(a.getDataColor5()),label:v.StyleSheetEditorImpl.toStyleColor(a.getLabelColor())}}}v.StyleSheetReaderImpl=class extends Kc{constructor(a,b,c){super(a,b);this.hasDefaultTopic=c}get chartStyle(){return this.getChartStyle()}get colorPaletteId(){return this.getColorPaletteId()}get styleSheets(){return this.getStyleSheets()}get themeColors(){return this.getThemeColors()}get fontDescriptions(){return this.getFontDescriptions()}hasStackTemplate(){return this.hasDefaultTopic()}hasPlanetTemplate(){return this.hasDefaultTopic()}};
v.StyleSheetEditorImpl=class extends Kc{constructor(a,b,c){super(K.FontDefinitionCache.createlookupFontInfoFromScene(a.mscene),()=>this.ctx.mscene.getPreziW().toIPdom());this.ctx=a;this.editorCache=b;this.baseObjectCommander=c}get chartStyle(){return this.getChartStyle()}get colorPaletteId(){return this.getColorPaletteId()}get styleSheets(){return this.getStyleSheets()}get themeColors(){return this.getThemeColors()}get fontDescriptions(){return this.getFontDescriptions()}hasStackTemplate(){return(new ta.SnippetEditorImpl(this.ctx.mscene)).hasSnippetForTopicType(d.TopicKind.Stack)}hasPlanetTemplate(){return(new ta.SnippetEditorImpl(this.ctx.mscene)).hasSnippetForTopicType(d.TopicKind.Planet)}createEmptyStyleBlock(){return G.createEmptyStyleBlock()}update(a){const b=
[];for(var c of a)oa.elementSelectorToObjectKind(c.rawTypeName)!==c.styledObjectKind&&g.Check.failure(`StyleDeclaration.rawTypeName (${c.rawTypeName}) and styledObjectKind (${c.styledObjectKind}) is inconsistent`);const e=(a,b)=>{const c=this.ctx.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations();for(let e=0;e<c.length();e++){const d=c.getMutableAt(e);if(d.getStyleSelector().toString().startsWith("#"))continue;const h=oa.selectorStringToStyleSelector(d.getStyleSelector().toString());
if(b===h.className&&a===h.rawTypeName)return d}return null};c=(a,b)=>{let c=e(a,b);if(null!=c)return c;a=k.DOM.createStyleDeclaration(k.DOM.createStyleBlock(),k.DOM.createSimpleSelectorFromString(oa.styleSelectorToString(a,b)));c=f.CetModel.ID.STYLE_DECLARATION.inflate(this.ctx.mscene,a);this.ctx.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations().add(c);return c};for(const d of a)if(null==d.styleBlock){if(a=e(d.rawTypeName,d.className),null!=a){const c=this.ctx.mscene.getPreziW().getMutableDocumentStyle().getStyleDeclarations().indexOf(a);
this.ctx.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations().removeAt(c);b.push(a)}}else a=c(d.rawTypeName,d.className),G.setStyleBlock_Internal(this.ctx.mscene,a,d.styleBlock,!1,null),b.push(a);this.baseObjectCommander.updateEntitesAfterStyleChange(this.editorCache,this.ctx,b)}set themeColors(a){g.Check.themeColors("theme colors",a);a=k.DOM.createFixedThemeColors(v.StyleSheetEditorImpl.toColor(a.color1),v.StyleSheetEditorImpl.toColor(a.color2),v.StyleSheetEditorImpl.toColor(a.color3),
v.StyleSheetEditorImpl.toColor(a.color4),v.StyleSheetEditorImpl.toColor(a.color5));this.ctx.mscene.getPreziW().getMutableDocumentStyle().setThemeColors(f.CetModel.ID.FIXED_THEME_COLORS.inflate(this.ctx.mscene,a))}set chartStyle(a){g.Check.chartStyle("chart style",a);a=k.DOM.createChartPdfStyle(this.createThemeStyle(a.dark),this.createThemeStyle(a.light));this.ctx.mscene.getPreziW().getMutableDocumentStyle().setChartStyle(f.CetModel.ID.CHART_STYLE.inflate(this.ctx.mscene,a))}set colorPaletteId(a){g.Check.notNull("id",
a);this.ctx.mscene.getPreziW().getMutableDocumentStyle().setColorPaletteInfo(f.CetModel.ID.COLOR_PALETTE_BY_ID.inflate(this.ctx.mscene,k.DOM.createColorPaletteById(a)))}createStyleDeclarationWithSelectorStringForPaste(a,b,c){a=k.DOM.createStyleDeclaration(k.DOM.createStyleBlock(),k.DOM.createSimpleSelectorFromString(a));a=f.CetModel.ID.STYLE_DECLARATION.inflate(this.ctx.mscene,a);this.ctx.mscene.getPreziW().getMutableDocumentStyle().getMutableStyleDeclarations().add(a);G.setStyleBlock_Internal(this.ctx.mscene,
a,b,!0,c);this.baseObjectCommander.updateEntitesAfterStyleChange(this.editorCache,this.ctx,[a])}static toStyleColor(a,b=null){return null==a?b:a.getRGBData()}static toColor(a){return null===a?null:q.Geometry.colorFromRGB(a.r/255,a.g/255,a.b/255)}createThemeStyle(a){return k.DOM.createChartPdfStyleTheme(v.StyleSheetEditorImpl.toColor(a.axis),v.StyleSheetEditorImpl.toColor(a.background),v.StyleSheetEditorImpl.toColor(a.data1),v.StyleSheetEditorImpl.toColor(a.data2),v.StyleSheetEditorImpl.toColor(a.data3),
v.StyleSheetEditorImpl.toColor(a.data4),v.StyleSheetEditorImpl.toColor(a.data5),v.StyleSheetEditorImpl.toColor(a.label))}};var tb={};Object.defineProperty(tb,"__esModule",{value:!0});tb.VideoURLParser=class{static extractYoutubeInfo(a){var b,c;if(null==a)return{id:null,startTimeSec:null};var e=[/^(?:https?:\/\/)?(?:www\.)?/,"(?:","(?:",/youtube\.com\//,"(?:",/(?:(?:v|embed|e|shorts)\/)/,"|(?:",/(?:watch\/?)?/,/(?:\?|#!?)/,/(?:.*?[&;])??/,/v=/,")",")",")",/|(?:youtu\.be\/)/,")",/([\w\-]{11})/,/(?:(?:[&?][^t][^&?]*)|(?:[&?]t[^=][^&?]*))*/,
/(?:[&?]t=([0-9]+)s?)?/].map((a)=>"string"===typeof a?a:a.source).join("");e=a.match(e);a=null!==(b=null===e||void 0===e?void 0:e[1])&&void 0!==b?b:null;b=null!==(c=null===e||void 0===e?void 0:e[2])&&void 0!==c?c:null;c=null==b?null:parseInt(b,10);return{id:a,startTimeSec:c}}};var xa={};Object.defineProperty(xa,"__esModule",{value:!0});xa.EditorUtils=class{static invalidateEditor(a){a.kill=()=>{};Object.setPrototypeOf(a,xa.EditorUtils.invalidProto)}};xa.EditorUtils.message="Editor already invalidated. The corresponding entity was removed from the document or the editor was created in a different execute block.";
xa.EditorUtils.invalidProto="undefined"!==typeof Proxy?new Proxy({},{get:()=>{throw new g.IllegalStateException(xa.EditorUtils.message);},set:()=>{throw new g.IllegalStateException(xa.EditorUtils.message);}}):{};var A={};Object.defineProperty(A,"__esModule",{value:!0});(function(a){a.visual="visual";a.cover="cover";a.surface="surface";a.master="master"})(A.EditorIdPrefix||(A.EditorIdPrefix={}));A.EditorId=new class{constructor(){this.ID_PREFIX="editorapi";this.SEPARATOR="."}create(a,b){return null==
a?b:`${this.ID_PREFIX}${this.SEPARATOR}${a}${this.SEPARATOR}${b}`}parse(a){return a.startsWith(this.ID_PREFIX)?(a=a.split(this.SEPARATOR),{prefix:a[1],entityId:a[2]}):{prefix:null,entityId:a}}};class Gd{constructor(a,b,c,e){this.kind=a;this.ctx=b;this.wrapper=c;this.editorCache=e;this.logger=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.BaseEditorImpl")}get id(){return A.EditorId.create(this.getIdPrefix(),this.wrapper.getId())}get ref(){return{__EditorApiRef:void 0,kind:this.kind,
id:this.id}}getIdPrefix(){return null}kill(){this.wrapper=null;xa.EditorUtils.invalidateEditor(this)}is(a){return Xa.isKindDescendantOf(this.kind,a)}handleNonApiChangeDontTriggerSystems(){}}A.BaseEditorImpl=Gd;var ca={},Hd=this&&ca.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{r(e.next(a))}catch(t){h(t)}}function p(a){try{r(e["throw"](a))}catch(t){h(t)}}function r(a){a.done?c(a.value):d(a.value).then(f,
p)}r((e=e.apply(a,b||[])).next())})};Object.defineProperty(ca,"__esModule",{value:!0});ca.CopyDataImpl=class{constructor(a,b,c){this.doc=b;this.masAssetSizes=c;this.layoutBoxImpl=g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl);g.Check.notNull("doc",b)}static create(a,b,c){const e=new Map,d=c.getZObjects().iterator();for(;d.hasNext();){var f=d.next();if(f.getObjectType()===k.ZObjectType.Z_ANIMATED_IMAGE&&(f=a.animatedImage(f.getId()),null!=f)){const a=f.imageAsset;e.set(f.imageAsset.mediaAssetId,
{width:a.width,height:a.height})}}return new ca.CopyDataImpl(b,c,e)}get originalLayoutBox(){return this.layoutBoxImpl}serialize(){const a=Object.assign(Object.assign({},this.layoutBoxImpl.toJSON()),{doc:k.DOM.saveXml(this.doc)});return JSON.stringify(a)}static parseAsync(a,b){return Hd(this,void 0,void 0,function*(){g.Check.notNull("json",b);var c=JSON.parse(b),e=g.Check.notNull("doc",c.doc);c=d.base.layoutBoxFromJSON(c);e=yield m.CetModelEditorInternal.loadAndConvertPreziXmlAsync(a,e);var h=e.getZObjects().iterator();
const f=[];for(;h.hasNext();){const a=h.next();a.getObjectType()===k.ZObjectType.Z_ANIMATED_IMAGE&&f.push(k.DOM.RuntimeTypeInfo().safeCastToZAnimatedImage(a).getMediaAssetId())}h=yield a.getMainStage().getRenderer().getAssetManager().queryMediaAssetDimensions(f);return new ca.CopyDataImpl(c,k.DOM.IPreziCopy().copyPrezi(e),h)})}};ca.ObjectEditorImpl=class extends A.BaseEditorImpl{constructor(a,b,c,e,d){super(a,b,c,d);this.baseObjectCommander=e;this.layoutableEditor=new u.LayoutableEditorImpl(()=>this.baseObjectCommander.getLayoutBox(this.getParentEditor().referenceFrame,
this.ctx.mscene,this.wrapper.getEntity(),l.TextBoundsOptions.Visible),(a)=>{a=g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl);this.baseObjectCommander.fitInto(this.ctx,this.wrapper.getEntity(),this.layoutBox,a)})}get position(){return this.layoutableEditor.position}set position(a){this.layoutableEditor.position=a}get rotationRad(){return this.layoutableEditor.rotationRad}set rotationRad(a){this.layoutableEditor.rotationRad=a}scale(a){this.layoutableEditor.scale(a)}get layoutBox(){return this.layoutableEditor.layoutBox}fitInto(a){this.layoutableEditor.fitInto(a)}copy(){const a=
k.DOM.copyObjects(this.ctx.mscene.getPreziW().toIPdom(),[this.wrapper.getId()]);return ca.CopyDataImpl.create(this.editorCache,this.layoutBox,a)}getParentId(){return l.Cet.createHierarchyQuery(this.ctx.mscene).getParentId(this.wrapper.getEntity())}getParentOrOverviewId(){const a=this.getParentId();return null!=a?a:this.ctx.mscene.getPreziW().getOverview().getId()}getParentEditor(){const a=this.getParentId();if(null==a)return this.editorCache.overview(this.ctx.mscene.getPreziW().getOverview().getId());
if(null==this.ctx.mscene.getEntityById(a))return null;if(m.CetModelEditorInternal.isPage(a,this.ctx.mscene))return this.editorCache.page(a);{const b=l.Cet.createTopicChildrenQuery(this.ctx.mscene);return b.hasBehavior(this.id,l.TopicChildBehavior.Visual)?this.editorCache.topic(a).visual:b.hasBehavior(this.id,l.TopicChildBehavior.Cover)?this.editorCache.topic(a).cover:b.hasBehavior(this.id,l.TopicChildBehavior.Surface)?this.editorCache.planetTopic(a).surface:b.hasBehavior(this.id,l.TopicChildBehavior.Master)?
this.editorCache.topic(a).master:this.editorCache.simpleObjectParent(a)}}get group(){const a=this.baseObjectCommander.groupManager.getGroupId(this.ctx.mscene,this.wrapper);return null==a?null:this.editorCache.group(a)}getScale(){return this.baseObjectCommander.getLocalToRelative(this.ctx.mscene,this.wrapper).getScale()}localToRelative(){return this.baseObjectCommander.getLocalToRelative(this.ctx.mscene,this.wrapper)}relativeToLocal(){return this.baseObjectCommander.getLocalToRelative(this.ctx.mscene,
this.wrapper).invert()}setTransform(a){this.baseObjectCommander.setLocalToRelative(this.ctx,this.wrapper,a)}delete(){this.baseObjectCommander.deleteObjects(this.ctx,[this.id])}isAbove(a){const b=m.CetModelEditorInternal.findZObject(this.id,this.ctx.mscene);a=m.CetModelEditorInternal.findZObject(a.id,this.ctx.mscene);return b>a}moveToTop(){this.changeZOrder(3,[])}moveToBottom(){this.changeZOrder(2,[])}moveAbove(a){null!=a&&(a=a instanceof Array?a:[a],0!==a.length&&this.changeZOrder(1,a))}moveBehind(a){null!=
a&&(a=a instanceof Array?a:[a],0!==a.length&&this.changeZOrder(0,a))}createLayoutGroupWith(a){return new u.LayoutGroupImpl(this.ctx,this.editorCache,this.baseObjectCommander,[this,...a])}fitIntoDontTriggerSystems(a){a=g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl);this.baseObjectCommander.fitIntoDontTriggerSystems(this.ctx,this.wrapper.getEntity(),this.layoutBox,a)}get selectionBox(){return this.baseObjectCommander.getLayoutBox(this.getParentEditor().referenceFrame,this.ctx.mscene,this.wrapper.getEntity(),
l.TextBoundsOptions.TextBox)}setVisibility(a,b,c){this.ctx.mscene.getTweener().createVisibilityAnimationHelper(a).setVisibility(this.wrapper.getEntity(),b,c)}changeZOrder(a,b){var c=l.Cet.createHierarchyQuery(this.ctx.mscene);const e=c.getDescendantEntitiesInZOrder([this.id]);b=c.getDescendantEntitiesInZOrder(b.map((a)=>a.id));c=null;switch(a){case 1:c=b[b.length-1].getId();break;case 0:c=b[0].getId()}m.CetModelEditorInternal.createEntityEditor(this.ctx.mscene).moveInZOrder(c,e.map((a)=>a.getId()),
a)}get(a){g.Check.notNull("ck",a);n.Utils.assert(!a.isDom,"cannot use dom component here");return this.wrapper.getEntity().get(a)}set(a,b){g.Check.notNull("ck",a);n.Utils.assert(!a.isDom,"cannot use dom component here");this.wrapper.getEntity().set(a,b)}discardOwnComponent(a){g.Check.notNull("ck",a);n.Utils.assert(!a.isDom,"cannot use dom component here");this.wrapper.getEntity().discardOwnComponent(a)}fitSelectionBoxInto(a){a=g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl);this.baseObjectCommander.fitInto(this.ctx,
this.wrapper.getEntity(),this.selectionBox,a)}fitSelectionBoxIntoDontTriggerSystems(a){a=g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl);this.baseObjectCommander.fitIntoDontTriggerSystems(this.ctx,this.wrapper.getEntity(),this.selectionBox,a)}preserveLayoutBox(a){const b=this.layoutBox;a=a();this.fitInto(this.getParentEditor().referenceFrame.layoutBox(b.center,b.size).withRotationRad(b.rotationRad));return a}};var u={layoutBoxFromJSON:function(a){var b=g.Check.notNull("layoutBox",a.layoutBox);
const c=g.Check.notNull("layoutBox.relativeToWorld",b.relativeToWorld),e=g.Check.notNull("layoutBox.obb",b.obb);g.Check.point("layoutBox.obb.center",b.obb.center);g.Check.point("relativeToWorld.translation",c.translation);g.Check.finite("relativeToWorld.scale",c.scale);g.Check.finite("relativeToWorld.rotation",c.rotation);g.Check.finite("layoutBox.obb.width",e.width);g.Check.finite("layoutBox.obb.height",e.height);g.Check.finite("layoutBox.obb.rotation",e.rotation);b=new u.ReferenceFrameImpl(q.Geometry.transform2dFromRad(a.layoutBox.relativeToWorld.translation,
a.layoutBox.relativeToWorld.scale,a.layoutBox.relativeToWorld.rotation));a=q.Geometry.obbFromData(a.layoutBox.obb.center.x,a.layoutBox.obb.center.y,a.layoutBox.obb.width,a.layoutBox.obb.height,180*a.layoutBox.obb.rotation/Math.PI);return new u.LayoutBoxImpl(b,a)}};Object.defineProperty(u,"__esModule",{value:!0});u.ReferenceFrameImpl=class{constructor(a){this.relativeToWorld=a}point(a){g.Check.point("point",a);return new u.ReferencePointImpl(this,a.x,a.y)}layoutBox(a,b){g.Check.point("centerPoint",
a);g.Check.size("size",b);return new u.LayoutBoxImpl(this,q.Geometry.obbFromData(a.x,a.y,b.width,b.height,0))}scale(a){g.Check.positive("factor",a);return new u.ReferenceFrameImpl(this.relativeToWorld.scaleAroundPoint(this.relativeToWorld.getTranslation(),a))}equals(a){a=g.Check.as("referenceFrame",a,"ReferenceFrameImpl",u.ReferenceFrameImpl);return this.relativeToWorld.equalsWithin(a.relativeToWorld,1E-5)}};u.ReferencePointImpl=class{constructor(a,b,c){this.referenceFrame=a;this.x=b;this.y=c}translate(a){g.Check.point("delta",
a);return new u.ReferencePointImpl(this.referenceFrame,this.x+a.x,this.y+a.y)}withReferenceFrame(a){a=g.Check.as("referenceFrame",a,"ReferenceFrameImpl",u.ReferenceFrameImpl);const b=a.relativeToWorld.invert().transformPoint(this.referenceFrame.relativeToWorld.transformPoint(this));return new u.ReferencePointImpl(a,b.x,b.y)}};u.LayoutBoxImpl=class{constructor(a,b){this.referenceFrame=a;this.relativeBounds=b}get aabb(){return 0===this.rotationRad?this:this.changeRelativeBounds(q.Geometry.obbFromRect(this.relativeBounds.getBounds().getData()))}get topLeft(){return this.point(d.base.AnchorPoint.topLeft)}get topCenter(){return this.point(d.base.AnchorPoint.topCenter)}get topRight(){return this.point(d.base.AnchorPoint.topRight)}get centerLeft(){return this.point(d.base.AnchorPoint.centerLeft)}get center(){return this.point(d.base.AnchorPoint.center)}get centerRight(){return this.point(d.base.AnchorPoint.centerRight)}get bottomLeft(){return this.point(d.base.AnchorPoint.bottomLeft)}get bottomCenter(){return this.point(d.base.AnchorPoint.bottomCenter)}get bottomRight(){return this.point(d.base.AnchorPoint.bottomRight)}get size(){return{width:this.relativeBounds.getWidth(),
height:this.relativeBounds.getHeight()}}get rotationRad(){return this.relativeBounds.getRotationRadians()}tsto(a=null){var b=this.size;if(null!=a)return a=a.shape("rectangle"),a.width=b.width,a.height=b.height,a.fitInto(this),b=u.LayoutBoxImpl.tstoColors[u.LayoutBoxImpl.tstoCounter++%u.LayoutBoxImpl.tstoColors.length],a.fill={fillKind:d.base.FillKind.solid,color:b},a;a=this.topLeft;return`Topleft: (${a.x}, ${a.y}), width: ${b.width} height: ${b.height}`}changeRelativeBounds(a){return new u.LayoutBoxImpl(this.referenceFrame,
a)}withRotationRad(a){g.Check.finite("radian",a);return this.changeRelativeBounds(this.relativeBounds.setRotationRadians(a))}rotateRad(a){g.Check.finite("delta",a);return this.changeRelativeBounds(this.relativeBounds.setRotationRadians(this.rotationRad+a))}translate(a){g.Check.point("delta",a);return this.changeRelativeBounds(this.relativeBounds.setPosition(this.relativeBounds.getCenterX()+a.x,this.relativeBounds.getCenterY()+a.y))}withSize(a){g.Check.size("size",a);return this.changeSize(a.width,
a.height)}extendToSquare(){var a=this.size;a=Math.max(a.width,a.height);return this.changeSize(a,a)}changeSize(a,b){return this.changeRelativeBounds(this.relativeBounds.setSize(a,b))}scaleToWidth(a){g.Check.positive("width",a);return this.changeSize(a,this.relativeBounds.getHeight()/this.relativeBounds.getWidth()*a)}scaleToHeight(a){g.Check.positive("height",a);return this.changeSize(this.relativeBounds.getWidth()/this.relativeBounds.getHeight()*a,a)}scale(a){g.Check.positive("factor",a);return this.changeSize(this.relativeBounds.getWidth()*
a,this.relativeBounds.getHeight()*a)}union(a){g.Check.notNull("other",a);a=g.Check.as("other",a,"LayoutBoxImpl",u.LayoutBoxImpl).withReferenceFrame(this.referenceFrame);return new u.LayoutBoxImpl(this.referenceFrame,this.relativeBounds.union(a.relativeBounds))}intersects(a){g.Check.notNull("other",a);return g.Check.as("other",a,"LayoutBoxImpl",u.LayoutBoxImpl).withReferenceFrame(this.referenceFrame).relativeBounds.intersects(this.relativeBounds)}contains(a){g.Check.notNull("point",a);a=a.withReferenceFrame(this.referenceFrame);
return this.relativeBounds.containsPoint(a)}fitOrFill(a,b){a=a.withReferenceFrame(this.referenceFrame);return a.withSize(n.Utils.fitOrFill(this.size,a.size,b))}fillOther(a){g.Check.notNull("other",a);a=g.Check.as("other",a,"LayoutBoxImpl",u.LayoutBoxImpl);return this.fitOrFill(a,!1)}fitIntoOther(a){g.Check.notNull("other",a);a=g.Check.as("other",a,"LayoutBoxImpl",u.LayoutBoxImpl);return this.fitOrFill(a,!0)}getBoundsInWorld(){return this.relativeBounds.transform(this.referenceFrame.relativeToWorld)}get asReferenceFrame(){var a=
this.getBoundsInWorld();a=q.Geometry.getFitTransform(q.Geometry.obbFromPoints({x:-this.size.width/2,y:-this.size.height/2},{x:this.size.width/2,y:this.size.height/2}),a,!0);return new u.ReferenceFrameImpl(a)}withReferenceFrame(a){const b=g.Check.as("referenceFrame",a,"ReferenceFrameImpl",u.ReferenceFrameImpl);return this.referenceFrame===a?this:new u.LayoutBoxImpl(b,this.getBoundsInWorld().transform(b.relativeToWorld.invert()))}checkAndNormalizePoint(a,b){if("referenceFrame"in b)return g.Check.as(a,
b,"ReferencePointImpl",u.ReferencePointImpl),b.withReferenceFrame(this.referenceFrame);g.Check.anchorPoint(a,b);return this.point(b)}move(a,b){a=this.checkAndNormalizePoint("from",a);b=this.checkAndNormalizePoint("to",b);return this.translate({x:b.x-a.x,y:b.y-a.y})}align(a,b,c,e){a=this.checkAndNormalizePoint("fromA",a);b=this.checkAndNormalizePoint("fromB",b);c=this.checkAndNormalizePoint("toA",c);e=this.checkAndNormalizePoint("toB",e);e=q.Geometry.transformFromTwoPointPairs(a,b,c,e);return this.changeRelativeBounds(this.relativeBounds.transform(e))}point(a){g.Check.anchorPoint("anchorPoint",
a);const b=this.relativeBounds.getCenterX(),c=this.relativeBounds.getCenterY(),e=this.relativeBounds.getHeightHalf(),d=this.relativeBounds.getWidthHalf(),f=this.relativeBounds.getUnitRightX(),r=this.relativeBounds.getUnitRightY(),{rx:k,ry:l}=a;return this.referenceFrame.point({x:b+k*d*f+l*e*-r,y:c+k*d*r+l*e*f})}toJSON(){const a=this.relativeBounds,b=this.referenceFrame.relativeToWorld;return{__LayoutBoxJSON:void 0,layoutBox:{obb:{center:a.getCenter(),rotation:a.getRotationRadians(),height:a.getHeight(),
width:a.getWidth()},relativeToWorld:{scale:b.getScale(),rotation:b.getRotationRad(),translation:b.getTranslation()}}}}sameAs(a,b){g.Check.notNull("other",a);g.Check.as("other",a,"LayoutBoxImpl",u.LayoutBoxImpl);a=a.withReferenceFrame(this.referenceFrame);const c=(a)=>[a.topLeft.x,a.topLeft.y,a.topRight.x,a.topRight.y,a.bottomLeft.x,a.bottomLeft.y,a.bottomRight.x,a.bottomRight.y],e=c(a);return c(this).every((a,c)=>Math.abs(a-e[c])<=(null!==b&&void 0!==b?b:0))}static transformBox(a,b){return new u.LayoutBoxImpl(new u.ReferenceFrameImpl(a.referenceFrame.relativeToWorld.concat(b)),
a.relativeBounds)}};u.LayoutBoxImpl.tstoCounter=0;u.LayoutBoxImpl.tstoColors=[{r:255,g:51,b:51,a:1},{r:255,g:153,b:51,a:1},{r:255,g:255,b:51,a:1},{r:153,g:255,b:51,a:1},{r:51,g:255,b:51,a:1},{r:51,g:51,b:255,a:1}];u.LayoutableEditorImpl=class{constructor(a,b){this.getLayoutBox=a;this.fitInto=b}get layoutBox(){return this.getLayoutBox()}get position(){const a=this.layoutBox.center;return{x:a.x,y:a.y}}set position(a){g.Check.point("position",a);this.fitInto(this.layoutBox.move(d.base.AnchorPoint.center,
this.layoutBox.referenceFrame.point(a)))}scale(a){g.Check.positive("scale multiplier",a);this.fitInto(this.layoutBox.scale(a))}get rotationRad(){return this.layoutBox.rotationRad}set rotationRad(a){g.Check.finite("rotationRad",a);this.fitInto(this.layoutBox.withRotationRad(a))}};u.LayoutGroupImpl=class{constructor(a,b,c,e){this.ctx=a;this.editorCache=b;this.baseObjectCommander=c;this.layoutables=e;g.Check.notEmpty("layoutables",e);this.items=e.reduce((a,b)=>b instanceof u.LayoutGroupImpl?a.concat(b.items):
a.concat(b),[]);this.layoutableEditor=new u.LayoutableEditorImpl(()=>this.items.map((a)=>a.layoutBox).reduce((a,b)=>a.union(b)),(a)=>{this.baseObjectCommander.batchFitInto(this.ctx,this.items,this.layoutBox,a)})}get position(){return this.layoutableEditor.position}set position(a){this.layoutableEditor.position=a}get rotationRad(){return this.layoutableEditor.rotationRad}set rotationRad(a){this.layoutableEditor.rotationRad=a}scale(a){this.layoutableEditor.scale(a)}get layoutBox(){return this.layoutableEditor.layoutBox}fitInto(a){this.layoutableEditor.fitInto(a)}createLayoutGroupWith(a){return new u.LayoutGroupImpl(this.ctx,
this.editorCache,this.baseObjectCommander,[this,...a])}tryToSetParent(a){return this.baseObjectCommander.tryBatchSetParent(this.ctx,this.items,a)}delete(){this.baseObjectCommander.deleteObjects(this.ctx,this.items.map((a)=>a.id))}copy(){return ca.CopyDataImpl.create(this.editorCache,this.layoutBox,k.DOM.copyObjects(this.ctx.mscene.getPreziW().toIPdom(),this.items.map((a)=>a.id)))}};u.DragGroupImpl=class{constructor(a,b,c,e){this.baseObjectCommander=b;this.originalDragProperties=[...new Set(c.concat(e))].map((b)=>
({editorId:b.id,dragLayoutBox:b.selectionBox,reset:b.is(d.base.ObjectKind.arc)?a.toDecorator(b).getSnapshot():null}));this.originalDragLayoutBox=1===c.length?c[0].selectionBox:c.map((a)=>a.selectionBox.aabb).reduce((a,b)=>a.union(b))}getOriginalDragLayoutBoxForEditor(a){var b;return null===(b=this.originalDragProperties.find((b)=>b.editorId===a.id))||void 0===b?void 0:b.dragLayoutBox}fitSelectionBoxInto(a,b,c){const e=g.Check.as("api",a,"BasePluginApiImpl",Z.BasePluginApiImpl);this.originalDragProperties.forEach(({editorId:a,
dragLayoutBox:d,reset:f})=>{a=e.lookup.transformedObject(a);if(null!=a){const e=d.align(this.originalDragLayoutBox.topLeft,this.originalDragLayoutBox.topRight,b.topLeft,b.topRight);c?(null!=f?f():a.fitSelectionBoxIntoDontTriggerSystems(d,!0),a.fitSelectionBoxIntoDontTriggerSystems(e,!1)):(null!=f&&f(),a.fitSelectionBoxIntoDontTriggerSystems(e,!0))}});this.baseObjectCommander.updateDocumentConsistency(e.executionContext,this.originalDragProperties.map((a)=>a.editorId))}};var T={},ia=this&&T.__awaiter||
function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{r(e.next(a))}catch(t){h(t)}}function p(a){try{r(e["throw"](a))}catch(t){h(t)}}function r(a){a.done?c(a.value):d(a.value).then(f,p)}r((e=e.apply(a,b||[])).next())})};Object.defineProperty(T,"__esModule",{value:!0});T.BaseAssetManagerImpl=class{constructor(a,b,c,e,d,f,r,g,k,l){this.preziOid=a;this.scene=b;this.mediaAssetPatcher=c;this.errorStream=e;this.templateService=
d;this.pptService=f;this.assetLoaderProvider=r;this.fontLoader=g;this.fontsLoadedStateHolder=k;this.mediaService=l;this.pptImporter=new Id(this.pptService,this.assetLoaderProvider)}getTemplateCategory(a,b){return ia(this,void 0,void 0,function*(){if(null==a)return null;const c=this.templateService.getTemplateIdFromTemplateInfo(a.templateId,a.themeId),e=(yield this.templateService.getTemplates(b)).find((a)=>c===a.templateId);return null!=e?e.category:null})}getTemplateBackground(a){return ia(this,
void 0,void 0,function*(){g.Check.notNull("templateInfo",a);var b=yield m.CetModelEditorInternal.loadTemplateData(this.templateService,a);b=k.DOM.createLocalSession(b,()=>{}).getPrezi().getTypedBackground();return null==b?null:{layerType:this.getBackgroundLayerType(b,a),fills:this.getBackgroundFills(b,a),layers:this.getBackgroundLayers(b,a)}})}getBackgroundLayerType(a,b){switch(a.getLayerType()){case k.DOM.ENUMS().BACKGROUND_LAYER_TYPE().OPAQUE():return d.base.BackgroundLayerType.opaque;case k.DOM.ENUMS().BACKGROUND_LAYER_TYPE().ALL_LAYERS_FULL_ALPHA():return d.base.BackgroundLayerType.allLayersFullAlpha;
case k.DOM.ENUMS().BACKGROUND_LAYER_TYPE().FADE_BETWEEN_TRANSPARENT_LAYERS():return d.base.BackgroundLayerType.fadeBetweenTransparentLayers;default:throw Error(`Unknown layerType: ${a.getLayerType()} in template: ${b.templateId}`);}}getBackgroundFills(a,b){return{hasAlpha:!1,current:this.getBackgroundFillType(a,b),solidFill:{fillKind:d.base.FillKind.solid,color:Object.assign(Object.assign({},a.getColor().getRGBData()),{a:1})},linearFill:{fillKind:d.base.FillKind.linear,startColor:Object.assign(Object.assign({},
a.getGradStartColor().getRGBData()),{a:1}),endColor:Object.assign(Object.assign({},a.getGradEndColor().getRGBData()),{a:1})},radialFill:{fillKind:d.base.FillKind.radial,startColor:Object.assign(Object.assign({},a.getGradStartColor().getRGBData()),{a:1}),endColor:Object.assign(Object.assign({},a.getGradEndColor().getRGBData()),{a:1})}}}getBackgroundFillType(a,b){switch(a.getFillType()){case k.DOM.ENUMS().FILL_TYPE().SOLID():return d.base.FillKind.solid;case k.DOM.ENUMS().FILL_TYPE().LINEAR():return d.base.FillKind.linear;
case k.DOM.ENUMS().FILL_TYPE().RADIAL():return d.base.FillKind.radial;default:throw Error(`Unknown fillType: ${a.getFillType()} in template: ${b.templateId}`);}}getBackgroundLayers(a,b){return Array.from(n.Utils.toTypedIterable(a.getTypedLayers())).map((a,e)=>{const c=(b,c,h)=>{const f=new u.LayoutBoxImpl(new u.ReferenceFrameImpl(a.getLocalToWorld()),q.Geometry.obbFromData(0,0,c,h,0));return{index:e,depth:a.getDepth(),fadeScale:a.getFadeScale(),position:f.center,rotationRad:f.rotationRad,layoutBox:f,
colorFilter:G.colorFilterFromPdom(a.getColorFilter()),filterStyle:l.Cet.matchStyleClassFromEnum(n.Utils.toIterable(a.getStyleClasses()),d.base.BackgroundFilterStyle),asset:{assetSourceFilename:a.getAssetSourceFilename(),offlineAssetId:a.getOfflineAssetId(),onlineAssetId:a.getOnlineAssetId(),url:a.getOnlineAssetUrl(),kind:b,width:c,height:h}}};var f=k.DOM.RuntimeTypeInfo();const r=f.safeCastToBackgroundImage(a);if(null!=r)return c(d.base.AssetKind.image,r.getWidth(),r.getHeight());f=f.safeCastToBackgroundSwfGraphics(a);
if(null!=f)return c(d.base.AssetKind.swf,f.getWidth(),f.getHeight());throw Error(`Unknown background layer type ${a.getObjectType()} in template ${b.templateId}`);})}getTemplateStyleSheetReader(a){return ia(this,void 0,void 0,function*(){g.Check.notNull("templateInfo",a);const b=yield m.CetModelEditorInternal.loadTemplateData(this.templateService,a);return new v.StyleSheetReaderImpl(K.FontUtils.createLookupFontInfoFromPreziData(b),()=>b,()=>null!=b.getDocumentStyle().getTopicSnippets())})}isYoutubeUrl(a){return null!=
tb.VideoURLParser.extractYoutubeInfo(a).id}createYoutubeAsset(a){g.Check.notNull("url",a);const {id:b,startTimeSec:c}=tb.VideoURLParser.extractYoutubeInfo(a);return null==b?(this.errorStream.error({errorCase:nb.EditorErrorCase.NOT_A_VIDEO_URL}),null):{kind:d.base.AssetKind.video,videoAssetKind:d.base.VideoAssetKind.youtube,assetSourceFilename:a,onlineAssetId:b,offlineAssetId:b,startTimeSec:c}}getPpt(a,b){return ia(this,void 0,void 0,function*(){g.Check.notNull("jobId",a);g.Check.positive("thumbnailSize",
b);return this.pptImporter.getPpt(this.preziOid,a,b)})}uploadPpt(a,b,c){return ia(this,void 0,void 0,function*(){g.Check.notNull("file",a);g.Check.positive("thumbnailSize",b);let e;try{return e=yield this.pptService.uploadPpt(this.preziOid,a,c),this.getPpt(e.importId,b)}catch(h){throw Error(h);}})}getFontDescriptions(){return K.FontUtils.listDownloadableFontDescriptions(this.scene)}getFontDescription(a){g.Check.notNull("fontFamily",a);return K.FontDefinitionCache.lookupFontDescription(this.scene,
a)}createFontDescription(a,b,c,e,d){g.Check.notNull("fontFamily",a);let h=K.FontDefinitionCache.lookupFontDescription(this.scene,a);return null!=h?(a=`Font '${h.fontFamily}' is already downloaded with a different definition`,g.Check.assert(b===h.normalKeg,a),g.Check.assert(c===h.boldKeg,a),g.Check.assert(e===h.italicKeg,a),g.Check.assert(d===h.boldItalicKeg,a),h):{fontFamily:a,hasNormal:null!=b,normalKeg:b,hasBold:null!=c,boldKeg:c,hasItalic:null!=e,italicKeg:e,hasBoldItalic:null!=d,boldItalicKeg:d}}downloadFont(a){return ia(this,
void 0,void 0,function*(){g.Check.notNull("fontDescription",a);g.Check.notNull("fontDescription.fontFamily",a.fontFamily);const b=U.getFontFaces(a).map((b)=>ia(this,void 0,void 0,function*(){const c=X.TextModel.getFontFaceId(a.fontFamily,b.weight,b.style),d=this.assetLoaderProvider.getFontUrl(b.fileWithOrigin);try{return yield this.fontLoader.fontFromUrl(c,d,b.fileWithOrigin.source)}catch(p){throw`Failed to download requested font: ${a.fontFamily}, weight: ${b.weight}, style: ${b.style}; url: ${d}`;
}}));yield Promise.all(b);this.fontsLoadedStateHolder.addDownloadedFont(a);return K.FontUtils.createFont(this.assetLoaderProvider,a)})}downloadImageAsset(a){return new Promise((b,c)=>{g.Check.notNull("imageAsset",a);g.Check.imageAsset("imageAsset",a);this.assetLoaderProvider.loadImageAsset(a.url,b,c)})}downloadAudioAsset(a){return new Promise((b,c)=>{g.Check.notNull("audioAsset",a);g.Check.audioAsset("audioAsset",a);this.assetLoaderProvider.loadBinaryAsset(a.url,(a)=>{n.AudioUtils.readAsAudioBuffer(a,
(a)=>{b(a)},()=>{c("Error decoding audio")})},()=>{c("Error loading audio")})})}rewriteUrl(a){g.Check.notNull("url",a);return this.assetLoaderProvider.rewriteUrl(a)}getFileAndChartId(a){return ia(this,void 0,void 0,function*(){if("chartId"in a.params)return{file:a.params.pdf,chartId:a.params.chartId};var b=a.params.colors;b=yield this.mediaService.requestChartData({preziId:this.preziOid,chartType:a.chartType,axisColor:this.colorToString(b.axis),backgroundColor:this.colorToString(b.background),dataColors:[b.data1,
b.data2,b.data3,b.data4,b.data5].map((a)=>this.colorToString(a)),labelColor:this.colorToString(b.label)}).result;return{file:n.Utils.arrayBufferToPdfFile(n.Utils.base64ToArrayBuffer(b.pdf)),chartId:b.chart_uuid}})}colorToString(a){return d.CetModelEditor.styleColorToColor(a).getRGBString()}downloadFile(a){return ia(this,void 0,void 0,function*(){return new Promise((b,c)=>{this.assetLoaderProvider.loadRemoteBinaryResource(a,(a)=>{b(n.Utils.arrayBufferToPdfFile(a))},c)})})}};T.ProgressiveAssetManagerImpl=
class extends T.BaseAssetManagerImpl{constructor(a,b,c,e,d,f,r,g,k,l,x,t,m,n,q,u,B){super(a,b,e,x,t,m,n,q,u,c);this.audioPatcher=d;this.imagePatcher=f;this.chartPatcher=r;this.videoPatcher=g;this.pdfPatcher=k;this.assetThumbnailAnnouncer=l;this.renderingAssetManager=B}uploadAudio(a){return new T.AudioAssetUploadImpl(a,this.mediaService,this.audioPatcher)}uploadImage(a){return this.uploadImageI(a,P.maxImageSize)}createExportedImageAssetFromMediaId(a){return new Lc(a,this.mediaService,this.imagePatcher,
this.errorStream)}uploadLogo(a){a=this.uploadImageI(a,P.maxLogoImageSize);return{token:P.createLogoAsset(a.token),finished:a.finished.then((a)=>P.createLogoAsset(a))}}uploadImageI(a,b){return new Mc(a,this.mediaService,this.imagePatcher,this.assetThumbnailAnnouncer,this.errorStream,b)}uploadVideo(a){return new Nc(a,this.mediaService,this.videoPatcher,this.errorStream)}uploadChart(a){return new Oc(this.preziOid,a,this.mediaService,this.chartPatcher,()=>this.getFileAndChartId(a))}uploadPdf(a){return new Pc(this.mediaService,
this.pdfPatcher,a,200,1E3,this.assetThumbnailAnnouncer,this.errorStream,(a)=>this.downloadFile(a))}uploadAnimatedImage(a){return new Qc(a,this.mediaService,this.preziOid,this.errorStream,P.maxAnimatedImageSize,this.renderingAssetManager)}};T.AudioAssetUploadImpl=class{constructor(a,b,c){const e=c.createAssetId();this.token={kind:d.base.AssetKind.audio,url:null,audioType:null,mediaLengthMilliSecs:0,offlineAssetId:e,assetSourceFilename:a.name,onlineAssetId:null};b=b.uploadAudioFile(a);this.uploadProgress=
b.uploadStatus.takeWhile(()=>!this.canceled);this.promise=b.result.catch((a)=>{throw{kind:d.AudioInsertErrorKind.EditorError,errorCase:a.errorCase};}).then((b)=>{c.patchUrl(e,a.name,b.media_id,b.media_url,b.audioType,b.audioLengthMilliSecs);if(this.canceled)throw{kind:d.AudioInsertErrorKind.Canceled,errorCase:null};return{kind:d.base.AssetKind.audio,url:b.media_url,audioType:b.audioType,mediaLengthMilliSecs:b.audioLengthMilliSecs,offlineAssetId:c.createAssetId(),onlineAssetId:b.media_id,assetSourceFilename:a.name}});
n.Utils.suppressError(this.promise)}get finished(){return this.promise}cancel(){this.canceled=!0}};var Rc;(function(a){a[a.Canceled=0]="Canceled"})(Rc=T.ImageUploadErrorKind||(T.ImageUploadErrorKind={}));class Ya{constructor(a){this.kind=a}static createCanceled(){return new Ya(Rc.Canceled)}}class Qc{constructor(a,b,c,e,h,f){let p;try{p=b.uploadGif({fileOrUrl:a,maxImageSize:h,preziOid:c})}catch(D){throw e.push(D),D;}this.token={kind:d.base.AssetKind.animatedImage,mediaAssetId:p.mediaAssetId,width:1,
height:1};this.finished=p.finished.then(()=>f.queryConversionResult(p.mediaAssetId)).then((a)=>{if(this.canceled)throw Ya.createCanceled();return{kind:d.base.AssetKind.animatedImage,mediaAssetId:p.mediaAssetId,width:a.width,height:a.height}}).catch((a)=>{e.error(a);throw a;});n.Utils.suppressError(this.finished)}cancel(){this.canceled=!0}}T.AnimatedImageAssetUploadImpl=Qc;class Lc{constructor(a,b,c,e){const h=c.createAssetId();this.token={kind:d.base.AssetKind.image,url:null,width:l.Cet.DEFAULT_THUMBNAIL_SIZE,
height:l.Cet.DEFAULT_THUMBNAIL_SIZE,offlineAssetId:h,assetSourceFilename:null,onlineAssetId:null};this.finished=b.getExportedImageByMediaId(a).then((b)=>{if(this.canceled)throw Ya.createCanceled();c.patchSizeAndScale(h,b.width,b.height);c.patchUrl(h,null,a,b.url);return b}).then((b)=>({kind:d.base.AssetKind.image,url:b.url,width:b.width,height:b.height,offlineAssetId:h,assetSourceFilename:null,onlineAssetId:a})).catch((a)=>{e.error(a);c.error(h);throw a;});n.Utils.suppressError(this.finished);this.tokenWithSize=
this.finished}cancel(){this.canceled=!0}}T.ExportedImageAssetFromMediaAssetUrlImpl=Lc;class Mc{constructor(a,b,c,e,h,f){const p=c.createAssetId();this.token={kind:d.base.AssetKind.image,url:null,width:l.Cet.DEFAULT_THUMBNAIL_SIZE,height:l.Cet.DEFAULT_THUMBNAIL_SIZE,offlineAssetId:p,assetSourceFilename:null,onlineAssetId:null};a=Promise.resolve(a).then((a)=>{const c=n.Utils.isString(a)?a:a.name;return{imageUrlUploadEvents:n.Utils.isString(a)?b.uploadImageUrl({url:a,maxImageSize:f}):b.uploadImage({file:a,
maxImageSize:f}),fileName:c}});const g=a.then((a)=>a.imageUrlUploadEvents.thumbnail.then((b)=>{if(this.canceled)throw Ya.createCanceled();const e=null!=b.finalImageWidth?b.finalImageWidth:l.Cet.DEFAULT_THUMBNAIL_SIZE,d=null!=b.finalImageHeight?b.finalImageHeight:l.Cet.DEFAULT_THUMBNAIL_SIZE,h=c.patchSizeAndScale(p,e,d);return{unresizedThumbnail:b.unresizedThumbnail,width:e,height:d,patchedAssetId:h,fileName:a.fileName}}));e.addThumbnailRenderer(p,()=>g.then((a)=>a.unresizedThumbnail));this.tokenWithSize=
g.then((a)=>({kind:d.base.AssetKind.image,url:null,width:a.width,height:a.height,offlineAssetId:a.patchedAssetId,assetSourceFilename:a.fileName,onlineAssetId:null}));n.Utils.suppressError(this.tokenWithSize);a=a.then((a)=>Promise.all([a.imageUrlUploadEvents.result,g]).then(([b,d])=>{if(this.canceled)throw Ya.createCanceled();c.patchUrl(d.patchedAssetId,a.fileName,b.media_id,b.media_url);e.removeAssetId(d.patchedAssetId);return{mediaId:b.media_id,url:b.media_url}}));this.finished=Promise.all([g,a]).then(([a,
b])=>({kind:d.base.AssetKind.image,url:b.url,width:a.width,height:a.height,offlineAssetId:c.createAssetId(),assetSourceFilename:a.fileName,onlineAssetId:b.mediaId})).catch((a)=>{h.error(a);c.error(p);e.removeAssetId(p);throw a;});n.Utils.suppressError(this.finished)}cancel(){this.canceled=!0}}T.ImageAssetUploadImpl=Mc;class Nc{constructor(a,b,c,e){const h=c.createAssetId();this.token={kind:d.base.AssetKind.video,videoAssetKind:d.base.VideoAssetKind.uploadedToPrezi,url:null,offlineAssetId:h,assetSourceFilename:a.name,
onlineAssetId:null};this.finished=b.uploadVideo(a).result.then((b)=>{c.patchUrl(h,a.name,b.media_id,b.media_url);return{kind:d.base.AssetKind.video,videoAssetKind:d.base.VideoAssetKind.uploadedToPrezi,url:b.media_url,offlineAssetId:c.createAssetId(),assetSourceFilename:a.name,onlineAssetId:b.media_id}}).catch((a)=>{e.error(a);c.error(h);throw a;});n.Utils.suppressError(this.finished)}}T.VideoAssetUploadImpl=Nc;class Oc{constructor(a,b,c,e,h){const f=e.createAssetId();this.token={kind:d.base.AssetKind.chart,
url:null,chartId:"chartId"in b.params?b.params.chartId:"",chartType:b.chartType,height:b.height,width:b.width,offlineAssetId:f,assetSourceFilename:null,onlineAssetId:null};this.finished=(()=>ia(this,void 0,void 0,function*(){let a,p;try{const b=yield h();a=b.file;p=b.chartId}catch(w){throw e.error(f),{errorCase:nb.EditorErrorCase.CHART_REQUEST_ERROR,message:"CHART_REQUEST_ERROR"};}try{const h=yield c.uploadPDF(a,!0).result;e.patchUrl(f,a.name,h.media_id,h.media_url,p);return{kind:d.base.AssetKind.chart,
url:h.media_url,chartId:p,chartType:b.chartType,height:b.height,width:b.width,offlineAssetId:e.createAssetId(),assetSourceFilename:a.name,onlineAssetId:h.media_id}}catch(w){throw e.error(f),{errorCase:nb.EditorErrorCase.CHART_UPLOAD_ERROR,message:"CHART_UPLOAD_ERROR"};}}))();n.Utils.suppressError(this.finished)}}T.ChartAssetUploadImpl=Oc;class Id{constructor(a,b){this.pptService=a;this.pdfThumbnailCreator=Hc.MediaServiceModule.createPdfThumbnailCreator(b)}getPpt(a,b,c){return ia(this,void 0,void 0,
function*(){g.Check.notNull("id",b);let e;try{e=yield this.pptService.getPpt(a,b,c)}catch(p){throw Error(p);}const h=(a,b)=>({slideAsset:{jobId:a.jobId,noBackgroundPdfAsset:Object.assign({kind:d.base.AssetKind.pdf},a.noBackgroundAsset),originalPdfAsset:Object.assign({kind:d.base.AssetKind.pdf},a.originalAsset),sourcePageNumber:a.sourcePageNumber},title:a.title,narrative:a.narrative,thumbnail:b,width:a.width,height:a.height});return new Promise((a,b)=>{let d;try{d=e.jobId}catch(t){b(t)}const f=[],
p={},r=(a,b)=>ia(this,void 0,void 0,function*(){if(null!=p[a])return p[a].find((a)=>a.pageNumber===b);const e=yield this.pdfThumbnailCreator.getPptPageThumbnails(a,c);p[a]=e;return e.find((a)=>a.pageNumber===b)});e.slides.forEach((a)=>{const b=a.slideResult.then((a)=>null!=a.thumbnail?h(a,a.thumbnail):r(a.originalAsset.url,a.originalAsset.page).then((a)=>a.thumbnail()).then((b)=>h(a,b)));f.push({slideResult:b,slideOrder:a.slideStructure.number})});a({jobId:d,slides:f,fullPptResult:e.fullPptResult})})})}}
class Pc{constructor(a,b,c,e,h,f,r,g){const p=n.Utils.isString(c)?c:c.name,k=(a)=>({kind:d.base.AssetKind.pdf,url:null,height:l.Cet.DEFAULT_THUMBNAIL_SIZE,width:l.Cet.DEFAULT_THUMBNAIL_SIZE,offlineAssetId:b.createAssetId(),page:a,onlineAssetId:null,assetSourceFilename:p}),D=(a)=>{t.forEach((a)=>{b.error(a.offlineAssetId);f.removeAssetId(a.offlineAssetId)});r.error(a)},t=[k(1)];this.token=t[0];this.finished=(()=>ia(this,void 0,void 0,function*(){const d=n.Utils.isString(c)?yield g(c):c,p=a.uploadPDF(d,
!0,e,h);let l=null;try{l=yield p.pdfPageInfos}catch(B){throw D(B),B;}let z=!1;for(;t.length<l.length;){const a=k(l[t.length].pageNumber);t.push(a)}l.forEach((a,c)=>{c=t[c];b.patchSizeAndScale(c.offlineAssetId,a.width,a.height);f.addThumbnailRenderer(c.offlineAssetId,()=>new Promise((b)=>{a.thumbnail().then((a)=>{if(!z){const c=new Image;c.onload=()=>{c.onload=null;b(c)};c.src=a}})}))});p.result.then((a)=>{t.forEach((c)=>{b.patchUrl(c.offlineAssetId,d.name,a.media_id,a.media_url,c.page);f.removeAssetId(c.offlineAssetId)})},
(a)=>{z=!0;D(a);r.error(a)});return t.map((a,b)=>({pdfAsset:a,pdfPageInfo:l[b]}))}))().catch((a)=>{r.error(a);throw a;});n.Utils.suppressError(this.finished)}}T.PdfAssetUploadImpl=Pc;var P={createLogoAsset:function(a){return{kind:d.base.AssetKind.logo,url:a.url,onlineAssetId:a.onlineAssetId,offlineAssetId:a.offlineAssetId,assetSourceFilename:a.assetSourceFilename}},isOversizedImageAsset:function(a){return a.width>P.maxImageSize||a.height>P.maxImageSize}},da=this&&P.__awaiter||function(a,b,c,e){function d(a){return a instanceof
c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{r(e.next(a))}catch(t){h(t)}}function p(a){try{r(e["throw"](a))}catch(t){h(t)}}function r(a){a.done?c(a.value):d(a.value).then(f,p)}r((e=e.apply(a,b||[])).next())})};Object.defineProperty(P,"__esModule",{value:!0});P.maxImageSize=2E6;P.maxAnimatedImageSize=2E3;P.maxLogoImageSize=128;P.ParallelActionQueue=class{constructor(a){this.maxParallelAction=a;this.runningActionCount=0;this.triggerQueue=[]}step(){this.runningActionCount<
this.maxParallelAction&&0<this.triggerQueue.length&&this.triggerQueue.shift()()}enqueue(a){const b=new Promise((b,c)=>{this.triggerQueue.push(()=>{this.runningActionCount++;try{a().then(b,c)}catch(p){c(p)}})}),c=()=>{this.runningActionCount--;this.step()};b.then(c,c);this.step();return b}};P.AssetManagerImpl=class extends T.BaseAssetManagerImpl{constructor(a,b,c,e,d,f,r,g,k,l){super(a,b,k,Qb.Bacon.newBus(),c,e,d,r,g,f);this.renderingAssetManager=l;this.parallelActionQueue=new P.ParallelActionQueue(2)}addErrorCaseMessage(a){return a.catch((a)=>
null!=a&&a.hasOwnProperty("errorCase")?Promise.reject(Object.assign(Object.assign({},a),{errorCaseMessage:nb.EditorErrorCase[a.errorCase]})):Promise.reject(a))}uploadImage(a){return da(this,void 0,void 0,function*(){g.Check.notNull("fileOrUrl",a);return this.uploadImageI(a,P.maxImageSize)})}uploadLogo(a){return da(this,void 0,void 0,function*(){g.Check.notNull("fileOrUrl",a);const b=yield this.uploadImageI(a,P.maxLogoImageSize);return(0,P.createLogoAsset)(b)})}uploadImageI(a,b){return da(this,void 0,
void 0,function*(){return this.addErrorCaseMessage(this.parallelActionQueue.enqueue(()=>da(this,void 0,void 0,function*(){const c=yield a;let e;e=n.Utils.isString(c)?this.mediaService.uploadImageUrl({url:c,maxImageSize:b}):this.mediaService.uploadImage({file:c,maxImageSize:b});const [h,f]=yield Promise.all([e.thumbnail,e.result]);return{kind:d.base.AssetKind.image,url:f.media_url,width:h.finalImageWidth,height:h.finalImageHeight,assetSourceFilename:n.Utils.isString(c)?c:c.name,offlineAssetId:this.mediaAssetPatcher.createId(),
onlineAssetId:f.media_id}})))})}uploadPdf(a){return da(this,void 0,void 0,function*(){g.Check.notNull("fileOrUrl",a);return this.addErrorCaseMessage(this.parallelActionQueue.enqueue(()=>da(this,void 0,void 0,function*(){var b=n.Utils.isString(a)?yield this.downloadFile(a):a;b=this.mediaService.uploadPDF(b,!0);var [c,e]=yield Promise.all([b.pdfPageInfos,b.result]);return c.map((b,c)=>({kind:d.base.AssetKind.pdf,url:e.media_url,page:c+1,width:b.width,height:b.height,assetSourceFilename:n.Utils.isString(a)?
a:a.name,offlineAssetId:this.mediaAssetPatcher.createId(),onlineAssetId:e.media_id,thumbnail:b.thumbnail}))})))})}uploadChart(a){return da(this,void 0,void 0,function*(){g.Check.chartAssetParams("params",a);const {file:b,chartId:c}=yield this.getFileAndChartId(a);return this.addErrorCaseMessage(this.parallelActionQueue.enqueue(()=>da(this,void 0,void 0,function*(){const e=(yield this.uploadPdf(b))[0];return{kind:d.base.AssetKind.chart,chartId:c,chartType:a.chartType,url:e.url,width:a.width,height:a.height,
assetSourceFilename:b.name,offlineAssetId:e.offlineAssetId,onlineAssetId:e.onlineAssetId}})))})}uploadAudio(a){return da(this,void 0,void 0,function*(){g.Check.notNull("file",a);return this.addErrorCaseMessage(this.parallelActionQueue.enqueue(()=>da(this,void 0,void 0,function*(){const b=yield this.mediaService.uploadAudioFile(a).result;return{kind:d.base.AssetKind.audio,url:b.media_url,audioType:b.audioType,mediaLengthMilliSecs:b.audioLengthMilliSecs,assetSourceFilename:a.name,offlineAssetId:this.mediaAssetPatcher.createId(),
onlineAssetId:b.media_id}})))})}uploadVideo(a){return da(this,void 0,void 0,function*(){g.Check.notNull("file",a);return this.addErrorCaseMessage(this.parallelActionQueue.enqueue(()=>da(this,void 0,void 0,function*(){const b=yield this.mediaService.uploadVideo(a).result;return{kind:d.base.AssetKind.video,videoAssetKind:d.base.VideoAssetKind.uploadedToPrezi,url:b.media_url,assetSourceFilename:a.name,offlineAssetId:this.mediaAssetPatcher.createId(),onlineAssetId:null}})))})}uploadAnimatedImage(a){g.Check.notNull("fileOrUrl",
a);return this.addErrorCaseMessage(this.parallelActionQueue.enqueue(()=>da(this,void 0,void 0,function*(){var b=this.mediaService.uploadGif({fileOrUrl:a,maxImageSize:P.maxAnimatedImageSize,preziOid:this.preziOid});yield b.finished;b=b.mediaAssetId;const c=yield this.renderingAssetManager.queryConversionResult(b);return{kind:d.base.AssetKind.animatedImage,mediaAssetId:b,width:c.width,height:c.height}})))}createExportedImageAssetFromMediaId(a){return da(this,void 0,void 0,function*(){g.Check.notNull("mediaId",
a);const b=yield this.assetLoaderProvider.getExportedImageResultByMediaId(a);return{kind:d.base.AssetKind.image,onlineAssetId:a,assetSourceFilename:null,offlineAssetId:null,url:b.url,width:b.width,height:b.height}})}};var ja={};Object.defineProperty(ja,"__esModule",{value:!0});ja.RandomImpl=class{constructor(a){this.seed=Math.floor(a)%2147483647;0>=this.seed&&(this.seed+=2147483646)}nextInt(a=2147483647){this.seed=16807*this.seed%2147483647;return this.seed%a}};ja.TopicPositionFinder=class{constructor(){this.randomGenerator=
new ja.RandomImpl(42)}findTopicPosition(a,b,c){if(null==b||b>c.length||0>b)b=c.length;b=0<b?c[b-1].layoutBox.extendToSquare():this.getDefaultLayoutBox(a);c=this.findRandomPosition(b,a.contentChildren.map((a)=>a.layoutBox),c.map((a)=>a.layoutBox),a.zoomLayoutBox);return a.zoomLayoutBox.referenceFrame.layoutBox(c.center,c.size)}getDefaultLayoutBox(a){return a.zoomLayoutBox.scale(ja.TopicPositionFinder.NEW_CHAPTER_TO_CONTAINER_RATIO).extendToSquare()}findRandomPosition(a,b,c,e){b=this.findRandomPositionStep(a,
[...b,...c],e,!1);if(null!=b)return{center:b,size:a.size};for(b=0;3>b;){const d=this.findRandomPositionStep(a,c,e,!1);if(null!=d)return{center:d,size:a.size};a=a.scale(.8);++b}return{center:this.findRandomPositionStep(a,c,e,!0),size:a.size}}findRandomPositionStep(a,b,c,e){a=this.randomPositions({width:1.1*a.size.width,height:1.1*a.size.height},b,a,c,e);if(0===a.length)return null;c=(a,b)=>this.closeTo(a.outOfZoomAreaRatio,b.outOfZoomAreaRatio)?a.distance-b.distance:a.outOfZoomAreaRatio-b.outOfZoomAreaRatio;
if(e)return e=a.filter((a)=>!a.overlapOthers),0<e.length?(e.sort(c),e[0].position):a[b.length%a.length].position;a.sort(c);return a[0].position}randomPositions(a,b,c,e,d){const h=[];for(let f=0;f<ja.TopicPositionFinder.MAX_RANDOM_POSITION_COUNT;++f){const f=this.randomPos(e),p=e.referenceFrame.layoutBox(f,a),r=b.some((a)=>p.intersects(a));!d&&r||h.push({position:f,distance:q.Geometry.distance(f,c.center),outOfZoomAreaRatio:1-this.calcCoverRatio(p,e),overlapOthers:r})}return h}calcCoverRatio(a,b){b=
b.withReferenceFrame(a.referenceFrame);return this.rectangleIntersectArea(a.topLeft,a.bottomRight,b.topLeft,b.bottomRight)/(a.size.width*a.size.height)}rectangleIntersectArea(a,b,c,e){return this.rangeIntersect(a.x,b.x,c.x,e.x)*this.rangeIntersect(a.y,b.y,c.y,e.y)}rangeIntersect(a,b,c,e){if(b<c||e<a)return 0;let [,d,f]=[a,c,b,e].sort((a,b)=>a-b);return f-d}randomPos(a){const b=a.topLeft;a=a.bottomRight;return{x:this.randomGenerator.nextInt(a.x-b.x)+b.x,y:this.randomGenerator.nextInt(a.y-b.y)+b.y}}closeTo(a,
b){return 1E-5>Math.abs(a-b)}};ja.TopicPositionFinder.NEW_CHAPTER_TO_CONTAINER_RATIO=.2;ja.TopicPositionFinder.MAX_RANDOM_POSITION_COUNT=500;var Za={};Object.defineProperty(Za,"__esModule",{value:!0});Za.BaseObjectCommander=class{constructor(){this.groupManager=new H.GroupManager}getLocalToRelative(a,b){return l.Cet.transform(b.getEntity()).getLocalToWorld().concat(this.relativeToWorldForParent(a,b.getEntity()).invert())}batchFitInto(a,b,c,e){var d=c.fitIntoOther(e);e=c.topLeft;c=c.topRight;const f=
d.topLeft;d=d.topRight;for(const a of b)a.fitIntoDontTriggerSystems(a.layoutBox.align(e,c,f,d));this.updateWorldGeometryAndBounds(a)}tryBatchSetParent(a,b,c){if(null!=b.find((a)=>a.is(d.base.ObjectKind.simpleObject)&&!c.is(d.base.ObjectKind.simpleObjectParent)?!0:a.is(d.base.ObjectKind.topic)&&!c.is(d.base.ObjectKind.topicParent)?!0:!1))return!1;const e=new Set;b.forEach((a)=>e.add(a.parent));if(1<e.size)return!1;const h=e.values().next().value,p=new Set(b.map((a)=>a.id)),r=new Set;for(let a of b)a.is(d.base.ObjectKind.simpleObject)&&
null!=a.group&&(a.group.members.every((a)=>p.has(a.id))?r.add(a.group.id):a.group.removeMember(a));E.createPathManager(a.mscene).moveAnimationsToTargetsUnderNewParent(h,c,[...p],[...r]);b.forEach((b)=>{if(b.is(d.base.ObjectKind.simpleObject)&&c.is(d.base.ObjectKind.simpleObjectParent))this.setSimpleObjectParentI(a,b,c);else if(b.is(d.base.ObjectKind.topic)&&c.is(d.base.ObjectKind.topicParent))switch(b.kind){case d.base.ObjectKind.planetTopic:b.setParentAndFitIntoDontMoveAnimations(c,null);break;case d.base.ObjectKind.stackTopic:b.setParentAndFitIntoDontMoveAnimations(c,
null);break;default:n.Utils.assertNever(b)}});b=H.getGroupOwnerFromZObject(a.mscene,a.mscene.lookup(b[0].id,f.CetModel.ID.Z_OBJECT.W));for(let c of r)this.groupManager.moveGroupUnderParent(a.mscene,c,b);return!0}setSimpleObjectParentI(a,b,c){const e=m.CetModelEditorInternal.createTopicChildrenEditor(a.mscene);c.is(d.base.ObjectKind.visual)?e.addVisual(b.id,c.parent.id,!0):c.is(d.base.ObjectKind.cover)?e.add(b.id,c.parent.id,l.TopicChildBehavior.Cover):c.is(d.base.ObjectKind.surface)?e.addSurface(b.id,
c.parent.id,!0):c.is(d.base.ObjectKind.master)?e.add(b.id,c.parent.id,l.TopicChildBehavior.Master):m.CetModelEditorInternal.createEntityEditor(a.mscene).moveUnderParent(c.id,b.id)}setSimpleObjectParent(a,b,c){const e=b.parent;e.id!==c.id&&(this.setSimpleObjectParentI(a,b,c),E.createPathManager(a.mscene).moveAnimationsToTargetsUnderNewParent(e,c,[b.id],[]),this.groupManager.setGroupId(a.mscene,a.mscene.lookup(b.id,f.CetModel.ID.Z_OBJECT.W),null))}setLocalToRelative(a,b,c){c=c.concat(this.relativeToWorldForParent(a.mscene,
b.getEntity()));m.CetModelEditorInternal.createEntityEditor(a.mscene).transformSubtree(b.getId(),c);this.updateDocumentConsistency(a,[b.getId()])}getReferenceBoundsInWorld(a){return a.isDef(f.CetModel.ID.OVERVIEW)?q.Geometry.obbFromData(0,0,32E3,18E3,0):q.Geometry.obbFromData(0,0,16,9,0).transform(l.Cet.transform(a).getLocalToWorld())}getRelativeBoundsOBB(a,b,c=l.TextBoundsOptions.Visible){c=l.Cet.createBoundsCalculator(a).getWorldBoundsForInteraction(b.getId(),c).getObb();a=this.relativeToWorldForParent(a,
b);return c.transform(a.invert())}getLayoutBox(a,b,c,e=l.TextBoundsOptions.Visible){a=g.Check.as("referenceFrame",a,"ReferenceFrameImpl",u.ReferenceFrameImpl);return new u.LayoutBoxImpl(a,this.getRelativeBoundsOBB(b,c,e))}getZoomLayoutBox(a,b){const c=this.getReferenceFrame(b);a=q.Geometry.obbFromRect(l.Cet.calculateZoomBounds(a,b).getData()).transform(l.Cet.transform(b).getLocalToWorld()).transform(c.relativeToWorld.invert());return new u.LayoutBoxImpl(c,a)}getReferenceFrame(a){return new u.ReferenceFrameImpl(this.relativeToWorld(a))}relativeToWorld(a){const b=
q.Geometry.obbFromData(0,0,1600,900,0);a=this.getReferenceBoundsInWorld(a);return this.getFitTransform(b,a,!1)}relativeToWorldForParent(a,b){b=l.Cet.createHierarchyQuery(a).getParentId(b);a=null==b?a.getPreziW().getOverview().getEntity():a.getEntityById(b);return this.relativeToWorld(a)}fitInto(a,b,c,e){this.fitIntoDontTriggerSystems(a,b,c,e);this.updateWorldGeometryAndBounds(a)}fitIntoDontTriggerSystems(a,b,c,e){c=c.relativeBounds.transform(c.referenceFrame.relativeToWorld);e=e.relativeBounds.transform(e.referenceFrame.relativeToWorld);
e=this.getFitTransform(c,e,!0);e=l.Cet.transform(b).getLocalToWorld().concat(e);m.CetModelEditorInternal.createEntityEditor(a.mscene).transformSubtree(b.getId(),e)}transformStuffButDontMoveChildren_KILLME_DONTUSE_USERELATIVETRANSFORMSINSTEADOF_THIS_HACK(a,b){a=m.CetModelEditorInternal.createEntityEditor(a.mscene);for(let {entity:e,sourceLayoutBox:d,targetLayoutBox:p,recursive:r}of b){b=d.relativeBounds.transform(d.referenceFrame.relativeToWorld);var c=p.relativeBounds.transform(p.referenceFrame.relativeToWorld);
b=this.getFitTransform(b,c,!0);b=l.Cet.transform(e).getLocalToWorld().concat(b);b=l.Cet.transform(e).getLocalToWorld().invert().concat(b);c=e.getChild(f.CetModel.ID.Z_TOPIC_CONTAINER.TOPIC);if(null!=c&&c.isDef(f.CetModel.ID.HAS_POSITION)&&c.getWrapper(f.CetModel.ID.HAS_POSITION.W).getPosition().getEntity().isDef(f.CetModel.ID.WRAP_CHILDREN_NO_BASELINE))break;b=l.Cet.transform(e).getLocalToWorld().concat(b);r?a.transformSubtree(e.getId(),b):l.Cet.updateTransform(e).setLocalToWorld(b)}}getFitTransform(a,
b,c){return q.Geometry.getFitTransform(a,b,c)}deleteObjects(a,b){m.CetModelEditorInternal.createEntityEditor(a.mscene).removeZObjects(b);this.updateWorldGeometryAndBounds(a)}updateWorldGeometryAndBounds(a){a.mscene.runSystems(l.UpdatePhase.GEOMETRY)}updateDocumentConsistency(a){a.mscene.runSystems(l.UpdatePhase.DOCUMENT)}handleNonApiChangeDontTriggerSystems(a,b,c){for(let b of c)b.isDef(f.CetModel.ID.Z_OBJECT)&&(c=a.lookup(b.getId(),d.base.ObjectKind.base),null!=c&&c instanceof A.BaseEditorImpl&&
c.handleNonApiChangeDontTriggerSystems());this.updateWorldGeometryAndBounds(b)}updateEntitesAfterStyleChange(a,b,c){c=(new N.StyleEditorImpl(b.mscene)).resolveStyleForMatchingEntities(b.mscene,c);this.handleNonApiChangeDontTriggerSystems(a,b,c)}updateEntityAfterStyleChange(a,b,c){const e=new N.StyleEditorImpl(b.mscene);c=b.mscene.getEntityById(c);null!=c&&(e.resolveStyleForEntity(c),this.handleNonApiChangeDontTriggerSystems(a,b,[c]))}afterAdd(a,b){this.updateDocumentConsistency(a,b)}afterAddTopic(a,
b,c){this.afterAdd(a,[c])}setStyleClassFromEnum(a,b,c,e,...d){l.Cet.setStyleClassFromEnum(c,e,...d);this.updateEntityAfterStyleChange(a,b,c.getId())}};Za.BaseTopicCommander=class{insertPlanetTopic(a,b,c,e,h,f){var p=b.mscene;const g=new ka.TopicQueryImpl(p);var l=(new ta.SnippetEditorImpl(p)).getDocumentFromSnippet(d.TopicKind.Planet);l=this.insertTopicFromPreziData(p,c,l,k.TopicType.PLANET_CHAPTER);this.linkToParentAsContent(p,l,c);c=a.lookup.topicParent(c);p=a.lookup.planetTopic(l);this.addChapterToSmartStructureAndPath(b,
g,p,c,e);null!=h&&h.apply(a,p);this.moveNewTopicToInitialPlace(p);null!=f&&p.applyLayout(f);return l}insertStackTopic(a,b,c,e,h){var f=b.mscene;const g=new ka.TopicQueryImpl(f);var l=(new ta.SnippetEditorImpl(f)).getDocumentFromSnippet(d.TopicKind.Stack);l=this.insertTopicFromPreziData(f,c,l,k.TopicType.STACK_CHAPTER);this.linkToParentAsContent(f,l,c);c=a.lookup.topicParent(c);f=a.lookup.topic(l);this.addChapterToSmartStructureAndPath(b,g,f,c,e);null!=h&&h.apply(a,f);this.moveNewTopicToInitialPlace(f);
return l}moveNewTopicToInitialPlace(a){const b=(new ja.TopicPositionFinder).getDefaultLayoutBox(a.parent);a.fitInto(b)}insertPage(a,b,c){a=a.mscene;var e=new ka.TopicQueryImpl(a);const d=this.addPageToStack(a,b);b=e.getChildTopics(b);e=m.CetModelEditorInternal.createEditorPathQuery(a);c=0===c?e.getStepIndexesForEntityId(b[0])[0]:e.findPathInsertPosition(b[c-1]);E.createPathManager(a).insertFlyToObject(d,c);return d}isAnchestorOrSelf(a,b){for(;;){if(a===b)return!0;b=b.parent;if(b.is(d.base.ObjectKind.overview))return!1}}moveTopic(a,
b,c,e=null,h=!0){g.Check.notNull("topicToBeMoved",b);g.Check.notNull("newParent",c);!c.is(d.base.ObjectKind.overview)&&this.isAnchestorOrSelf(b,c)&&g.Check.failure("topicToBeMoved cannot be an achestor of newParent, because it would create a circle.");if(b.parent!==c){var p=b.layoutBox;e=null!=e?e.withReferenceFrame(c.referenceFrame):null;var r=m.CetModelEditorInternal.createEditorPathQuery(a.mscene).findPathInsertPosition(c.id),k=E.createPathManager(a.mscene),w=b.parent;h&&k.moveAnimationsToTargetsUnderNewParent(w,
c,[b.id],[]);k.moveToWithDescendants(b.id,r);r=l.Cet.createHierarchyQuery(a.mscene).getSmartStructureIdOfEntity(b.parent.id);null!=r&&(h=m.CetModelEditorInternal.createSmartStructureEditor(a.mscene),r=a.mscene.lookup(r,f.CetModel.ID.SMART_STRUCTURE.W),h.removeFromSmartStructure(a.mscene.getEntityById(b.id),r));h=b.parent;if(h.is(d.base.ObjectKind.planetTopic)){const c=a.mscene.lookup(h.id,f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic();if(c.is(f.CetModel.ID.PLANET_CHAPTER))c.getMutableTopicChildren().forEachMutable((a,
e)=>{a.getChild()===b.id&&(a.setChild(null),c.getMutableTopicChildren().removeAt(e))});else throw Error("not a planet topic");}else h.is(d.base.ObjectKind.overview)||n.Utils.assertNever(h);this.linkToParentAsContent(a.mscene,b.id,c.id);m.CetModelEditorInternal.createSmartStructureEditor(a.mscene).addToSmartStructure([b],c,d.SmartStructureAddIntention.insert,null);a.mscene.runSystems(l.UpdatePhase.DOCUMENT);a=null!=e?e:p;null!=a&&b.fitInto(c.referenceFrame.layoutBox(a.center,a.size))}}moveStackPage(a,
b,c){var e=a.mscene,d=b.zoomLayoutBox,p=e.lookup(b.parent.id,f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic();if(!p.is(f.CetModel.ID.STACK_CHAPTER))throw n.Utils.fail("old parent is not a stack");if(!e.lookup(c.id,f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic().is(f.CetModel.ID.STACK_CHAPTER))throw n.Utils.fail("new parent is not a stack");var g=!1,k=0;const w=b.id;for(var z of p.getMutableTopicChildren()){if(z.getChild()===w){p.getMutableTopicChildren().removeAt(k);a.mscene.getEntityById(w).set(f.CetModel.ID.TOPIC_CHILD.CHILD_PARENT,
null);g=!0;break}k++}if(!g)throw n.Utils.fail("topicChild cannot be found under the stack parent");this.linkToParentAsContent(e,w,c.id);p=c.pageChildren[c.pageChildren.length-1];k=m.CetModelEditorInternal.createEditorPathQuery(a.mscene);g=k.getStepIndexesForEntityId(b.id)[0];k=k.getStepIndexesForEntityId(p.id)[0]+1;z=E.createPathManager(a.mscene);a=m.CetModelEditorInternal.createEditorPathQuery(a.mscene).getPathStepTargetId(g);z.moveToWithDescendants(a,k);a=e.getEntityById(b.id);a.set(f.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD,
F.CetRendererModule.getLocalToWorld(e.getEntityById(c.id)));F.CetRendererModule.updateWorldProperties(a);0<b.contentChildren.length&&(a=c.pageChildren[0].zoomLayoutBox,b=b.contentChildren[0].createLayoutGroupWith(b.contentChildren.slice(1)),b.fitInto(b.layoutBox.align(d.topLeft,d.topRight,a.topLeft,a.topRight)));d=m.CetModelEditorInternal.createEntityEditor(e);b=l.Cet.createHierarchyQuery(e);a=e.getPreziW().getZObjects().indexOf(e.lookup(p.id,f.CetModel.ID.Z_TOPIC_CONTAINER.W));e=e.getPreziW().getZObjects().indexOf(e.lookup(c.id,
f.CetModel.ID.Z_TOPIC_CONTAINER.W));d.moveInZOrder(e>a?c.id:p.id,b.getDescendantEntities([w]),1)}addPageToStack(a,b){var c=(new ta.SnippetEditorImpl(a)).getDocumentFromSnippet(d.TopicKind.Page);c=this.insertTopicFromPreziData(a,b,c,k.TopicType.PAGE);for(var e=(new ta.SnippetEditorImpl(a)).getDocumentFromSnippet(d.TopicKind.Stack).getZObjects().iterator(),h=null;e.hasNext()&&null==h;){var f=e.next();f.getObjectType()===k.ZObjectType.Z_TOPIC_CONTAINER&&f.getTopic().getObjectType()===k.TopicType.STACK_CHAPTER&&
(h=f.getTopic().getPosition().getLocalToWorld())}const g=l.Cet.transform(a.getEntityById(b)).getLocalToWorld();e=l.Cet.createHierarchyQuery(a).getChildrenIds(a.getEntityById(c));f=m.CetModelEditorInternal.createEntityEditor(a);h=f.getDeltaTransform(h,g);f.transformWithDelta(b,e,h);this.linkToParentAsContent(a,c,b);return c}insertTopicFromPreziData(a,b,c,e){c=a.regenerateIDs(c);var h=[],p=d.CetModelEditor.createStyleQuery(a);for(c=c.getZObjects().iterator();c.hasNext();)h.push(c.next());let g;for(var l of h)if(k.ZObjectType.Z_TOPIC_CONTAINER===
l.getObjectType()&&(c=l,c.getTopic().getObjectType()===e)){g=c;break}c=g.getTopic();l=[];if(c.getObjectType()===k.TopicType.STACK_CHAPTER||c.getObjectType()===k.TopicType.PLANET_CHAPTER){c=c.getTopicChildren();for(var w of f.CetModel.pdomIterable(c))c=w.getBehaviour(),c.getObjectType()!==k.TopicChildBehaviourType.VISUAL&&c.getObjectType()!==k.TopicChildBehaviourType.SURFACE||l.push(w.getChild())}b=(w=m.CetModelEditorInternal.isOverview(b,a))?"2":"3";p=w?p.getDefaultChapterStyle():p.getDefaultSubChapterStyle();
k.TopicType.PAGE!==e&&(e=g.getStyleClasses(),e.append(p),g.setStyleClasses(e));for(const a of h)for(e=a.getStyleClasses(),w=0;w<e.length();++w){c=e.get(w);const d=-1<l.indexOf(a.getId());c.startsWith("frame")||d&&c.startsWith("poly")?e.update(w,p):d&&(c=c.substring(0,c.length-1),-1<["line","shapelikeFilter","fullBlendShapelikeFilter","imageFilter"].indexOf(c)&&e.update(w,c+b))}h=a.inflateAll(f.CetModel.ID.Z_OBJECT,h);a=a.getPreziW();for(let b of h)b.isDef(f.CetModel.ID.Z_OBJECT)&&a.getMutableZObjects().add(b.getMutableWrapper(f.CetModel.ID.Z_OBJECT.W));
return g.getId()}linkToParentAsContent(a,b,c){m.CetModelEditorInternal.isOverview(c,a)||f.CetModel.ID.TOPIC_CHILD.inflate(a,k.DOM.createTopicChild(k.DOM.createContent(),b),(b)=>{a.getEntityById(c).getMutableWrapper(f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic().getEntity().getMutableWrapper(f.CetModel.ID.HAS_TOPIC_CHILDREN.W).getMutableTopicChildren().add(b)})}addChapterToSmartStructureAndPath(a,b,c,e,h){var f=a.mscene;a=m.CetModelEditorInternal.createSmartStructureEditor(f);b=b.getChildTopics(e.id);
b=0===h?e.id:b[h-1];b=m.CetModelEditorInternal.createEditorPathQuery(f).findPathInsertPosition(b);const g=E.createPathManager(f);g.insertFlyToObject_DONTFIX(c.id,b++);if(c.is(d.base.ObjectKind.stackTopic)){f=m.CetModelEditorInternal.getPagesOfChapterUnsorted(c.id,f);n.Utils.assert(1<=f.length,"should be a new stack with at least one page");for(const a of f)g.insertFlyToObject_DONTFIX(a,b++)}e.is(d.base.ObjectKind.overview)?g.insertFlyToOverview_DONTFIX(b,c.id):e.is(d.base.ObjectKind.planetTopic)?
g.insertFlyToObject_DONTFIX(e.id,b,c.id):n.Utils.assertNever(e);a.addToSmartStructure([c],e,d.SmartStructureAddIntention.pasteKeepTransform,h)}move(a,b,c,e){if(c!==e){var h=new ka.TopicQueryImpl(a.mscene),f=h.getChildTopics(b);c=f[c];e=f[e];h=h.getTopicKind(b);switch(h){case d.TopicKind.Overview:this.moveInSmartStructure(a,this.calcFromToForChain(a,c,e),b);break;case d.TopicKind.Stack:b=m.CetModelEditorInternal.createEditorPathQuery(a.mscene);c=b.getStepIndexesForEntityId(c)[0];b=b.getStepIndexesForEntityId(e)[0];
this.pathMove(a,c,b);break;case d.TopicKind.Planet:this.moveInSmartStructure(a,this.calcFromToForLinear(a,c,e),b);break;default:throw Error(`Cannot reorder children of topic with kind '${d.TopicKind[h]}'`);}}}calcFromToForChain(a,b,c){var e=a.mscene.getPreziW().getOverview().getSmartStructure().getId();a=a.mscene.getEntityById(e);e=a.getWrapper(f.CetModel.ID.SMART_STRUCTURE.W).getChildren().items();b=e.indexOf(b);c=e.indexOf(c);return{fromIndex:b,toIndex:b<c?c+1:c,smartStructureEntity:a}}moveInSmartStructure(a,
b){const c=b.fromIndex,e=b.toIndex;b=b.smartStructureEntity.getId();b=a.mscene.getEntityById(b).getMutableWrapper(f.CetModel.ID.SMART_STRUCTURE.W);m.CetModelEditorInternal.createSmartStructureEditor(a.mscene).moveInSmartStructure(c,e,b)}pathMove(a,b,c){const e=E.createPathManager(a.mscene);b<c&&c++;a=m.CetModelEditorInternal.createEditorPathQuery(a.mscene).getPathStepTargetId(b);e.moveToWithDescendants(a,c)}calcFromToForLinear(a,b,c){var e=m.CetModelEditorInternal.getParentSmartStructureId(b,a.mscene);
a=a.mscene.getEntityById(e);e=a.getWrapper(f.CetModel.ID.SMART_STRUCTURE.W).getChildren().items();b=e.indexOf(b);c=e.indexOf(c);return{fromIndex:b,toIndex:b<c?c+1:c,smartStructureEntity:a}}};var S={};Object.defineProperty(S,"__esModule",{value:!0});S.SimpleObjectEditorImpl=class extends ca.ObjectEditorImpl{constructor(a,b,c,e,d){super(a,b,c,e,d);this.baseObjectCommander=e}get parent(){return this.getParentEditor()}set parent(a){this.preserveLayoutBox(()=>this.setParent(a))}setParentAndFitInto(a,b){this.setParent(a);
this.fitInto(b)}setParent(a){this.baseObjectCommander.setSimpleObjectParent(this.ctx,this,a)}get presetSelector(){var a=this.wrapper.getEntity();a=(new N.StyleEditorImpl(this.ctx.mscene)).findMatchingDeclarationsStrongerFirst(a,!1);return null!=a&&0<a.length?oa.selectorStringToStyleSelector(a[0].getStyleSelector().toString()):null}updatePresetStyle(){const a=this.wrapper.getEntity(),b=new N.StyleEditorImpl(this.ctx.mscene);var c=b.findMatchingDeclarationsStrongerFirst(a,!1);null!=c&&0<c.length&&(c=
this.ctx.mscene.getEntityById(c[0].getId()).getMutableWrapper(f.CetModel.ID.STYLE_DECLARATION.W),b.copyStyleProperties(a,c),this.baseObjectCommander.updateEntitesAfterStyleChange(this.editorCache,this.ctx,[c]),this.resetStyleDontTriggerSystems(b))}applyPresetStyle(){const a=new N.StyleEditorImpl(this.ctx.mscene);this.resetStyleDontTriggerSystems(a);this.baseObjectCommander.updateEntityAfterStyleChange(this.editorCache,this.ctx,this.wrapper.getId())}resetStyleDontTriggerSystems(a){a.removeIdStyleClasses([this.id])}get coverLayoutRole(){const a=
this.safeGetTopicChildBehavior(()=>this.parent.is(d.base.ObjectKind.cover));if(null!=a&&a.is(f.CetModel.ID.COVER))return this.coverLayoutRoleWToApiRole(a.getLayoutRole());throw Error(`Unexpected missing cover behavior on topic child relationship: ${this.wrapper.getId()}`);}set coverLayoutRole(a){const b=this.safeGetTopicChildBehavior(()=>this.parent.is(d.base.ObjectKind.cover));if(null!=b&&b.is(f.CetModel.ID.COVER))a=a!==d.base.CoverLayoutRole.none?f.CetModel.ID.COVER_LAYOUT_ROLE.inflate(this.ctx.mscene,
this.apiCoverLayoutRoleToPdomData(a)):null,b.setLayoutRole(a);else throw Error(`Unexpected missing cover behavior on topic child relationship: ${this.wrapper.getId()}`);}get contentLayoutRole(){const a=this.safeGetTopicChildBehavior(()=>this.parent.is(d.base.ObjectKind.page)||this.parent.is(d.base.ObjectKind.topic));if(null!=a&&a.is(f.CetModel.ID.CONTENT))return this.contentLayoutRoleWToApiRole(a.getLayoutRole());throw Error(`Unexpected missing content behavior on topic child relationship: ${this.wrapper.getId()}`);
}set contentLayoutRole(a){const b=this.safeGetTopicChildBehavior(()=>this.parent.is(d.base.ObjectKind.page)||this.parent.is(d.base.ObjectKind.topic));if(null!=b&&b.is(f.CetModel.ID.CONTENT))a=a!==d.base.ContentLayoutRole.none?f.CetModel.ID.CONTENT_LAYOUT_ROLE.inflate(this.ctx.mscene,this.apiContentLayoutRoleToPdomData(a)):null,b.setLayoutRole(a);else throw Error(`Unexpected missing content behavior on topic child relationship: ${this.wrapper.getId()}`);}get surfaceLayoutRole(){const a=this.safeGetTopicChildBehavior(()=>
this.parent.is(d.base.ObjectKind.surface));if(null!=a&&a.is(f.CetModel.ID.SURFACE))return this.surfaceLayoutRoleWToApiRole(a.getLayoutRole());throw Error(`Unexpected missing surface behavior on topic child relationship: ${this.wrapper.getId()}`);}set surfaceLayoutRole(a){const b=this.safeGetTopicChildBehavior(()=>this.parent.is(d.base.ObjectKind.surface));if(null!=b&&b.is(f.CetModel.ID.SURFACE))a=a!==d.base.SurfaceLayoutRole.none?f.CetModel.ID.SURFACE_LAYOUT_ROLE.inflate(this.ctx.mscene,this.apiSurfaceLayoutRoleToPdomData(a)):
null,b.setLayoutRole(a);else throw Error(`Unexpected missing surface behavior on topic child relationship: ${this.wrapper.getId()}`);}get visualLayoutRole(){const a=this.safeGetTopicChildBehavior(()=>this.parent.is(d.base.ObjectKind.visual));if(null!=a&&a.is(f.CetModel.ID.VISUAL))return this.visualLayoutRoleWToApiRole(a.getLayoutRole());throw Error(`Unexpected missing visual behavior on topic child relationship: ${this.wrapper.getId()}`);}set visualLayoutRole(a){const b=this.safeGetTopicChildBehavior(()=>
this.parent.is(d.base.ObjectKind.visual));if(null!=b&&b.is(f.CetModel.ID.VISUAL))a=a!==d.base.VisualLayoutRole.none?f.CetModel.ID.VISUAL_LAYOUT_ROLE.inflate(this.ctx.mscene,this.apiVisualLayoutRoleToPdomData(a)):null,b.setLayoutRole(a);else throw Error(`Unexpected missing visual behavior on topic child relationship: ${this.wrapper.getId()}`);}safeGetTopicChildBehavior(a){if(a()){a=this.getReferingTopicChild();if(null!=a)return a.getMutableBehaviour();throw Error(`Object has no topic child relationship to get/set layout role on: ${this.wrapper.getId()}`);
}return null}getReferingTopicChild(){const a=this.wrapper.getEntity().get(f.CetModel.ID.TOPIC_CHILD.CHILD_PARENT);if(null==a||0===a.length)return null;const b=this.ctx.mscene.getEntityById(a[0]);if(null==b)throw Error(`Unexpected missing topic child entity ${a[0]}`);return b.getMutableWrapper(f.CetModel.ID.TOPIC_CHILD.W)}coverLayoutRoleWToApiRole(a){return null==a?d.base.CoverLayoutRole.none:a.is(f.CetModel.ID.COVER_TITLE)?d.base.CoverLayoutRole.coverTitle:a.is(f.CetModel.ID.COVER_ICON)?d.base.CoverLayoutRole.coverIcon:
d.base.CoverLayoutRole.none}apiCoverLayoutRoleToPdomData(a){switch(a){case d.base.CoverLayoutRole.none:return null;case d.base.CoverLayoutRole.coverTitle:return k.DOM.createCoverTitle();case d.base.CoverLayoutRole.coverIcon:return k.DOM.createCoverIcon();default:return null}}contentLayoutRoleWToApiRole(a){return null==a?d.base.ContentLayoutRole.none:a.is(f.CetModel.ID.CONTENT_TITLE)?d.base.ContentLayoutRole.contentTitle:a.is(f.CetModel.ID.CONTENT_ICON)?d.base.ContentLayoutRole.contentIcon:d.base.ContentLayoutRole.none}apiContentLayoutRoleToPdomData(a){switch(a){case d.base.ContentLayoutRole.none:return null;
case d.base.ContentLayoutRole.contentTitle:return k.DOM.createContentTitle();case d.base.ContentLayoutRole.contentIcon:return k.DOM.createContentIcon();default:return null}}visualLayoutRoleWToApiRole(a){return null==a?d.base.VisualLayoutRole.none:a.is(f.CetModel.ID.VISUAL_ANCHOR)?d.base.VisualLayoutRole.visualAnchor:a.is(f.CetModel.ID.SLIDE_ANCHOR_16_9)?d.base.VisualLayoutRole.slideAnchor_16_9:a.is(f.CetModel.ID.SLIDE_ANCHOR_4_3)?d.base.VisualLayoutRole.slideAnchor_4_3:a.is(f.CetModel.ID.SLIDE_DECORATOR)?
d.base.VisualLayoutRole.slideDecorator:a.is(f.CetModel.ID.CONTENT_AREA)?d.base.VisualLayoutRole.contentArea:a.is(f.CetModel.ID.TOPIC_SHAPE)?d.base.VisualLayoutRole.topicShape:d.base.VisualLayoutRole.none}apiVisualLayoutRoleToPdomData(a){switch(a){case d.base.VisualLayoutRole.none:return null;case d.base.VisualLayoutRole.visualAnchor:return k.DOM.createVisualAnchor();case d.base.VisualLayoutRole.slideAnchor_16_9:return k.DOM.createSlideAnchor_16_9();case d.base.VisualLayoutRole.slideAnchor_4_3:return k.DOM.createSlideAnchor_4_3();
case d.base.VisualLayoutRole.slideDecorator:return k.DOM.createSlideDecorator();case d.base.VisualLayoutRole.contentArea:return k.DOM.createContentArea();case d.base.VisualLayoutRole.topicShape:return k.DOM.createTopicShape();default:n.Utils.assertNever(a)}}apiSurfaceLayoutRoleToPdomData(a){switch(a){case d.base.SurfaceLayoutRole.none:return null;case d.base.SurfaceLayoutRole.surfaceTopicShape:return k.DOM.createSurfaceTopicShape();default:return null}}surfaceLayoutRoleWToApiRole(a){return null==
a?d.base.SurfaceLayoutRole.none:a.is(f.CetModel.ID.SURFACE_TOPIC_SHAPE)?d.base.SurfaceLayoutRole.surfaceTopicShape:d.base.SurfaceLayoutRole.none}isAutoChild(a,b){var c=g.Check.as("child",a,"SimpleObjectEditorImpl",S.SimpleObjectEditorImpl);a=l.Cet.world(this.wrapper.getEntity()).getWorldBoundingShape();c=l.Cet.world(c.wrapper.getEntity()).getWorldBounds();return"webgl"===b?zc(q.Geometry.obbFromRect(a.getBounds().getData()),q.Geometry.obbFromRect(c.getBounds().getData())):zc(a,c)}};var Xb={};Object.defineProperty(Xb,
"__esModule",{value:!0});Xb.AnimatedImageEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.animatedImage,a,b,c,e)}get imageAsset(){const a=l.Cet.draw(this.wrapper.getEntity()).calculateGraphicsBounds(this.wrapper.getEntity());return{kind:d.base.AssetKind.animatedImage,mediaAssetId:this.wrapper.getMediaAssetId(),width:a.getWidth(),height:a.getHeight()}}set imageAsset(a){g.Check.animatedImageAsset("imageAsset",a);this.wrapper.setMediaAssetId(a.mediaAssetId);
this.setAssetSize({width:a.width,height:a.height});this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",a);this.wrapper.setHyperlink(a)}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}setAssetSize(a){const b=l.Cet.mutableDraw(this.wrapper.getEntity());if(b.kind===F.DrawComponentKind.animatedImage)b.setAssetSize(a);else throw Error("Invalid draw component kind: "+
b.kind);}};var $a={};Object.defineProperty($a,"__esModule",{value:!0});$a.ArcEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e,d){super(d,a,b,c,e);this.curvedLineCalculation=F.CetRendererModule.CurvedLineCalculation()}getSnapshot(){const a=this.wrapper.getThickness(),b=this.wrapper.getArcHeight(),c=this.wrapper.getStartEndDistance(),e=this.wrapper.getLocalToWorld(),d=this.wrapper;return()=>{d.setLocalToWorld(e);d.setArcHeight(b);d.setStartEndDistance(c);d.setThickness(a);F.CetRendererModule.updateBounds(d.getEntity());
F.CetRendererModule.updateWorldProperties(d.getEntity())}}static insertArrow(a,b){let c=k.DOM.createZArrow(a.generateEntityId());this.fillZData(c,b);b=f.CetModel.ID.Z_ARROW.inflate(a,c);a.getPreziW().getMutableZObjects().add(b);return b}static insertLine(a,b){let c=k.DOM.createZLine(a.generateEntityId());this.fillZData(c,b);b=f.CetModel.ID.Z_LINE.inflate(a,c);a.getPreziW().getMutableZObjects().add(b);return b}static fillZData(a,b){a.setArcHeight(d.PresetConstants.PRESET_LINE_ARROW_ARC_HEIGHT);a.setStartEndDistance(d.PresetConstants.PRESET_LINE_ARROW_START_END_DISTANCE);
null!=b&&a.setStyleClasses(k.DOM.createArrayToken([b]))}setTransform(a){this.connectorStart=this.connectorEnd=null;super.setTransform(a)}set arcStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ArcStyle)}get arcStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),d.base.ArcStyle)}set filterStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ShapelikeFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),
d.base.ShapelikeFilterStyle)}set colorFilter(a){a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get start(){return this.localToRelative().transformPoint(this.curvedLineCalculation.getStartPoint(this.wrapper))}set start(a){g.Check.point("start",a);this.wrapper.setConnectorTail(null);const b=this.curvedLineCalculation.getEndPoint(this.wrapper),
c=this.curvedLineCalculation.getStartPoint(this.wrapper);this.changeEndpoints(this.adjustToMinimalWidth(b,c,this.relativeToLocal().transformPoint(a)),b)}get end(){return this.localToRelative().transformPoint(this.curvedLineCalculation.getEndPoint(this.wrapper))}set end(a){g.Check.point("end",a);this.wrapper.setConnectorHead(null);const b=this.curvedLineCalculation.getStartPoint(this.wrapper),c=this.curvedLineCalculation.getEndPoint(this.wrapper);this.changeEndpoints(b,this.adjustToMinimalWidth(b,
c,this.relativeToLocal().transformPoint(a)))}get middle(){return this.localToRelative().transformPoint(this.curvedLineCalculation.getArcPoint(this.wrapper))}get arcHeight(){return pa.calculateBigCurceArchHeight(this.wrapper,this.ctx.mscene)*this.getScale()}set arcHeight(a){g.Check.finite("archHeight",a);a/=this.getScale();a=pa.calculateArcHeightChange(this.wrapper,this.ctx.mscene,a-pa.calculateBigCurceArchHeight(this.wrapper,this.ctx.mscene));null!=a.bigCurveArcHeight&&this.wrapper.getEntity().set(d.CetModelEditor.getConnectorArcHeightKey(),
a.bigCurveArcHeight);var b=this.wrapper.getLocalToWorld().getScale();b=q.Geometry.transform2dFromRad(a.center,b,a.rotation);F.CetRendererModule.CurvedLineCalculation().validateCurvedLineData(b.getScale(),a.arcHeight,a.startEndDistance);this.wrapper.setLocalToWorld(b);this.wrapper.setStartEndDistance(a.startEndDistance);this.wrapper.setArcHeight(a.arcHeight);this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}get connectorStart(){return null==this.wrapper.getConnectorTail()?null:
this.editorCache.transformedObject(this.wrapper.getConnectorTail().getTarget())}get connectorEnd(){return null==this.wrapper.getConnectorHead()?null:this.editorCache.transformedObject(this.wrapper.getConnectorHead().getTarget())}set connectorStart(a){null==a?this.wrapper.setConnectorTail(null):(this.wrapper.setConnectorTail(f.CetModel.ID.CONNECTOR_END.inflate(this.ctx.mscene,k.DOM.createConnectorEnd(a.id))),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}set connectorEnd(a){null==
a?this.wrapper.setConnectorHead(null):(this.wrapper.setConnectorHead(f.CetModel.ID.CONNECTOR_END.inflate(this.ctx.mscene,k.DOM.createConnectorEnd(a.id))),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}get thickness(){return this.wrapper.getThickness()*this.getScale()}set thickness(a){g.Check.positive("thickness",a);a/=this.getScale();a!==this.wrapper.getThickness()&&(this.wrapper.setThickness(a),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}get fill(){return Object.assign(Object.assign({},
this.wrapper.getColor().getRGBData()),{a:this.wrapper.getAlpha()})}set fill(a){g.Check.rgba("fill",a);const b=wa.colorFromData("fill",a);this.wrapper.setColor(b);this.wrapper.setGradStartColor(b);this.wrapper.setGradEndColor(b);this.wrapper.setAlpha(a.a)}get fills(){return{solidFill:{fillKind:d.base.FillKind.solid,color:Object.assign(Object.assign({},this.wrapper.getColor().getRGBData()),{a:this.wrapper.getAlpha()})},current:d.base.FillKind.solid,hasAlpha:!0}}get minStartEndDistance(){return this.minStartEndDistanceInLocal()*
this.getScale()}minStartEndDistanceInLocal(){return this.kind===d.base.ObjectKind.arrow?l.Cet.getArrowHeadLength()*this.wrapper.getThickness():pa.lineMinStartEndDistance}adjustToMinimalWidth(a,b,c){const e=this.minStartEndDistanceInLocal();return q.Geometry.distance(a,c)<e?(c=q.Geometry.fromPoint(c).sub(q.Geometry.fromPoint(a)).normalize(),.1>c.length()&&(c=q.Geometry.fromPoint(b).sub(q.Geometry.fromPoint(a)).normalize()),c.mul(e).add(q.Geometry.fromPoint(a)).toPoint()):c}changeEndpoints(a,b){const c=
this.wrapper.getLocalToWorld();a=this.curvedLineCalculation.getCurve(c.transformPoint(a),c.transformPoint(b),this.wrapper.getArcHeight(),c,this.curvedLineCalculation.isInverse(this.wrapper));this.curvedLineCalculation.validateCurvedLineData(a.localToWorld.getScale(),a.curvedLine.getArcHeight(),a.curvedLine.getStartEndDistance());m.CetModelEditorInternal.createEntityEditor(this.ctx.mscene).transformSubtree(this.wrapper.getId(),a.localToWorld);this.wrapper.setArcHeight(a.curvedLine.getArcHeight());
this.wrapper.setStartEndDistance(a.curvedLine.getStartEndDistance());this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}};class pa{static calculateBigCurceArchHeight(a,b){const c=F.CetRendererModule.CurvedLineCalculation();b=l.Cet.createBoundsCalculator(b);var e=a.getConnectorTail(),d=null!=e?e.getTarget():"";let f=!1,g=!1;e=a.getLocalToWorld().transformPoint(c.getStartPoint(a));let k=a.getLocalToWorld().transformPoint(c.getEndPoint(a));null!=d&&""!==d&&(e=b.getWorldBoundsForLayout(d,
l.TextBoundsOptions.TextBox).getCenter(),f=!0);d=a.getConnectorHead();d=null!=d?d.getTarget():"";null!=d&&""!==d&&(k=b.getWorldBoundsForLayout(d,l.TextBoundsOptions.TextBox).getCenter(),g=!0);return f||g?(b=c.getCurveCircleWorld(a,a.getLocalToWorld()),c.getCurveFromChord(b,a.getLocalToWorld().getScale(),e,k,0>a.getArcHeight()).curvedLine.getArcHeight()):a.getArcHeight()}static calculateArcHeightChange(a,b,c){const e=F.CetRendererModule.CurvedLineCalculation();var d=l.Cet.createHierarchyQuery(b).getParentOrOverview(a.getEntity());
d=b.getEntityById(d);let p=null,g=null,k=!1,w=!1;const z=a.getLocalToWorld();var x=z.transformPoint(e.getStartPoint(a)),t=z.transformPoint(e.getEndPoint(a)),m=e.isInverse(a),n=z.getScale();const q=l.Cet.world(a.getEntity()).getWorldBounds();var u=l.Cet.createBoundsCalculator(b),B=a.getConnectorTail();B=null!=B?B.getTarget():"";null!=B&&""!==B&&(p=b.getEntityById(B),x=u.getWorldBoundsForLayout(B,l.TextBoundsOptions.TextBox).getCenter(),k=!0);B=a.getConnectorHead();B=null!=B?B.getTarget():"";null!=
B&&""!==B&&(g=b.getEntityById(B),t=u.getWorldBoundsForLayout(B,l.TextBoundsOptions.TextBox).getCenter(),w=!0);b=pa.middlePoint(x,t);if(k||w)if(u=e.getCurveCircleWorld(a,z),n=e.getCurveFromChord(u,n,x,t,0>a.getArcHeight()),n=this.snapStraightIfArcHeightTooSmall(n.curvedLine.getArcHeight()+c,n.curvedLine.getStartEndDistance()),m=e.getCurve(x,t,n,z,m),n=!0,k&&(x=e.getConnectorEndPoint(m,e.getAttachPaddingInWorld(a.is(f.CetModel.ID.Z_ARROW),z,a,a,l.Cet.world(d).getWorldBounds(),l.Cet.world(p).getWorldBoundingShape()),
l.Cet.world(p).getWorldBoundingShape(),!0),null==x&&(n=!1)),w&&(t=e.getConnectorEndPoint(m,e.getAttachPaddingInWorld(a.is(f.CetModel.ID.Z_ARROW),z,a,a,l.Cet.world(d).getWorldBounds(),l.Cet.world(g).getWorldBoundingShape()),l.Cet.world(g).getWorldBoundingShape(),!1),null==t&&(n=!1)),n)return a=e.getCurveFromChordAndArcHeight(m.curvedLine.getStartEndDistance(),m.curvedLine.getArcHeight(),m.localToWorld,z.getScale(),x,t),{center:a.localToWorld.getTranslation(),rotation:a.localToWorld.getRotationRad(),
startEndDistance:a.curvedLine.getStartEndDistance(),arcHeight:a.curvedLine.getArcHeight(),bigCurveArcHeight:m.curvedLine.getArcHeight()};return pa.bendLineAsNoConnectorWithArcHeightDelta(a,c,b,q.getRotationRadians())}static bendLineAsNoConnectorWithArcHeightDelta(a,b,c,e){b=this.snapStraightIfArcHeightTooSmall(a.getArcHeight()+b,a.getStartEndDistance());return pa.bendLineAsNoConnectorWithNewArcHeight(a,b,c,e)}static bendLineAsNoConnectorWithNewArcHeight(a,b,c,e){return{center:pa.calculateCorrectCenter(c,
a.getLocalToWorld(),b,a.getLocalToWorld().getRotationRad()),rotation:e,startEndDistance:a.getStartEndDistance(),arcHeight:b}}static snapStraightIfArcHeightTooSmall(a,b){return Math.abs(a/b)<pa.minimalArcHeightRatio?0:a}static calculateCorrectCenter(a,b,c,e){b=q.Geometry.transform2dFromRad(b.getTranslation(),b.getScale(),e);c=q.Geometry.fromPoint(b.transformPoint({x:0,y:c/2}));b=q.Geometry.fromPoint(b.transformPoint({x:0,y:0}));return c.sub(b).add(q.Geometry.fromPoint(a)).toPoint()}static middlePoint(a,
b){return{x:(a.x+b.x)/2,y:(a.y+b.y)/2}}}pa.lineMinStartEndDistance=25;pa.minimalArcHeightRatio=1/75;var ab={};Object.defineProperty(ab,"__esModule",{value:!0});ab.FillHelper=class{constructor(a){this.hasFillW=a}getFillNoRadial(a){a=this.getFill(a);if(a.fillKind===d.base.FillKind.radial)throw Error(`Illegal fillType for shape: ${this.hasFillW.getFillType()}`);return a}getFill(a){return this.getFillWithFillType(this.hasFillW.getFillType(),a)}getFillKind(){switch(this.hasFillW.getFillType()){case f.FillType.Solid:return d.base.FillKind.solid;
case f.FillType.Linear:return d.base.FillKind.linear;case f.FillType.Radial:return d.base.FillKind.radial;default:throw Error(`Illegal fillType for shape: ${this.hasFillW.getFillType()}`);}}getFillWithFillType(a,b){switch(a){case f.FillType.Solid:return{fillKind:d.base.FillKind.solid,color:Object.assign(Object.assign({},this.hasFillW.getColor().getRGBData()),{a:b?this.hasFillW.getAlpha():1})};case f.FillType.Linear:return{fillKind:d.base.FillKind.linear,startColor:Object.assign(Object.assign({},this.hasFillW.getGradStartColor().getRGBData()),
{a:b?this.hasFillW.getGradStartAlpha():1}),endColor:Object.assign(Object.assign({},this.hasFillW.getGradEndColor().getRGBData()),{a:b?this.hasFillW.getGradEndAlpha():1})};case f.FillType.Radial:return{fillKind:d.base.FillKind.radial,startColor:Object.assign(Object.assign({},this.hasFillW.getGradStartColor().getRGBData()),{a:b?this.hasFillW.getGradStartAlpha():1}),endColor:Object.assign(Object.assign({},this.hasFillW.getGradEndColor().getRGBData()),{a:b?this.hasFillW.getGradEndAlpha():1})};default:throw Error(`Illegal fillType for shape: ${this.hasFillW.getFillType()}`);
}}setFill(a){g.Check.notNull("fill",a);switch(a.fillKind){case d.base.FillKind.solid:g.Check.rgba("fill",a.color);this.hasFillW.setFillType(f.FillType.Solid);this.hasFillW.setColor(wa.colorFromData("fill",a.color));this.hasFillW.setAlpha(a.color.a);break;case d.base.FillKind.linear:case d.base.FillKind.radial:g.Check.rgba("fillStart",a.startColor);g.Check.rgba("fillEnd",a.endColor);switch(a.fillKind){case d.base.FillKind.linear:this.hasFillW.setFillType(f.FillType.Linear);break;case d.base.FillKind.radial:this.hasFillW.setFillType(f.FillType.Radial);
break;default:n.Utils.assertNever(a)}this.hasFillW.setGradStartColor(wa.colorFromData("fillStart",a.startColor));this.hasFillW.setGradStartAlpha(a.startColor.a);this.hasFillW.setGradEndColor(wa.colorFromData("fillEnd",a.endColor));this.hasFillW.setGradEndAlpha(a.endColor.a);break;default:n.Utils.assertNever(a)}}setFillKind(a){g.Check.notNull("fillKind",a);if(a!==this.getFillKind())switch(a){case d.base.FillKind.solid:this.hasFillW.setAlpha(1);this.hasFillW.setFillType(f.FillType.Solid);!this.hasFillW.getColor()&&
this.hasFillW.getGradStartColor()&&this.hasFillW.setColor(this.hasFillW.getGradStartColor());break;case d.base.FillKind.radial:case d.base.FillKind.linear:this.hasFillW.setFillType(a===d.base.FillKind.linear?f.FillType.Linear:f.FillType.Radial);!this.hasFillW.getGradStartColor()&&this.hasFillW.getColor()&&(a=this.hasFillW.getColor(),this.hasFillW.setGradStartColor(a),this.hasFillW.setGradEndColor(a));break;default:n.Utils.assertNever(a)}}};var bb={createBackgroundLayerW:function(a,b,c,e){const h=
(a,b)=>{b.setOnlineAssetUrl(a.url).setAssetSourceFilename(a.assetSourceFilename).setOnlineAssetId(a.onlineAssetId).setOfflineAssetId(a.offlineAssetId).setHeight(a.height).setWidth(a.width).setDepth(c).setFadeScale(e);return b};switch(b.kind){case d.base.AssetKind.image:return g.Check.imageAsset("asset",b),f.CetModel.ID.BACKGROUND_IMAGE.inflate(a,h(b,k.DOM.createBackgroundImage()));case d.base.AssetKind.swf:return g.Check.swfAsset("asset",b),f.CetModel.ID.BACKGROUND_SWF_GRAPHICS.inflate(a,h(b,k.DOM.createBackgroundSwfGraphics()));
default:n.Utils.assertNever(b)}}};Object.defineProperty(bb,"__esModule",{value:!0});bb.BackgroundLayerEditorImpl=class extends A.BaseEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.backgroundLayer,a,c,e);this.baseObjectCommander=b;this.layoutableEditor=new u.LayoutableEditorImpl(()=>b.getLayoutBox(e.overview(this.ctx.mscene.getPreziW().getOverview().getId()).referenceFrame,this.ctx.mscene,this.wrapper.getEntity(),l.TextBoundsOptions.Visible),(a)=>{a=g.Check.as("layoutBox",a,"LayoutBoxImpl",
u.LayoutBoxImpl);b.fitInto(this.ctx,this.wrapper.getEntity(),this.layoutBox,a)})}get position(){return this.layoutableEditor.position}set position(a){this.layoutableEditor.position=a}get rotationRad(){return this.layoutableEditor.rotationRad}set rotationRad(a){this.layoutableEditor.rotationRad=a}scale(a){this.layoutableEditor.scale(a)}get layoutBox(){return this.layoutableEditor.layoutBox}fitInto(a){this.layoutableEditor.fitInto(a)}get asset(){var a=this.wrapper;if(!a.is(f.CetModel.ID.BACKGROUND_SWF_GRAPHICS)&&
!a.is(f.CetModel.ID.BACKGROUND_IMAGE))throw Error("invalid asset kind");const b={assetSourceFilename:a.getAssetSourceFilename(),width:a.getWidth(),height:a.getHeight(),offlineAssetId:a.getOfflineAssetId(),onlineAssetId:a.getOnlineAssetId(),url:a.getOnlineAssetUrl()};a=a.is(f.CetModel.ID.BACKGROUND_SWF_GRAPHICS)?d.base.AssetKind.swf:d.base.AssetKind.image;return Object.assign(Object.assign({},b),{kind:a})}set asset(a){const b=this.index;a=(0,bb.createBackgroundLayerW)(this.ctx.mscene,a,this.depth,
this.fadeScale);this.delete();this.getLayers().insert(b,a)}delete(){const a=this.id;this.getLayers().removeAt(this.index);Q.avro.Avro.createDefaultLogger().logDeleteObject({object_type:"BACKGROUND",topic_relationship:"CONTENT",delete_type:"SIDEBAR_BG",object_id:a})}get depth(){return this.wrapper.getDepth()}set depth(a){g.Check.finite("depth",a);this.wrapper.setDepth(a)}get fadeScale(){return this.wrapper.getFadeScale()}set fadeScale(a){g.Check.finite("fadeScale",a);this.wrapper.setFadeScale(a)}get index(){return this.getLayers().indexOf(this.wrapper)}getLayers(){return this.ctx.mscene.getPreziW().getMutableBackground().getMutableLayers()}set index(a){g.Check.integer("index",
a);const b=this.getLayers();g.Check.range("index",a,0,b.length()-1);const c=this.index;b.move(c,c<a?a+1:a)}set colorFilter(a){a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}set filterStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.BackgroundFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),d.base.BackgroundFilterStyle)}};var Yb={};Object.defineProperty(Yb,"__esModule",{value:!0});
Yb.BackgroundEditorImpl=class extends A.BaseEditorImpl{constructor(a,b,c){super(d.base.ObjectKind.background,a,b,c);this.fillHelper=new ab.FillHelper(b);this.add=new Jd(a,b,c)}get fill(){return this.fillHelper.getFill(!1)}set fill(a){this.fillHelper.setFill(a)}get fills(){return{solidFill:this.fillHelper.getFillWithFillType(f.FillType.Solid,!1),linearFill:this.fillHelper.getFillWithFillType(f.FillType.Linear,!1),radialFill:this.fillHelper.getFillWithFillType(f.FillType.Radial,!1),current:this.fillHelper.getFillKind(),
hasAlpha:!1}}setFillKind(a){this.fillHelper.setFillKind(a)}get layers(){return[...this.wrapper.getLayers()].map((a)=>this.editorCache.backgroundLayer(a.getId()))}get layerType(){const a=this.wrapper.getLayerType();switch(a){case f.BackgroundLayerType.AllLayersFullAlpha:return d.base.BackgroundLayerType.allLayersFullAlpha;case f.BackgroundLayerType.FadeBetweenTransparentLayers:return d.base.BackgroundLayerType.fadeBetweenTransparentLayers;case f.BackgroundLayerType.Opaque:return d.base.BackgroundLayerType.opaque;
default:n.Utils.assertNever(a,`Unknown layer type in document: ${a}`)}}getDomlayerType(a){switch(a){case d.base.BackgroundLayerType.allLayersFullAlpha:return f.BackgroundLayerType.AllLayersFullAlpha;case d.base.BackgroundLayerType.fadeBetweenTransparentLayers:return f.BackgroundLayerType.FadeBetweenTransparentLayers;case d.base.BackgroundLayerType.opaque:return f.BackgroundLayerType.Opaque;default:n.Utils.assertNever(a,`Unknown layer type: ${a}`)}}set layerType(a){this.wrapper.setLayerType(this.getDomlayerType(a))}};
class Jd{constructor(a,b,c){this.ctx=a;this.wrapper=b;this.editorCache=c}layer(a,b){a=bb.createBackgroundLayerW(this.ctx.mscene,a,0,0);const c=this.wrapper.getMutableLayers();null==b?c.add(a):(g.Check.integer("index",b),g.Check.range("index",b,0,c.length()),c.insert(b,a));return this.editorCache.backgroundLayer(a.getId())}}var ub={};Object.defineProperty(ub,"__esModule",{value:!0});ub.BorderHelper=class{constructor(a,b,c){this.hasBorderW=a;this.getScale=b;this.updateDocumentConsistency=c}setBorder(a){g.Check.notNull("border",
a);g.Check.rgba("border.color",a.color);let b;null==a.thickness?b=-1:(g.Check.nonNegative("border.thickness",a.thickness),b=a.thickness/this.getScale());b!==this.hasBorderW.getBorderThickness()&&(this.hasBorderW.setBorderThickness(b),this.updateDocumentConsistency());this.hasBorderW.setBorderColor(wa.colorFromData("border",a.color));this.hasBorderW.setBorderAlpha(a.color.a)}getBorder(){const a=this.hasBorderW.getBorderThickness();return{thickness:-1===a?null:a*this.getScale(),color:Object.assign(Object.assign({},
this.hasBorderW.getBorderColor().getRGBData()),{a:this.hasBorderW.getBorderAlpha()})}}};var vb={};Object.defineProperty(vb,"__esModule",{value:!0});vb.BracketFrameEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.bracketFrame,a,b,c,e);this.fillHelper=new ab.FillHelper(b);this.borderHelper=new ub.BorderHelper(b,()=>this.getScale(),()=>{this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])})}static insert(a,b,c){b=k.DOM.createZBracketFrame(a.mscene.generateEntityId());
b.setWidth(c.width);b.setHeight(c.height);c=f.CetModel.ID.Z_BRACKET_FRAME.inflate(a.mscene,b);a.mscene.getPreziW().getMutableZObjects().add(c);return c}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get width(){return this.wrapper.getWidth()*this.getScale()}get height(){return this.wrapper.getHeight()*this.getScale()}set width(a){g.Check.positive("width",a);a/=this.getScale();this.setWidth(a)}set height(a){g.Check.positive("height",
a);a/=this.getScale();this.setHeight(a)}setWidth(a){a!==this.wrapper.getWidth()&&(this.wrapper.setWidth(a),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}setHeight(a){a!==this.wrapper.getHeight()&&(this.wrapper.setHeight(a),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}set fill(a){this.fillHelper.setFill(a)}get fill(){return this.fillHelper.getFillNoRadial(!0)}get fills(){return{solidFill:this.fillHelper.getFillWithFillType(f.FillType.Solid,!0),linearFill:this.fillHelper.getFillWithFillType(f.FillType.Linear,
!0),current:this.fillHelper.getFillKind(),hasAlpha:!0}}setFillKind(a){this.fillHelper.setFillKind(a)}set border(a){this.borderHelper.setBorder(a)}get border(){return this.borderHelper.getBorder()}get thickness(){return this.wrapper.getThickness()}set thickness(a){g.Check.finite("thickness",a);this.setThickness(a)}setThickness(a){this.wrapper.setThickness(Math.max(0,Math.min(a,100)))}};var Ja={checkOfflineAssetIdReuse:function(a,b){n.Utils.assert(a.offlineAssetId!==b.offlineAssetId||a.width===b.width&&
a.height===b.height&&a.url===b.url,"offline asset id should not be reused")}};Object.defineProperty(Ja,"__esModule",{value:!0});Ja.PdfEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e,h){super(d.base.ObjectKind.pdf,a,b,c,e);this.pdfPatcher=h}static insert(a,b){var c=a.mscene.generateEntityId();c=k.DOM.createZPdf(c);c.setWidth(b.width);c.setHeight(b.height);c.setOnlineAssetUrl(b.url);c.setPageNumber(b.page);c.setOfflineAssetId(b.offlineAssetId);c.setAssetSourceFilename(b.assetSourceFilename);
c.setOnlineAssetId(b.onlineAssetId);b=f.CetModel.ID.Z_PDF.inflate(a.mscene,c);a.mscene.getPreziW().getMutableZObjects().add(b);return b}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get pdfAsset(){return{kind:d.base.AssetKind.pdf,width:this.wrapper.getWidth(),height:this.wrapper.getHeight(),url:this.wrapper.getOnlineAssetUrl(),page:this.wrapper.getPageNumber(),assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),
onlineAssetId:this.wrapper.getOnlineAssetId()}}set pdfAsset(a){g.Check.pdfAsset("pdfAsset",a);(0,Ja.checkOfflineAssetIdReuse)(this.pdfAsset,a);this.wrapper.setOfflineAssetId(a.offlineAssetId);null!=a.offlineAssetId&&""!==a.offlineAssetId&&this.pdfPatcher.patchBack(this.wrapper);this.wrapper.setAssetSourceFilename(a.assetSourceFilename);this.wrapper.setOnlineAssetId(a.onlineAssetId);this.wrapper.setOnlineAssetUrl(a.url);null!=a.url&&(this.wrapper.setWidth(a.width),this.wrapper.setHeight(a.height));
this.wrapper.setPageNumber(a.page);this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}set colorFilter(a){a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}set filterStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),
d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get isPlaceholder(){return this.wrapper.getIsPlaceholder()}set isPlaceholder(a){g.Check.notNull("isPlaceholder",a);this.wrapper.setIsPlaceholder(a)}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",a);this.wrapper.setHyperlink(a)}};var Zb={};Object.defineProperty(Zb,"__esModule",{value:!0});Zb.ChartEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,
e,h){super(d.base.ObjectKind.chart,a,b,c,h);this.chartPatcher=e}get chartAsset(){return{kind:d.base.AssetKind.chart,chartId:this.wrapper.getChartId(),chartType:this.wrapper.getChartType(),width:this.wrapper.getWidth(),height:this.wrapper.getHeight(),url:this.wrapper.getOnlineAssetUrl(),assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),onlineAssetId:this.wrapper.getOnlineAssetId()}}set chartAsset(a){g.Check.chartAsset("chartAsset",a);Ja.checkOfflineAssetIdReuse(this.chartAsset,
a);this.wrapper.setOfflineAssetId(a.offlineAssetId);null!=a.offlineAssetId&&""!==a.offlineAssetId&&this.chartPatcher.patchBack(this.wrapper);this.wrapper.setAssetSourceFilename(a.assetSourceFilename);this.wrapper.setOnlineAssetId(a.onlineAssetId);this.wrapper.setOnlineAssetUrl(a.url);this.wrapper.setHeight(a.height);this.wrapper.setWidth(a.width);this.wrapper.setChartId(a.chartId);this.wrapper.setChartType(a.chartType);this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}set colorFilter(a){a=
G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}set filterStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",
a);this.wrapper.setHyperlink(a)}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}};var Fa=xd,W={};Object.defineProperty(W,"__esModule",{value:!0});W.InserterImpl=class{constructor(a,b,c,e,d){this.api=a;this.targetParent=b;this.copyDataImpl=c;this.ctx=e;this.baseObjectCommander=d}isValid(){try{return this.check(this.targetParent,this.copyDataImpl),!0}catch(a){return!1}}insert(a){var b;this.check(this.targetParent,this.copyDataImpl);null!=
a&&(this.targetParent.is(d.base.ObjectKind.topicParent)?g.Check.range("idx",a,0,this.targetParent.topicChildren.length):this.targetParent.is(d.base.ObjectKind.stackTopic)?g.Check.range("idx",a,0,this.targetParent.pageChildren.length):this.targetParent.is(d.base.ObjectKind.simpleObjectParent)||n.Utils.assertNever(this.targetParent));var c=this.copyDataImpl.doc,e=this.api;let h=e.executionContext.mscene,f=new Map,r=new Map;c=k.DOM.IPreziCopy().copyPrezi(l.Cet.fixIPrezi(c,e.generation));const D=W.InserterImpl.pasteObjects(e,
c),w=W.InserterImpl.collectGroups(h,D);e=[];const z=[],x=[];var t=l.Cet.createHierarchyQuery(h);for(let a=D.getZObjects().iterator(),b=c.getZObjects().iterator();b.hasNext();){var m=b.next().getId(),q=a.next().getId();f.set(m,q);r.set(q,m);null==t.getParentId(h.getEntityById(q))&&(m=this.api.lookup.object(q),m.is(d.base.ObjectKind.topic)?e.push(m):m.is(d.base.ObjectKind.simpleObject)?z.push(m):m.is(d.base.ObjectKind.page)?g.Check.failure(`Cannot paste ${m.kind} under ${this.targetParent.kind}`):n.Utils.assertNever(m))}for(t=
D.getZObjects().iterator();t.hasNext();)m=t.next(),m.getObjectType()===k.ZObjectType.Z_ANIMATED_IMAGE&&(m=this.api.lookup.animatedImage(m.getId()),q=null===(b=this.copyDataImpl.masAssetSizes)||void 0===b?void 0:b.get(m.imageAsset.mediaAssetId),null!=q&&m.setAssetSize(q));b=h.getPreziW().getMutableOverview().getMutableSmartStructure();for(var u of e)b.getMutableChildren().add(u.id);W.InserterImpl.importPath(h,D,this.targetParent);u=this.getTargetLayoutBox([...e,...z]);if(0<e.length)if(this.targetParent.is(d.base.ObjectKind.stackTopic)){var Ia=
e.map((a)=>this.api.lookup.stackTopic(a.id));e.splice(0);for(var B of Ia)for(let b of B.pageChildren)b.setParentNoLastCheck(this.targetParent),null!=a&&(b.index=a++),x.push(b);Ia[0].createLayoutGroupWith(Ia.slice(1)).delete()}else{B=this.api.lookup.topicParent(this.targetParent.id);for(Ia of e)Ia.setParentAndFitIntoDontMoveAnimations(B,Ia.layoutBox),null!=a&&(Ia.index=a++)}if(0<z.length){a=this.api.lookup.simpleObjectParent(this.targetParent.id);for(var v of z)v.setParentAndFitInto(a,v.layoutBox)}v=
[...e,...z];0<v.length&&this.baseObjectCommander.batchFitInto(this.ctx,v,this.copyDataImpl.originalLayoutBox,u);W.InserterImpl.reconstructGroups(h,w,c);W.InserterImpl.adjustTopicShapes(h,c);for(let a of[...r.keys()])null==h.getEntityById(a)&&(c=r.get(a),f.delete(c),r.delete(a));return{simpleObjects:z,topics:e,pages:x,oldIdToNewId:f,newIdToOldId:r}}static pasteObjects(a,b){var c=a.executionContext.mscene;b=c.regenerateIDs(b);const e=[];for(var h of O.toIterable(b.getZObjects())){switch(h.getObjectType()){case k.ZObjectType.Z_ANIMATED_IMAGE:case k.ZObjectType.Z_ARROW:case k.ZObjectType.Z_BRACKET_FRAME:case k.ZObjectType.Z_CHART_PDF:case k.ZObjectType.Z_IMAGE:case k.ZObjectType.Z_LINE:case k.ZObjectType.Z_PDF:case k.ZObjectType.Z_RICH_TEXT:case k.ZObjectType.Z_SHAPE:case k.ZObjectType.Z_SLIDE:case k.ZObjectType.Z_SWF_GRAPHICS:case k.ZObjectType.Z_TEXT:case k.ZObjectType.Z_VIDEO:h.setLocked(!1)}e.push(h)}h=
c.inflateAll(f.CetModel.ID.Z_OBJECT,e);c=c.getPreziW();for(var g of h)g.isDef(f.CetModel.ID.Z_OBJECT)&&c.getMutableZObjects().add(g.getMutableWrapper(f.CetModel.ID.Z_OBJECT.W));g=b.getDocumentStyle();for(const e of O.toIterable(g.getStyleDeclarations()))c=e.getStyleBlock(),g=e.getStyleSelector().toString(),g.startsWith("#")&&(c=d.CetModelEditor.styleBlockFromPdom(K.FontUtils.createLookupFontInfoFromPreziData(b),c),a.styleSheet.createStyleDeclarationWithSelectorStringForPaste(g,c,b));return b}static importPath(a,
b,c,e=null){E.createPathManager(a).importPath(b,c,e)}static reconstructGroups(a,b,c){c.getGrouping()===f.Grouping.On&&a.getPreziW().getGrouping()===f.Grouping.Off&&a.getPreziW().setGrouping(f.Grouping.On);c=new H.GroupManager;for(let e of b.keys()){const d=b.get(e).map((b)=>a.lookup(b,f.CetModel.ID.Z_OBJECT.W)).filter((a)=>null!=a);1<d.length&&c.createGroup(a,d,e)}}static adjustTopicShapes(a,b){b.getTopicType()===k.DOM.ENUMS().TOPIC_TYPE().TOPIC_SHAPE()&&a.getPreziW().getTopicType()!==f.TopicType.TopicShape&&
a.getPreziW().setTopicType(f.TopicType.TopicShape)}check(a,b){g.Check.assert(W.InserterImpl.documentGenerationMatch(this.ctx.mscene.getPreziW().toIPdom(),this.copyDataImpl.doc),"Document generations mismatch");const c=a.is(d.base.ObjectKind.topicParent),e=a.is(d.base.ObjectKind.stackTopic),h=a.is(d.base.ObjectKind.simpleObjectParent),f=new Set;for(const a of O.toIterable(b.doc.getZObjects()))if(O.isZTopicContainer(a)){const b=a.getTopic();if(O.isHasTopicChildrenData(b))for(const a of O.toIterable(b.getTopicChildren()))f.add(a.getChild());
if(O.isHasTopicPageData(b))for(const a of O.toIterable(b.getChildren()))f.add(a)}for(const d of O.toIterable(b.doc.getZObjects()))f.has(d.getId())||(e?g.Check.assert(O.isStack(d),`Cannot paste ${O.kind(d)} under ${a.kind}`):(g.Check.assert(c||!O.isTopic(d),`Cannot paste ${O.kind(d)} under ${a.kind}`),g.Check.assert(h||!O.isSimpleObject(d),`Cannot paste ${O.kind(d)} under ${a.kind}`)))}getTargetLayoutBox(a){return 0<a.length?(a=this.copyDataImpl.originalLayoutBox,this.targetParent.zoomLayoutBox.asReferenceFrame.layoutBox(a.center,
a.size).rotateRad(a.rotationRad)):null}static collectGroups(a,b){const c=new Map;for(let e of O.toIterable(b.getZObjects())){b=e.getId();const d=a.getEntityById(b).get(f.CetModel.ID.Z_OBJECT.GROUP_ID);null!=d&&null==a.getEntityById(d)&&(c.has(d)||c.set(d,[]),c.get(d).push(b))}return c}static documentGenerationMatch(a,b){b=f.CetModel.getDocumentGeneration(b);let c=f.CetModel.isSupportedDocumentGeneration(a,b);c||Q.LoggerModule.getLoggerManager().createLogger("InserterImpl").error({action:"documentGenerationMatch",
object:"InserterImpl",trigger:"machine",payload:{sourceGeneration:b,targetGeneration:f.CetModel.getDocumentGeneration(a),targetSupports:f.CetModel.getSupportedDocumentGenerations(a).join(", ")}});return c}};class O{static toIterable(a){return{[Symbol.iterator]:()=>{const b=a.iterator();let c=b.hasNext();return{next:()=>{const a={value:c?b.next():void 0,done:!c};c=b.hasNext();return a}}}}}static isZTopicContainer(a){return a.getDomType()===k.DomType.Z_TOPIC_CONTAINER}static isHasTopicChildrenData(a){return a.getDomType()===
k.DomType.PLANET_CHAPTER||a.getDomType()===k.DomType.STACK_CHAPTER}static isHasTopicPageData(a){return a.getDomType()===k.DomType.PAGE}static isTopic(a){return O.isPlanet(a)||O.isStack(a)}static isPlanet(a){return O.isZTopicContainer(a)&&a.getTopic().getDomType()===k.DomType.PLANET_CHAPTER}static isStack(a){return O.isZTopicContainer(a)&&a.getTopic().getDomType()===k.DomType.STACK_CHAPTER}static isSimpleObject(a){return!O.isZTopicContainer(a)}static kind(a){return k.DomType[a.getDomType()]}}var ea=
{};Object.defineProperty(ea,"__esModule",{value:!0});ea.TextRangeEditorImpl=class{constructor(a,b,c,e){this._textEditor=a;this.offset=b;this.length=c;this.getScale=e;this.textEditorVersion=this._textEditor.version}get id(){return this._textEditor.id}get textEditor(){if(this._textEditor.version!==this.textEditorVersion)throw Error("The TextEditor is invalid.");return this._textEditor}getText(){return this.textEditor.getText().substr(this.offset,this.length)}getWordBoundaryToLeft(a){g.Check.range("offset",
a,this.offset,this.offset+this.length);a=this.textEditor.getRenderingText().getWordBoundaryToLeft(a,!0);return Math.max(a,this.offset)}getWordBoundaryToRight(a){g.Check.range("offset",a,this.offset,this.offset+this.length);a=this.textEditor.getRenderingText().getWordBoundaryToRight(a);return Math.min(a,this.offset+this.length)}getParagraphs(){const a=this.textEditor.getRenderingText(),b=[],c=a.getParagraphCount();let e=0;for(let d=0;d<c;d++){const c=e+a.getParagraph(d).getLength()+1;(0===this.length&&
e<=this.offset&&this.offset<c||0<this.length&&e<this.offset+this.length&&this.offset<c)&&b.push(new ea.ParagraphEditorImpl(this.textEditor,d,()=>this.getScale()));e=c}return b}getCharacterProps(){var a,b;const c=this.textEditor.getRenderingText(),e=c.getBaseStyle(),h=[];for(let f=0;f<this.length;f++){const g=c.getCharacterStylesAt(this.offset+f);h.push({fontStyle:g.getFontStyleWithFallback(e),fontWeight:g.getFontWeightWithFallback(e),fontSize:g.getFontSizeWithFallback(e),color:d.base.modelColorToCharacterColor(g.getColorWithFallback(e)),
url:null!==(b=null===(a=g.getUrlText())||void 0===a?void 0:a.value)&&void 0!==b?b:null})}return h}getFontSizes(){const a=this.textEditor.getRenderingText(),b=a.getBaseStyle(),c=[];for(let e=0;e<this.length;e++){const d=a.getCharacterStylesAt(this.offset+e);c.push(d.getFontSizeWithFallback(b)*this.getScale())}return c}setAllParagraphProps(a){g.Check.notNull("props",a);a=this.setParagraphPropsI(this.textEditor.getRenderingText(),a,this.offset,this.length);this.textEditor.setRenderingText(a);return this}setParagraphProps(a){g.Check.notNull("props",
a);const b=this.getParagraphs();g.Check.eql("props.length",a.length,b.length);a=a.reduce((a,e,d)=>this.setParagraphPropsI(a,e,b[d].offset,b[d].length),this.textEditor.getRenderingText());this.textEditor.setRenderingText(a);return this}setParagraphPropsI(a,b,c,e){null!=b.alignment&&(a=a.setAlignment(c,c+e,kd(b.alignment)));null!=b.listType&&(a=a.setListType(c,c+e,ld(b.listType)));null!=b.indent&&(g.Check.nonNegative("indent",b.indent),a=a.setIndent(c,c+e,b.indent));return a}setAllCharacterProps(a){g.Check.notNull("props",
a);this.textEditor.setRenderingText(this.setCharacterPropsI(this.textEditor.getRenderingText(),a,0,this.length));return this}setCharacterProps(a){g.Check.notNull("props",a);g.Check.eql("props.length",a.length,this.length);a=a.reduce((a,c,e)=>this.setCharacterPropsI(a,c,e,1),this.textEditor.getRenderingText());this.textEditor.setRenderingText(a);return this}setCharacterPropsI(a,b,c,e){let h=X.TextModel.createEmptyCharacterStyleContainer();null!=b.fontWeight&&(h=h.setFontWeight(b.fontWeight));null!=
b.fontSize&&(h=h.setFontSize(b.fontSize));null!=b.fontStyle&&(h=h.setFontStyle(b.fontStyle));null!=b.color&&(g.Check.rgb("character color",b.color),h=h.setColor(d.base.characterColorToModelColor(b.color)));void 0!==b.url&&(h=h.setUrlText({value:b.url}).setUnderline(null==b.url?0:1));return a.applyStyles(this.offset+c,this.offset+c+e,h,!1)}resetCharacterProps(){const a=this.textEditor.getRenderingText();this.textEditor.setRenderingText(a.resetStyles(this.offset,this.offset+this.length));return this}markUrls(a){a=
f.CetModel.urlMarker.markUrlsInText(this._textEditor.getRenderingText(),this.offset,this.length,a);this.textEditor.setRenderingText(a)}};ea.ParagraphEditorImpl=class extends ea.TextRangeEditorImpl{constructor(a,b,c){super(a,a.getRenderingText().getParagraphStartOffset(b),a.getRenderingText().getParagraph(b).getText().length,c);this.paragraphIndex=b}getParagraphProps(){var a=this.textEditor.getRenderingText().getParagraph(this.paragraphIndex),b=jd(a.getAlignment()),c=a.getIndent();a:switch(a=a.getListType(),
a){case X.ListType.BULLET:a=d.base.TextListType.Bullet;break a;case X.ListType.NONE:a=d.base.TextListType.None;break a;default:throw Error("Unexpected object: "+a);}return{alignment:b,indent:c,listType:a}}};ea.BaseTextEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e,h){super(d.base.ObjectKind.text,a,b,c,e);this.assetLoaderProvider=h;this._version=this.offset=0}get version(){return this._version}get virtualLength(){return this.getText().length}get realLength(){return this.virtualLength-
1}get length(){return this.virtualLength}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get wrapWidth(){return 0>this.getRenderingText().getWrapWidth()?0:this.getRenderingText().getWrapWidth()*this.getScale()}set wrapWidth(a){g.Check.nonNegative("wrapWidth",a);const b=this.minWrapWidth;0<a&&a<b&&(a=b);this.setRenderingText(this.getRenderingText().setWrapWidth(a/this.getScale()))}get minWrapWidth(){return this.getRenderingText().getMinWrapWidth()*
this.getScale()}get lineCount(){return this.getRenderingText().getLineCount()}getLineMetrics(a){var b=this.getRenderingText();g.Check.range("lineIndex",a,0,b.getLineCount()-1);a=b.getLineMetrics(a);b=this.getScale();return{ascent:a.ascent*b,descent:a.descent*b,lineGap:a.lineGap*b,height:a.height*b}}get glyphBox(){return this.baseObjectCommander.getLayoutBox(this.getParentEditor().referenceFrame,this.ctx.mscene,this.wrapper.getEntity(),l.TextBoundsOptions.Glyphs)}get textBox(){return this.baseObjectCommander.getLayoutBox(this.getParentEditor().referenceFrame,
this.ctx.mscene,this.wrapper.getEntity(),l.TextBoundsOptions.TextBox)}get font(){var a=this.ctx.mscene;const b=m.CetModelEditorInternal.createStyleEditor(a);a=K.FontDefinitionCache.lookupFontDescription(a,b.getFontFamily(this.wrapper));return null==a?null:K.FontUtils.createFont(this.assetLoaderProvider,a)}set font(a){g.Check.notNull("font",a);if(!a.downloaded)throw new g.IllegalArgumentException(`Font '${a.fontFamily}' is not downloaded, use the assetManager to download the font first`);m.CetModelEditorInternal.createStyleEditor(this.ctx.mscene).setFontDescription(this.wrapper,
a);this.invokeTextFixer()}set colorFilter(a){a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}set textStyle(a){this.resetStyleDontTriggerSystems(new N.StyleEditorImpl(this.ctx.mscene));l.Cet.setStyleClass(this.wrapper.getEntity(),a);this.invokeTextFixer()}get textStyle(){return l.Cet.getStyleClass(this.wrapper.getEntity())}static insert(a,b){const c=a.mscene.generateEntityId();b=f.CetModel.textKludge.createText(c,
b,a.mscene,a.mscene.getPreziW().toIPdom());a.mscene.getPreziW().getMutableZObjects().add(b);m.CetModelEditorInternal.createStyleEditor(a.mscene).updateFontToSupportCurrentLanguage(b);return b}getTextRange(a,b){if(null==a&&null==b)return this;this.checkSubRange(a,b);return new ea.TextRangeEditorImpl(this,a,b,()=>this.getScale())}addText(a,b=this.virtualLength-1){g.Check.notNull("text",a);this.checkSubRangeWithRealLength(b,0);return this.setText(a,b,0)}setText(a,b=this.offset,c=this.virtualLength-b){g.Check.notNull("text",
a);const e=a.length;b+c===this.virtualLength&&(c--,a.endsWith("\n")&&(a=a.substring(0,a.length-1)));this.checkSubRangeWithRealLength(b,c);this.setRenderingText(this.getRenderingText().replaceText(b,b+c,a));return new ea.TextRangeEditorImpl(this,b,e,()=>this.getScale())}clearText(a=this.offset,b=this.virtualLength-1){this.checkSubRangeWithRealLength(a,b);this.setRenderingText(this.getRenderingText().deleteText(a,a+b))}removeParagraph(a){const b=this.getRenderingText();g.Check.range("paragraphIndex",
a,0,b.getParagraphCount()-1);const c=b.getParagraphStartOffset(a),e=b.getParagraph(a).getLength();1===b.getParagraphCount()?this.clearText():0===a?this.clearText(c,e+1):this.clearText(c-1,e+1)}getText(){return this.getRenderingText().getRawText()+"\n"}getParagraphs(){return this.getAllTextRange().getParagraphs()}getCharacterProps(){return this.getAllTextRange().getCharacterProps()}getFontSizes(){return this.getAllTextRange().getFontSizes()}setParagraphProps(a){this.getAllTextRange().setParagraphProps(a)}setAllParagraphProps(a){this.getAllTextRange().setAllParagraphProps(a)}setCharacterProps(a){this.getAllTextRange().setCharacterProps(a)}setAllCharacterProps(a){this.getAllTextRange().setAllCharacterProps(a)}resetCharacterProps(){this.getAllTextRange().resetCharacterProps()}getRenderingText(){return l.Cet.shapedText(this.wrapper.getEntity())}setRenderingText(a){this.setRenderingTextDontTriggerSystems(a);
this.invokeTextFixer()}setRenderingTextDontTriggerSystems(a){this.virtualLength!==a.getLength()+1&&(this._version++,this.allTextRange=null);l.Cet.setText(this.wrapper.getEntity(),a,this.ctx.mscene)}get background(){return this.wrapper.getDisplayBackground()?Object.assign(Object.assign({},this.wrapper.getBackgroundColor().getRGBData()),{a:this.wrapper.getBackgroundAlpha()}):null}set background(a){null==a?this.toggleBackground(!1):(g.Check.rgba("text background",a),this.toggleBackground(!0),this.mutateBackgroundColor(a),
this.mutateBackgroundAlpha(a.a));this.invokeTextFixer()}toggleBackground(a){this.mutateBackgroundDisplay(a)}get backgroundCornerRadius(){return this.wrapper.getBackgroundCornerRadius()*this.getScale()}set backgroundCornerRadius(a){g.Check.range("backgroundCornerRadius",a,0,Math.min(this.textBox.size.width,this.textBox.size.height)/2);this.wrapper.setBackgroundCornerRadius(a/this.getScale())}getLongestWordLengthInLocal(){const a=new RegExp(/[^ \t\n]+/,"g");var b;let c=0;for(;null!=(b=a.exec(this.getRenderingText().getRawText()));){b=
b.index;const e=a.lastIndex;b=this.getRenderingText().getLayoutBoundsForRange(b,e).reduce((a,b)=>a+b.getWidth(),0);b>c&&(c=b)}return c}getLongestParagraph(){let a=0,b=null;this.getParagraphs().forEach((c)=>{var e=c.offset;const d=c.offset+c.length;e=this.getRenderingText().getLayoutBoundsForRange(e,d).reduce((a,b)=>a+b.getWidth(),0);e>a&&(a=e,b=c)});return{longestParagraph:b,lengthInLocal:a}}wrap(a,b){g.Check.positive("aspectRatio",a);this.wrapWidth=0;b?b=this.minWrapWidth:(b=this.getLongestWordLengthInLocal(),
b=0<b?(b+1)*this.getScale():this.minWrapWidth);const {longestParagraph:c,lengthInLocal:e}=this.getLongestParagraph();if(null!=c){var d=(e+1)*this.getScale(),f=e*this.getScale()/c.length/2,r=()=>{let a=this.layoutBox.size;return a.width/a.height};this.wrapWidth=b;if(!(r()>=a||(this.wrapWidth=d,r()<=a))){for(;d-b>f;){const c=(b+d)/2;this.wrapWidth=c;r()>a?d=c:b=c}this.wrapWidth=b;f=a-r();this.wrapWidth=d;a=r()-a;f<a&&(this.wrapWidth=b)}}}invokeTextFixer(){this.invokeTextFixerDontTriggerSystems()&&this.baseObjectCommander.updateWorldGeometryAndBounds(this.ctx)}invokeTextFixerDontTriggerSystems(){const a=
l.Cet.getZTextFixer(this.ctx.mscene);return null!=a&&a.fix(this.wrapper.getEntity())}checkSubRange(a,b){g.Check.range("offset",a,this.offset,this.offset+this.virtualLength);g.Check.range("length",b,0,this.offset+this.virtualLength-a)}checkSubRangeWithRealLength(a,b){g.Check.range("offset",a,this.offset,this.offset+this.realLength);g.Check.range("length",b,0,this.offset+this.realLength-a)}getAllTextRange(){null==this.allTextRange&&(this.allTextRange=this.getTextRange(this.offset,this.virtualLength));
return this.allTextRange}get isPlaceholder(){return this.wrapper.getIsPlaceholder()}set isPlaceholder(a){this.wrapper.setIsPlaceholder(a);this.baseObjectCommander.updateWorldGeometryAndBounds(this.ctx)}mutateBackgroundDisplay(a){this.logger.info({action:"modify",trigger:"click",object:"text",payload:{active_container:"overview",object_id:this.id,modified_value:"text-background",new_value:a.toString(),old_value:this.wrapper.getDisplayBackground().toString(),part:"0",prezi_mode:"editor"}});this.wrapper.setDisplayBackground(a)}mutateBackgroundColor(a){a=
wa.colorFromData("text background",a);this.logger.info({action:"modify",trigger:"click",object:"text",payload:{active_container:"overview",object_id:this.id,modified_value:"text-background-color",new_value:a.getRGBAString(),old_value:this.wrapper.getBackgroundColor().getRGBAString(),part:"0",prezi_mode:"editor"}});this.wrapper.setBackgroundColor(a)}mutateBackgroundAlpha(a){this.logger.info({action:"modify",trigger:"click",object:"text",payload:{active_container:"overview",object_id:this.id,modified_value:"text-background-alpha",
new_value:a+"",old_value:this.wrapper.getBackgroundAlpha()+"",part:"0",prezi_mode:"editor"}});this.wrapper.setBackgroundAlpha(a)}resetStyleDontTriggerSystems(a){super.resetStyleDontTriggerSystems(a);a=this.getRenderingText();let b=a.resetStyles(0,a.getLength()+1);for(let e=0;e<a.getLength();e++){var c=a.getCharacterStylesAt(e);c=b.getCharacterStylesAt(e).setFontSize(c.getFontSize()).setUrlText(c.getUrlText()).setUnderline(c.getUnderline());b=b.applyStyles(e,e+1,c,!0)}this.setRenderingTextDontTriggerSystems(b)}handleNonApiChangeDontTriggerSystems(){this.invokeTextFixerDontTriggerSystems()}getWordBoundaryToLeft(a){return this.getAllTextRange().getWordBoundaryToLeft(a)}getWordBoundaryToRight(a){return this.getAllTextRange().getWordBoundaryToRight(a)}get pointSize(){return this.localToRelative().transformRectangle(q.Geometry.rectangleFromData({x:0,
y:0,width:1,height:1})).getHeight()}set pointSize(a){g.Check.positive("pointSize",a);this.scale(a/this.pointSize)}markUrls(a){this.getAllTextRange().markUrls(a)}};ea.PluginTextEditorImpl=class extends ea.BaseTextEditorImpl{constructor(){super(...arguments);this.textHelper=m.CetModelEditorInternal.createTextHelper()}get hasSelection(){const a=this.selection;return null!=a&&null!=a.start&&null!=a.end}get selection(){return this.textHelper.getSelection(this.wrapper.getEntity())}get selectionStartOffset(){const a=
this.selection;return null!=a?a.start:null}get selectionEndOffset(){const a=this.selection;return null!=a?a.end:null}set selection(a){null==a&&(a={start:null,end:null});this.textHelper.setSelection(this.wrapper.getEntity(),this.ctx.mscene,a.start,a.end)}set caretOffset(a){this.textHelper.setCaretOffset(this.wrapper.getEntity(),a)}get caretOffset(){return this.textHelper.getCaretOffset(this.wrapper.getEntity())}set inEditFontSize(a){this.wrapper.getEntity().set(F.CetRendererModule.getInEditFontSizeComponentKey(),
a)}get inEditFontSize(){return this.wrapper.getEntity().get(F.CetRendererModule.getInEditFontSizeComponentKey())}updateFontToSupportCurrentLanguage(){return m.CetModelEditorInternal.createStyleEditor(this.ctx.mscene).updateFontToSupportCurrentLanguage(this.wrapper)}setTextWithStyle(a,b=0,c){b=this.setText(a.text,b,c);null!=a.characterPropss&&b.setCharacterProps(a.characterPropss)}getTextWithStyle(){return{text:this.getText(),characterPropss:this.getCharacterProps()}}};ea.TextEditorImpl=class extends ea.PluginTextEditorImpl{};
var wb={};Object.defineProperty(wb,"__esModule",{value:!0});wb.ShapeEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.shape,a,b,c,e);this.fillHelper=new ab.FillHelper(b);this.borderHelper=new ub.BorderHelper(b,()=>this.getScale(),()=>{this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])})}static insert(a,b,c,e,d){return m.CetModelEditorInternal.createEntityEditor(a.mscene).createShape(b,e,d,c)}get shapeKind(){const a=this.wrapper.getShapeType();
switch(a){case f.ShapeType.Oval:return"circle";case f.ShapeType.Rectangle:return"rectangle";case f.ShapeType.Triangle:return"triangle";default:throw Error(`invalid shape type ${a}`);}}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get width(){return this.wrapper.getWidth()*this.getScale()}get height(){return this.wrapper.getHeight()*this.getScale()}set width(a){g.Check.positive("width",a);a/=this.getScale();this.setWidth(a);"circle"===
this.shapeKind&&this.setHeight(a)}set height(a){g.Check.positive("height",a);a/=this.getScale();this.setHeight(a);"circle"===this.shapeKind&&this.setWidth(a)}setWidth(a){a!==this.wrapper.getWidth()&&(this.wrapper.setWidth(a),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}setHeight(a){a!==this.wrapper.getHeight()&&(this.wrapper.setHeight(a),this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id]))}set fill(a){this.fillHelper.setFill(a)}get fill(){return this.fillHelper.getFillNoRadial(!0)}get fills(){return{solidFill:this.fillHelper.getFillWithFillType(f.FillType.Solid,
!0),linearFill:this.fillHelper.getFillWithFillType(f.FillType.Linear,!0),current:this.fillHelper.getFillKind(),hasAlpha:!0}}setFillKind(a){this.fillHelper.setFillKind(a)}set colorFilter(a){a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}set shapeStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ShapeStyle)}get shapeStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),
d.base.ShapeStyle)}set filterStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ShapelikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),d.base.ShapelikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}set border(a){this.borderHelper.setBorder(a)}get border(){return this.borderHelper.getBorder()}get thickness(){return this.wrapper.getThickness()}set thickness(a){g.Check.positive("thickness",
a);this.wrapper.setThickness(a)}get cornerRadius(){return this.wrapper.getCornerRadius()/2}set cornerRadius(a){g.Check.finite("corner radius",a);this.wrapper.setCornerRadius(2*Math.max(0,Math.min(a,100)))}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",a);this.wrapper.setHyperlink(a)}};var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0});Ra.SlideEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.slide,a,b,
c,e)}static createAssetData(a){return k.DOM.createImmutablePdfAsset(a.assetSourceFilename,a.height,1,1,!1,null,a.offlineAssetId,a.onlineAssetId,a.url,a.page,0,0,!1,a.width)}static insert(a,b){var c=a.mscene.generateEntityId(),e=Ra.SlideEditorImpl.createAssetData(b.noBackgroundPdfAsset);const d=Ra.SlideEditorImpl.createAssetData(b.originalPdfAsset);e=k.DOM.createImmutableImportedPdfAsset(b.jobId,e,d,b.sourcePageNumber);c=k.DOM.createZSlide(c,e);c.setWidth(b.originalPdfAsset.width);c.setHeight(b.originalPdfAsset.height);
c.setOnlineAssetUrl(b.originalPdfAsset.url);c.setPageNumber(b.originalPdfAsset.page);c.setOfflineAssetId(b.originalPdfAsset.offlineAssetId);c.setAssetSourceFilename(b.originalPdfAsset.assetSourceFilename);c.setOnlineAssetId(b.originalPdfAsset.onlineAssetId);b=f.CetModel.ID.Z_SLIDE.inflate(a.mscene,c);a.mscene.getPreziW().getMutableZObjects().add(b);return b}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get slideAsset(){return{originalPdfAsset:{kind:d.base.AssetKind.pdf,
width:this.wrapper.getImportedAsset().getOriginalPdfAsset().getWidth(),height:this.wrapper.getImportedAsset().getOriginalPdfAsset().getHeight(),url:this.wrapper.getImportedAsset().getOriginalPdfAsset().getOnlineAssetUrl(),page:this.wrapper.getImportedAsset().getOriginalPdfAsset().getPageNumber(),assetSourceFilename:this.wrapper.getImportedAsset().getOriginalPdfAsset().getAssetSourceFilename(),offlineAssetId:this.wrapper.getImportedAsset().getOriginalPdfAsset().getOfflineAssetId(),onlineAssetId:this.wrapper.getImportedAsset().getOriginalPdfAsset().getOnlineAssetId()},
noBackgroundPdfAsset:{kind:d.base.AssetKind.pdf,width:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getWidth(),height:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getHeight(),url:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getOnlineAssetUrl(),page:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getPageNumber(),assetSourceFilename:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getAssetSourceFilename(),offlineAssetId:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getOfflineAssetId(),
onlineAssetId:this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getOnlineAssetId()},sourcePageNumber:this.wrapper.getImportedAsset().getSourcePageNumber(),jobId:this.wrapper.getImportedAsset().getImportJobId()}}get variant(){const a=this.wrapper.getOnlineAssetUrl();if(a===this.wrapper.getImportedAsset().getOriginalPdfAsset().getOnlineAssetUrl())return d.base.SlideVariant.Original;if(a===this.wrapper.getImportedAsset().getNoBackgroundPdfAsset().getOnlineAssetUrl())return d.base.SlideVariant.NoBackground;
throw Error("Active asset is invalid");}setAsset(a){this.wrapper.setOnlineAssetUrl(a.getOnlineAssetUrl());this.wrapper.setPageNumber(a.getPageNumber());this.wrapper.setOfflineAssetId(a.getOfflineAssetId());this.wrapper.setAssetSourceFilename(a.getAssetSourceFilename());this.wrapper.setOnlineAssetId(a.getOnlineAssetId());this.wrapper.setWidth(a.getWidth());this.wrapper.setHeight(a.getHeight())}set variant(a){g.Check.notNull("slideVariant",a);switch(a){case d.base.SlideVariant.NoBackground:this.setAsset(this.wrapper.getImportedAsset().getNoBackgroundPdfAsset());
break;case d.base.SlideVariant.Original:this.setAsset(this.wrapper.getImportedAsset().getOriginalPdfAsset());break;default:n.Utils.assertNever(a)}this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",a);this.wrapper.setHyperlink(a)}};var xb={};Object.defineProperty(xb,"__esModule",{value:!0});xb.VideoEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.video,
a,b,c,e)}getVideoAssetKind(){switch(this.wrapper.getVideoType()){case "video":return d.base.VideoAssetKind.uploadedToPrezi;case "youtube":return d.base.VideoAssetKind.youtube;case "vimeo":return d.base.VideoAssetKind.vimeo;default:throw Error("Unknown video type: "+this.wrapper.getVideoType());}}get letterboxYoutubeThumbnail(){return this.wrapper.getLetterboxYoutubeThumbnail()}set letterboxYoutubeThumbnail(a){g.Check.notNull("letterboxYoutubeThumbnail",a);this.wrapper.setLetterboxYoutubeThumbnail(a)}get videoAsset(){const a=
this.getVideoAssetKind();switch(a){case d.base.VideoAssetKind.uploadedToPrezi:return{kind:d.base.AssetKind.video,videoAssetKind:a,url:this.wrapper.getOnlineAssetUrl(),assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),onlineAssetId:this.wrapper.getOnlineAssetId()};case d.base.VideoAssetKind.youtube:return{kind:d.base.AssetKind.video,videoAssetKind:a,assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),
onlineAssetId:this.wrapper.getOnlineAssetId(),startTimeSec:this.wrapper.getStartTime()};case d.base.VideoAssetKind.vimeo:return{kind:d.base.AssetKind.video,videoAssetKind:a,assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),onlineAssetId:this.wrapper.getOnlineAssetId()};default:n.Utils.assertNever(a,`Unknown video asset kind: ${a}`)}}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}static insert(a,
b){var c=null;let e=null,h=null,g=null;switch(b.videoAssetKind){case d.base.VideoAssetKind.youtube:c="youtube";e=b.onlineAssetId;g=b.startTimeSec;break;case d.base.VideoAssetKind.uploadedToPrezi:c="video";h=b.url;break;default:n.Utils.assertNever(b)}const r=a.mscene.generateEntityId();c=k.DOM.createZVideo(r,c);c.setOnlineAssetId(e);c.setOnlineAssetUrl(h);c.setOfflineAssetId(b.offlineAssetId);c.setAssetSourceFilename(b.assetSourceFilename);c.setLetterboxYoutubeThumbnail(!1);c.setStartTime(g);b=f.CetModel.ID.Z_VIDEO.inflate(a.mscene,
c);a.mscene.getPreziW().getMutableZObjects().add(b);return b}};var yb={};Object.defineProperty(yb,"__esModule",{value:!0});yb.ZoomAreaEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.zoomArea,a,b,c,e)}static insert(a,b,c){const e=k.DOM.createZZoomArea(a.mscene.generateEntityId());e.setWidth(b.width);e.setHeight(b.height);e.setLocalToWorld(c);b=f.CetModel.ID.Z_ZOOM_AREA.inflate(a.mscene,e);a.mscene.getPreziW().getMutableZObjects().add(b);return b}get width(){return this.wrapper.getWidth()*
this.getScale()}get height(){return this.wrapper.getHeight()*this.getScale()}set width(a){g.Check.positive("width",a);a/=this.getScale();this.wrapper.setWidth(a);this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}set height(a){g.Check.positive("height",a);a/=this.getScale();this.wrapper.setHeight(a);this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}};var fa={};Object.defineProperty(fa,"__esModule",{value:!0});var qa;(function(a){a[a.Content=0]="Content";a[a.Visual=
1]="Visual";a[a.Cover=2]="Cover";a[a.Master=3]="Master";a[a.Surface=4]="Surface"})(qa=fa.InsertTarget||(fa.InsertTarget={}));class cb{constructor(a,b,c,e,d){this.baseEditorApi=a;this.ctx=b;this.baseObjectCommander=c;this.parentEntity=e;this.adderTarget=d}get topicChildrenEditor(){null==this._topicChildrenEditor&&(this._topicChildrenEditor=m.CetModelEditorInternal.createTopicChildrenEditor(this.ctx.mscene));return this._topicChildrenEditor}get entityEditor(){null==this._entityEditor&&(this._entityEditor=
m.CetModelEditorInternal.createEntityEditor(this.ctx.mscene));return this._entityEditor}insertChild(a){switch(this.adderTarget){case qa.Visual:this.topicChildrenEditor.addVisual(a.getId(),this.parentEntity.getId(),!0);break;case qa.Content:this.entityEditor.moveUnderParent(this.parentEntity.getId(),a.getId(),!0);break;case qa.Cover:this.topicChildrenEditor.add(a.getId(),this.parentEntity.getId(),l.TopicChildBehavior.Cover);break;case qa.Master:this.topicChildrenEditor.add(a.getId(),this.parentEntity.getId(),
l.TopicChildBehavior.Master);break;case qa.Surface:this.topicChildrenEditor.addSurface(a.getId(),this.parentEntity.getId(),!0);break;default:n.Utils.assertNever(this.adderTarget)}}addSimpleI(a){a=a.getEntity();this.insertChild(a);const b=this.baseEditorApi.lookup.object(a.getId());b.setTransform(q.Geometry.transform2dFromRad({x:0,y:0},1,0));this.baseObjectCommander.afterAdd(this.ctx,[a.getId()]);return b}text(a="body"){g.Check.notNull("textStyle",a);return this.addSimpleI(ea.TextEditorImpl.insert(this.ctx,
a))}arrow(a=d.base.ArcStyle.Line1){g.Check.notNull("arcStyle",a);return this.addSimpleI($a.ArcEditorImpl.insertArrow(this.ctx.mscene,a))}line(a=d.base.ArcStyle.Line1){g.Check.notNull("arcStyle",a);return this.addSimpleI($a.ArcEditorImpl.insertLine(this.ctx.mscene,a))}shape(a,b=d.base.ShapeStyle.Poly1){g.Check.notNull("shapeKind",a);g.Check.notNull("shapeStyle",b);return this.addSimpleI(wb.ShapeEditorImpl.insert(this.ctx,cb.getShapeKind(a),b,q.Geometry.transform2dIdentity(),cb.getDefaultShapeSize(a)))}bracketFrame(){return this.addSimpleI(vb.BracketFrameEditorImpl.insert(this.ctx,
q.Geometry.transform2dIdentity(),{width:d.PresetConstants.PRESET_BRACKET_FRAME_WIDTH,height:d.PresetConstants.PRESET_BRACKET_FRAME_HEIGHT}))}static getDefaultShapeSize(a){switch(a){case "circle":return{width:d.PresetConstants.PRESET_CIRCLE_RADIUS,height:d.PresetConstants.PRESET_CIRCLE_RADIUS};case "triangle":return{width:d.PresetConstants.PRESET_TRIANGLE_WIDTH,height:d.PresetConstants.PRESET_TRIANGLE_HEIGHT};case "rectangle":return{width:d.PresetConstants.PRESET_RECT_WIDTH,height:d.PresetConstants.PRESET_RECT_HEIGHT};
default:return n.Utils.assertNever(a)}}static getShapeKind(a){switch(a){case "circle":return f.ShapeType.Oval;case "triangle":return f.ShapeType.Triangle;case "rectangle":return f.ShapeType.Rectangle;default:return n.Utils.assertNever(a)}}image(a){g.Check.imageAsset("imageAsset",a);var b=this.ctx.mscene.generateEntityId();b=k.DOM.createZImage(b);b.setWidth(a.width);b.setHeight(a.height);b.setOnlineAssetUrl(a.url);b.setOfflineAssetId(a.offlineAssetId);b.setAssetSourceFilename(a.assetSourceFilename);
b.setOnlineAssetId(a.onlineAssetId);Fa.isActive("js-pdom-upgrade-show-placeholders-in-present-mode")&&b.setShowPlaceholderInPresentMode(!0);a=f.CetModel.ID.Z_IMAGE.inflate(this.ctx.mscene,b);this.ctx.mscene.getPreziW().getMutableZObjects().add(a);return this.addSimpleI(a)}animatedImage(a){g.Check.isSupportedDocumentGeneration(this.ctx.mscene.getPreziW(),f.DocumentGeneration.AnimatedImage);g.Check.animatedImageAsset("imageAsset",a);var b=this.ctx.mscene.generateEntityId();b=k.DOM.createZAnimatedImage(b,
a.mediaAssetId);b=f.CetModel.ID.Z_ANIMATED_IMAGE.inflate(this.ctx.mscene,b);this.ctx.mscene.getPreziW().getMutableZObjects().add(b);const c=l.Cet.mutableDraw(b.getEntity());c.kind===F.DrawComponentKind.animatedImage&&c.setAssetSize(a);return this.addSimpleI(b)}swf(a){g.Check.swfAsset("swfAsset",a);var b=this.ctx.mscene.generateEntityId();b=k.DOM.createZSwfGraphics(b);b.setWidth(a.width);b.setHeight(a.height);b.setOnlineAssetUrl(a.url);b.setOfflineAssetId(a.offlineAssetId);b.setAssetSourceFilename(a.assetSourceFilename);
b.setOnlineAssetId(a.onlineAssetId);a=f.CetModel.ID.Z_SWF_GRAPHICS.inflate(this.ctx.mscene,b);this.ctx.mscene.getPreziW().getMutableZObjects().add(a);return this.addSimpleI(a)}slide(a){g.Check.slideAsset("slideAsset",a);a=Ra.SlideEditorImpl.insert(this.ctx,a);return this.addSimpleI(a)}pdf(a){g.Check.pdfAsset("pdfAsset",a);return this.addSimpleI(Ja.PdfEditorImpl.insert(this.ctx,a))}chart(a){g.Check.chartAsset("chartAsset",a);var b=this.ctx.mscene.generateEntityId();b=k.DOM.createZChartPdf(a.chartId,
a.chartType,b);b.setWidth(a.width);b.setHeight(a.height);b.setOnlineAssetUrl(a.url);b.setOfflineAssetId(a.offlineAssetId);b.setAssetSourceFilename(a.assetSourceFilename);b.setOnlineAssetId(a.onlineAssetId);a=f.CetModel.ID.Z_CHART_PDF.inflate(this.ctx.mscene,b);this.ctx.mscene.getPreziW().getMutableZObjects().add(a);return this.addSimpleI(a)}video(a){g.Check.videoAsset("videoAsset",a);return this.addSimpleI(xb.VideoEditorImpl.insert(this.ctx,a))}zoomArea(){return this.addSimpleI(yb.ZoomAreaEditorImpl.insert(this.ctx,
{width:d.PresetConstants.PRESET_ZOOM_AREA_WIDTH,height:d.PresetConstants.PRESET_RECT_HEIGHT},q.Geometry.transform2dIdentity()))}inserter(a){a=g.Check.as("copyData",a,"CopyData",ca.CopyDataImpl);let b=this.getTargetParent();return new W.InserterImpl(this.baseEditorApi,b,a,this.ctx,this.baseObjectCommander)}getTargetParent(){switch(this.adderTarget){case qa.Content:return this.baseEditorApi.lookup.simpleObjectParent(this.parentEntity.getId());case qa.Cover:return this.baseEditorApi.lookup.topic(this.parentEntity.getId()).cover;
case qa.Visual:return this.baseEditorApi.lookup.topic(this.parentEntity.getId()).visual;case qa.Master:return this.baseEditorApi.lookup.topic(this.parentEntity.getId()).master;case qa.Surface:return this.baseEditorApi.lookup.planetTopic(this.parentEntity.getId()).surface}}group(a){g.Check.notNull("groupMembers",a);const b=this.getTargetParent();var c=a.filter((a)=>a.parent!==b);g.Check.assert(0===c.length,"Invalid group member(s): under different parent. Ids: "+c.map((a)=>a.id).join(","));c=[];for(let b of a)b instanceof
A.BaseEditorImpl&&b.is(d.base.ObjectKind.simpleObject)?c.push(b.wrapper):g.Check.failure("Invalid editor found. id: "+b.id+"; kind: "+b.kind);a=this.baseObjectCommander.groupManager.createGroup(this.ctx.mscene,c);return this.baseEditorApi.lookup.group(a)}}fa.SimpleAdderImpl=cb;class Kd{constructor(a,b,c,e){this.baseEditorApi=a;this.ctx=b;this.baseObjectCommander=c;this.baseTopicCommander=e}createSimpleAdder(a,b){return new cb(this.baseEditorApi,this.ctx,this.baseObjectCommander,a,b)}createAdder(a,
b,c){return new Sc(this.baseEditorApi,this.ctx,this.baseObjectCommander,this.baseTopicCommander,a,b,c)}createPageAdder(a,b){return new Tc(this.baseEditorApi,this.ctx,this.baseObjectCommander,this.baseTopicCommander,a,b)}}fa.AdderFactory=Kd;class Sc extends cb{constructor(a,b,c,e,d,f,g){super(a,b,c,d,f);this.baseTopicCommander=e;this.getSiblingCount=g}planet(a,b){null!=a&&g.Check.range("index",a,0,this.getSiblingCount());a=null==a?this.getSiblingCount():a;var c=this.baseEditorApi.lookup.topicParent(this.parentEntity.getId());
null==b&&(b=c.getThemeIdForNewSubtopic(a,d.base.ObjectKind.planetTopic));c=c.getLayoutIdForNewSubtopic(a);a=this.baseTopicCommander.insertPlanetTopic(this.baseEditorApi,this.ctx,this.parentEntity.getId(),a,b,c);this.baseObjectCommander.afterAddTopic(this.ctx,this.parentEntity.getId(),a);return this.baseEditorApi.lookup.planetTopic(a)}stack(a,b){null!=a&&g.Check.range("index",a,0,this.getSiblingCount());a=null==a?this.getSiblingCount():a;const c=this.baseEditorApi.lookup.topicParent(this.parentEntity.getId());
null==b&&(b=c.getThemeIdForNewSubtopic(a,d.base.ObjectKind.stackTopic));a=this.baseTopicCommander.insertStackTopic(this.baseEditorApi,this.ctx,this.parentEntity.getId(),a,b);this.baseObjectCommander.afterAddTopic(this.ctx,this.parentEntity.getId(),a);return this.baseEditorApi.lookup.stackTopic(a)}}fa.AdderImpl=Sc;class Tc{constructor(a,b,c,e,d,f){this.baseEditorApi=a;this.ctx=b;this.baseObjectCommander=c;this.baseTopicCommander=e;this.entityId=d;this.getSiblingCount=f}page(a){null!=a&&g.Check.range("index",
a,0,this.getSiblingCount());a=null==a?this.getSiblingCount():a;a=this.baseTopicCommander.insertPage(this.ctx,this.entityId,a);this.baseObjectCommander.afterAddTopic(this.ctx,this.entityId,a);return this.baseEditorApi.lookup.page(a)}inserter(a){a=g.Check.as("copyData",a,"CopyData",ca.CopyDataImpl);return new W.InserterImpl(this.baseEditorApi,this.baseEditorApi.lookup.stackTopic(this.entityId),a,this.ctx,this.baseObjectCommander)}}fa.PageAdderImpl=Tc;var Sa={createContentEditorForTopic:function(a,b,
c,e,d){return new Sa.ContentEditor(d,a,e,b.getEntity(),c,()=>l.Cet.createHierarchyQuery(a.mscene).getChildrenIds(b.getEntity()))}};Object.defineProperty(Sa,"__esModule",{value:!0});var ba;(function(a){a[a.Surface=0]="Surface";a[a.Master=1]="Master";a[a.Cover=2]="Cover";a[a.Visual=3]="Visual";a[a.Topic=4]="Topic";a[a.Content=5]="Content";a[a.Baseline=6]="Baseline";a[a.ChainLink=7]="ChainLink"})(ba||(ba={}));Sa.ContentEditor=class{constructor(a,b,c,e,d,f){this.editorCache=a;this.ctx=b;this.adderFactory=
c;this.parentEntity=e;this.baseObjectCommander=d;this.getChildEntityIds=f}createAdderForContent(){return this.adderFactory.createAdder(this.parentEntity,fa.InsertTarget.Content,()=>this.getTopicChildren().length)}createSimpleAdderForContent(){return this.adderFactory.createSimpleAdder(this.parentEntity,fa.InsertTarget.Content)}createSimpleAdderFor(a){switch(a){case d.base.ObjectKind.cover:return this.adderFactory.createSimpleAdder(this.parentEntity,fa.InsertTarget.Cover);case d.base.ObjectKind.visual:return this.adderFactory.createSimpleAdder(this.parentEntity,
fa.InsertTarget.Visual);case d.base.ObjectKind.master:return this.adderFactory.createSimpleAdder(this.parentEntity,fa.InsertTarget.Master);case d.base.ObjectKind.surface:return this.adderFactory.createSimpleAdder(this.parentEntity,fa.InsertTarget.Surface);default:n.Utils.assertNever(a)}}createPageAdderForStack(){return this.adderFactory.createPageAdder(this.parentEntity.getId(),()=>this.getPageChildren().length)}isContentKind(a,b){var c=m.CetModelEditorInternal.createTopicQuery(this.ctx.mscene);const e=
l.Cet.createTopicChildrenQuery(this.ctx.mscene);c=c.isContainerTopic(b);const d=e.hasBehavior(b,l.TopicChildBehavior.Visual),f=e.hasBehavior(b,l.TopicChildBehavior.Cover),g=e.hasBehavior(b,l.TopicChildBehavior.Master);b=e.hasBehavior(b,l.TopicChildBehavior.Surface);switch(a){case ba.Baseline:return!1;case ba.Topic:return c;case ba.Cover:return f;case ba.Visual:return d;case ba.ChainLink:return!1;case ba.Master:return g;case ba.Surface:return b;case ba.Content:return!c&&!d&&!f&&!g&&!b&&!0;default:throw Error(`Unknown contentKind: ${a}`);
}}getChildren(a){return this.getChildEntityIds().filter((b)=>this.isContentKind(a,b)).map((a)=>this.editorCache.object(a))}getChildrenFor(a){switch(a){case d.base.ObjectKind.cover:return this.getChildren(ba.Cover);case d.base.ObjectKind.visual:return this.getChildren(ba.Visual);case d.base.ObjectKind.master:return this.getChildren(ba.Master);case d.base.ObjectKind.surface:return this.getChildren(ba.Surface);default:n.Utils.assertNever(a)}}get contentChildren(){return this.getChildren(ba.Content)}getGroupsFor(a){switch(a){case d.base.ObjectKind.cover:return this.getGroups(H.GroupOwnerKind.cover);
case d.base.ObjectKind.visual:return this.getGroups(H.GroupOwnerKind.visual);case d.base.ObjectKind.master:return this.getGroups(H.GroupOwnerKind.master);case d.base.ObjectKind.surface:return this.getGroups(H.GroupOwnerKind.surface);default:n.Utils.assertNever(a)}}getGroups(a){var b=this.parentEntity.getMutableWrapper(f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic();if(null==b||!b.getEntity().isDef(f.CetModel.ID.HAS_TOPIC_GROUPS))return[];b=b.getEntity().getMutableWrapperChecked(f.CetModel.ID.HAS_TOPIC_GROUPS.W);
return this.baseObjectCommander.groupManager.getGroupsUnder(this.ctx.mscene,{wrapper:b,kind:a}).map((a)=>this.editorCache.group(a))}getTopicChildren(){return m.CetModelEditorInternal.createTopicQuery(this.ctx.mscene).getChildTopics(this.parentEntity.getId()).map((a)=>this.editorCache.topic(a))}getPageChildren(){return m.CetModelEditorInternal.createTopicQuery(this.ctx.mscene).getChildTopics(this.parentEntity.getId()).map((a)=>this.editorCache.page(a))}getReferenceFrame(){return this.baseObjectCommander.getReferenceFrame(this.parentEntity)}getZoomLayoutBox(){return this.baseObjectCommander.getZoomLayoutBox(this.ctx.mscene,
this.parentEntity)}};var $b={};Object.defineProperty($b,"__esModule",{value:!0});$b.GroupEditorImpl=class extends A.BaseEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.group,a,b,c);this.baseObjectCommander=e}get parent(){const a=this.baseObjectCommander.groupManager.getGroupDesignator(this.ctx.mscene,this.wrapper.getId());if(null==a)return null;switch(a.kind){case H.GroupOwnerKind.cover:return this.editorCache.lookup(a.wrapper.getEntity().getOwner().getId(),d.base.ObjectKind.topic).cover;
case H.GroupOwnerKind.visual:return this.editorCache.lookup(a.wrapper.getEntity().getOwner().getId(),d.base.ObjectKind.topic).visual;case H.GroupOwnerKind.master:return this.editorCache.lookup(a.wrapper.getEntity().getOwner().getId(),d.base.ObjectKind.topic).master;case H.GroupOwnerKind.surface:return this.editorCache.lookup(a.wrapper.getEntity().getOwner().getId(),d.base.ObjectKind.planetTopic).surface;case H.GroupOwnerKind.content:return a.wrapper.getEntity().isDef(f.CetModel.ID.OVERVIEW)?this.editorCache.lookup(a.wrapper.getId(),
d.base.ObjectKind.simpleObjectParent):this.editorCache.lookup(a.wrapper.getEntity().getOwner().getId(),d.base.ObjectKind.simpleObjectParent);default:n.Utils.assertNever(a)}}get members(){return this.baseObjectCommander.groupManager.getGroupMembers(this.ctx.mscene,this.wrapper.getId()).map((a)=>this.editorCache.lookup(a.getId(),d.base.ObjectKind.simpleObject))}get layoutGroup(){return new u.LayoutGroupImpl(this.ctx,this.editorCache,this.baseObjectCommander,this.members)}delete(){this.baseObjectCommander.groupManager.removeGroup(this.ctx.mscene,
this.wrapper.getId())}removeMember(a){g.Check.notNull("member",a);g.Check.assert(-1!==this.members.indexOf(a),"Given member should be a member of the group");a instanceof A.BaseEditorImpl?this.baseObjectCommander.groupManager.setGroupId(this.ctx.mscene,a.wrapper,null):g.Check.failure("Invalid member found. id: "+a.id+"; kind: "+a.kind)}};var ac={};Object.defineProperty(ac,"__esModule",{value:!0});ac.ImageEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e,h){super(d.base.ObjectKind.image,
a,b,c,h);this.imagePatcher=e}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get imageAsset(){return{kind:d.base.AssetKind.image,width:this.wrapper.getWidth(),height:this.wrapper.getHeight(),url:this.wrapper.getOnlineAssetUrl(),assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),onlineAssetId:this.wrapper.getOnlineAssetId()}}set imageAsset(a){g.Check.imageAsset("imageAsset",a);Ja.checkOfflineAssetIdReuse(this.imageAsset,
a);var b=null==this.wrapper.getOnlineAssetUrl();this.wrapper.setOnlineAssetUrl(a.url);null!=a.url?(this.wrapper.setHeight(a.height),this.wrapper.setWidth(a.width)):b&&(b=Math.max(this.wrapper.getHeight(),this.wrapper.getWidth()),this.wrapper.setHeight(b),this.wrapper.setWidth(b));this.wrapper.setOfflineAssetId(a.offlineAssetId);this.imagePatcher.canPatch(this.wrapper)&&this.imagePatcher.patchBack(this.wrapper);this.wrapper.setAssetSourceFilename(a.assetSourceFilename);this.wrapper.setOnlineAssetId(a.onlineAssetId);
this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",a);this.wrapper.setHyperlink(a)}set colorFilter(a){a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}set filterStyle(a){this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),a,d.base.ShapelikeFilterStyle,
d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get isPlaceholder(){return this.wrapper.getIsPlaceholder()}set isPlaceholder(a){g.Check.notNull("isPlaceholder",a);this.wrapper.setIsPlaceholder(a);Fa.isActive("js-pdom-upgrade-show-placeholders-in-present-mode")&&this.wrapper.setShowPlaceholderInPresentMode(!0)}get mask(){const a=
this.wrapper.getMask();return null==a?{x:0,y:0,width:this.imageAsset.width,height:this.imageAsset.height}:a.getData()}set mask(a){null==a?this.wrapper.setMask(null):(g.Check.range("x",a.x,0,this.imageAsset.width),g.Check.range("y",a.y,0,this.imageAsset.height),g.Check.positive("width",a.width),g.Check.range("width",a.width,0,this.imageAsset.width-a.x),g.Check.positive("height",a.height),g.Check.range("height",a.height,0,this.imageAsset.height-a.y),this.wrapper.setMask(q.Geometry.rectangleFromData(a)));
this.baseObjectCommander.updateWorldGeometryAndBounds(this.ctx)}};var bc={};Object.defineProperty(bc,"__esModule",{value:!0});bc.MarkerEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.marker,a,b,c,e)}get fill(){return Object.assign(Object.assign({},this.wrapper.getColor().getRGBData()),{a:this.wrapper.getAlpha()})}set fill(a){g.Check.rgba("fill",a);const b=wa.colorFromData("fill",a);this.wrapper.setColor(b);this.wrapper.setGradStartColor(b);this.wrapper.setGradEndColor(b);
this.wrapper.setAlpha(a.a)}};var db={};Object.defineProperty(db,"__esModule",{value:!0});db.BaseLayoutEditor=class{constructor(a,b,c){this.baseAdder=a;this.topicParentEditor=b;this.ctx=c;this.arrow=this.baseAdder.arrow.bind(this.baseAdder);this.line=this.baseAdder.line.bind(this.baseAdder);this.chart=this.baseAdder.chart.bind(this.baseAdder);this.group=this.baseAdder.group.bind(this.baseAdder);this.image=this.baseAdder.image.bind(this.baseAdder);this.swf=this.baseAdder.swf.bind(this.baseAdder);this.pdf=
this.baseAdder.pdf.bind(this.baseAdder);this.shape=this.baseAdder.shape.bind(this.baseAdder);this.bracketFrame=this.baseAdder.bracketFrame.bind(this.baseAdder);this.slide=this.baseAdder.slide.bind(this.baseAdder);this.text=this.baseAdder.text.bind(this.baseAdder);this.video=this.baseAdder.video.bind(this.baseAdder);this.animatedImage=this.baseAdder.animatedImage.bind(this.baseAdder);this.zoomArea=this.baseAdder.zoomArea.bind(this.baseAdder);this.add=this}planet(a,b){const c=this.topicParentEditor.topicChildren;
a=this.baseAdder.planet(a,b);this.positionTopic(a,c);this.applyLayout({kind:d.base.TopicLayoutEventKind.adjust,topics:[a]});return a}stack(a,b){const c=this.topicParentEditor.topicChildren;a=this.baseAdder.stack(a,b);this.positionTopic(a,c);this.applyLayout({kind:d.base.TopicLayoutEventKind.adjust,topics:[a]});return a}adjust(a){g.Check.notNull("children",a);g.Check.assert(null!=a&&a.every((a)=>a.parent===this.topicParentEditor),"children should be under same parent");this.applyLayout({kind:d.base.TopicLayoutEventKind.adjust,
topics:a})}reset(){this.applyLayout({kind:d.base.TopicLayoutEventKind.reset})}delete(a){0<a.length&&(this.applyLayout({kind:d.base.TopicLayoutEventKind.remove,toBeRemoved:[...a.filter(d.base.editorIs(d.base.ObjectKind.topic))]}),a[0].createLayoutGroupWith(a.slice(1)).delete())}inserter(a){const b=this,c=this.baseAdder.inserter(a);return new class{insert(a){if(c.isValid()){const e=[...b.topicParentEditor.topicChildren];a=c.insert(a);const f=m.CetModelEditorInternal.createPositionFinder(b.ctx.mscene,
null);a.topics.forEach((a)=>{let b=f.findTopicPosition(a,e);a.fitInto(b);e.push(a)});b.applyLayout({kind:d.base.TopicLayoutEventKind.adjust,topics:a.topics});return a}throw Error("inserter not valid");}isValid(){return c.isValid()}}}positionTopic(a,b){b=(new ja.TopicPositionFinder).findTopicPosition(a.parent,a.index,b);a.fitInto(b)}};var la={};Object.defineProperty(la,"__esModule",{value:!0});la.TemplateBasedTopicThemeId=class{constructor(a,b){this.ctx=a;this.template=b;g.Check.notNull("ctx",this.ctx);
g.Check.notNull("template",this.template)}apply(a,b){this.copyPrevious(a,this.ctx.mscene,b.id,this.template.id);b.is(d.base.ObjectKind.planetTopic)&&this.template.is(d.base.ObjectKind.planetTopic)&&null!=this.template&&null!=this.template.layout.id&&b.applyLayout(this.template.layout.id)}fixZorderOfCoverlikes(a,b,c,e,d){function*h(a){yield*a}b=l.Cet.sortInZOrder(b).map((b)=>{b=a.getBehavior(b.getId());switch(b){case l.TopicChildBehavior.Cover:return"COVER";case l.TopicChildBehavior.Visual:return"VISUAL";
case l.TopicChildBehavior.Surface:return"SURFACE";case l.TopicChildBehavior.Content:throw Error("Content objects shouldn't appear here");case l.TopicChildBehavior.Master:throw Error("Master objects shouldn't appear here");default:n.Utils.assertNever(b)}});const f=h(c),g=h(e),k=h(d);return b.map((a)=>{switch(a){case "COVER":return g.next().value;case "VISUAL":return f.next().value;case "SURFACE":return k.next().value;default:n.Utils.assertNever(a)}})}copyPrevious(a,b,c,e){const h=m.CetModelEditorInternal.createEntityEditor(b),
g=m.CetModelEditorInternal.createTopicChildrenEditor(b),r=a.lookup.topic(c),k=a.lookup.topic(e);null!=k.coverLayoutId&&(r.coverLayoutId=k.coverLayoutId);var w=b.getEntityById(e),z=l.Cet.createBoundsCalculator(b),x=z.getWorldBoundsForLayout(e,l.TextBoundsOptions.Visible).getObb();z=z.getWorldBoundsForLayout(c,l.TextBoundsOptions.Visible).getObb();const t=d.CetModelEditor.getTransformBetweenAreas(x,z);let q,u;z=g.getChildrenIds(e,l.TopicChildBehavior.Visual).filter((b)=>d.CetModelEditor.isTopicShapeObjectKILLME(a.lookup.simpleObject(b)));
q=l.Cet.sortInZOrder(z.map((a)=>b.getEntityById(a)));var v=g.getChildrenIds(w.getId(),l.TopicChildBehavior.Surface).filter((b)=>d.CetModelEditor.isTopicShapeObjectKILLME(a.lookup.simpleObject(b)));u=l.Cet.sortInZOrder(v.map((a)=>b.getEntityById(a)));g.getChildrenIdsVisibleOutside(c).filter((b)=>d.CetModelEditor.isTopicShapeObjectKILLME(a.lookup.simpleObject(b))).forEach((a)=>h.removeZObjects([a],{allowRemoveVisual:!0}));w=l.Cet.sortInZOrder([...g.getChildrenIds(c,l.TopicChildBehavior.Content),...g.getChildrenIdsVisibleOutside(c).filter((b)=>
!d.CetModelEditor.isTopicShapeObjectKILLME(a.lookup.simpleObject(b)))].map((a)=>b.getEntityById(a)));w=b.getPreziW().getZObjects().indexOf((0<w.length?w[0]:b.getEntityById(c)).getWrapper(f.CetModel.ID.Z_OBJECT.W));e=b.dup(q.map((a)=>b.getEntityById(a.getId())));x=b.dup(u.map((a)=>b.getEntityById(a.getId())));z=this.fixZorderOfCoverlikes(g,[...z,...v].map((a)=>b.getEntityById(a)),e,[],x);v=b.getPreziW();for(let a=z.length-1;0<=a;--a){const c=z[a];v.getMutableZObjects().insert(w,b.getEntityById(c.getId()).getMutableWrapper(f.CetModel.ID.Z_OBJECT.W))}e.forEach((a,
e)=>{this.updateTransform(a.getId(),t,b);g.addVisual(a.getId(),c,!1);const d=q[e].getId();e=k.visual.contentChildren.find((a)=>a.id===d);if(null!=e&&null!=e.visualLayoutRole){const b=a.getId();a=r.visual.contentChildren.find((a)=>a.id===b);null!=a&&(a.visualLayoutRole=e.visualLayoutRole)}});k.is(d.base.ObjectKind.planetTopic)&&x.forEach((a,e)=>{this.updateTransform(a.getId(),t,b);r.is(d.base.ObjectKind.planetTopic)?g.addSurface(a.getId(),c,!1):g.addVisual(a.getId(),c,!1);const h=u[e].getId();e=k.surface.contentChildren.find((a)=>
a.id===h);if(null!=e&&null!=e.surfaceLayoutRole){const b=a.getId();if(r.is(d.base.ObjectKind.planetTopic))a=r.surface.contentChildren.find((a)=>a.id===b),null!=a&&(a.surfaceLayoutRole=e.surfaceLayoutRole);else if(a=r.visual.contentChildren.find((a)=>a.id===b),null!=a)switch(e.surfaceLayoutRole){case d.base.SurfaceLayoutRole.surfaceTopicShape:a.visualLayoutRole=d.base.VisualLayoutRole.topicShape;break;case d.base.SurfaceLayoutRole.none:a.visualLayoutRole=d.base.VisualLayoutRole.none;break;default:n.Utils.assertNever(e.surfaceLayoutRole)}}})}updateTransform(a,
b,c){a=c.getEntityById(a);c=l.Cet.transform(a).getLocalToWorld();null!=c&&l.Cet.setWorld(a,c.concat(b))}};la.NoTopicThemeIdImpl=class{apply(){}};la.CustomTopicThemeIdImpl=class{constructor(a,b){this.coverLayoutId=a;this.topicThemeApplicator=b}apply(a,b){null!=this.coverLayoutId&&(b.coverLayoutId=this.coverLayoutId,this.topicThemeApplicator.apply(this.coverLayoutId,a,b))}};la.ThemeAndLayoutHelper=class{constructor(a,b,c){this.ctx=a;this.topicParent=b;this.topicThemeApplicator=c}getLayoutIdForNewSubtopic(a){g.Check.range("idx",
a,0,this.topicParent.topicChildren.length);for(--a;0<=a;--a){const b=this.topicParent.topicChildren[a];if(b.is(d.base.ObjectKind.planetTopic)&&null!=b.layout.id&&"DefaultSlideLayout"!==b.layout.id&&"NoBackgroundSlideLayout"!==b.layout.id)return b.layout.id}return this.topicParent.is(d.base.ObjectKind.planetTopic)?this.topicParent.layout.id:null}hasTopicShape(a){return a.simpleChildren(d.base.ChildVisibilityKind.outside).some((a)=>d.CetModelEditor.isTopicShapeObjectKILLME(a))}getThemeIdForNewSubtopic(a,
b){g.Check.range("idx",a,0,this.topicParent.topicChildren.length);if(0===a)return this.getMostCommonCustomId();for(--a;0<=a;--a){const c=this.topicParent.topicChildren[a];if(c.kind===b&&this.hasTopicShape(c))return new la.TemplateBasedTopicThemeId(this.ctx,c)}return this.getMostCommonCustomId()}getMostCommonCustomId(){let a=[];this.topicParent.is(d.base.ObjectKind.topic)&&a.push(this.topicParent);a.push(...this.topicParent.topicChildren);if(0===a.length)return new la.NoTopicThemeIdImpl;let b=-Infinity;
const c={};let e=null;a.forEach((a)=>{a=a.coverLayoutId;null!=a&&(c[a]=null==c[a]?1:c[a]+1,c[a]>b&&(b=c[a],e=a))});return null==e?new la.NoTopicThemeIdImpl:new la.CustomTopicThemeIdImpl(e,this.topicThemeApplicator)}};var eb={};Object.defineProperty(eb,"__esModule",{value:!0});eb.OverviewLayoutImpl=class extends db.BaseLayoutEditor{constructor(a,b,c,e,d){super(b,c,e);this.baseEditorApi=a;this.overview=c;this.overviewLayouter=d}set id(a){g.Check.isSupportedDocumentGeneration(this.ctx.mscene.getPreziW(),
f.DocumentGeneration.OverviewAndContentLayout);const b=this.overview.wrapper;null==a?b.setOverviewLayoutInfo(null):b.setOverviewLayoutInfo(f.CetModel.ID.OVERVIEW_LAYOUT_BY_ID.inflate(this.ctx.mscene,k.DOM.createOverviewLayoutById(a)));this.reset()}get id(){const a=this.overview.wrapper.getOverviewLayoutInfo();return null!=a&&a.is(f.CetModel.ID.OVERVIEW_LAYOUT_BY_ID)?a.getOverviewLayoutById():null}isValid(){return null!=this.id?this.overviewLayouter.isValid(this.overview.layout.id,this.overview):!0}applyLayout(a){null!=
this.id&&this.overviewLayouter.apply(this.id,this.baseEditorApi,this,Object.assign(Object.assign({},a),{parent:this.overview}))}fitInto(a,b){null!=this.ctx.mscene.getAnimationScene()?(new Ca.AnimatedLayoutableEditorImpl(this.ctx,a)).fitInto(b):a.fitInto(b)}setWrapWidth(a,b){a.wrapWidth=b}wrap(a,b,c){a.wrap(b,c)}setBackground(a,b){a.toggleBackground(!0);a.backgroundCornerRadius=Math.min(a.layoutBox.size.height/2,a.layoutBox.size.width/2,b)}removeBackground(a){a.toggleBackground(!1)}fitSelectionBoxInto(a,
b){this.baseEditorApi.toDecorator(a).fitSelectionBoxInto(b)}getSelectionBox(a){return this.baseEditorApi.toDecorator(a).selectionBox}};eb.OverviewEditorImpl=class extends A.BaseEditorImpl{constructor(a,b,c,e,h,f,g,k){super(d.base.ObjectKind.overview,b,e,f);this.baseObjectCommander=h;this.contentEditor=new Sa.ContentEditor(this.editorCache,b,c,e.getEntity(),h,()=>l.Cet.createHierarchyQuery(b.mscene).getTopLevelEntities());this.add=this.contentEditor.createAdderForContent();this.layoutI=new eb.OverviewLayoutImpl(a,
this.add,this,b,k);this.themeAndLayoutHelper=new la.ThemeAndLayoutHelper(b,this,g)}get layout(){return this.layoutI}get contentChildren(){return this.contentEditor.contentChildren}get topicChildren(){return this.contentEditor.getTopicChildren()}kill(){this.add=this.contentEditor=this.wrapper=this.ctx=this.editorCache=null}get referenceFrame(){return this.contentEditor.getReferenceFrame()}get zoomLayoutBox(){return this.contentEditor.getZoomLayoutBox()}get minimumZoomArea(){const a=this.wrapper.getMinimumScale().transformRectangle(l.Cet.localBounds(this.wrapper.getEntity()).getGraphicsBounds());
return(new u.LayoutBoxImpl(new u.ReferenceFrameImpl(q.Geometry.transform2dIdentity()),q.Geometry.obbFromRect(a.getData()))).withReferenceFrame(this.referenceFrame)}fitInto(a){const b=g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl);g.Check.assert(0===a.rotationRad,"axis aligned layoutbox needed");a=b.relativeBounds.transform(b.referenceFrame.relativeToWorld);this.wrapper.setOverviewBounds(k.DOM.createImmutableFixedOverviewBounds(a.getBounds()));this.baseObjectCommander.updateWorldGeometryAndBounds(this.ctx)}applyLayout(a){this.layoutI.id=
a}get contentGroups(){return this.baseObjectCommander.groupManager.getGroupsUnder(this.ctx.mscene,{wrapper:this.wrapper,kind:H.GroupOwnerKind.content}).map((a)=>this.editorCache.group(a))}simpleChildren(a){switch(a){case d.base.ChildVisibilityKind.outside:return[];case d.base.ChildVisibilityKind.inside:return this.contentChildren;case d.base.ChildVisibilityKind.below:return[];case d.base.ChildVisibilityKind.outsideAndInside:return[];case d.base.ChildVisibilityKind.all:return this.contentChildren;
default:n.Utils.assertNever(a)}}getLayoutIdForNewSubtopic(a){return this.themeAndLayoutHelper.getLayoutIdForNewSubtopic(a)}getThemeIdForNewSubtopic(a,b){return this.themeAndLayoutHelper.getThemeIdForNewSubtopic(a,b)}};var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});Ka.TopicAndPageEditorImpl=class extends ca.ObjectEditorImpl{constructor(a,b,c,e,d,f,g){super(a,b,c,e,g);this.baseTopicCommander=d;this.contentEditor=f;this.editorCache=g}get index(){return m.CetModelEditorInternal.createTopicQuery(this.ctx.mscene).getChildTopics(this.getParentOrOverviewId()).indexOf(this.id)}set index(a){g.Check.range("index",
a,0,this.siblingCount()-1);g.Check.integer("index",a);this.baseTopicCommander.move(this.ctx,this.getParentOrOverviewId(),this.index,a)}get referenceFrame(){return this.contentEditor.getReferenceFrame()}get zoomLayoutBox(){return this.contentEditor.getZoomLayoutBox()}};Ka.TopicEditorImpl=class extends Ka.TopicAndPageEditorImpl{constructor(a,b,c,e,d,f,g,k,l){super(a,c,e,d,f,g,k);this.baseEditorApi=b;this.topicThemeApplicator=l}get cover(){return this.editorCache.cover(A.EditorId.create(A.EditorIdPrefix.cover,
this.wrapper.getId()))}get visual(){return this.editorCache.visual(A.EditorId.create(A.EditorIdPrefix.visual,this.wrapper.getId()))}get master(){return this.editorCache.master(A.EditorId.create(A.EditorIdPrefix.master,this.wrapper.getId()))}setParentAndFitInto(a,b){this.setParentI(a,b,!0)}setParentAndFitIntoDontMoveAnimations(a,b){this.setParentI(a,b,!1)}simpleChildren(a){switch(a){case d.base.ChildVisibilityKind.outside:return[...this.cover.contentChildren,...this.visual.contentChildren];case d.base.ChildVisibilityKind.inside:return[...this.visual.contentChildren,
...this.master.contentChildren];case d.base.ChildVisibilityKind.below:return[...this.visual.contentChildren,...this.master.contentChildren];case d.base.ChildVisibilityKind.outsideAndInside:return[...this.visual.contentChildren];case d.base.ChildVisibilityKind.all:return[...this.cover.contentChildren,...this.visual.contentChildren,...this.master.contentChildren];default:n.Utils.assertNever(a)}}fitZoomAreaIntoLayoutBox(a){const b=this.baseObjectCommander,c=this.zoomLayoutBox.topLeft,e=this.zoomLayoutBox.topRight,
d=a.topLeft;a=a.topRight;b.transformStuffButDontMoveChildren_KILLME_DONTUSE_USERELATIVETRANSFORMSINSTEADOF_THIS_HACK(this.ctx,[{entity:this.wrapper.getEntity(),sourceLayoutBox:this.zoomLayoutBox,targetLayoutBox:this.zoomLayoutBox.align(c,e,d,a),recursive:!1}]);b.updateWorldGeometryAndBounds(this.ctx)}fitSelectionBoxInto(a,b=!1){b?this.fitSelectionBoxIntoDontTriggerSystems(a,b):super.fitSelectionBoxInto(a)}fitSelectionBoxIntoDontTriggerSystemsI(a,b){const c=this.selectionBox.topLeft,e=this.selectionBox.topRight,
d=a.topLeft,f=a.topRight;this.baseObjectCommander.transformStuffButDontMoveChildren_KILLME_DONTUSE_USERELATIVETRANSFORMSINSTEADOF_THIS_HACK(this.ctx,b.map((a)=>({entity:a.wrapper.getEntity(),sourceLayoutBox:a.selectionBox,targetLayoutBox:a.selectionBox.align(c,e,d,f),recursive:!1})))}fitSelectionBoxIntoDontTriggerSystems(a,b=!1){b?(b=[this,...this.simpleChildren(d.base.ChildVisibilityKind.outside)],this.fitSelectionBoxIntoDontTriggerSystemsI(a,b)):super.fitSelectionBoxIntoDontTriggerSystems(a)}get coverLayoutId(){var a=
this.wrapper.getTopic();if(a.is(f.CetModel.ID.STACK_CHAPTER)||a.is(f.CetModel.ID.PLANET_CHAPTER))if(a=a.getCoverLayoutInfo(),null!=a&&a.is(f.CetModel.ID.COVER_LAYOUT_BY_ID))return a.getCoverLayoutId();return null}set coverLayoutId(a){const b=this.wrapper.getMutableTopic();(b.is(f.CetModel.ID.STACK_CHAPTER)||b.is(f.CetModel.ID.PLANET_CHAPTER))&&b.setCoverLayoutInfo(null!=a?f.CetModel.ID.COVER_LAYOUT_BY_ID.inflate(this.ctx.mscene,k.DOM.createCoverLayoutById(a)):null)}get theme(){return new la.CustomTopicThemeIdImpl(this.coverLayoutId,
this.topicThemeApplicator)}applyTheme(a){a.apply(this.baseEditorApi,this)}};var Ta={};Object.defineProperty(Ta,"__esModule",{value:!0});Ta.ContentLayoutImpl=class{constructor(a,b,c,e,d){this.baseEditorApi=a;this.ctx=b;this.wrapper=c;this.topic=e;this.contentLayouter=d}set id(a){const b=this.wrapper.getMutableTopic();if(b.is(f.CetModel.ID.PLANET_CHAPTER)||b.is(f.CetModel.ID.PAGE))g.Check.isSupportedDocumentGeneration(this.ctx.mscene.getPreziW(),f.DocumentGeneration.OverviewAndContentLayout),null==
a?b.setContentLayoutInfo(null):b.setContentLayoutInfo(f.CetModel.ID.CONTENT_LAYOUT_BY_ID.inflate(this.ctx.mscene,k.DOM.createContentLayoutById(a))),this.contentLayouter.apply(a,this.baseEditorApi,{kind:d.base.TopicLayoutEventKind.reset,parent:this.topic})}get id(){var a=this.wrapper.getMutableTopic();return a.is(f.CetModel.ID.PLANET_CHAPTER)||a.is(f.CetModel.ID.PAGE)?(a=a.getContentLayoutInfo(),(null===a||void 0===a?0:a.is(f.CetModel.ID.CONTENT_LAYOUT_BY_ID))?a.getContentLayoutById():null):null}isValid(){return this.contentLayouter.isValid(this.id,
this.topic)}reset(){this.id=this.id}};class Ld extends db.BaseLayoutEditor{constructor(a,b,c,e,d){super(e,c,b);this.baseEditorApi=a;this.planetTopicEditor=c;this.topicLayouter=d}get id(){var a=this.planetTopicEditor.wrapper.getTopic();return a.is(f.CetModel.ID.PLANET_CHAPTER)&&(a=a.getInternalLayoutInfo(),null!=a&&a.is(f.CetModel.ID.INTERNAL_LAYOUT_BY_ID))?a.getInternalLayoutId():null}set id(a){const b=this.planetTopicEditor.wrapper.getMutableTopic();b.is(f.CetModel.ID.PLANET_CHAPTER)&&(null==a?b.setInternalLayoutInfo(null):
b.setInternalLayoutInfo(f.CetModel.ID.INTERNAL_LAYOUT_BY_ID.inflate(this.ctx.mscene,k.DOM.createInternalLayoutById(a))));this.reset()}isValid(){return null!=this.id?this.topicLayouter.isValid(this.id,this.planetTopicEditor):!0}applyLayout(a){null!=this.id&&this.topicLayouter.apply(this.id,this.baseEditorApi,this,Object.assign(Object.assign({},a),{parent:this.planetTopicEditor}))}fitInto(a,b){null!=this.ctx.mscene.getAnimationScene()?(new Ca.AnimatedLayoutableEditorImpl(this.ctx,a)).fitInto(b):a.fitInto(b)}fitZoomArea(a,
b){null!=this.ctx.mscene.getAnimationScene()?(new Ca.AnimatedLayoutableEditorImpl(this.ctx,a)).fitZoomAreaIntoLayoutBox(b):a.fitZoomAreaIntoLayoutBox(b)}}Ta.PlanetTopicEditorImpl=class extends Ka.TopicEditorImpl{constructor(a,b,c,e,h,f,g,k,l,z,x){super(d.base.ObjectKind.planetTopic,a,b,c,e,h,x,z,k);this.add=this.contentEditor.createAdderForContent();this.layoutI=new Ld(a,b,this,this.add,g);this.themeAndLayoutHelper=new la.ThemeAndLayoutHelper(b,this,k);this.contentLayoutI=new Ta.ContentLayoutImpl(a,
b,this.wrapper,this,l)}get surface(){return this.editorCache.surface(A.EditorId.create(A.EditorIdPrefix.surface,this.wrapper.getId()))}get contentLayout(){return this.contentLayoutI}applyContentLayout(a){this.contentLayoutI.id=a}applyLayout(a){this.layout.id=a}get contentChildren(){return this.contentEditor.contentChildren}get contentGroups(){const a=this.wrapper.getMutableTopic();return a.is(f.CetModel.ID.PLANET_CHAPTER)?this.baseObjectCommander.groupManager.getGroupsUnder(this.ctx.mscene,{wrapper:a,
kind:H.GroupOwnerKind.content}).map((a)=>this.editorCache.group(a)):[]}get topicChildren(){return this.contentEditor.getTopicChildren()}get parent(){return this.getParentEditor()}set parent(a){this.setParentI(a,null,!0)}setParentI(a,b,c){this.baseTopicCommander.moveTopic(this.ctx,this,a,b,c)}kill(){this.add=this.contentEditor=null;super.kill()}siblingCount(){return this.parent.topicChildren.length}setAsPlanetTemplate(){(new ta.SnippetEditorImpl(this.ctx.mscene)).updatePlanetSnippet(this.ctx.mscene,
this.id)}get layout(){return this.layoutI}simpleChildren(a){switch(a){case d.base.ChildVisibilityKind.outside:return[...this.cover.contentChildren,...this.visual.contentChildren,...this.surface.contentChildren];case d.base.ChildVisibilityKind.inside:return[...this.visual.contentChildren,...this.master.contentChildren,...this.surface.contentChildren,...this.contentChildren];case d.base.ChildVisibilityKind.outsideAndInside:return[...this.visual.contentChildren,...this.surface.contentChildren];case d.base.ChildVisibilityKind.below:return[...this.visual.contentChildren,
...this.master.contentChildren];case d.base.ChildVisibilityKind.all:return[...this.cover.contentChildren,...this.visual.contentChildren,...this.master.contentChildren,...this.surface.contentChildren,...this.contentChildren];default:n.Utils.assertNever(a)}}getLayoutIdForNewSubtopic(a){return this.themeAndLayoutHelper.getLayoutIdForNewSubtopic(a)}getThemeIdForNewSubtopic(a,b){return this.themeAndLayoutHelper.getThemeIdForNewSubtopic(a,b)}};var cc={};Object.defineProperty(cc,"__esModule",{value:!0});
cc.PageEditorImpl=class extends Ka.TopicAndPageEditorImpl{constructor(a,b,c,e,h,f,g,k){super(d.base.ObjectKind.page,b,c,e,h,new Sa.ContentEditor(k,b,f,c.getEntity(),e,()=>l.Cet.createHierarchyQuery(this.ctx.mscene).getChildrenIds(c.getEntity())),k);this.add=this.contentEditor.createSimpleAdderForContent();this.contentLayoutI=new Ta.ContentLayoutImpl(a,b,this.wrapper,this,g)}get contentLayout(){return this.contentLayoutI}applyContentLayout(a){this.contentLayoutI.id=a}get parent(){return this.editorCache.stackTopic(this.getParentId())}set parent(a){if(1===
this.parent.pageChildren.length)throw Error("Cannot remove last child of a stack topic");this.setParentNoLastCheck(a)}setParentNoLastCheck(a){this.baseTopicCommander.moveStackPage(this.ctx,this,a)}get contentChildren(){return this.contentEditor.contentChildren}get contentGroups(){const a=this.wrapper.getMutableTopic();return a.is(f.CetModel.ID.PAGE)?this.baseObjectCommander.groupManager.getGroupsUnder(this.ctx.mscene,{wrapper:a,kind:H.GroupOwnerKind.content}).map((a)=>this.editorCache.group(a)):[]}kill(){this.add=
this.contentEditor=null;super.kill()}delete(){if(1===this.parent.pageChildren.length)throw Error("Cannot remove last child of a stack topic");super.delete()}siblingCount(){return this.parent.pageChildren.length}copy(){var a=k.DOM.copyObjects(this.ctx.mscene.getPreziW().toIPdom(),[this.id]);a=k.DOM.createLocalSession(a,()=>{});a.fixInvariants();a=k.DOM.IPreziCopy().copyPrezi(a.getPrezi());return ca.CopyDataImpl.create(this.editorCache,this.zoomLayoutBox,a)}simpleChildren(a){switch(a){case d.base.ChildVisibilityKind.outside:return[];
case d.base.ChildVisibilityKind.inside:return this.contentChildren;case d.base.ChildVisibilityKind.below:return[];case d.base.ChildVisibilityKind.outsideAndInside:return[];case d.base.ChildVisibilityKind.all:return this.contentChildren;default:n.Utils.assertNever(a)}}};var dc={};Object.defineProperty(dc,"__esModule",{value:!0});class Md{constructor(a,b,c,e){this.baseEditorApi=a;this.ctx=b;this.stackTopicEditor=c;this.topicLayouter=e}get id(){var a=this.stackTopicEditor.wrapper.getTopic();return a.is(f.CetModel.ID.STACK_CHAPTER)&&
(a=a.getInternalLayoutInfo(),null!=a&&a.is(f.CetModel.ID.INTERNAL_LAYOUT_BY_ID))?a.getInternalLayoutId():null}set id(a){const b=this.stackTopicEditor.wrapper.getMutableTopic();b.is(f.CetModel.ID.STACK_CHAPTER)&&(null==a?b.setInternalLayoutInfo(null):b.setInternalLayoutInfo(f.CetModel.ID.INTERNAL_LAYOUT_BY_ID.inflate(this.ctx.mscene,k.DOM.createInternalLayoutById(a))));this.reset()}isValid(){return null!=this.id?this.topicLayouter.isValid(this.id,this.stackTopicEditor):!0}applyLayout(a){null!=this.id&&
this.topicLayouter.apply(this.id,this.baseEditorApi,this,Object.assign(Object.assign({},a),{parent:this.stackTopicEditor}))}fitInto(a,b){null!=this.ctx.mscene.getAnimationScene()?(new Ca.AnimatedLayoutableEditorImpl(this.ctx,a)).fitInto(b):a.fitInto(b)}reset(){this.applyLayout({kind:d.base.TopicLayoutEventKind.reset,parent:this.stackTopicEditor})}}dc.StackTopicEditorImpl=class extends Ka.TopicEditorImpl{constructor(a,b,c,e,h,f,g,k,l,z){super(d.base.ObjectKind.stackTopic,a,b,c,e,h,z,g,k);this.add=
this.contentEditor.createPageAdderForStack();this.layoutI=new Md(a,b,this,l)}get pageChildren(){return this.contentEditor.getPageChildren()}get parent(){return this.getParentEditor()}set parent(a){this.setParentI(a,null,!0)}setParentI(a,b,c){this.baseTopicCommander.moveTopic(this.ctx,this,a,b,c)}setAsStackTemplate(){(new ta.SnippetEditorImpl(this.ctx.mscene)).updateStackSnippet(this.ctx.mscene,this.id)}kill(){this.contentEditor=null;super.kill()}siblingCount(){return this.parent.topicChildren.length}applyLayout(a){this.layoutI.id=
a}get layout(){return this.layoutI}};var C={getPlaybackPathGenerationStrategyFromIPathGenerationStrategyW:function(a){if(a.is(f.CetModel.ID.VISIT_NONE))return d.base.PlaybackPathGenerationStrategy.OverviewAfterLastChild_TopicAfterLastChild;if(a.is(f.CetModel.ID.VISIT_OVERVIEW))return d.base.PlaybackPathGenerationStrategy.OverviewAfterEachChild_TopicAfterLastChild;if(a.is(f.CetModel.ID.VISIT_OVERVIEW_AND_PARENT))return d.base.PlaybackPathGenerationStrategy.OverviewAfterEachChild_TopicAfterEachChild;
if(a.is(f.CetModel.ID.VISIT_PARENT))return d.base.PlaybackPathGenerationStrategy.OverviewAfterLastChild_TopicAfterEachChild;if(a.is(f.CetModel.ID.LEGACY))return d.base.PlaybackPathGenerationStrategy.OverviewAfterEachChild;if(a.is(f.CetModel.ID.LEGACY_FINISH_ON_OVERVIEW))return d.base.PlaybackPathGenerationStrategy.OverviewAfterLastChild;throw Error("unknown path generation strategy");},shouldSkipStep:function(a,b){b=b.getComingFrom();return null!=b&&b.is(f.CetModel.ID.TOPIC_REF)?m.CetModelEditorInternal.createTopicQuery(a).getTopicKind(b.getTarget())===
d.TopicKind.Page:!1},getLabelledIdsInOrderI:function(a){const b=a.getPreziW();l.Cet.pathKludge.assertEditorPathV2(b);return Ec(a,b.getEditorPath()).filter((a)=>a.value.getEntity().isDef(f.CetModel.ID.HAS_TARGET)).map((a)=>a.value.getTarget())},createLabelMapI:function(a){var b=a.getPreziW();l.Cet.pathKludge.assertEditorPathV2(b);var c=b.getEditorPath();const e=E.createEntityIdToPlaybackPathPositionMap(b,a);var h=Ec(a,c);c=Ac(c);let g=Fa.isActive("js-frame-only-editor")?0:1;const k=new Map(h.map((a)=>
[a.value.getId(),e.has(a.value.getId())?g++:g]));b=(b,c)=>{const h=k.get(b.value.getId()),g=`${h}`;if(b.kind===Ga.step)if(c.kind===R.Visit&&b.value.is(f.CetModel.ID.FLY_TO_OBJECT_EP)){if(b=m.CetModelEditorInternal.createTopicQuery(a).getTopicKind(b.value.getTarget()),b===d.TopicKind.Planet||b===d.TopicKind.Stack)return c=c.back.wrapper.getId(),b=e.has(c),c=k.get(c)-(b?0:1),{outsideLabel:h>=c?g:`${h}-${c}`,insideLabel:g}}else if(c.kind===R.Root&&b.value.is(f.CetModel.ID.FLY_TO_OVERVIEW_EP))return{outsideLabel:null,
insideLabel:g};return{outsideLabel:g,insideLabel:null}};const D=(a,b)=>null==a?b:null==b?a:`${a}, ${b}`,w=new Map;for(const a of h){var z=c.get(a.value.getId());h=b(a,z);w.set(a.value.getId(),h);var x=a.value.getEntity();z.kind!==R.BackToParent&&x.isDef(f.CetModel.ID.HAS_TARGET)&&(z=a.value.getTarget(),x=w.get(z),w.set(z,null==x?h:{outsideLabel:D(x.outsideLabel,h.outsideLabel),insideLabel:D(x.insideLabel,h.insideLabel)}))}return w},createLabelMapFromApiI:function(a){a=g.Check.as("rapi",a,"BaseEditorApiImpl",
Z.BaseEditorApiImpl);return(0,C.createLabelMapI)(a.executionContext.mscene)}};Object.defineProperty(C,"__esModule",{value:!0});var R;(function(a){a.Root="Root";a.Visit="Visit";a.BackToParent="BackToParent";a.Free="Free"})(R||(R={}));class Uc extends A.BaseEditorImpl{constructor(a,b,c,e,d,f){super(a,b,c,e);this.pathManager=d;this.editorPathW=f}}C.StructuredPathEditorImpl=class extends Uc{constructor(a,b,c,e,h){super(d.base.ObjectKind.structuredPath,a,b,c,e,h)}get editorPath(){return this.editorCache.visitOverview(this.wrapper.getSteps().getAt(0).getId())}get playbackPathGenerationStrategy(){return(0,
C.getPlaybackPathGenerationStrategyFromIPathGenerationStrategyW)(this.wrapper.getPathGenerationStrategy())}set playbackPathGenerationStrategy(a){this.pathManager.setPlaybackPathGenerationStrategy(a)}get customStartPoint(){for(const a of Cc(this.wrapper))if(null!=a.value.getStartPointToken())return this.editorCache.pathElement(a.value.getId());return null}set customStartPoint(a){null==a?this.pathManager.setStartPoint(null):(a=g.Check.as("startPoint",a,"PathElementEditorImpl",zb),this.pathManager.setStartPoint(a.wrapper.getId()))}get pathElementsInOrder(){return Dc(this.ctx.mscene,
this.wrapper).map((a)=>this.editorCache.pathElement(a.value.getId()))}get viewPathElementsInOrder(){const a=d.CetModelEditor.createPathElementIdToPlaybackPathPositionMapFromScene(this.ctx.mscene);return this.pathElementsInOrder.filter((b)=>a.has(b.id))}get backgroundAudio(){return this.pathManager.getBackgroundAudio(this.wrapper.getSteps().getAt(0))}set backgroundAudio(a){this.pathManager.setBackgroundAudio(this.wrapper.getSteps().getAt(0),a)}};class zb extends Uc{constructor(a,b,c,e,d,f,g){super(a,
b,c,e,d,f);this.pathTreeNodeKind=g}getNarrative(){const a=this.wrapper.getNarrative();return null!=a&&a.is(f.CetModel.ID.PLAIN_TEXT_NARRATIVE)?a.getText():null}createPathNode(){const a=Ac(this.editorPathW).get(this.wrapper.getId());n.Utils.assert(a.kind===this.pathTreeNodeKind,`${this.kind} should be the ${this.pathTreeNodeKind} node but it is ${a.kind} node`);return a}}class ec{constructor(a,b,c,e){this.ctx=a;this.editorCache=b;this.pathManager=c;this.createPathParentNode=e}fadeIn(a,b,c){g.Check.notNull("targets",
b);g.Check.notNull("groupTargets",c);return this.editorCache.fadeIn(this.create(a,b,c,d.ActionType.FADE_IN))}fadeOut(a,b,c){g.Check.notNull("targets",b);g.Check.notNull("groupTargets",c);return this.editorCache.fadeOut(this.create(a,b,c,d.ActionType.FADE_OUT))}zoom(a,b){g.Check.notNull("target",b);return this.editorCache.zoom(this.create(a,[b],[],d.ActionType.ZOOM_TO))}create(a,b,c,e){const d=[],f=[];for(const a of b){g.Check.notNull("target",a);g.Check.notNull("target.id",a.id);if(null==this.ctx.mscene.getEntityById(a.id))throw new g.IllegalArgumentException(`Cannot create path action, because objecteditor with id #${a.id} was not found`);
d.push(a.id)}for(const a of c){g.Check.notNull("groupTarget",a);g.Check.notNull("groupTarget.id",a.id);if(null==this.ctx.mscene.getEntityById(a.id))throw new g.IllegalArgumentException(`Cannot create path action, because groupeditor with id #${a.id} was not found`);f.push(a.id)}c=this.createPathParentNode();g.Check.range("index",a,0,c.indexToStep.length-1);b=c.indexToStep[a];a=c.children[a];a=null!=a&&a.kind===R.Free?a.wrapper.getId():null;return this.pathManager.insertAnimation(d,f,b,e,a).getId()}kill(){xa.EditorUtils.invalidateEditor(this)}}
C.VisitOverviewEditorImpl=class extends zb{constructor(a,b,c,e,h){super(d.base.ObjectKind.visitOverview,a,b,c,e,h,R.Root);this.add=new ec(a,c,e,()=>this.createPathNode())}get title(){return y.I18n.ts("Overview")}get target(){return this.editorCache.overview(this.ctx.mscene.getPreziW().getOverview().getId())}get children(){return this.createPathNode().children.map((a)=>this.editorCache.pathChild(a.wrapper.getId()))}get narrative(){return this.getNarrative()}set narrative(a){this.pathManager.setNarrativeOnPathStep(this.wrapper,
a)}get audio(){return this.pathManager.getAudio(this.wrapper)}set audio(a){this.pathManager.setAudio(this.wrapper,a)}kill(){this.add.kill();super.kill()}};class fc extends zb{get index(){const a=this.createPathNode();return a.parent.children.indexOf(a)}set index(a){this.setIndex(a)}}C.VisitTopicEditorImpl=class extends fc{constructor(a,b,c,e,d,f){super(a,b,c,e,d,f,R.Visit);this.add=new ec(b,e,d,()=>this.createPathNode())}get title(){{var a=this.target;const b=d.CetModelEditor.calculatePageOrTopicTitle(a);
a=null!=b?b:a.parent.is(d.base.ObjectKind.overview)?y.I18n.ts("Untitled topic"):y.I18n.ts("Untitled subtopic")}return a}get parent(){var a=this.createPathNode();a=this.editorCache.pathParent(a.parent.wrapper.getId());return a.is(d.base.ObjectKind.visitOverview)?a:a.is(d.base.ObjectKind.visitPlanet)?a:Pb(a)}get narrative(){return this.getNarrative()}set narrative(a){this.pathManager.setNarrativeOnPathStep(this.wrapper,a)}get backToParent(){const a=this.createPathNode();return this.editorCache.backToParent(a.back.wrapper.getId())}setIndex(a){g.Check.range("targetIndex",
a,0,this.parent.children.length-1);const b=this.index;b<a&&a++;const c=this.createPathNode().parent;let e=0;for(var h=0;h<a;h++){var f=this.parent.children[h];(f.is(d.base.ObjectKind.visitPlanet)||f.is(d.base.ObjectKind.visitStack))&&e++}b<a&&e--;h=c.indexToStep[b+1];f=c.indexToStep[b];const k=[],l=[];for(var m=b+1;m<c.children.length;m++)if(c.children[m].kind===R.Free)k.push(c.children[m].wrapper.getId());else break;for(;a<c.children.length;a++)if(c.children[a].kind===R.Free)if(m=c.children[a].wrapper.getId(),
m=k.indexOf(m),0<=m){k.splice(m);break}else l.push(c.children[a].wrapper.getId());else if(a!==b)break;(0<l.length||0<k.length)&&this.pathManager.moveAnimations([{actionIds:k,toIPathStep:f,toIndex:f.getActions().length()},{actionIds:l,toIPathStep:h,toIndex:0}]);this.target.index!==e&&(this.target.index=e)}kill(){this.add.kill();super.kill()}};C.VisitPlanetEditorImpl=class extends C.VisitTopicEditorImpl{constructor(a,b,c,e,h){super(d.base.ObjectKind.visitPlanet,a,b,c,e,h)}get children(){return this.createPathNode().children.map((a)=>
this.editorCache.pathChild(a.wrapper.getId()))}get target(){return this.editorCache.planetTopic(this.wrapper.getTarget())}get audio(){return this.pathManager.getAudio(this.wrapper)}set audio(a){this.pathManager.setAudio(this.wrapper,a)}};C.VisitStackEditorImpl=class extends C.VisitTopicEditorImpl{constructor(a,b,c,e,h){super(d.base.ObjectKind.visitStack,a,b,c,e,h)}get children(){return this.createPathNode().children.map((a)=>this.editorCache.visitPage(a.wrapper.getId()))}get target(){return this.editorCache.stackTopic(this.wrapper.getTarget())}};
C.VisitPageEditorImpl=class extends fc{constructor(a,b,c,e,h){super(d.base.ObjectKind.visitPage,a,b,c,e,h,R.Visit);this.add=new ec(a,c,e,()=>this.createPathNode())}get title(){var a;return null!==(a=d.CetModelEditor.calculatePageOrTopicTitle(this.target))&&void 0!==a?a:0===this.target.index?y.I18n.ts("Untitled topic"):y.I18n.ts("Untitled page")}get parent(){const a=this.createPathNode();return this.editorCache.visitStack(a.parent.wrapper.getId())}get children(){return this.createPathNode().children.map((a)=>
this.editorCache.freePathChild(a.wrapper.getId()))}get target(){return this.editorCache.page(this.wrapper.getTarget())}get narrative(){return this.getNarrative()}set narrative(a){this.pathManager.setNarrativeOnPathStep(this.wrapper,a)}get audio(){return this.pathManager.getAudio(this.wrapper)}set audio(a){this.pathManager.setAudio(this.wrapper,a)}setIndex(a){this.target.index=a}kill(){this.add.kill();super.kill()}};C.BackToParentEditorImpl=class extends zb{constructor(a,b,c,e,h){super(d.base.ObjectKind.backToParent,
a,b,c,e,h,R.BackToParent)}get title(){return y.I18n.ts("Back to Parent")}get backFrom(){var a=this.createPathNode();a=this.editorCache.pathParent(a.parent.wrapper.getId());if(a.is(d.base.ObjectKind.visitPlanet)||a.is(d.base.ObjectKind.visitStack))return a;Pb(a)}get narrative(){return this.getNarrative()}set narrative(a){this.pathManager.setNarrativeOnPathStep(this.wrapper,a)}get backTo(){return this.backFrom.parent}get audio(){return this.pathManager.getAudio(this.wrapper)}set audio(a){this.pathManager.setAudio(this.wrapper,
a)}};class gc extends fc{constructor(a,b,c,e,d,f){super(a,b,c,e,d,f,R.Free)}get parent(){var a=this.createPathNode();a=this.editorCache.pathParent(a.parent.wrapper.getId());return a.is(d.base.ObjectKind.visitOverview)?a:a.is(d.base.ObjectKind.visitPlanet)?a:a.is(d.base.ObjectKind.visitPage)?a:Pb(a)}get narrative(){return this.getNarrative()}set narrative(a){this.pathManager.setNarrativeOnAction(this.wrapper,a)}delete(){this.logger.info({action:"delete",object:"animation",trigger:this.ctx.intent.trigger,
payload:{animation_type:this.wrapper.getEntity().getDef().getName()}});const a=this.createPathNode();this.pathManager.removeAnimation(a.step,a.wrapper,this.ctx.intent.trigger)}setIndex(a){g.Check.range("index",a,0,this.parent.children.length);const b=this.parent.createPathNode();a>this.index&&a++;const c=a-b.indexToStep.indexOf(b.indexToStep[a]);this.pathManager.moveAnimation(b.indexToStep[this.index],this.wrapper.getId(),b.indexToStep[a],c)}}class Ab extends gc{get title(){return Bc(this.targets,
this.groupTargets)}get targets(){return this.getTargetIds().map((a)=>this.editorCache.object(a))}get groupTargets(){return this.getTargetGroupIds().map((a)=>this.editorCache.group(a))}}class Ua{static createFadeInCopy(a,b,c){b=b.add.fadeIn(c,a.targets,a.groupTargets);b.narrative=a.narrative;return b}static createFadeOutCopy(a,b,c){b=b.add.fadeOut(c,a.targets,a.groupTargets);b.narrative=a.narrative;return b}static createZoomCopy(a,b,c){b=b.add.zoom(c,a.target);b.narrative=a.narrative;b.audio=a.audio;
return b}}C.FadeInEditorImpl=class extends Ab{constructor(a,b,c,e,h){super(d.base.ObjectKind.fadeIn,a,b,c,e,h)}getTargetIds(){return[this.wrapper.getTarget()]}getTargetGroupIds(){return[]}copyTo(a,b){return Ua.createFadeInCopy(this,a,b)}};C.FadeInsEditorImpl=class extends Ab{constructor(a,b,c,e,h){super(d.base.ObjectKind.fadeIn,a,b,c,e,h)}getTargetIds(){return this.wrapper.getTargets().items()}getTargetGroupIds(){return this.wrapper.getTargetGroups().items()}copyTo(a,b){return Ua.createFadeInCopy(this,
a,b)}};C.FadeOutEditorImpl=class extends Ab{constructor(a,b,c,e,h){super(d.base.ObjectKind.fadeOut,a,b,c,e,h)}getTargetIds(){return[this.wrapper.getTarget()]}getTargetGroupIds(){return[]}copyTo(a,b){return Ua.createFadeOutCopy(this,a,b)}};C.FadeOutsEditorImpl=class extends Ab{constructor(a,b,c,e,h){super(d.base.ObjectKind.fadeOut,a,b,c,e,h)}getTargetIds(){return this.wrapper.getTargets().items()}getTargetGroupIds(){return this.wrapper.getTargetGroups().items()}copyTo(a,b){return Ua.createFadeOutCopy(this,
a,b)}};C.ZoomObjectEditorImpl=class extends gc{constructor(a,b,c,e,h){super(d.base.ObjectKind.zoom,a,b,c,e,h)}get title(){const a=Bc([this.target],[]);return y.I18n.tsFormatKeys("Zoom to {object}",{object:a})}get target(){return this.editorCache.object(this.wrapper.getTarget())}set audio(a){this.pathManager.setPathActionAudio(this.wrapper,a)}get audio(){return this.pathManager.getPathActionAudio(this.wrapper)}copyTo(a,b){return Ua.createZoomCopy(this,a,b)}};C.ZoomOverviewEditorImpl=class extends gc{constructor(a,
b,c,e,h){super(d.base.ObjectKind.zoom,a,b,c,e,h)}get title(){const a=y.I18n.ts("Overview");return y.I18n.tsFormatKeys("Zoom to {object}",{object:a})}get target(){return this.editorCache.overview(this.ctx.mscene.getPreziW().getOverview().getId())}get audio(){return this.pathManager.getPathActionAudio(this.wrapper)}set audio(a){this.pathManager.setPathActionAudio(this.wrapper,a)}copyTo(a,b){return Ua.createZoomCopy(this,a,b)}};var Ga;(function(a){a.step="step";a.action="action"})(Ga||(Ga={}));var hc=
{};Object.defineProperty(hc,"__esModule",{value:!0});hc.SwfEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.swf,a,b,c,e)}get swfAsset(){return{kind:d.base.AssetKind.swf,width:this.wrapper.getWidth(),height:this.wrapper.getHeight(),url:this.wrapper.getOnlineAssetUrl(),assetSourceFilename:this.wrapper.getAssetSourceFilename(),offlineAssetId:this.wrapper.getOfflineAssetId(),onlineAssetId:this.wrapper.getOnlineAssetId()}}set swfAsset(a){g.Check.swfAsset("swfAsset",
a);this.wrapper.setOnlineAssetUrl(a.url);this.wrapper.setHeight(a.height);this.wrapper.setWidth(a.width);this.wrapper.setOfflineAssetId(a.offlineAssetId);this.wrapper.setAssetSourceFilename(a.assetSourceFilename);this.wrapper.setOnlineAssetId(a.onlineAssetId);this.baseObjectCommander.updateDocumentConsistency(this.ctx,[this.id])}get locked(){return this.wrapper.getLocked()}set locked(a){g.Check.notNull("locked",a);this.wrapper.setLocked(a)}get isPlaceholder(){return this.wrapper.getIsPlaceholder()}set isPlaceholder(a){g.Check.notNull("isPlaceholder",
a);this.wrapper.setIsPlaceholder(a)}set colorFilter(a){g.Check.isSupportedDocumentGeneration(this.ctx.mscene.getPreziW(),f.DocumentGeneration.SwfTint);a=G.colorFilterToPdom(a);this.wrapper.setColorFilter(a)}get colorFilter(){const a=this.wrapper.getColorFilter();return G.colorFilterFromPdom(a)}set filterStyle(a){g.Check.isSupportedDocumentGeneration(this.ctx.mscene.getPreziW(),f.DocumentGeneration.SwfTint);this.baseObjectCommander.setStyleClassFromEnum(this.editorCache,this.ctx,this.wrapper.getEntity(),
a,d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get filterStyle(){return l.Cet.getStyleClassFromEnum(this.wrapper.getEntity(),d.base.ShapelikeFilterStyle,d.base.ImageLikeFilterStyle,d.base.FullBlendShapelikeFilterStyle)}get hyperlink(){return this.wrapper.getHyperlink()}set hyperlink(a){g.Check.string("link",a);this.wrapper.setHyperlink(a)}};var ha={};Object.defineProperty(ha,"__esModule",{value:!0});ha.TopicPartEditor=class extends A.BaseEditorImpl{constructor(a,
b,c,e,d){super(a,b,c,d);this.contentEditor=e;this.add=e.createSimpleAdderFor(a)}getIdPrefix(){const a=this.kind;switch(a){case d.base.ObjectKind.cover:return A.EditorIdPrefix.cover;case d.base.ObjectKind.visual:return A.EditorIdPrefix.visual;case d.base.ObjectKind.master:return A.EditorIdPrefix.master;case d.base.ObjectKind.surface:return A.EditorIdPrefix.surface;default:n.Utils.assertNever(a)}}get parent(){return this.editorCache.topic(this.wrapper.getId())}get contentChildren(){return this.contentEditor.getChildrenFor(this.kind)}get referenceFrame(){return this.contentEditor.getReferenceFrame()}get zoomLayoutBox(){return this.contentEditor.getZoomLayoutBox()}get contentGroups(){return this.contentEditor.getGroupsFor(this.kind)}};
ha.VisualEditorImpl=class extends ha.TopicPartEditor{constructor(a,b,c,e){super(d.base.ObjectKind.visual,a,b,c,e)}};ha.CoverEditorImpl=class extends ha.TopicPartEditor{constructor(a,b,c,e){super(d.base.ObjectKind.cover,a,b,c,e)}};ha.MasterEditorImpl=class extends ha.TopicPartEditor{constructor(a,b,c,e){super(d.base.ObjectKind.master,a,b,c,e)}};ha.SurfaceEditorImpl=class extends ha.TopicPartEditor{constructor(a,b,c,e){super(d.base.ObjectKind.surface,a,b,c,e)}};var ic={};Object.defineProperty(ic,"__esModule",
{value:!0});ic.UnknownEditorImpl=class extends S.SimpleObjectEditorImpl{constructor(a,b,c,e){super(d.base.ObjectKind.unknownObject,a,b,c,e)}};var ra={getEditorPath:function(a){a=a.mscene.getPreziW();l.Cet.pathKludge.assertEditorPathV2(a);return a.getMutableEditorPath()}};Object.defineProperty(ra,"__esModule",{value:!0});const ma={create:(a)=>{throw Error("Unknown def: "+a.getDef().getName());},add:(a,b)=>Fc(ma,Array.isArray(a)?a:[a],b)};ra.EditorCache=class extends Xa.EditorCacheBase{constructor(a,
b,c,e,d,g,k,l,m,z,x){super();this.executionContext=a;this.baseEditorApi=b;this.adderFactory=c;this.baseObjectCommander=e;this.baseTopicCommander=d;this.imagePatcher=g;this.chartPatcher=k;this.pdfPatcher=l;this.behaviorExtensions=m;this.assetLoaderProvider=z;this.pathManager=x;this.cache=new Map;this.entityIdToIdsMap=new Map;null==ra.EditorCache.key&&(ra.EditorCache.key=f.CetModel.createComponentKey("editorcache",!1,!1,!1))}baseEditor(a){if(null==a)return null;let b=this.cache.get(a);if(null==b){const {prefix:e,
entityId:h}=A.EditorId.parse(a);var c=this.executionContext.mscene.getEntityById(h);if(null==c)return null;if(null==e)b=this.createBaseEditor(c);else switch(e){case A.EditorIdPrefix.visual:b=ma.add(f.CetModel.ID.Z_TOPIC_CONTAINER.W,(a)=>this.createVisualEditor(a)).create(c);break;case A.EditorIdPrefix.cover:b=ma.add(f.CetModel.ID.Z_TOPIC_CONTAINER.W,(a)=>this.createCoverEditor(a)).create(c);break;case A.EditorIdPrefix.surface:b=ma.add(f.CetModel.ID.Z_TOPIC_CONTAINER.W,(a)=>this.getTopicKind(a)===
d.TopicKind.Planet?this.createSurfaceEditor(a):ma.create(a.getEntity())).create(c);break;case A.EditorIdPrefix.master:b=ma.add(f.CetModel.ID.Z_TOPIC_CONTAINER.W,(a)=>this.createMasterEditor(a)).create(c)}null!=b&&(this.cache.set(a,b),c.hasComponent(ra.EditorCache.key,!0)||c.setComponent(ra.EditorCache.key,l.Cet.createDisposableComponent(()=>this.killById(h))),c=this.entityIdToIdsMap.get(h),null==c&&(c=new Set,this.entityIdToIdsMap.set(h,c)),c.add(a))}return b}lookup(a,b){return this.lookupI(a,b)}lookupI(a,
b){const c=this.baseEditor(a);if(null==c)return null;if(c.is(b))return c;throw this.invalidObjectKind(a,c,b);}findAll(a){return this.allBaseEditors().filter((b)=>null!=b&&b.is(a))}resolve(a){return this.lookupI(a.id,a.kind)}allBaseEditors(){const a=[this.baseEditorApi.background],b=(c)=>{null!=c&&(a.push(c),c.is(d.base.ObjectKind.simpleObjectParent)&&(a.push(...c.contentChildren),a.push(...c.contentGroups)),c.is(d.base.ObjectKind.topicParent)&&c.topicChildren.forEach(b),c.is(d.base.ObjectKind.topic)&&
(b(c.cover),b(c.visual),b(c.master)),c.is(d.base.ObjectKind.stackTopic)&&c.pageChildren.forEach(b),c.is(d.base.ObjectKind.planetTopic)&&b(c.surface))};b(this.baseEditorApi.overview);a.push(this.baseEditorApi.structuredPath);a.push(...this.baseEditorApi.structuredPath.pathElementsInOrder);return a}invalidObjectKind(a,b,c){const e=this.executionContext.mscene.getEntityById(a);if(null==e)throw Error(`Cannot create ${c} for an invalid reference ${a}, actual kind: ${b.kind}`);throw Error(`Cannot create ${c} for an ${e.getDef().getName()}, actual kind: ${b.kind}`);
}kill(){for(var a of this.cache.keys())this.cache.get(a).kill();this.cache.clear();a=[...this.entityIdToIdsMap.keys()];this.entityIdToIdsMap.clear();for(const b of a)a=this.executionContext.mscene.getEntityById(b),null!=a&&a.discardOwnComponent(ra.EditorCache.key)}killById(a){const b=this.entityIdToIdsMap.get(a);this.entityIdToIdsMap.delete(a);if(null!=b)for(const c of b)a=this.cache.get(c),null!=a&&(a.kill(),this.cache.delete(c))}createBaseEditor(a){return ma.add(f.CetModel.ID.Z_OBJECT.W,(a)=>this.createObjectEditor(a)).add(f.CetModel.ID.OVERVIEW.W,
(a)=>this.createOverviewEditor(a)).add(f.CetModel.ID.GROUP.W,(a)=>this.createGroupEditor(a)).add(f.CetModel.ID.BACKGROUND.W,(a)=>this.createBackgroundEditor(a)).add(f.CetModel.ID.BACKGROUND_LAYER.W,(a)=>this.createBackgroundLayerEditor(a)).add(f.CetModel.ID.EDITOR_PATH_V2.W,(a)=>this.createStructuredPathEditor(a)).add(f.CetModel.ID.EDITOR_PATH_STEP.W,(a)=>this.createStructuredPathElementEditorFromStep(a)).add(f.CetModel.ID.EDITOR_PATH_ACTION.W,(a)=>this.createStructuredPathElementEditorFromAction(a)).create(a)}createStructuredPathEditor(a){return new C.StructuredPathEditorImpl(this.executionContext,
a,this,this.pathManager,a)}createStructuredPathElementEditorFromStep(a){const b=(0,ra.getEditorPath)(this.executionContext);return null!=a.getComingFrom()?new C.BackToParentEditorImpl(this.executionContext,a,this,this.pathManager,b):ma.add(f.CetModel.ID.FLY_TO_OVERVIEW_EP.W,(a)=>new C.VisitOverviewEditorImpl(this.executionContext,a,this,this.pathManager,b)).add(f.CetModel.ID.FLY_TO_OBJECT_EP.W,(a)=>{switch(m.CetModelEditorInternal.createTopicQuery(this.executionContext.mscene).getTopicKind(a.getTarget())){case d.TopicKind.Page:return new C.VisitPageEditorImpl(this.executionContext,
a,this,this.pathManager,b);case d.TopicKind.Planet:return new C.VisitPlanetEditorImpl(this.executionContext,a,this,this.pathManager,b);case d.TopicKind.Stack:return new C.VisitStackEditorImpl(this.executionContext,a,this,this.pathManager,b);default:return ma.create(a.getEntity())}}).create(a.getEntity())}createStructuredPathElementEditorFromAction(a){const b=(0,ra.getEditorPath)(this.executionContext);return ma.add(f.CetModel.ID.FADE_IN_OBJECT_EP.W,(a)=>new C.FadeInEditorImpl(this.executionContext,
a,this,this.pathManager,b)).add(f.CetModel.ID.FADE_IN_OBJECTS_EP.W,(a)=>new C.FadeInsEditorImpl(this.executionContext,a,this,this.pathManager,b)).add(f.CetModel.ID.FADE_OUT_OBJECT_EP.W,(a)=>new C.FadeOutEditorImpl(this.executionContext,a,this,this.pathManager,b)).add(f.CetModel.ID.FADE_OUT_OBJECTS_EP.W,(a)=>new C.FadeOutsEditorImpl(this.executionContext,a,this,this.pathManager,b)).add(f.CetModel.ID.ZOOM_TO_OBJECT_EP.W,(a)=>new C.ZoomObjectEditorImpl(this.executionContext,a,this,this.pathManager,b)).add(f.CetModel.ID.ZOOM_TO_OVERVIEW_EP.W,
(a)=>new C.ZoomOverviewEditorImpl(this.executionContext,a,this,this.pathManager,b)).create(a.getEntity())}createGroupEditor(a){return new $b.GroupEditorImpl(this.executionContext,a,this,this.baseObjectCommander)}createOverviewEditor(a){return new eb.OverviewEditorImpl(this.baseEditorApi,this.executionContext,this.adderFactory,a,this.baseObjectCommander,this,this.behaviorExtensions.topicThemeApplicator,this.behaviorExtensions.overviewLayouter)}createObjectEditor(a){return ma.add(f.CetModel.ID.Z_OBJECT.W,
(a)=>this.createUnknownEditor(a)).add(f.CetModel.ID.Z_TEXT.W,(a)=>this.createTextEditor(a)).add(f.CetModel.ID.Z_RICH_TEXT.W,(a)=>this.createTextEditor(a)).add(f.CetModel.ID.Z_TOPIC_CONTAINER.W,(a)=>this.createTopicEditor(a)).add(f.CetModel.ID.Z_SHAPE.W,(a)=>this.createShapeEditor(a)).add(f.CetModel.ID.Z_BRACKET_FRAME.W,(a)=>this.createBracketFrameEditor(a)).add(f.CetModel.ID.Z_SLIDE.W,(a)=>this.createSlideEditor(a)).add(f.CetModel.ID.Z_MARKER.W,(a)=>this.createMarkerEditor(a)).add(f.CetModel.ID.Z_LINE.W,
(a)=>this.createArcEditor(a,d.base.ObjectKind.line)).add(f.CetModel.ID.Z_ARROW.W,(a)=>this.createArcEditor(a,d.base.ObjectKind.arrow)).add(f.CetModel.ID.Z_IMAGE.W,(a)=>this.createImageEditor(a)).add(f.CetModel.ID.Z_ANIMATED_IMAGE.W,(a)=>this.createAnimatedImageEditor(a)).add(f.CetModel.ID.Z_SWF_GRAPHICS.W,(a)=>this.createSwfEditor(a)).add(f.CetModel.ID.Z_PDF.W,(a)=>this.createPdfEditor(a)).add(f.CetModel.ID.Z_CHART_PDF.W,(a)=>this.createChartEditor(a)).add(f.CetModel.ID.Z_VIDEO.W,(a)=>this.createVideoEditor(a)).add(f.CetModel.ID.Z_ZOOM_AREA.W,
(a)=>this.createZoomAreaEditor(a)).create(a.getEntity())}createTextEditor(a){return new ea.TextEditorImpl(this.executionContext,a,this.baseObjectCommander,this,this.assetLoaderProvider)}createSlideEditor(a){return new Ra.SlideEditorImpl(this.executionContext,a,this.baseObjectCommander,this)}createShapeEditor(a){return new wb.ShapeEditorImpl(this.executionContext,a,this.baseObjectCommander,this)}createBracketFrameEditor(a){return new vb.BracketFrameEditorImpl(this.executionContext,a,this.baseObjectCommander,
this)}createMarkerEditor(a){return new bc.MarkerEditorImpl(this.executionContext,a,this.baseObjectCommander,this)}createArcEditor(a,b){return new $a.ArcEditorImpl(this.executionContext,a,this.baseObjectCommander,this,b)}createUnknownEditor(a){return new ic.UnknownEditorImpl(this.executionContext,a,this.baseObjectCommander,this)}createImageEditor(a){return new ac.ImageEditorImpl(this.executionContext,a,this.baseObjectCommander,this.imagePatcher,this)}createAnimatedImageEditor(a){return new Xb.AnimatedImageEditorImpl(this.executionContext,
a,this.baseObjectCommander,this)}createSwfEditor(a){return new hc.SwfEditorImpl(this.executionContext,a,this.baseObjectCommander,this)}createPdfEditor(a){return new Ja.PdfEditorImpl(this.executionContext,a,this.baseObjectCommander,this,this.pdfPatcher)}createChartEditor(a){return new Zb.ChartEditorImpl(this.executionContext,a,this.baseObjectCommander,this.chartPatcher,this)}createVideoEditor(a){return new xb.VideoEditorImpl(this.executionContext,a,this.baseObjectCommander,this)}createZoomAreaEditor(a){return new yb.ZoomAreaEditorImpl(this.executionContext,
a,this.baseObjectCommander,this)}createContentEditorForTopic(a){return Sa.createContentEditorForTopic(this.executionContext,a,this.baseObjectCommander,this.adderFactory,this)}createCoverEditor(a){return new ha.CoverEditorImpl(this.executionContext,a,this.createContentEditorForTopic(a),this)}createVisualEditor(a){return new ha.VisualEditorImpl(this.executionContext,a,this.createContentEditorForTopic(a),this)}createMasterEditor(a){return new ha.MasterEditorImpl(this.executionContext,a,this.createContentEditorForTopic(a),
this)}createSurfaceEditor(a){return new ha.SurfaceEditorImpl(this.executionContext,a,this.createContentEditorForTopic(a),this)}createTopicEditor(a){switch(this.getTopicKind(a)){case d.TopicKind.Planet:return new Ta.PlanetTopicEditorImpl(this.baseEditorApi,this.executionContext,a,this.baseObjectCommander,this.baseTopicCommander,this.adderFactory,this.behaviorExtensions.planetLayouter,this.behaviorExtensions.topicThemeApplicator,this.behaviorExtensions.contentLayouter,this,this.createContentEditorForTopic(a));
case d.TopicKind.Stack:return new dc.StackTopicEditorImpl(this.baseEditorApi,this.executionContext,a,this.baseObjectCommander,this.baseTopicCommander,this.adderFactory,this,this.behaviorExtensions.topicThemeApplicator,this.behaviorExtensions.stackLayouter,this.createContentEditorForTopic(a));case d.TopicKind.Page:return new cc.PageEditorImpl(this.baseEditorApi,this.executionContext,a,this.baseObjectCommander,this.baseTopicCommander,this.adderFactory,this.behaviorExtensions.contentLayouter,this);default:return ma.create(a.getEntity())}}getTopicKind(a){return m.CetModelEditorInternal.createTopicQuery(this.executionContext.mscene).getTopicKind(a.getId())}createBackgroundEditor(a){return new Yb.BackgroundEditorImpl(this.executionContext,
a,this)}createBackgroundLayerEditor(a){return new bb.BackgroundLayerEditorImpl(this.executionContext,this.baseObjectCommander,a,this)}};var Z={},fb=this&&Z.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{k(e.next(a))}catch(t){h(t)}}function g(a){try{k(e["throw"](a))}catch(t){h(t)}}function k(a){a.done?c(a.value):d(a.value).then(f,g)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(Z,"__esModule",
{value:!0});Z.EditorSessionImpl=class{constructor(a,b,c,e,d,f,g,k,l,m,x,t,n,q){this.scene=d;this.cetSession=f;this.saveEnabled=g;this.oid=k;this.rateLimitInMilliseconds=l;this.cetApp=q;this.actionQueue=[];this.timer=null;this.runner=new Ba.RunnerImpl(a,d,b,n);this._assetManager=new P.AssetManagerImpl(k,d,x,t,b,c,e,q.fontsLoadedStateHolder,m,q.getMainStage().getRenderer().getAssetManager());this.preziSaver=this.cetSession.getPreziSaver()}get assetManager(){return this._assetManager}execute(a){return this.rateLimit(()=>
fb(this,void 0,void 0,function*(){return this.runner.executeApiCommand({name:"EditorApi Command",run:(b)=>a(b)})}))}executeLegacyCmd(a){return this.rateLimit(()=>fb(this,void 0,void 0,function*(){return this.runner.executeLegacyCommand(a)}))}save(){return this.rateLimit(()=>fb(this,void 0,void 0,function*(){if(null!=this.saveEnabled){const a=yield this.preziSaver.save().toPromise();switch(a){case ob.SaveResult.Success:break;case ob.SaveResult.Error:throw Error("Save error.");case ob.SaveResult.ErrorExternalEdit:throw Error("Save error: merge conflict.");
default:throw Error(`Save error: unknown save result ${ob.SaveResult[a]}.`);}}else throw Error("Save error: not supported.");}))}parseCopyDataAsync(a){return m.CetModelEditorInternal.parseCopyDataAsync(this.cetApp,a)}toXml(){return k.DOM.saveXml(this.cetSession.getIPrezi())}getIPrezi(){return this.cetSession.getIPrezi()}rateLimit(a){const b=()=>{if(0<this.actionQueue.length&&!this.timer){const a=(new Date).getTime();this.timer=setTimeout(()=>fb(this,void 0,void 0,function*(){this.timer=null;const a=
this.actionQueue.pop();try{this.lastAction=(new Date).getTime(),yield a()}finally{b()}}),null==this.lastAction||a-this.lastAction>=this.rateLimitInMilliseconds?0:this.rateLimitInMilliseconds-(a-this.lastAction))}};return new Promise((c,e)=>{this.actionQueue.push(()=>fb(this,void 0,void 0,function*(){try{c(yield a())}catch(h){e(h)}}));b()})}read(a){return this.runner.read(a)}};Z.BaseEditorApiImpl=class{constructor(a,b,c,e,d,f){this.executionContext=a;this.imagePatcher=b;this.chartPatcher=c;this.pdfPatcher=
e;this.behaviorExtensions=d;this.assetLoaderProvider=f;this.baseObjectCommander=new Za.BaseObjectCommander;this.editorCache=this.createEditorCache();this.overview=this.editorCache.overview(this.executionContext.mscene.getPreziW().getOverview().getId());this.background=this.editorCache.background(this.executionContext.mscene.getPreziW().getBackground().getId());this.styleSheet=new v.StyleSheetEditorImpl(this.executionContext,this.editorCache,this.baseObjectCommander)}get structuredPath(){return this.editorCache.structuredPath(ra.getEditorPath(this.executionContext).getId())}tstoJson(){return this.executionContext.mscene.getPrezi().tstoJson()}get logo(){var a,
b=this.executionContext.mscene.getPreziW();const c=b.getLogo();b=b.getNextLogo();if(null!=b){if(b.is(f.CetModel.ID.NEXT_LOGO_V1))return{logoKind:d.base.LogoKind.next,asset:{kind:d.base.AssetKind.logo,url:b.getOnlineAssetUrl(),assetSourceFilename:b.getAssetSourceFilename(),offlineAssetId:b.getOfflineAssetId(),onlineAssetId:b.getOnlineAssetId()},color:null!=b.getBackgroundColor()?Object.assign(Object.assign({},v.StyleSheetEditorImpl.toStyleColor(b.getBackgroundColor())),{a:null!==(a=b.getBackgroundAlpha())&&
void 0!==a?a:1}):null,linkUrl:b.getLinkUrl()};throw Error("unsupported logo type");}return null!=c?{logoKind:d.base.LogoKind.classic,asset:{kind:d.base.AssetKind.logo,url:c.getOnlineAssetUrl(),assetSourceFilename:c.getAssetSourceFilename(),offlineAssetId:c.getOfflineAssetId(),onlineAssetId:c.getOnlineAssetId()}}:null}set logo(a){const b=this.executionContext.mscene.getPreziW();if(null==a)b.setLogo(null),b.setNextLogo(null);else switch(g.Check.logoAsset("asset",a.asset),a.logoKind){case d.base.LogoKind.classic:var c=
k.DOM.createLogo();c.setOnlineAssetUrl(a.asset.url);c.setOfflineAssetId(a.asset.offlineAssetId);c.setAssetSourceFilename(a.asset.assetSourceFilename);c.setOnlineAssetId(a.asset.onlineAssetId);b.setLogo(f.CetModel.ID.LOGO.inflate(this.executionContext.mscene,c));b.setNextLogo(null);break;case d.base.LogoKind.next:c=k.DOM.createNextLogoV1();c.setOnlineAssetUrl(a.asset.url);c.setOfflineAssetId(a.asset.offlineAssetId);c.setAssetSourceFilename(a.asset.assetSourceFilename);c.setOnlineAssetId(a.asset.onlineAssetId);
c.setLinkUrl(a.linkUrl);null==a.color?(c.setBackgroundColor(null),c.setBackgroundAlpha(null)):(g.Check.color("asset",a.color),c.setBackgroundColor(v.StyleSheetEditorImpl.toColor(a.color)),c.setBackgroundAlpha(a.color.a));b.setLogo(null);b.setNextLogo(f.CetModel.ID.NEXT_LOGO_V1.inflate(this.executionContext.mscene,c));break;default:n.Utils.assertNever(a)}}get brandKit(){const a=this.executionContext.mscene.getPreziW().getBranding();if(null==a)return null;if(a.is(f.CetModel.ID.BRAND_KIT))return{brandId:a.getBrandId(),
hash:a.getHash(),ownerId:a.getOwnerId()};if(a.is(f.CetModel.ID.NO_BRAND_KIT))return null;throw Error("Invalid brand kit enum value: "+a);}set brandKit(a){const b=this.executionContext.mscene.getPreziW();null==a?a=k.DOM.createNoBrandKit():(g.Check.brandKit("brandKit",a),a=k.DOM.createBrandKit(a.brandId,a.hash,a.ownerId));b.setBranding(f.CetModel.ID.BRANDING.inflate(this.executionContext.mscene,a))}get lookup(){return this.editorCache}createEditorCache(){const a=new Za.BaseTopicCommander,b=new fa.AdderFactory(this,
this.executionContext,this.baseObjectCommander,a);return new ra.EditorCache(this.executionContext,this,b,this.baseObjectCommander,a,this.imagePatcher,this.chartPatcher,this.pdfPatcher,this.behaviorExtensions,this.assetLoaderProvider,E.createPathManager(this.executionContext.mscene))}kill(){this.editorCache.kill()}setAspectRatio(a){switch(a){case d.base.AspectRatioSpecification.WideScreen:this.executionContext.mscene.getPreziW().setAspectRatio(f.AspectRatio._16_9);break;case d.base.AspectRatioSpecification.SmallScreen:this.executionContext.mscene.getPreziW().setAspectRatio(f.AspectRatio._4_3);
break;case d.base.AspectRatioSpecification.WideScreenWithoutLetterBox:this.executionContext.mscene.getPreziW().setAspectRatio(f.AspectRatio.Off);break;default:n.Utils.assertNever(a)}this.setOverviewBoundsToAspectRatio(a);this.baseObjectCommander.updateWorldGeometryAndBounds(this.executionContext)}setOverviewBoundsToAspectRatio(a){const b=this.executionContext.mscene.getPreziW().getMutableOverview();var c=b.getOverviewBounds();switch(c.getObjectType()){case k.OverviewBoundsType.AUTOMATIC_OVERVIEW_BOUNDS:break;
case k.OverviewBoundsType.FIXED_OVERVIEW_BOUNDS:c=c.getBoundsInWorld();switch(a){case d.base.AspectRatioSpecification.WideScreen:case d.base.AspectRatioSpecification.WideScreenWithoutLetterBox:a=(c.getWidth()/16*9-c.getHeight())/2;c=c.inflate(0,a);b.setOverviewBounds(k.DOM.createImmutableFixedOverviewBounds(c));break;case d.base.AspectRatioSpecification.SmallScreen:a=(c.getWidth()/4*3-c.getHeight())/2;c=c.inflate(0,a);b.setOverviewBounds(k.DOM.createImmutableFixedOverviewBounds(c));break;default:n.Utils.assertNever(a)}break;
case k.OverviewBoundsType.XCONSTRUCTOR:throw Error("invalid overview type");default:throw Error("invalid overview type");}}get aspectRatio(){const a=l.Cet.parseAspectRatio(this.executionContext.mscene.getPreziW().getAspectRatio());return{width:a.width,height:a.height}}get letterBoxing(){return l.Cet.parseAspectRatio(this.executionContext.mscene.getPreziW().getAspectRatio()).letterBoxing}get templateInfo(){return m.CetModelEditorInternal.readTemplateInfo(this.executionContext.mscene.getPreziW().toIPdom())}set templateInfo(a){if(null==
a)this.executionContext.mscene.getPreziW().setTemplateInfo(null);else{g.Check.templateInfo("templateInfo",a);const b=null!=a.themeId?a.themeId:m.CetModelEditorInternal.NOT_USED_THEME_ID;this.executionContext.mscene.getPreziW().setTemplateInfo(f.CetModel.ID.TEMPLATE_INFO.inflate(this.executionContext.mscene,k.DOM.createTemplateInfo(a.templateId,b)))}}get generation(){return f.CetModel.getDocumentGeneration(this.executionContext.mscene.getPreziW().toIPdom())}getSupportedGenerations(){return f.CetModel.getSupportedDocumentGenerations(this.executionContext.mscene.getPreziW().toIPdom())}isSupportedGeneration(a){return f.CetModel.isSupportedDocumentGeneration(this.executionContext.mscene.getPreziW(),
a)}get meta(){return this}};Z.BasePluginApiImpl=class extends Z.BaseEditorApiImpl{constructor(a,b,c,e,d,f){super(a,b,c,e,d,f);this.executionContext=a;this.documentDecorator={get:(a)=>this.executionContext.mscene.getPrezi().get(a),set:(a,b)=>{this.executionContext.mscene.getPrezi().set(a,b)},discardOwnComponent:(a)=>{this.executionContext.mscene.getPrezi().discardOwnComponent(a)}};this.intent=a.intent}toDecorator(a){return a}animated(a,b){a=a.map((a)=>(new Ca.AnimatedLayoutableEditorImpl(this.executionContext,
a)).snapshot());b();a.forEach((a)=>a.animateToPlace())}animate(a){return new Ca.AnimatedLayoutableEditorImpl(this.executionContext,a)}editorsUnderPoint(a,b=[]){const c=this.executionContext.mscene.getPrezi().get(d.CetModelEditor.getStageQueryKey()),e=g.Check.as("referencePoint",a,"ReferencePointImpl",u.ReferencePointImpl);let h=c.getEntitiesByWorldPoint(e.referenceFrame.relativeToWorld.transformPoint(a)).apply(c.strategies().general());b.forEach((a)=>{switch(a){case d.basePlugin.EditorsUnderPointStrategy.ifCloseToBorder:h=
h.apply(c.strategies().entityIfCloseToBorder());break;case d.basePlugin.EditorsUnderPointStrategy.replaceCoverWithTopic:h=h.apply(c.strategies().replaceCoverWithTopic(this.executionContext.mscene))}});return h.entities().map((a)=>{a=this.lookup.base(a.getId());return null!=a&&a.is(d.base.ObjectKind.transformedObject)?a:null}).filter((a)=>null!==a)}createDragGroup(a,b){return new u.DragGroupImpl(this,this.baseObjectCommander,a.map((a)=>this.toDecorator(a)),b.map((a)=>this.toDecorator(a)))}};var I=
{initCetApp:function(a){return Y(this,void 0,void 0,function*(){const b=a.getSceneBuilder().getSystemFactory(),c=b.createWorldGeometrySystem(),e=b.createBoundCalculationSystem(),h=b.createOverviewFrameSystem(null),f=d.CetModelEditor.createEditorConnectorFixerSystem(b),g=a.getSceneHierarchy().createChildScene(a.getBaseScene(),"edit",{inflateList:[b.createWorldGeometrySystem(),m.CetModelEditorInternal.createHideDegenerateConnectorsFixerSystem(b)],updateList:[b.createBoundCalculationSystem(),h],updateOnceList:[e,
c,f,e,c],geometryUpdateList:[e,c,h,f,e,c,h],fixerList:[e,c,c,f,e,c,m.CetModelEditorInternal.createHideDegenerateConnectorsFixerSystem(b),m.CetModelEditorInternal.createFranklinPathFixerSystem(b),e,c]});a.getSceneHierarchy().setAutoCommitScene(g);g.setTweenMode(l.TweenMode.IMMEDIATE);yield a.getSceneRender().getRenderer().getIsReady();return{cetApp:a,editScene:g,updateAndRunFixers:()=>{if(g.hasAnyUncommitedChange())throw Error("uncommitted changes before fixers");g.triggerSync();g.update();g.update(l.UpdatePhase.FIXER);
if(g.hasAnyUncommitedChange())throw Error("uncommitted changes after fixers");}}})},waitForFontAndMasatLoaded:function(a){return Y(this,void 0,void 0,function*(){yield nd(a);yield od(a)})}},Y=this&&I.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{k(e.next(a))}catch(t){h(t)}}function g(a){try{k(e["throw"](a))}catch(t){h(t)}}function k(a){a.done?c(a.value):d(a.value).then(f,g)}k((e=e.apply(a,b||
[])).next())})};Object.defineProperty(I,"__esModule",{value:!0});I.BaseConnection=class{constructor(){this.externalServiceProvider=lb.ExternalServiceProviderModule.browserExternalServiceProvider({hostName:"https://prezi.com"},new Nd);this.mediaService=Hc.MediaServiceModule.createMediaService(this.externalServiceProvider.mediaUploadProvider,this.externalServiceProvider.assetLoaderProvider,this.externalServiceProvider)}initCetApp(a){return Y(this,void 0,void 0,function*(){const b=l.Cet.createCetApplication({headless:!0,
speedMeasurementOptions:{measureSpeed:!1},rendererKind:F.RendererKind.Headless,tryRetainMainCanvas:!1,isDesktop:this.externalServiceProvider.isDesktop()},a,l.Cet.createAssetManager(this.externalServiceProvider.assetLoaderProvider),null,Qb.Bacon.newBus().toProperty(!1),Qb.Bacon.newVoidBus());return Object.assign({cetSession:a},yield(0,I.initCetApp)(b))})}waitForLoad(a){return Y(this,void 0,void 0,function*(){yield this.waitForPreziLoaded(a);yield(0,I.waitForFontAndMasatLoaded)(a.cetApp);a.updateAndRunFixers()})}waitForPreziLoaded(){return Y(this,
void 0,void 0,function*(){})}static emptyPrezi(){return k.DOM.loadXml(I.BaseConnection.emptyPreziXMLForTest())}static emptyPreziXMLForTest(){return`
<prezi version="2"
	xmlns="http://prezi.com/schema/prezi/2"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://prezi.com/schema/prezi/2 http://prezi.com/schema/prezi/2">
  <xFields>
    <xField name="editorPath">
      <xConstructor type="editorPath" name="editorPathV2">
        <xField name="steps">
          <xArray>
            <xConstructor type="editorPathStep" name="flyToOverviewEp"/>
          </xArray>
        </xField>
      </xConstructor>
    </xField>
    <xField name="editorWorkflowMode">
      <xEnum type="EditorWorkflowMode" value="EditableOverview"/>
    </xField>
    <xField name="grouping">
      <xEnum type="Grouping" value="on"/>
    </xField>
    <xField name="topicType">
      <xEnum type="TopicType" value="UnifiedSmartStructures"/>
    </xField>
  </xFields>
  <aspectRatio>
    <aspectRatio value="16:9"/>
  </aspectRatio>
  ${I.BaseConnection.documentStyle}
  <overview>
    <overview>
      <xFields>
        <xField name="usesChapters">
          <xBool value="true"/>
        </xField>
      </xFields>
      <minimumScale>
        <transform2D x="0" y="0" scale="2000" rotation="0"/>
      </minimumScale>
      <smartStructure>
        <xConstructor name="unifiedSmartStructure" type="smartStructure">
          <xField name="id">
            <xString value="06F75C08C98BA5995ED2EC3575DF406C"/>
          </xField>
        </xConstructor>
      </smartStructure>
    </overview>
  </overview>
  <path>
    <array>
      <flyToOverview/>
    </array>
  </path>
  <templateInfo>
    <templateInfo>
      <baseId>
        <string value="quarterly_business_review_-_dam"/>
      </baseId>
      <themeId>
        <string value="quarterly_business_review_-_dam_quarterly_business_review_-_dam"/>
      </themeId>
    </templateInfo>
  </templateInfo>
</prezi>`}};I.BaseConnection.documentStyle='<documentStyle>\n\t\t\t\t\t<documentStyle>\n\t\t\t\t\t  <fontClasses>\n\t\t\t\t\t\t<array>\n\t\t\t\t\t\t  <fontClass>\n\t\t\t\t\t\t\t<fontFamily>\n\t\t\t\t\t\t\t  <string value="Arimo"/>\n\t\t\t\t\t\t\t</fontFamily>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="Arimo"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontClass>\n\t\t\t\t\t\t  <fontClass>\n\t\t\t\t\t\t\t<fontFamily>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</fontFamily>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontClass>\n\t\t\t\t\t\t  <fontClass>\n\t\t\t\t\t\t\t<fontFamily>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</fontFamily>\n\t\t\t\t\t\t\t<fontWeight>\n\t\t\t\t\t\t\t  <fontWeight value="bold"/>\n\t\t\t\t\t\t\t</fontWeight>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="title"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontClass>\n\t\t\t\t\t\t  <fontClass>\n\t\t\t\t\t\t\t<fontFamily>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</fontFamily>\n\t\t\t\t\t\t\t<fontWeight>\n\t\t\t\t\t\t\t  <fontWeight value="bold"/>\n\t\t\t\t\t\t\t</fontWeight>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="subtitle"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontClass>\n\t\t\t\t\t\t  <fontClass>\n\t\t\t\t\t\t\t<fontFamily>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</fontFamily>\n\t\t\t\t\t\t\t<fontWeight>\n\t\t\t\t\t\t\t  <fontWeight value="bold"/>\n\t\t\t\t\t\t\t</fontWeight>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="subtitle_2"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontClass>\n\t\t\t\t\t\t  <fontClass>\n\t\t\t\t\t\t\t<fontFamily>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</fontFamily>\n\t\t\t\t\t\t\t<fontWeight>\n\t\t\t\t\t\t\t  <fontWeight value="bold"/>\n\t\t\t\t\t\t\t</fontWeight>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="body_2"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontClass>\n\t\t\t\t\t\t</array>\n\t\t\t\t\t  </fontClasses>\n\t\t\t\t\t  <fontFamilies>\n\t\t\t\t\t\t<array>\n\t\t\t\t\t\t  <fontFamily>\n\t\t\t\t\t\t\t<fontFaces>\n\t\t\t\t\t\t\t  <array>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Cabin-Regular.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Cabin-Bold.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t  <fontWeight>\n\t\t\t\t\t\t\t\t\t<fontWeight value="bold"/>\n\t\t\t\t\t\t\t\t  </fontWeight>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Cabin-Italic.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t  <fontStyle>\n\t\t\t\t\t\t\t\t\t<fontStyle value="italic"/>\n\t\t\t\t\t\t\t\t  </fontStyle>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Cabin-BoldItalic.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t  <fontStyle>\n\t\t\t\t\t\t\t\t\t<fontStyle value="italic"/>\n\t\t\t\t\t\t\t\t  </fontStyle>\n\t\t\t\t\t\t\t\t  <fontWeight>\n\t\t\t\t\t\t\t\t\t<fontWeight value="bold"/>\n\t\t\t\t\t\t\t\t  </fontWeight>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t  </array>\n\t\t\t\t\t\t\t</fontFaces>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="Cabin"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontFamily>\n\t\t\t\t\t\t  <fontFamily>\n\t\t\t\t\t\t\t<fontFaces>\n\t\t\t\t\t\t\t  <array>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Arimo-Regular.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Arimo-Bold.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t  <fontWeight>\n\t\t\t\t\t\t\t\t\t<fontWeight value="bold"/>\n\t\t\t\t\t\t\t\t  </fontWeight>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Arimo-Italic.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t  <fontStyle>\n\t\t\t\t\t\t\t\t\t<fontStyle value="italic"/>\n\t\t\t\t\t\t\t\t  </fontStyle>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t\t<fontFace>\n\t\t\t\t\t\t\t\t  <fontSrc>\n\t\t\t\t\t\t\t\t\t<string value="Arimo-BoldItalic.keg"/>\n\t\t\t\t\t\t\t\t  </fontSrc>\n\t\t\t\t\t\t\t\t  <fontStyle>\n\t\t\t\t\t\t\t\t\t<fontStyle value="italic"/>\n\t\t\t\t\t\t\t\t  </fontStyle>\n\t\t\t\t\t\t\t\t  <fontWeight>\n\t\t\t\t\t\t\t\t\t<fontWeight value="bold"/>\n\t\t\t\t\t\t\t\t  </fontWeight>\n\t\t\t\t\t\t\t\t</fontFace>\n\t\t\t\t\t\t\t  </array>\n\t\t\t\t\t\t\t</fontFaces>\n\t\t\t\t\t\t\t<name>\n\t\t\t\t\t\t\t  <string value="Arimo"/>\n\t\t\t\t\t\t\t</name>\n\t\t\t\t\t\t  </fontFamily>\n\t\t\t\t\t\t</array>\n\t\t\t\t\t  </fontFamilies>\n\t\t\t\t\t  <styleDeclarations>\n\t\t\t\t\t\t<array>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingHorizontal">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingVertical">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<backgroundAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.5"/>\n\t\t\t\t\t\t\t\t</backgroundAlpha>\n\t\t\t\t\t\t\t\t<backgroundColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</backgroundColor>\n\t\t\t\t\t\t\t\t<backgroundPadding>\n\t\t\t\t\t\t\t\t  <double value="10"/>\n\t\t\t\t\t\t\t\t</backgroundPadding>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<displayBackground>\n\t\t\t\t\t\t\t\t  <bool value="false"/>\n\t\t\t\t\t\t\t\t</displayBackground>\n\t\t\t\t\t\t\t\t<fontClass>\n\t\t\t\t\t\t\t\t  <string value="title"/>\n\t\t\t\t\t\t\t\t</fontClass>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.2"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="zText.title"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingHorizontal">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingVertical">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<backgroundAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.66"/>\n\t\t\t\t\t\t\t\t</backgroundAlpha>\n\t\t\t\t\t\t\t\t<backgroundColor>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</backgroundColor>\n\t\t\t\t\t\t\t\t<backgroundPadding>\n\t\t\t\t\t\t\t\t  <double value="10"/>\n\t\t\t\t\t\t\t\t</backgroundPadding>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<displayBackground>\n\t\t\t\t\t\t\t\t  <bool value="false"/>\n\t\t\t\t\t\t\t\t</displayBackground>\n\t\t\t\t\t\t\t\t<fontClass>\n\t\t\t\t\t\t\t\t  <string value="subtitle"/>\n\t\t\t\t\t\t\t\t</fontClass>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.2"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="zText.subtitle"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingHorizontal">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingVertical">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<backgroundAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.3"/>\n\t\t\t\t\t\t\t\t</backgroundAlpha>\n\t\t\t\t\t\t\t\t<backgroundColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</backgroundColor>\n\t\t\t\t\t\t\t\t<backgroundPadding>\n\t\t\t\t\t\t\t\t  <double value="10"/>\n\t\t\t\t\t\t\t\t</backgroundPadding>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#0F1825"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<displayBackground>\n\t\t\t\t\t\t\t\t  <bool value="false"/>\n\t\t\t\t\t\t\t\t</displayBackground>\n\t\t\t\t\t\t\t\t<fontClass>\n\t\t\t\t\t\t\t\t  <string value="Arimo"/>\n\t\t\t\t\t\t\t\t</fontClass>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.2"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="zText.body"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingHorizontal">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingVertical">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<backgroundAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.74"/>\n\t\t\t\t\t\t\t\t</backgroundAlpha>\n\t\t\t\t\t\t\t\t<backgroundColor>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</backgroundColor>\n\t\t\t\t\t\t\t\t<backgroundPadding>\n\t\t\t\t\t\t\t\t  <double value="10"/>\n\t\t\t\t\t\t\t\t</backgroundPadding>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<displayBackground>\n\t\t\t\t\t\t\t\t  <bool value="true"/>\n\t\t\t\t\t\t\t\t</displayBackground>\n\t\t\t\t\t\t\t\t<fontClass>\n\t\t\t\t\t\t\t\t  <string value="subtitle_2"/>\n\t\t\t\t\t\t\t\t</fontClass>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.2"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="zText.subtitle_2"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingHorizontal">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t  <xField name="deprecatedBackgroundPaddingVertical">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="5"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<backgroundAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.3"/>\n\t\t\t\t\t\t\t\t</backgroundAlpha>\n\t\t\t\t\t\t\t\t<backgroundColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</backgroundColor>\n\t\t\t\t\t\t\t\t<backgroundPadding>\n\t\t\t\t\t\t\t\t  <double value="10"/>\n\t\t\t\t\t\t\t\t</backgroundPadding>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<displayBackground>\n\t\t\t\t\t\t\t\t  <bool value="false"/>\n\t\t\t\t\t\t\t\t</displayBackground>\n\t\t\t\t\t\t\t\t<fontClass>\n\t\t\t\t\t\t\t\t  <string value="body_2"/>\n\t\t\t\t\t\t\t\t</fontClass>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.2"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="zText.body_2"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="attachPadding">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="10"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="7"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.line1"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="attachPadding">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="10"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="7"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.line2"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="attachPadding">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="10"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#02B56D"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#02B56D"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#02B56D"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="7"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.line3"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="attachPadding">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="10"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#7836B5"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#7836B5"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#7836B5"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="7"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.line4"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="attachPadding">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="10"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#E0F252"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#E0F252"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#E0F252"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="6.7926195623317005"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.line5"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<xFields>\n\t\t\t\t\t\t\t\t  <xField name="attachPadding">\n\t\t\t\t\t\t\t\t\t<xJust>\n\t\t\t\t\t\t\t\t\t  <xDouble value="10"/>\n\t\t\t\t\t\t\t\t\t</xJust>\n\t\t\t\t\t\t\t\t  </xField>\n\t\t\t\t\t\t\t\t</xFields>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.5"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.chainLink"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.poly1"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#15549A"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#15549A"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.poly2"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#02B56D"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#3080FD"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#3080FD"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.poly3"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#7836B5"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#F15A24"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#F15A24"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.poly4"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#E0F252"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.poly5"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.61"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#BAD5FE"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.03"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.frame1"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="0.69"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#0082C8"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.03"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.frame2"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<borderAlpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</borderAlpha>\n\t\t\t\t\t\t\t\t<borderColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</borderColor>\n\t\t\t\t\t\t\t\t<borderThickness>\n\t\t\t\t\t\t\t\t  <double value="-1"/>\n\t\t\t\t\t\t\t\t</borderThickness>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#15549A"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</gradEndAlpha>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartAlpha>\n\t\t\t\t\t\t\t\t  <double value="0.85"/>\n\t\t\t\t\t\t\t\t</gradStartAlpha>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#152235"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t\t<padding>\n\t\t\t\t\t\t\t\t  <double value="1.03"/>\n\t\t\t\t\t\t\t\t</padding>\n\t\t\t\t\t\t\t\t<thickness>\n\t\t\t\t\t\t\t\t  <double value="100"/>\n\t\t\t\t\t\t\t\t</thickness>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.frame3"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="1"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<color>\n\t\t\t\t\t\t\t\t  <color value="#69CAFF"/>\n\t\t\t\t\t\t\t\t</color>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t\t<gradEndColor>\n\t\t\t\t\t\t\t\t  <color value="#15549A"/>\n\t\t\t\t\t\t\t\t</gradEndColor>\n\t\t\t\t\t\t\t\t<gradStartColor>\n\t\t\t\t\t\t\t\t  <color value="#FFFFFF"/>\n\t\t\t\t\t\t\t\t</gradStartColor>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="background"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t  <styleDeclaration>\n\t\t\t\t\t\t\t<styleBlock>\n\t\t\t\t\t\t\t  <styleBlock>\n\t\t\t\t\t\t\t\t<alpha>\n\t\t\t\t\t\t\t\t  <double value="0"/>\n\t\t\t\t\t\t\t\t</alpha>\n\t\t\t\t\t\t\t\t<fillType>\n\t\t\t\t\t\t\t\t  <fillType value="solid"/>\n\t\t\t\t\t\t\t\t</fillType>\n\t\t\t\t\t\t\t  </styleBlock>\n\t\t\t\t\t\t\t</styleBlock>\n\t\t\t\t\t\t\t<styleSelector>\n\t\t\t\t\t\t\t  <simpleSelector value="*.baseLine"/>\n\t\t\t\t\t\t\t</styleSelector>\n\t\t\t\t\t\t  </styleDeclaration>\n\t\t\t\t\t\t</array>\n\t\t\t\t\t  </styleDeclarations>\n\t\t\t\t\t</documentStyle>\n\t\t\t\t  </documentStyle>';
I.IPreziConnectionImpl=class extends I.BaseConnection{loadSession(a){return Y(this,void 0,void 0,function*(){const b=yield this.initCetApp(a),c=this.waitForLoad(b);b.editScene.update();yield c;return this.createEditorSession(b)})}loadIPrezi(a){return Y(this,void 0,void 0,function*(){var b=m.CetModelEditorInternal.cetSessionFactory().createHeadlessCetSession();const c=yield this.initCetApp(b);a=yield m.CetModelEditorInternal.converterPlugins().convertPrezi(a,c.cetApp);b.setIPrezi(a);b=this.waitForLoad(c);
c.editScene.update();yield b;return this.createEditorSession(c)})}create(a=null){return null==a?this.loadIPrezi(I.ConnectionImpl.emptyPrezi()):this.loadIPrezi(k.DOM.loadXml(a))}createEditorSession(a){a.editScene.setIdleChangeStream(a.editScene.getImmediateChangeStream(l.ChangeEventKind.Entity));return new Z.EditorSessionImpl(a.cetApp,this.externalServiceProvider.assetLoaderProvider,this.mediaService,a.cetApp.getMainStage().getRenderer().getAssetManager(),a.editScene,a.cetSession,!1,null,0,a.cetApp.getMediaAssetPatcher(),
Rb.TemplateServiceModule.createTemplateService(this.externalServiceProvider),this.externalServiceProvider,new Aa.NoBehaviorExtensions,a.cetApp)}};I.XmlConnectionImpl=class extends I.IPreziConnectionImpl{loadXml(a){return Y(this,void 0,void 0,function*(){return this.loadIPrezi(k.DOM.loadXml(a))})}};I.ConnectionImpl=class extends I.BaseConnection{open(a){return Y(this,void 0,void 0,function*(){const b=yield this.init(),c=this.waitForLoad(b);b.cetSession.getPreziLoader().loadPrezi(b.cetApp,a);yield c;
return new Z.EditorSessionImpl(b.cetApp,this.externalServiceProvider.assetLoaderProvider,this.mediaService,b.cetApp.getMainStage().getRenderer().getAssetManager(),b.editScene,b.cetSession,!0,a,I.ConnectionImpl.rateLimitInMilliseconds,b.cetApp.getMediaAssetPatcher(),Rb.TemplateServiceModule.createTemplateService(this.externalServiceProvider),this.externalServiceProvider,new Aa.NoBehaviorExtensions,b.cetApp)})}create(a=null){return Y(this,void 0,void 0,function*(){return null==a?this.createFromIPrezi(I.BaseConnection.emptyPrezi()):
this.createFromIPrezi(k.DOM.loadXml(a))})}createFromIPrezi(a){return Y(this,void 0,void 0,function*(){const b=yield this.init();return new Promise((c,e)=>{const d=this.waitForLoad(b);b.cetSession.getPreziCreator().createPrezi(b.cetApp,"Untitled prezi","",a,"2",null).take(1).onValue((a)=>Y(this,void 0,void 0,function*(){a.kind!==l.CetPreziCreatorResultKind.success&&e(Error("prezi creation failed"));try{yield d}catch(r){e(r)}c(new Z.EditorSessionImpl(b.cetApp,this.externalServiceProvider.assetLoaderProvider,
this.mediaService,b.cetApp.getMainStage().getRenderer().getAssetManager(),b.editScene,b.cetSession,!0,a.metadata.oid,I.ConnectionImpl.rateLimitInMilliseconds,b.cetApp.getMediaAssetPatcher(),Rb.TemplateServiceModule.createTemplateService(this.externalServiceProvider),this.externalServiceProvider,new Aa.NoBehaviorExtensions,b.cetApp))}))})})}init(){return Y(this,void 0,void 0,function*(){const a=m.CetModelEditorInternal.cetSessionFactory().createCetSession(this.externalServiceProvider,new Od,{keepReconnectingAfterOfflineTimerTriggered:!0,
offlineTimerInSeconds:10,coeditExternalServiceProviders:k.DOM.getProductionCoeditExternalServiceProviders(),reconnectSyncEnabled:!1}),b=yield this.initCetApp(a);a.getPreziLoader().getNetworkEventStream().onValue((a)=>{switch(a.type){case l.CetNetworkEventType.SessionReady:case l.CetNetworkEventType.RemoteChangesAvailable:case l.CetNetworkEventType.Reconnected:case l.CetNetworkEventType.RequestSync:b.updateAndRunFixers()}});return b})}waitForPreziLoaded(a){return new Promise((b,c)=>{a.cetSession.getPreziLoader().getLoaderStream().onValue((a)=>
{switch(a.type){case M.PreziLoaderEventType.PreziLoaded:b();break;case M.PreziLoaderEventType.MetaDataUpdated:case M.PreziLoaderEventType.StartLoading:case M.PreziLoaderEventType.MetaDataLoaded:case M.PreziLoaderEventType.NewPrezi:case M.PreziLoaderEventType.AssetLoadError:case M.PreziLoaderEventType.AllAssetsLoaded:case M.PreziLoaderEventType.TemplateChooserLoaded:case M.PreziLoaderEventType.EditorInit:case M.PreziLoaderEventType.EditorStartEventForPrezipage:case M.PreziLoaderEventType.PdomSessionCreated:case M.PreziLoaderEventType.CetSessionCreated:case M.PreziLoaderEventType.ConversionStarted:case M.PreziLoaderEventType.FeaturePreviewModeWithSaveDisabled:break;
case M.PreziLoaderEventType.PreziCreationError:case M.PreziLoaderEventType.MetaDataLoadError:case M.PreziLoaderEventType.PreziXMLLoadError:case M.PreziLoaderEventType.PreziConversionNotAllowedError:case M.PreziLoaderEventType.PreziConversionFailedError:case M.PreziLoaderEventType.PdomSessionCreationError:c(Error(`Cannot open prezi, ${M.PreziLoaderEventType[a.type]}.`));break;default:n.Utils.assertNever(a)}})})}};I.ConnectionImpl.rateLimitInMilliseconds=100;class Od{createPreziError(){}}class Nd{initLogger(){}logSaveWithRevision(){}logUploadPreviewImages(){}logSaveError(){}logSaveSuccess(){}logTemplateFallbackToStatic(){}}
var Bb={};Object.defineProperty(Bb,"__esModule",{value:!0});Bb.CameraControlImpl=class{constructor(a){this.camera=a}getWorldReferenceFrame(){return new u.ReferenceFrameImpl(q.Geometry.transform2dIdentity())}getStagePointInWorld(a){return this.camera.screenPointToWorld(a)}getStageAreaInWorld(){return this.camera.screenAreaToWorld(this.getStageAreaInScreen())}getCameraTransform(){return this.camera.getTransform()}getMarginCorrectedViewport(){return this.camera.getMarginCorrectedViewport()}getMarginCorrectedViewportInWorld(){return this.camera.screenAreaToWorld(this.camera.getMarginCorrectedViewport())}getMarginCorrectedStageArea(){return this.camera.getMarginCorrectedStageArea()}getStageAreaInScreen(){return this.camera.getStageArea()}getScreenLayoutBox(){return new u.LayoutBoxImpl(new u.ReferenceFrameImpl(this.getCameraTransform().invert()),
q.Geometry.obbFromRect(this.getMarginCorrectedViewport().getData()))}getMarginCorrectedStageLayoutBox(){return new u.LayoutBoxImpl(new u.ReferenceFrameImpl(this.getCameraTransform().invert()),q.Geometry.obbFromRect(this.getMarginCorrectedStageArea().getData()))}getStageAreaLayoutBox(){return new u.LayoutBoxImpl(new u.ReferenceFrameImpl(this.getCameraTransform().invert()),q.Geometry.obbFromRect(this.getStageAreaInScreen().getData()))}setScreenLayoutBox(a){var b=this.getScreenLayoutBox();a=g.Check.as("newBox",
a,"LayoutBoxImpl",u.LayoutBoxImpl);b=b.relativeBounds.transform(b.referenceFrame.relativeToWorld);a=a.relativeBounds.transform(a.referenceFrame.relativeToWorld);b=d.CetModelEditor.getTransformBetweenAreas(a,b).concat(this.camera.getViewportTransform());this.camera.setViewportTransform(b)}};var jc={};Object.defineProperty(jc,"__esModule",{value:!0});jc.CetModelLogHelperImpl=class{constructor(a){this.scene=a}getDetailedEntityLogName(a,b){return d.CetModelEditor.isOverview(b,this.scene)?"overview":"topic"!==
a?a:d.CetModelEditor.isPage(b,this.scene)?"page":d.CetModelEditor.isPlanetOrStack(b,this.scene)?"chapter":"topic"}getTopicLogName(a){return d.CetModelEditor.isPlanet(a,this.scene)?"chapter-overview":d.CetModelEditor.isPlanetOrStack(a,this.scene)?"chapter":d.CetModelEditor.isPage(a,this.scene)?"page":d.CetModelEditor.isOverviewThatUsesChapters(a,this.scene)?"overview":null}getCoverReferer(a){return l.Cet.createTopicChildrenQuery(this.scene).getBehaviorReferer(a,l.TopicChildBehavior.Cover)}};var La=
{},Pd=this&&La.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,h){function f(a){try{k(e.next(a))}catch(t){h(t)}}function g(a){try{k(e["throw"](a))}catch(t){h(t)}}function k(a){a.done?c(a.value):d(a.value).then(f,g)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(La,"__esModule",{value:!0});La.BaseConvertStep=class{constructor(a,b){this.name=a;this.continueOnError=b;this.logger=Q.LoggerModule.getLoggerManager().createLogger(a)}logConversionError(a){Q.LoggerModule.logException(this.logger,
this.name,"conversion",a,null,"error")}convertPrezi(a,b){return Pd(this,void 0,void 0,function*(){try{const c=this.createContext(a);if(this.shouldConvert(c)){const a=yield this.convert(c,b);return{converted:!0,iPrezi:a.iPrezi,convertWithApi:a.convertWithApi}}}catch(c){if(this.logConversionError(c),!this.continueOnError)throw c;}return{converted:!1}})}};var Cb={},Db=this&&Cb.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,
h){function f(a){try{k(e.next(a))}catch(t){h(t)}}function g(a){try{k(e["throw"](a))}catch(t){h(t)}}function k(a){a.done?c(a.value):d(a.value).then(f,g)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(Cb,"__esModule",{value:!0});Cb.ClassicToNextConverter=class extends La.BaseConvertStep{constructor(){super("ClassicToNextConverter",!1)}createContext(a){return a}shouldConvert(a){return a.getPreziType()===k.DOM.ENUMS().PREZI_TYPE().CONVERTED_FROM_CORE()}convert(a,b){return Db(this,void 0,void 0,
function*(){const c=new Qd(this.logger,a,b);return{iPrezi:yield c.preprocess(),convertWithApi:(a)=>c.convertWithApi(a)}})}};class Qd{constructor(a,b,c){this.logger=a;this.iPrezi=b;this.swfCalculator=c;this.extractedPath=[];this.zgroups=new Map;this.styleBlockMatcher=k.DOM.createUnsafeStyleBlockMatcher(b);this.originalIZObjectMap=new Map(Array.from(n.Utils.toIterable(this.iPrezi.getZObjects())).map((a)=>[a.getId(),a]))}convertZGroup(a){const b=a.getId(),c=[];for(let b=0;b<a.getChildren().length();b++)c.push(a.getChildren().get(b));
this.zgroups.set(b,c);return k.DOM.createZZoomArea(b)}convertShape(a,b){return k.DOM.createZShape(a.getId(),b).setHeight(a.getHeight()).setWidth(a.getWidth()).setLocalToWorld(a.getLocalToWorld()).setStyleClasses(k.DOM.IPreziCopy().copyArrayToken(a.getStyleClasses()))}convertZCircleFrame(a){return k.DOM.createZShape(a.getId(),k.DOM.ENUMS().SHAPE_TYPE().OVAL()).setLocalToWorld(a.getLocalToWorld()).setWidth(a.getWidth()).setHeight(a.getHeight()).setStyleClasses(k.DOM.IPreziCopy().copyArrayToken(a.getStyleClasses()))}convertZCircle(a){return k.DOM.createZShape(a.getId(),
k.DOM.ENUMS().SHAPE_TYPE().OVAL()).setLocalToWorld(a.getLocalToWorld()).setWidth(2*a.getRadius()).setHeight(2*a.getRadius()).setStyleClasses(k.DOM.IPreziCopy().copyArrayToken(a.getStyleClasses()))}convertZInvisibleFrame(a){return k.DOM.createZZoomArea(a.getId()).setHeight(a.getHeight()).setWidth(a.getWidth()).setLocalToWorld(a.getLocalToWorld()).setStyleClasses(k.DOM.IPreziCopy().copyArrayToken(a.getStyleClasses()))}convertZPencil(a){return k.DOM.createZMarker(a.getId()).setLocalToWorld(a.getLocalToWorld()).setPoints(k.DOM.IPreziCopy().copyArrayPoint(a.getPoints()))}convertZObject(a){return Gc(a)?
this.convertZGroup(a):Rd(a)?this.convertZCircleFrame(a):Sd(a)?this.convertZCircle(a):Td(a)||Ud(a)?this.convertShape(a,k.DOM.ENUMS().SHAPE_TYPE().RECTANGLE()):Vd(a)?this.convertShape(a,k.DOM.ENUMS().SHAPE_TYPE().TRIANGLE()):Wd(a)?this.convertZInvisibleFrame(a):Xd(a)?this.convertZPencil(a):null}isProbablyValidSwfUrl(a){try{const b=new URL(a.startsWith("/")?"https:"+a:a);return[/.*\.static\.prezi\.com/,/.*\.s3\.amazonaws\.com/,/s3\.amazonaws\.com/,/media\.preziusercontent\.com/].some((a)=>b.hostname.match(a))}catch(b){return!1}}truncSwfToTwips(a,
b){return Db(this,void 0,void 0,function*(){let c;if(this.isProbablyValidSwfUrl(b)){try{c=yield this.swfCalculator.calcSwfBounds(b)}catch(p){Q.LoggerModule.logException(this.logger,"ClassicToNextConverter","truncSwfToTwips","machine",p);return}if(0>=c.width||0>=c.height)this.logger.error({trigger:"machine",action:"invalidSwfBounds",object:"ClassicToNextConverter",payload:{url:b,width:c.width,height:c.height}});else{if(null==a.getMask()){var e=c.x+.5*c.width*a.getImageScaleX(),d=c.y+.5*c.height*a.getImageScaleY();
e=mb(e)-e;d=mb(d)-d;a.updateSwfBoundsLeft(c.x+e);a.updateSwfBoundsTop(c.y+d)}else a.updateSwfBoundsLeft(c.x),a.updateSwfBoundsTop(c.y);a.updateWidth(c.width);a.updateHeight(c.height)}}else this.logger.error({trigger:"machine",action:"invalidSwfUrl",object:"ClassicToNextConverter",payload:{url:b}})})}preprocess(){var a;return Db(this,void 0,void 0,function*(){const b=k.DOM.createLocalSession(this.iPrezi,()=>{});b.fixInvariants();const c=b.getPrezi();c.updatePreziType(k.DOM.ENUMS().PREZI_TYPE().PITCH());
c.updateTopicType(k.DOM.ENUMS().TOPIC_TYPE().TOPIC_SHAPE());var e=c.getTypedZObjects();for(var d=e.length()-1;0<=d;d--)0===e.get(d).getLocalToWorld().getScale()&&e.remove(d);d=e.length();this.autoGroupParents=Array.from(n.Utils.toTypedIterable(e)).filter(pd).map((a)=>a.getId());var f=null===(a=c.getTypedBackground())||void 0===a?void 0:a.getTypedLayers();if(null!=f)for(var g=0;g<f.length();g++){var l=f.getTyped(g);Yd(l)&&(yield this.truncSwfToTwips(l,l.getOnlineAssetUrl()))}for(f=0;f<d;f++)g=e.getTyped(f),
Zd(g)&&(yield this.truncSwfToTwips(g,g.getOnlineAssetUrl())),g=this.convertZObject(g),null!=g&&(e.remove(f),e.insert(f,g));e=c.getTypedPath();d=e.length();for(f=0;f<d;f++){var m=e.getTyped(f);if($d(m))for(g=m.getTypedActions(),l=g.length(),this.extractedPath.push({kind:"zoom",id:m.getTarget(),sound:null==m.getSound()?null:k.DOM.IPreziCopy().copySound(m.getSound())}),m=0;m<l;m++){const a=g.getTyped(m);ae(a)?this.extractedPath.push({kind:"fadeIn",id:a.getTarget(),sound:null}):this.logger.error({action:"classic-import",
object:"classic-import",trigger:"machine",payload:{error:`Unsupported path action type ${a.getObjectType()}`}})}else this.logger.error({action:"classic-import",object:"classic-import",trigger:"machine",payload:{error:`Unsupported  path step type ${m.getObjectType()}`}})}e=k.DOM.createArrayPathStep([k.DOM.createFlyToOverview()]);c.updatePath(e);null!=c.getBackgroundSound()&&(this.backgroundSound=k.DOM.IPreziCopy().copySound(c.getBackgroundSound()),c.updateBackgroundSound(null));e=this.getShapeStylesInOrder(b);
this.setNewStyleDeclarations(b,e);this.setStyleClasses(b,e);this.inlineStyles(b);b.commit();b.sync();return c})}convertWithApi(a){return Db(this,void 0,void 0,function*(){yield a.executeApiCommand({name:"set minimum overview size",run:(a)=>{a=a.executionContext.mscene;if(null==a.getPreziW().getMutableOverview().getMinimumScale()){var b=a.getPreziW().getOverview().getEntity();b=q.Geometry.obbFromRect(l.Cet.calculateZoomBounds(a,b).getData()).transform(l.Cet.transform(b).getLocalToWorld());const c=
l.Cet.parseAspectRatio(a.getPreziW().getAspectRatio());a.getPreziW().getMutableOverview().setMinimumScale(q.Geometry.transform2dFromDeg(b.getCenter(),Math.min(b.getWidth()/c.width,b.getHeight()/c.height),0))}}});yield a.executeApiCommand({name:"textalign",run:(a)=>{for(const c of a.lookup.findAll(d.base.ObjectKind.text)){a=c.wrapper;var b=a.getEntity();b=l.Cet.shapedText(b);var e=b.getLayoutWidth(),f=b.getLayoutHeight();const d=-.5*e,h=-.5*f;b=1/4096;e=mb(d)-.5*b*e-d;f=mb(h)-.5*b*f-h;b=1-b;b=q.Geometry.transform2dIdentity().scaleAroundPoint({x:0,
y:0},b).translate({x:e,y:f});a.setLocalToWorld(b.concat(a.getLocalToWorld()))}}});yield a.executeApiCommand({name:"convert",run:(a)=>{for(const [c,e]of this.zgroups){var b=e.map((b)=>a.lookup.transformedObject(b)).filter((a)=>null!=a);const d=a.lookup.zoomArea(c);0===b.length?d.delete():(b=b[0].createLayoutGroupWith(b).layoutBox,d.width=b.size.width,d.height=b.size.height,d.fitInto(b))}const e=a.overview.contentChildren,f=new Map(this.autoGroupParents.map((b)=>a.lookup.simpleObject(b)).filter((a)=>
null!=a).map((a)=>{const b=e.filter((b)=>{var c;if(c=b.id!==a.id)c=g.Check.as("parent",a,"SimpleObjectEditorImpl",S.SimpleObjectEditorImpl).isAutoChild(b,"webgl");return c});return[a.id,b]}));this.buildGroups(a);const k=new Set(this.extractedPath.filter((a)=>"fadeIn"===a.kind).map((a)=>a.id)),l=new Set;for(const [a,b]of this.zgroups){l.add(a);for(const a of b)l.add(a)}const m=a.structuredPath.editorPath,w=(a)=>({kind:d.base.AssetKind.audio,url:a.getOnlineAssetUrl(),onlineAssetId:a.getOnlineAssetId(),
offlineAssetId:a.getOfflineAssetId(),audioType:a.getAudioType(),assetSourceFilename:a.getAssetSourceFilename(),mediaLengthMilliSecs:a.getMediaLength()});this.extractedPath.forEach((b)=>{switch(b.kind){case "fadeIn":var c=this.zgroups.get(b.id);if(null!=c)b=c.map((b)=>a.lookup.transformedObject(b)).filter((a)=>null!=a),m.add.fadeIn(m.children.length,b,[]);else{var e=f.get(b.id);if(null!=e){c=new Set(e.map((a)=>a.id));for(var d of e)if(l.has(d.id))c.delete(d.id);else if(k.has(d.id)&&(c.delete(d.id),
e=f.get(d.id),null!=e))for(const a of e)c.delete(a.id);c.add(b.id);b=Array.from(c).map((b)=>a.lookup.transformedObject(b));m.add.fadeIn(m.children.length,b,[])}else b=a.lookup.transformedObject(b.id),m.add.fadeIn(m.children.length,[b],[])}break;case "zoom":d=a.lookup.transformedObject(b.id),d=m.add.zoom(m.children.length,d),null!=b.sound&&(d.audio=w(b.sound))}});null!=this.backgroundSound&&(a.structuredPath.backgroundAudio=w(this.backgroundSound));0<m.children.length&&(a.structuredPath.customStartPoint=
m.children[0])}})})}getShapeStylesInOrder(){return[d.base.ShapeStyle.Poly3,d.base.ShapeStyle.Poly1,d.base.ShapeStyle.Poly2]}setNewStyleDeclarations(a,b){const c=new Map(Array.from(n.Utils.toIterable(this.iPrezi.getDocumentStyle().getStyleDeclarations())).map((a)=>[a.getStyleSelector().toString(),a])),e=(a,b,c,e,d)=>{c=k.DOM.IPreziCopy().copyStyleBlock(this.styleBlockMatcher.getMatchingStyleBlockWithoutIdSpecificStyles(c,k.DOM.createArrayToken(e)));null!=d&&d(c);return k.DOM.createStyleDeclaration(c,
k.DOM.createSimpleSelectorFromString(oa.styleSelectorToString(a,b)))},f=(a)=>{a.hasRadius()&&(a.setCornerRadius(a.getRadius()),a.clearRadius())};a.getPrezi().getTypedDocumentStyle().updateStyleDeclarations(k.DOM.createArrayStyleDeclaration([((a,b)=>{a=c.get(oa.styleSelectorToString(a,b));return null!=a?k.DOM.IPreziCopy().copyStyleDeclaration(a):null})(be,null),e(ua,"title",ua,["title"]),e(ua,"subtitle",ua,["subtitle"]),e(ua,"subtitle_2",ua,["subtitle","subtitle-background"]),e(ua,"body",ua,["body"]),
e(ua,"body_2",ua,["body","body-background"]),e(null,d.base.ArcStyle.Line1,gb,[d.base.ArcStyle.Line1]),e(null,d.base.ArcStyle.Line2,gb,[d.base.ArcStyle.Line2]),e(null,d.base.ArcStyle.Line3,gb,[d.base.ArcStyle.Line3]),e(null,d.base.ArcStyle.Line4,gb,[d.base.ArcStyle.Line4]),e(null,d.base.ArcStyle.Line5,gb,[d.base.ArcStyle.Line5]),e(null,d.base.ShapeStyle.Poly1,ce,[],(a)=>{a.clearRadius()}),e(null,d.base.ShapeStyle.Poly2,de,[],f),e(null,d.base.ShapeStyle.Poly3,kc,[b[0]],f),e(null,d.base.ShapeStyle.Poly4,
kc,[b[1]],f),e(null,d.base.ShapeStyle.Poly5,kc,[b[2]],f)].filter((a)=>null!=a)))}getStyleClasses(a,b){const c=(b)=>{b=new Set(b);for(const c of n.Utils.toIterable(a.getStyleClasses()))if(!b.delete(c))return!1;return 0===b.size};var e=this.originalIZObjectMap.get(a.getId());if(null==e)return null;e=e.getDomType();return e===k.DomType.Z_TEXT?[["title"],["subtitle"],["body"]].some(c)?null:c(["subtitle","subtitle-background"])?["subtitle_2"]:c(["title","title-background"])?["title"]:c(["body","body-background"])?
["body_2"]:["body"]:e===k.DomType.Z_LINE||e===k.DomType.Z_ARROW?[[d.base.ArcStyle.Line2],[d.base.ArcStyle.Line3],[d.base.ArcStyle.Line4],[d.base.ArcStyle.Line5],[d.base.ArcStyle.Line1]].some(c)?null:[d.base.ArcStyle.Line1]:e===k.DomType.Z_CIRCLE_FRAME?[d.base.ShapeStyle.Poly1]:e===k.DomType.Z_RECTANGLE_FRAME?[d.base.ShapeStyle.Poly2]:e===k.DomType.Z_TRIANGLE||e===k.DomType.Z_SQUARE||e===k.DomType.Z_CIRCLE?c([b[0]])?[d.base.ShapeStyle.Poly3]:c([b[1]])?[d.base.ShapeStyle.Poly4]:c([b[2]])?[d.base.ShapeStyle.Poly5]:
[d.base.ShapeStyle.Poly3]:[]}setStyleClasses(a,b){for(const c of n.Utils.toTypedIterable(a.getPrezi().getTypedZObjects()))a=this.getStyleClasses(c,b),null!=a&&c.updateStyleClasses(k.DOM.createArrayToken(a))}createStyleBlockToInline(a,b,c){const e=k.DOM.createStyleBlock();let d=!0;a.getColor().equals(b.getColor())||(d=!1,e.setColor(b.getColor()));a.getAlpha()!==b.getAlpha()&&(d=!1,e.setAlpha(b.getAlpha()));a.getGradStartColor().equals(b.getGradStartColor())||(d=!1,e.setGradStartColor(b.getGradStartColor()));
a.getGradStartAlpha()!==b.getGradStartAlpha()&&(d=!1,e.setGradStartAlpha(b.getGradStartAlpha()));a.getGradEndColor().equals(b.getGradEndColor())||(d=!1,e.setGradEndColor(b.getGradEndColor()));a.getGradEndAlpha()!==b.getGradEndAlpha()&&(d=!1,e.setGradEndAlpha(b.getGradEndAlpha()));a.getBackgroundColor().equals(b.getBackgroundColor())||(d=!1,e.setBackgroundColor(b.getBackgroundColor()));a.getBackgroundAlpha()!==b.getBackgroundAlpha()&&(d=!1,e.setBackgroundAlpha(b.getBackgroundAlpha()));a.getBorderColor().equals(b.getBorderColor())||
(d=!1,e.setBorderColor(b.getBorderColor()));a.getBorderAlpha()!==b.getBorderAlpha()&&(d=!1,e.setBorderAlpha(b.getBorderAlpha()));a.getFillType()!==b.getFillType()&&(d=!1,e.setFillType(b.getFillType()));a.getBackgroundPadding()!==b.getBackgroundPadding()&&(d=!1,e.setBackgroundPadding(b.getBackgroundPadding()));a.getBorderThickness()!==b.getBorderThickness()&&(d=!1,e.setBorderThickness(b.getBorderThickness()));a.getDisplayBackground()!==b.getDisplayBackground()&&(d=!1,e.setDisplayBackground(b.getDisplayBackground()));
a.getFontClass()!==b.getFontClass()&&(d=!1,e.setFontClass(b.getFontClass()));a.getPadding()!==b.getPadding()&&(d=!1,e.setPadding(b.getPadding()));c!==k.DomType.Z_CIRCLE&&c!==k.DomType.Z_SQUARE&&b.getRadius()!==a.getCornerRadius()&&(d=!1,e.setCornerRadius(b.getRadius()));a.getThickness()!==b.getThickness()&&(d=!1,e.setThickness(b.getThickness()));a.getDeprecatedBackgroundPaddingVertical()!==b.getDeprecatedBackgroundPaddingVertical()&&(d=!1,e.setDeprecatedBackgroundPaddingVertical(b.getDeprecatedBackgroundPaddingVertical()));
a.getDeprecatedBackgroundPaddingHorizontal()!==b.getDeprecatedBackgroundPaddingHorizontal()&&(d=!1,e.setDeprecatedBackgroundPaddingHorizontal(b.getDeprecatedBackgroundPaddingHorizontal()));a.getAttachPadding()!==b.getAttachPadding()&&(d=!1,e.setAttachPadding(b.getAttachPadding()));return d?null:e}inlineStyles(a){const b=k.DOM.createUnsafeStyleBlockMatcher(a.getPrezi()),c=[];for(const h of n.Utils.toTypedIterable(a.getPrezi().getTypedZObjects())){var e=h.getId(),d=b.getMatchingStyleBlock(e,f.getObjectTypeFromDomType(h.getDomType()),
h.getStyleClasses());const a=this.originalIZObjectMap.get(e),g=this.styleBlockMatcher.getMatchingStyleBlock(e,f.getObjectTypeFromDomType(a.getDomType()),a.getStyleClasses());d=this.createStyleBlockToInline(d,g,a.getDomType());null!=d&&(e=k.DOM.createStyleDeclaration(d,k.DOM.createSimpleSelectorFromString(`#${e}`)),c.push(e))}for(const b of c)a.getPrezi().getTypedDocumentStyle().getTypedStyleDeclarations().append(b)}buildGroups(a){var b=new Map;for(const [a,d]of this.zgroups){b.set(a,a);for(var c of d)b.set(c,
a)}c=new Map;for(const [a,d]of b)b=c.get(d),null==b&&(b=[],c.set(d,b)),b.push(a);for(const e of c.values())b=e.map((b)=>a.lookup.simpleObject(b)).filter((a)=>null!=a),1<b.length&&a.overview.add.group(b)}}const be=f.getObjectTypeFromDomType(k.DomType.BACKGROUND),ua=f.getObjectTypeFromDomType(k.DomType.Z_TEXT),gb=f.getObjectTypeFromDomType(k.DomType.Z_LINE),ce=f.getObjectTypeFromDomType(k.DomType.Z_CIRCLE_FRAME),kc=f.getObjectTypeFromDomType(k.DomType.Z_CIRCLE),de=f.getObjectTypeFromDomType(k.DomType.Z_RECTANGLE_FRAME),
Eb=()=>(a)=>(b)=>b.getObjectType()===a,ya=Eb(),Gc=ya(k.ZObjectType.Z_GROUP),Td=ya(k.ZObjectType.Z_SQUARE),Vd=ya(k.ZObjectType.Z_TRIANGLE),Rd=ya(k.ZObjectType.Z_CIRCLE_FRAME),Ud=ya(k.ZObjectType.Z_RECTANGLE_FRAME),Sd=ya(k.ZObjectType.Z_CIRCLE),Wd=ya(k.ZObjectType.Z_INVISIBLE_FRAME),Zd=ya(k.ZObjectType.Z_SWF_GRAPHICS),Xd=ya(k.ZObjectType.Z_PENCIL),Yd=Eb()(k.BackgroundLayerType.BACKGROUND_SWF_GRAPHICS),$d=Eb()(k.PathStepType.FLY_TO_OBJECT),ae=Eb()(k.PathActionType.FADE_IN_OBJECT);var Fb={},lc=this&&
Fb.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function h(a){try{k(e.next(a))}catch(t){f(t)}}function g(a){try{k(e["throw"](a))}catch(t){f(t)}}function k(a){a.done?c(a.value):d(a.value).then(h,g)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(Fb,"__esModule",{value:!0});Fb.ConverterPluginArray=class{constructor(a){this.steps=a}convertPrezi(a,b){return lc(this,void 0,void 0,function*(){const c=yield this.convertPreziI(a,
b);return c.converted?c.iPrezi:a})}convert(a,b){return lc(this,void 0,void 0,function*(){const c=yield this.convertPreziI(a.getPrezi().freeze(),b);c.converted&&a.updateAndCommitWithoutHistoryTracking(()=>{a.updatePrezi(c.iPrezi)})})}convertPreziI(a,b){return lc(this,void 0,void 0,function*(){let c=!1;const e=[];var f=b.getMainStage().getRenderer().getAssetManager();for(var g of this.steps){var k=yield g.convertPrezi(a,f);k.converted&&(c=!0,a=k.iPrezi,null!=k.convertWithApi&&e.push(k.convertWithApi))}if(0<
e.length){f=d.CetModelEditor.cetSessionFactory().createCetSessionWithIPrezi(a);g=b.createSubCetApplication({speedMeasurementOptions:{measureSpeed:!1}},f,!1);k=yield d.CetModelEditor.createRunnerForCetApp(g,null,void 0);for(const a of e)yield a(k);a=f.getIPrezi();g.kill()}return c?{converted:!0,iPrezi:a}:{converted:!1}})}};var Gb={},ee=this&&Gb.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function h(a){try{k(e.next(a))}catch(t){f(t)}}
function g(a){try{k(e["throw"](a))}catch(t){f(t)}}function k(a){a.done?c(a.value):d(a.value).then(h,g)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(Gb,"__esModule",{value:!0});Gb.EnsureFilterStyleConverter=class extends La.BaseConvertStep{constructor(){super("filter_style",!0)}createContext(a){const b=[];for(let c=a.getDocumentStyle().getStyleDeclarations().iterator();c.hasNext();){const a=c.next().getStyleSelector().getClassNameSelector();n.isFromEnum(a,d.base.ShapelikeFilterStyle)?b.push(a):
n.isFromEnum(a,d.base.FullBlendShapelikeFilterStyle)&&b.push(a)}return{filterStyles:b,iPrezi:a}}shouldConvert(a){return Fa.isActive("js-disable-filterstyle-conversion")?!1:10>a.filterStyles.length}convert(a){return ee(this,void 0,void 0,function*(){const {iPrezi:b,filterStyles:c}=a;let e=this.getColorsFromTheme(b);0===e.size&&(e=this.getColorsFromShapeStyles(b));if(0<e.size){const a=k.DOM.loadXml(k.DOM.saveXml(b)),d=a.getDocumentStyle().getStyleDeclarations(),f=Array.from(e.keys()).filter((a)=>-1===
c.indexOf(a));this.removeExistingStyleClassesFromObjects(a,f);f.forEach((a)=>{d.append(this.createFilterDeclaration(a,e.get(a)))});return{iPrezi:a}}return{iPrezi:b}})}getColorsFromTheme(a){var b=a.getDocumentStyle().getThemeColors();a=new Map;null!=b&&(b=k.DOM.RuntimeTypeInfo().safeCastToFixedThemeColors(b),null!=b&&(a.set(d.base.ShapelikeFilterStyle.Filter1,b.getColor1()),a.set(d.base.ShapelikeFilterStyle.Filter2,b.getColor2()),a.set(d.base.ShapelikeFilterStyle.Filter3,b.getColor3()),a.set(d.base.ShapelikeFilterStyle.Filter4,
b.getColor4()),a.set(d.base.ShapelikeFilterStyle.Filter5,b.getColor5()),a.set(d.base.FullBlendShapelikeFilterStyle.Filter1,b.getColor1()),a.set(d.base.FullBlendShapelikeFilterStyle.Filter2,b.getColor2()),a.set(d.base.FullBlendShapelikeFilterStyle.Filter3,b.getColor3()),a.set(d.base.FullBlendShapelikeFilterStyle.Filter4,b.getColor4()),a.set(d.base.FullBlendShapelikeFilterStyle.Filter5,b.getColor5())));return a}getColorsFromShapeStyles(a){const b=new Map,c=new Map,e=new Map;for(a=a.getDocumentStyle().getStyleDeclarations().iterator();a.hasNext();){var f=
a.next();const c=f.getStyleSelector().getClassNameSelector();n.isFromEnum(c,d.base.ShapeStyle)&&(f=this.getMainColorFromFillData(f.getStyleBlock()),null!=f&&b.set(c,f))}b.has(d.base.ShapeStyle.Poly1)&&(c.set(d.base.ShapelikeFilterStyle.Filter1,b.get(d.base.ShapeStyle.Poly1)),e.set(d.base.FullBlendShapelikeFilterStyle.Filter1,b.get(d.base.ShapeStyle.Poly1)));b.has(d.base.ShapeStyle.Poly2)&&(c.set(d.base.ShapelikeFilterStyle.Filter2,b.get(d.base.ShapeStyle.Poly2)),e.set(d.base.FullBlendShapelikeFilterStyle.Filter2,
b.get(d.base.ShapeStyle.Poly2)));b.has(d.base.ShapeStyle.Poly3)&&(c.set(d.base.ShapelikeFilterStyle.Filter3,b.get(d.base.ShapeStyle.Poly3)),e.set(d.base.FullBlendShapelikeFilterStyle.Filter3,b.get(d.base.ShapeStyle.Poly3)));b.has(d.base.ShapeStyle.Poly4)&&(c.set(d.base.ShapelikeFilterStyle.Filter4,b.get(d.base.ShapeStyle.Poly4)),e.set(d.base.FullBlendShapelikeFilterStyle.Filter4,b.get(d.base.ShapeStyle.Poly4)));b.has(d.base.ShapeStyle.Poly5)&&(c.set(d.base.ShapelikeFilterStyle.Filter5,b.get(d.base.ShapeStyle.Poly5)),
e.set(d.base.FullBlendShapelikeFilterStyle.Filter5,b.get(d.base.ShapeStyle.Poly5)));return new Map([...c,...e])}getMainColorFromFillData(a){switch(a.getFillType()){case f.FillType.Solid:return a.getColor();case f.FillType.Linear:case f.FillType.Radial:return a.getGradStartColor();default:return null}}removeExistingStyleClassesFromObjects(a,b){for(a=a.getZObjects().iterator();a.hasNext();){const c=a.next();for(let a=0;a<c.getStyleClasses().length();a++)null!=b.find((b)=>b===c.getStyleClasses().get(a))&&
(c.getStyleClasses().remove(a),a--)}}createFilterDeclaration(a,b){const c=k.DOM.createStyleBlock(),e=n.isFromEnum(a,d.base.FullBlendShapelikeFilterStyle)?1:.8;c.setColorFilter(k.DOM.createSolidColorBlend(e,b));a=k.DOM.createSimpleSelectorFromString(`*.${a}`);return k.DOM.createStyleDeclaration(c,a)}};var mc={};Object.defineProperty(mc,"__esModule",{value:!0});mc.EntityHitImpl=class{constructor(a){this.data=a;this.hitTagBits=0;this.hitTagBits=this.createHitTagBits(a.hitTags)}getEntityId(){return this.data.entity.getId()}is(a){return!!(this.hitTagBits&
1<<a)}compare(a){let b=this.data.layerIndex-a.getData().layerIndex;return-1*(0===b?this.data.zIndex-a.getData().zIndex:b)}getData(){return this.data}createHitTagBits(a){let b=0;for(let c=0;c<a.length;++c)b|=1<<a[c];return b}};var va={};Object.defineProperty(va,"__esModule",{value:!0});const hb=Math.pow(2,-30);va.ConnectorFixer=class{constructor(){this.lineCalc=F.CetRendererModule.CurvedLineCalculation()}processConnector(a,b){this._processConnector(a,b);var c=b.getWrapper(f.CetModel.ID.Z_LINE.W);if(this.isDegenerate(b,
a)){0!==c.getArcHeight()&&(b.getMutableWrapper(f.CetModel.ID.Z_LINE.W).setArcHeight(0),b.set(d.CetModelEditor.getConnectorArcHeightKey(),0));if(b.isDef(f.CetModel.ID.Z_ARROW))for(c=b.getComponent(F.CetRendererModule.getDrawComponentKey());!c.isValidThicknessLenghtRatio(b);){const a=b.getMutableWrapper(f.CetModel.ID.HAS_THICKNESS.W);a.setThickness(a.getThickness()/2)}this._processConnector(a,b)}}_processConnector(a,b){let c=!1,e=!1;const h=b.getWrapper(f.CetModel.ID.Z_LINE.W);var g=l.Cet.createHierarchyQuery(a).getParentOrOverview(b);
g=a.getEntityById(g);var k=this.lineCalc.getStartPoint(h),m=this.lineCalc.getEndPoint(h),w=this.lineCalc.isInverse(h),n=h.getLocalToWorld(),x=n.transformPoint(k);const t=n.transformPoint(m);m=x;k=t;let q=null,u=null;var v=b.getWrapper(f.CetModel.ID.CONNECTOR.W).getConnectorTail();v=null!=v?v.getTarget():"";null!=v&&""!==v&&(q=a.getEntityById(v),m=va.ConnectorFixer.getCenter(v,a),this.onCircle(h,m,x,t)||(c=!0));v=b.getWrapper(f.CetModel.ID.CONNECTOR.W).getConnectorHead();v=null!=v?v.getTarget():"";
null!=v&&""!==v&&(u=a.getEntityById(v),k=va.ConnectorFixer.getCenter(v,a),this.onCircle(h,k,x,t)||(e=!0));if(null!=q||null!=u)v=l.Cet.curvedLine(b),c||e?(x=b.get(d.CetModelEditor.getConnectorArcHeightKey()),x=null!=x?x:v.getArcHeight(),n=this.lineCalc.getCurve(m,k,x,n,w),a=this.calculateTrimmedCurvePositions(a,n,h,q,u,m,k,l.Cet.world(g).getWorldBounds()),null!=a.startPoint&&null!=a.endPoint&&this.setTrimmedCurve(b,n,a)):(w=this.lineCalc.getCurveCircleWorld(h,n),n=this.lineCalc.getCurveFromChord(w,
n.getScale(),m,k,0>v.getArcHeight()),a=this.calculateTrimmedCurvePositions(a,n,h,q,u,m,k,l.Cet.world(g).getWorldBounds()),null!=a.startPoint&&null!=a.endPoint&&(va.ConnectorFixer.closeTo(x,a.startPoint,Da.EditorConnectorFixerSystem.epsilon)&&va.ConnectorFixer.closeTo(t,a.endPoint,Da.EditorConnectorFixerSystem.epsilon)?b.set(d.CetModelEditor.getConnectorArcHeightKey(),n.curvedLine.getArcHeight()):this.setTrimmedCurve(b,n,a)))}calculateTrimmedCurvePositions(a,b,c,e,d,g,k,m){null!=e&&(g=l.Cet.createBoundsCalculator(a).getWorldBoundsForLayout(e.getId(),
l.TextBoundsOptions.TextBox),e=this.lineCalc.getAttachPaddingInWorld(c.is(f.CetModel.ID.Z_ARROW),l.Cet.transform(c.getEntity()).getLocalToWorld(),c,c,m,g),g=this.lineCalc.getConnectorEndPoint(b,e,g,!0));null!=d&&(a=l.Cet.createBoundsCalculator(a).getWorldBoundsForLayout(d.getId(),l.TextBoundsOptions.TextBox),c=this.lineCalc.getAttachPaddingInWorld(c.is(f.CetModel.ID.Z_ARROW),l.Cet.transform(c.getEntity()).getLocalToWorld(),c,c,m,a),k=this.lineCalc.getConnectorEndPoint(b,c,a,!1));return{startPoint:g,
endPoint:k}}setTrimmedCurve(a,b,c){let e=b.curvedLine.getArcHeight(),f=this.lineCalc.getCurveFromChordAndArcHeight(b.curvedLine.getStartEndDistance(),e,b.localToWorld,b.localToWorld.getScale(),c.startPoint,c.endPoint);Math.abs(f.curvedLine.getArcHeight()/f.curvedLine.getStartEndDistance())<Da.EditorConnectorFixerSystem.minimalArcHeightRatio&&(e=0,f=this.lineCalc.getCurveFromChordAndArcHeight(b.curvedLine.getStartEndDistance(),e,b.localToWorld,b.localToWorld.getScale(),c.startPoint,c.endPoint));this.setTransformedCurvedLine(a,
f);a.set(d.CetModelEditor.getConnectorArcHeightKey(),e)}setTransformedCurvedLine(a,b){this.lineCalc.validateCurvedLineData(b.localToWorld.getScale(),b.curvedLine.getArcHeight(),b.curvedLine.getStartEndDistance());const c=l.Cet.getMutableCurvedLine(a);a=l.Cet.updateTransform(a);a.getLocalToWorld().equalsWithin(b.localToWorld,hb)||a.setLocalToWorld(b.localToWorld);Math.abs(c.getStartEndDistance()-b.curvedLine.getStartEndDistance())>hb&&c.setStartEndDistance(b.curvedLine.getStartEndDistance());Math.abs(c.getArcHeight()-
b.curvedLine.getArcHeight())>hb&&c.setArcHeight(b.curvedLine.getArcHeight())}onCircle(a,b,c,e){a=this.lineCalc.getCurveCircleWorld(a,a.getLocalToWorld());return 0===a.getRadius()?this.lineCalc.isPointOnStraightLine(c,e,b):this.lineCalc.isPointOnCircle(a,b)}isValidThicknessArrow(a){return a.isDef(f.CetModel.ID.Z_ARROW)?a.getComponent(F.CetRendererModule.getDrawComponentKey()).isValidThicknessLenghtRatio(a):!0}isDegenerate(a,b){var c=a.getWrapper(f.CetModel.ID.Z_LINE.W),e=c.getLocalToWorld(),d=e.transformPoint(this.lineCalc.getStartPoint(c));
c=e.transformPoint(this.lineCalc.getEndPoint(c));e=d;let g=c;var k=a.getWrapper(f.CetModel.ID.CONNECTOR.W).getConnectorTail();k=null!=k?k.getTarget():"";null!=k&&""!==k&&(e=l.Cet.world(b.getEntityById(k)).getWorldBounds().getCenter());k=a.getWrapper(f.CetModel.ID.CONNECTOR.W).getConnectorHead();k=null!=k?k.getTarget():"";null!=k&&""!==k&&(g=l.Cet.world(b.getEntityById(k)).getWorldBounds().getCenter());if(va.ConnectorFixer.closeTo(e,g,hb)||va.ConnectorFixer.closeTo(d,c,hb)||!this.isValidThicknessArrow(a))return!0;
a=q.Geometry.fromPoint(g).sub(q.Geometry.fromPoint(e));d=q.Geometry.fromPoint(c).sub(q.Geometry.fromPoint(d));d=a.dot(d)/(a.length()*d.length());1<d&&(d=1);-1>d&&(d=-1);return Math.acos(d)>Math.PI/2}static getCenter(a,b){return l.Cet.createBoundsCalculator(b).getWorldBoundsForLayout(a,l.TextBoundsOptions.TextBox).getCenter()}static closeTo(a,b,c){return Math.abs(a.x-b.x)<c&&Math.abs(a.y-b.y)<c}};var Da={};Object.defineProperty(Da,"__esModule",{value:!0});Da.EditorConnectorFixerSystem=class{constructor(){this.connectorFixer=
new va.ConnectorFixer}getName(){return"EditorConnectorSystem"}select(a){if(a.isDef(f.CetModel.ID.CONNECTOR)||a.isDef(f.CetModel.ID.CONNECTOR_END))return!0;a=a.get(f.CetModel.ID.CONNECTOR_END.TARGET_PARENT);return null!=a&&0<a.length}getTriggerKeys(){return[f.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD,F.CetRendererModule.getLocalBoundsComponentKey(),...f.CetModel.ID.CONNECTOR.getFields(),...f.CetModel.ID.CONNECTOR_END.getFields(),F.CetRendererModule.getWorldGeometryComponentKey()]}process(a,b){const c=
(a)=>{a=a.get(f.CetModel.ENTITY_OWNER_ID());return null!=a?b.getEntityById(a):null},e=[],d=[],g=[];for(let h of a)h.isDef(f.CetModel.ID.CONNECTOR)?e.push(h):h.isDef(f.CetModel.ID.CONNECTOR_END)?d.push(c(h)):(a=h.get(f.CetModel.ID.CONNECTOR_END.TARGET_PARENT),null!=a&&0<a.length&&a.forEach((a)=>{a=b.getEntityById(a);null!=a&&g.push(c(a))}));[...e,...d,...g].forEach((a)=>{null!=a&&this.connectorFixer.processConnector(b,a)})}changesPdomComponents(){return!0}};Da.EditorConnectorFixerSystem.epsilon=.1;
Da.EditorConnectorFixerSystem.minimalArcHeightRatio=1/75;var nc={};Object.defineProperty(nc,"__esModule",{value:!0});nc.HideDegenerateConnectorsFixerSystem=class{constructor(){this.lineCalc=F.CetRendererModule.CurvedLineCalculation();this.connFixer=new va.ConnectorFixer}getName(){return"HideDegenerateConnectorsFixerSystem"}reset(){}getTriggerKeys(){return f.CetModel.ID.CURVED_LINE.getFields()}select(a){return null!=a.getComponent(f.CetModel.ID.CONNECTOR.CONNECTOR_HEAD)||null!=a.getComponent(f.CetModel.ID.CONNECTOR.CONNECTOR_TAIL)}process(a,
b){return this.processI(a,b)}processI(a,b){for(let c=0;c<a.length;c++){const e=a[c];this.connFixer.isDegenerate(e,b)?e.getMutableWrapper(f.CetModel.ID.CONNECTOR.W).setDegenerateInvisible(!0):e.getMutableWrapper(f.CetModel.ID.CONNECTOR.W).setDegenerateInvisible(!1)}}initializeEntities(a,b){this.processI(b,a)}changesPdomComponents(){return!0}};var oc={};Object.defineProperty(oc,"__esModule",{value:!0});var Va;(function(a){a[a.noop=0]="noop";a[a.all=1]="all";a[a.keepStack=2]="keepStack"})(Va||(Va={}));
oc.LegacyInserterImpl=class{constructor(){this.logger=Q.LoggerModule.getLoggerManager().createLogger("InserterImpl")}insertLegacy(a,b,c,e){return this.insertLegacyI(a,b,(a,b,e,d)=>c.findPosition(a,b,e,d),e)}insertLegacyI(a,b,c,e){if(!this.canPaste(a.executionContext.mscene,b.doc))throw Error("Cannot paste");const f=a.executionContext.mscene,p=b.targetParentId,r=f.getEntityById(p);this.cleanSnippet(p,b.doc,f);const m=k.DOM.IPreziCopy().copyPrezi(l.Cet.fixIPrezi(b.doc,a.generation)),n=W.InserterImpl.pasteObjects(a,
m),q=[];for(var x=n.getZObjects().iterator();x.hasNext();)q.push(x.next().getId());f.runSystems(l.UpdatePhase.DOCUMENT);this.handlePastedPendingImages(m,n,f);x=[];let t=[];const u=[],v=l.Cet.createHierarchyQuery(f);var y=d.CetModelEditor.createTopicQuery(f);const C=W.InserterImpl.collectGroups(f,n);for(var B of q){var A=f.getEntityById(B);A=v.getParentId(A);null==A?d.CetModelEditor.isPlanetOrStack(B,f)?t.push(B):d.CetModelEditor.isPage(B,f)?x.push(B):u.push(B):y.getTopicKind(A)===d.TopicKind.Stack&&
y.getTopicKind(B)===d.TopicKind.Page&&x.push(B)}t=this.sortByPathOccurance(t,n,f);B=d.CetModelEditor.isOverviewThatUsesChapters(p,f);y=d.CetModelEditor.isPlanet(p,f);if(B||y)this.insertOnPlanetOrOverview(a,f,t,u,a.lookup.topicParent(p),b,B,n,c,e);else{e=a.lookup.baseEditor(p);e=e.is(d.base.ObjectKind.page)||e.is(d.base.ObjectKind.stackTopic)?e:null;if(null==e)throw Error("Invalid paste target:"+p);this.insertOnPageOrStack(f,t,u,x,e,b,n,c)}f.runSystems(l.UpdatePhase.DOCUMENT);this.logTopicInserts(f,
q.filter((a)=>v.isZTopicContainer(a)));f.runSystems(l.UpdatePhase.DOCUMENT);b.insertAsContent?this.insertAsContent(f,q,r):this.insertIntoCoverLegacy(a,f,m,q,r);W.InserterImpl.reconstructGroups(f,C,m);0<t.length&&(b=a.lookup.base(p),b.is(d.base.ObjectKind.topicParent)&&g.Check.as("layout",b.layout,"BaseTopicLayoutEditor",db.BaseLayoutEditor).applyLayout({kind:d.base.TopicLayoutEventKind.adjust,topics:t.map((b)=>a.lookup.topic(b))}));f.runSystems(l.UpdatePhase.DOCUMENT);return{ids:q,pageIds:x,topLevelChapterIds:t,
topLevelSimpleObjectIds:u}}sortByPathOccurance(a,b,c){const e=(a,b)=>{for(let c=0;c<b.length;++c){const e=b[c];if(f.CetModel.domPathKludge.isFlyToObjectEp(e)&&e.getTarget()===a)return c}return-1},h=(a,b,c)=>{const f=e(a,b);return-1<f?f:c.getTopicKind(a)===d.TopicKind.Stack&&(a=c.getChildTopics(a),0<a.length)?e(a[0],b):-1},g=d.CetModelEditor.createTopicQuery(c),k=l.Cet.pathKludge.getIEditorPathStepsFromIPrezi(b);return a.sort((a,b)=>h(a,k,g)-h(b,k,g))}insertOnPlanetOrOverview(a,b,c,e,d,f,g,k,n,u){var h=
!1;if(f.singlePageCopied)e=Object.assign(Object.assign({},f),{worldHeight:null,worldWidth:null}),this.positionObjects(b,e,c,n);else if(e=[...c,...e],d.id!==f.originalParent){const a=l.Cet.createBoundsCalculator(b),c=e.reduce((b,c)=>null==b?a.getAnchorWorldBounds(c,l.TextBoundsOptions.Visible).getObb():b.union(a.getAnchorWorldBounds(c,l.TextBoundsOptions.Visible).getObb()),null);h=null!=f.viewportInWorld?q.Geometry.obbFromRect(f.viewportInWorld.getData()):null!=f.originalParentWorldBounds?f.originalParentWorldBounds:
c;n=b.getEntityById(d.id);n=l.Cet.world(n).getWorldBounds();const g=null!=f.originalParentWorldBounds?f.originalParentWorldBounds.getRotationDegrees():0,k=n.getRotationDegrees()-g,p=m.CetModelEditorInternal.createEntityEditor(b);e.forEach((a)=>{var e=b.getEntityById(a);e=l.Cet.transform(e).getLocalToWorld().rotateDegAroundPoint(c.getCenter(),k);p.transformSubtree(a,e)});u=u.getMarginCorrectedViewportInWorld();u=q.Geometry.obbFromRect(u.getData());this.transformEntities(b,e,h,u);h=!0}else h=1<c.length,
this.positionObjects(b,f,e,n);e=null;0<c.length&&(e=this.addToSmartStructureAndHierarchy(a,b,c,f,d,g,h));W.InserterImpl.importPath(b,k,d,e)}addToSmartStructureAndHierarchy(a,b,c,e,h,g,k){const l=d.CetModelEditor.createSmartStructureEditor(b);let p=null,r=null;if(null!=e.currentSelection){const a=d.CetModelEditor.createEntityEditor(b).getSmartStructure(h.id),c=b.getEntityById(a).getWrapper(f.CetModel.ID.SMART_STRUCTURE.W).getChildren().items();e=e.currentSelection.filter((a)=>-1!==c.indexOf(a));0<
e.length&&(p=e[e.length-1],r=c.indexOf(p)+1)}g||this.addEntitiesToParent(c,h.id,b);b=c.map((b)=>a.lookup.topic(b));l.addToSmartStructure(b,h,k?d.SmartStructureAddIntention.pasteKeepTransform:d.SmartStructureAddIntention.paste,r);return p}insertOnPageOrStack(a,b,c,e,f,g,k,m){const h=d.CetModelEditor.createEntityEditor(a),p=l.Cet.createHierarchyQuery(a);for(let b of e){e=a.getEntityById(b);e=l.Cet.world(e).getWorldBounds();const c=a.getEntityById(f.id),d=l.Cet.world(c).getWorldBounds();this.transformEntities(a,
p.getDescendantEntities([b]),e,d);e=p.getParentId(c);e=a.getEntityById(e);h.moveUnderParent(e.getId(),b)}h.removeZObjects(b);W.InserterImpl.importPath(a,k,f);this.positionObjects(a,g,c,m)}positionObjects(a,b,c,e){e=this.calculateDestinationBounds(a,b,b.positionRelativeToId,e);this.transformEntities(a,c,b.originalWorldBounds,e)}logTopicInserts(a,b){for(let c of b)this.logger.info({action:"create",object:"topic",trigger:"machine",payload:{user_intent_id:"",object_id:c,object_depth:l.Cet.createHierarchyQuery(a).getDepthOfEntity(c)}})}cleanSnippet(a,
b,c){let e=[];d.CetModelEditor.createTopicQuery(c).getTopicKind(a)===d.TopicKind.Page&&(e=e.concat(this.removeObjectsFromSnippet(b,(a)=>null!=a.getTopic&&a.getTopic().getObjectType()!==k.TopicType.PAGE&&a.getTopic().getObjectType()!==k.TopicType.STACK_CHAPTER,Va.keepStack)));this.removeLooseConnectorEnds(b);this.removeObjectsFromSnippet(b,(a)=>a.getObjectType()===k.ZObjectType.Z_IMAGE?null==a.getOnlineAssetUrl()&&null==c.getEntityById(a.getId()):!1,Va.noop)}calculateDestinationBounds(a,b,c,e){const f=
b.originalWorldBounds,g=b.originalParent;var k=a.getEntityById(c);k=l.Cet.world(k).getWorldBounds();if(b.originalParentIsPage&&d.CetModelEditor.isPage(c,a)&&c!==g&&void 0!==b.originalParentWorldBounds)return b=q.Geometry.getFitTransform(b.originalParentWorldBounds,k,!0),f.transform(b);a=e(f.getWidth(),f.getHeight(),b.stageX,b.stageY);c=null!=b.originalParentWorldBounds?b.originalParentWorldBounds.getRotationDegrees():0;k=f.getRotationDegrees()-c+k.getRotationDegrees();return null!=b.worldWidth&&null!=
b.worldHeight?q.Geometry.obbFromData(0,0,b.worldWidth,b.worldHeight,k).setPosition(a.localToWorld.getTranslation().x,a.localToWorld.getTranslation().y):q.Geometry.obbFromData(0,0,f.getWidth(),f.getHeight(),k).transform(a.localToWorld)}transformEntities(a,b,c,e){if(null!=c&&null!=e){const d=q.Geometry.getFitTransform(c,e,!0),f=m.CetModelEditorInternal.createEntityEditor(a);b.forEach((b)=>{var c=a.getEntityById(b);c=l.Cet.transform(c).getLocalToWorld().concat(d);f.transformSubtree(b,c)})}}removeLooseConnectorEnds(a){const b=
[];for(var c=0;c<a.getZObjects().length();c++)b.push(a.getZObjects().get(c).getId());for(c=0;c<a.getZObjects().length();c++){let e=a.getZObjects().get(c);null!=e.getConnectorHead&&null!=e.getConnectorHead()&&-1===b.indexOf(e.getConnectorHead().getTarget())&&e.setConnectorHead(null);null!=e.getConnectorTail&&null!=e.getConnectorTail()&&-1===b.indexOf(e.getConnectorTail().getTarget())&&e.setConnectorTail(null)}}removeObjectsFromSnippet(a,b,c){let e=[];const d=[];for(let c=a.getZObjects().length()-1;0<=
c;c--){var f=a.getZObjects().get(c);if(b(f)&&(e.push(f.getId()),a.getZObjects().remove(c),null!=f.getTopic))if(f=f.getTopic(),null!=f.getTopicChildren)for(f=f.getTopicChildren().iterator();f.hasNext();)d.push(f.next().getChild());else if(null!=f.getChildren)for(f=f.getChildren().iterator();f.hasNext();)d.push(f.next())}0<d.length&&c!==Va.noop&&(a=this.removeObjectsFromSnippet(a,c===Va.keepStack?(a)=>-1<d.indexOf(a.getId())&&(null==a.getTopic||a.getTopic().getObjectType()!==k.TopicType.STACK_CHAPTER):
(a)=>-1<d.indexOf(a.getId()),c),e=e.concat(a));return e}addEntitiesToParent(a,b,c){let e=c.getEntityById(b);if(e&&l.Cet.createHierarchyQuery(c).isZTopicContainer(b)){b=d.CetModelEditor.createEntityEditor(c);for(let d=0;d<a.length;++d){let f=c.getEntityById(a[d]);null===l.Cet.createHierarchyQuery(c).getParentId(f)&&b.moveUnderParent(e.getId(),a[d])}}}findPendingImages(a){let b=[];for(a=a.getZObjects().iterator();a.hasNext();){let c=a.next();c.getObjectType()===k.ZObjectType.Z_IMAGE&&null==c.getOnlineAssetUrl()&&
b.push(c.getId())}return b}handlePastedPendingImages(a,b,c){a=this.findPendingImages(a);b=this.findPendingImages(b);for(let d=0;d<a.length;d++){var e=c.getEntityById(a[d]);const f=c.getEntityById(b[d]);null!=e&&null!=f&&(e=e.get(F.CetRendererModule.getThumbnailImageKey()),null!=e&&f.set(F.CetRendererModule.getThumbnailImageKey(),e))}}insertAsContent(a,b,c){a=d.CetModelEditor.createEntityEditor(a);c=c.getId();for(let e of b)a.moveUnderParent(c,e,!0)}insertIntoCoverLegacy(a,b,c,e,f){const h=l.Cet.createTopicChildrenQuery(b),
g=e.filter((a,b)=>!h.isVisibleOutsideAndInside(c.getZObjects().get(b).getId())),k=e.filter((a,b)=>h.hasBehavior(c.getZObjects().get(b).getId(),l.TopicChildBehavior.Visual)),m=e.filter((a,b)=>h.hasBehavior(c.getZObjects().get(b).getId(),l.TopicChildBehavior.Surface)),n=a.lookup.topic(f.getId());ud.AppUtilsModule.getLogHelperUtils().addCoverItems(this.logger,f.getId(),e);e=b.getEntityList().getMutableEntitiesById([...g,...k,...m]);d.CetModelEditor.createLayoutEditor().layoutCoversToCenter(b,e,f);g.forEach((b)=>
{const c=a.lookup.transformedObject(b).layoutBox;a.lookup.simpleObject(b).setParentAndFitInto(n.cover,c)});k.forEach((b)=>{const c=a.lookup.transformedObject(b).layoutBox;a.lookup.simpleObject(b).setParentAndFitInto(n.visual,c)});const q=n.is(d.base.ObjectKind.planetTopic)?n.surface:n.cover;m.forEach((b)=>{const c=a.lookup.transformedObject(b).layoutBox;a.lookup.simpleObject(b).setParentAndFitInto(q,c)})}canPaste(a,b){a=a.getPreziW().toIPdom();return W.InserterImpl.documentGenerationMatch(a,b)}};
var Ea={};Object.defineProperty(Ea,"__esModule",{value:!0});Ea.PositionFinderImpl=class{constructor(a){this.cameraAccess=a}getWorldReferenceFrame(){return new u.ReferenceFrameImpl(q.Geometry.transform2dIdentity())}findPosition(a,b,c,e){return this.findPositions([{width:a,height:b}],c,e)[0]}findLayoutBox(a,b,c,e,d){return this.findLayoutBoxes(a,[{width:b,height:c}],e,d)[0]}findPositions(a,b,c){const e=this.calculateGridSize(a.length);b=this.calculateFirstArea(e,b,c);c=[];for(let h=0;h<e.height;h++)for(let g=
0;g<e.width;g++){var d=h*e.width+g;if(d<a.length){var f=this.moveRectangle(b,{x:g*b.getWidth(),y:h*b.getHeight()});d=a[d];d=this.calculateRelativeScale(d.width,d.height,f);f=f.getCenter();const e=this.cameraAccess.getCameraTransform().getRotationRad();c.push({localToWorld:q.Geometry.transform2dFromRad(f,d,-e),zIndex:-1})}}return c}findLayoutBoxes(a,b,c,e){if(a.is(d.base.ObjectKind.cover)){c=this.calculateGridSize(b.length);e=a.parent.layoutBox.scale(.66);a=e.size;a={width:a.width/c.width,height:a.height/
c.height};e=e.withSize(a).move(d.base.AnchorPoint.topLeft,e.topLeft);const f=[];for(let b=0;b<c.height;b++)for(let d=0;d<c.width;d++)f.push(e.translate({x:d*a.width,y:b*a.height}));return f}return this.findPositions(b,c,e).map((a)=>a.localToWorld).map((a,c)=>(new u.ReferenceFrameImpl(a)).layoutBox({x:0,y:0},b[c]))}getCameraLayoutBox(){return this.cameraAccess.getScreenLayoutBox()}calculateFirstArea(a,b,c){let e=this.cameraAccess.getStageAreaInWorld();e=e.inflate(-e.getWidth()*(1-Ea.PositionFinderImpl.SCREEN_FILL_FACTOR)/
2,-e.getHeight()*(1-Ea.PositionFinderImpl.SCREEN_FILL_FACTOR)/2);"number"===typeof b&&"number"===typeof c?(b=this.cameraAccess.getStagePointInWorld({x:b,y:c}),e=this.setRectangleCenter(e,b)):Fa.FeatureSwitcher.isActive("js-for-test-no-random-position")||(b=this.cameraAccess.getStageAreaInWorld().getWidth()*Ea.PositionFinderImpl.DISPOSITION_FACTOR,e=this.moveRectangle(e,{x:Math.round(b*(Math.random()-.5)),y:Math.round(b*(Math.random()-.5))}));return this.scaleDownRectangleWithUnchangedPosition(e,a)}setRectangleCenter(a,
b){return q.Geometry.rectangleFromData({x:b.x-a.getWidth()/2,y:b.y-a.getHeight()/2,width:a.getWidth(),height:a.getHeight()})}moveRectangle(a,b){return q.Geometry.rectangleFromData({x:a.getData().x+b.x,y:a.getData().y+b.y,width:a.getWidth(),height:a.getHeight()})}scaleDownRectangleWithUnchangedPosition(a,b){return q.Geometry.rectangleFromData({x:a.getData().x,y:a.getData().y,width:a.getData().width/b.width,height:a.getData().height/b.height})}calculateGridSize(a){const b=Math.floor(Math.sqrt(a));return{width:Math.ceil(a/
b),height:b}}calculateRelativeScale(a,b,c){a=c.getWidth()/a;b=c.getHeight()/b;return a<b?a:b}findTopicPosition(a,b){return(new ja.TopicPositionFinder).findTopicPosition(a.parent,a.index,b)}getDefaultTopicWidthToContainerRatio(){return ja.TopicPositionFinder.NEW_CHAPTER_TO_CONTAINER_RATIO}};Ea.PositionFinderImpl.SCREEN_FILL_FACTOR=.33;Ea.PositionFinderImpl.DISPOSITION_FACTOR=.1;var Hb={};Object.defineProperty(Hb,"__esModule",{value:!0});Hb.CetLayout=class{static getTransformBetweenAreas(a,b){b=Hb.CetLayout.fitCenteredBoxIntoArea(a.getWidth(),
a.getHeight(),b);b=q.Geometry.obbFromData(0,0,a.getWidth(),a.getHeight(),0).transform(b);return q.Geometry.getFitTransform(a,b,!0)}static fitCenteredBoxIntoArea(a,b,c){a=c.getWidth()/a;b=c.getHeight()/b;b=Math.min(a,b);return q.Geometry.transform2dFromRad(c.getCenter(),b,c.getRotationRadians())}};var Ma={};Object.defineProperty(Ma,"__esModule",{value:!0});Ma.LayoutEditorImpl=class{getPageHeightToChapterRatio(a){return a.getDef()===f.CetModel.ID.Z_CIRCLE_FRAME||a.isDef(f.CetModel.ID.Z_CIRCLE)?Ma.LayoutEditorImpl.PAGE_SIZE_FACTOR_FOR_CIRCLE:
Ma.LayoutEditorImpl.PAGE_SIZE_FACTOR_FOR_RECT}layoutCoversToCenter(a,b,c){a=l.Cet.createBoundsCalculator(a).getWorldBoundsForInteraction(c.getId(),l.TextBoundsOptions.TextBox).getObb();c=l.Cet.world(b[0]).getWorldBounds();for(var e=1;e<b.length;++e)c=c.union(l.Cet.world(b[e]).getWorldBounds());e=1;c.getWidth()>a.getWidth()&&(e=Math.min(e,.66*a.getWidth()/c.getWidth()));c.getHeight()>a.getHeight()&&(e=Math.min(e,.66*a.getHeight()/c.getHeight()));e=c.setSize(c.getWidth()*e,c.getHeight()*e);e=e.setPosition(a.getCenter().x,
a.getCenter().y);a=m.CetModelEditorInternal.getTransformBetweenAreas(c,e);for(c=0;c<b.length;++c)e=l.Cet.transform(b[c]).getLocalToWorld().concat(a),l.Cet.updateTransform(b[c]).setLocalToWorld(e)}localToWorldCompute(a,b,c){return q.Geometry.getFitTransform(q.Geometry.obbFromRect(b.getData()),c,!0).concat(a)}};Ma.LayoutEditorImpl.PAGE_SIZE_FACTOR_FOR_RECT=.6;Ma.LayoutEditorImpl.PAGE_SIZE_FACTOR_FOR_CIRCLE=.3;var pc={};Object.defineProperty(pc,"__esModule",{value:!0});pc.TopicLayoutTrackerImpl=class{constructor(a,
b=[f.CetModel.ID.VISUAL,f.CetModel.ID.COVER]){this.scene=a;this.trackedBehaviors=b;this.getTopicWrapperEntityIdForTopicTransformTracker=(a)=>{if(!a.hasComponent(l.Cet.getPdomCompKey())&&!a.hasComponent(f.CetModel.PENDING_INSERT()))return null;let b=a;if(a.isDef(f.CetModel.ID.ABSOLUTE)){a=a.getOwner();if(null==a)return null;b=a.getOwner();if(null==b)return null}return b.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER)?b.getId():null};this.getTopicWrapperEntityIdForTopicBehaviorChangeTracker=(a)=>{a=a.getOwner();
if(null==a)return null;a=a.getOwner();return null==a?null:a.getId()};this.getTopicWrapperEntityIdForTopicCoverLikesTracker=(a)=>{if(!a.hasComponent(l.Cet.getPdomCompKey())&&!a.hasComponent(f.CetModel.PENDING_INSERT()))return null;for(const b of this.trackedBehaviors)if(null!=l.Cet.getReferer(a,b))return a=this.hq.getParentId(a),this.scene.getEntityById(a).getId();return null};this.getTopicWrapperEntityIdForTopicRemoveCoverLikeTracker=(a)=>{if(!a.hasComponent(l.Cet.getPdomCompKey())&&!a.hasComponent(f.CetModel.PENDING_INSERT()))return null;
if(a.isDef(f.CetModel.ID.TOPIC_CHILD)){a=a.getParentEntity();if(null==a)return null;const c=a.getChild(f.CetModel.ID.TOPIC_CHILD.BEHAVIOUR);if(null!=c)for(var b of this.trackedBehaviors)if(c.isDef(b))return b=a.getOwner().getOwner(),b=this.scene.getEntityById(b.getId()),null!=b?b.getId():null}return null};this.hq=l.Cet.createHierarchyQuery(this.scene);this.topicTransformTracker=this.scene.getEntityList().startNewTracking("SmartStruct-topicTransformTracker",[...f.CetModel.ID.TRANSFORMED.getFields(),
f.CetModel.ID.ABSOLUTE.LOCAL_TO_WORLD],(a)=>null!=this.getTopicWrapperEntityIdForTopicTransformTracker(a));this.topicBehaviorChangeTracker=this.scene.getEntityList().startNewTracking("SmartStruct-topicBehaviorChangeTracker",[f.CetModel.ID.TOPIC_CHILD.BEHAVIOUR],(a)=>null!=this.getTopicWrapperEntityIdForTopicBehaviorChangeTracker(a));this.topicCoverlikeTracker=this.scene.getEntityList().startNewTracking("SmartStruct-topicCoverLikesTracker",[F.CetRendererModule.getWorldGeometryComponentKey()],(a)=>
null!=this.getTopicWrapperEntityIdForTopicCoverLikesTracker(a));this.topicRemoveCoverlikeTracker=this.scene.getEntityList().startNewTracking("SmartStruct-topicRemoveCoverTracker",[f.CetModel.getRemovedEntityCompKey()],(a)=>null!=this.getTopicWrapperEntityIdForTopicRemoveCoverLikeTracker(a))}forEachTopicWithChangedGeometry(a){this.scene.getEntityList().forChangedMutableEntities((b)=>{for(let c of this.group(b,this.getTopicWrapperEntityIdForTopicTransformTracker))a(c)},this.topicTransformTracker);this.scene.getEntityList().forChangedMutableEntities((b)=>
{for(let c of this.group(b,this.getTopicWrapperEntityIdForTopicBehaviorChangeTracker))a(c)},this.topicBehaviorChangeTracker);this.scene.getEntityList().forChangedMutableEntities((b)=>{for(let c of this.group(b,this.getTopicWrapperEntityIdForTopicCoverLikesTracker))a(c)},this.topicCoverlikeTracker);this.scene.getEntityList().forChangedMutableEntities((b)=>{for(let c of this.group(b,this.getTopicWrapperEntityIdForTopicRemoveCoverLikeTracker))a(c)},this.topicRemoveCoverlikeTracker)}group(a,b){const c=
new Set;for(let e of a)a=b(e),null!=a&&c.add(a);return c}};var qc={};Object.defineProperty(qc,"__esModule",{value:!0});qc.PlaybackPathQueryImpl=class{constructor(a,b){this.scene=a;this.pathQueryHelper=b}getPath(){return l.Cet.createPlaybackPath(this.scene)}getPathComponent(){return this.scene.getPrezi().getComponent(f.CetModel.ID.PREZI.PATH)}getStepIndexForPathStepId(a){return this.pathQueryHelper.getStepIndexForPathStepId(this.getPathComponent(),a)}getStepIdForStepIndex(a){return this.pathQueryHelper.getStepIdForStepIndex(this.getPathComponent(),
a)}getStepTargetId(a){return this.pathQueryHelper.getStepTargetId(a)}getStepIndexesForEntityId(a){return this.pathQueryHelper.getStepIndexesForEntityId(this.getPathComponent(),a)}getPathTargetIds(){return this.pathQueryHelper.getPathTargetIds(this.getPathComponent())}getPathStepTargetId(a){return this.pathQueryHelper.getPathStepTargetId(this.getPathComponent(),a)}getActionIndexById(a,b){return this.pathQueryHelper.getActionIndexById(a,b)}getActionType(a,b){return this.pathQueryHelper.getActionType(a,
b)}getTargetEntitiesForActionById(a){return this.pathQueryHelper.getTargetEntitiesForActionById(a)}getActionIdsForStep(a){return this.pathQueryHelper.getActionsForStep(a).map((a)=>a.getEntity().getId())}getStartPoint(){return this.pathQueryHelper.getStartPoint(this.getPath())}hasCustomStartPoint(){return this.pathQueryHelper.hasCustomStartPoint(this.getPath())}isStartPoint(a,b){return this.pathQueryHelper.isStartPoint(this.getPath(),this.getPathComponent(),a,b)}idsToPathPosition(a,b){return this.pathQueryHelper.idsToPathPosition(this.getPath(),
this.getPathComponent(),a,b)}pathPositionToIds(a){return this.pathQueryHelper.pathPositionToIds(this.getPathComponent(),a)}getClosestSuitablePathPosition(a,b,c=!1){const e=this.scene.getPrezi().getEntityList();let d=this.getPathComponent().items();if(0===d.length)return null;const g=l.Cet.createPlaybackPath(this.scene);null==a&&(a=g.getPathPosition(0,0));let k,m=a.getStep();for(var n,q=!1;0<=m;m--){k=e.getEntityById(d[m]);for(n=m===a.getStep()?a.getAction()-1:k.getComponent(f.CetModel.ID.PATH_STEP.ACTIONS).length()-
1;0<=n;n--){const a=k.getChildAt(f.CetModel.ID.PATH_STEP.ACTIONS,n);if(this.getTargetForPathPosition(k,a)===b){q=!0;break}}k.get(f.CetModel.ID.HAS_TARGET.TARGET)===b&&(q=!0);if(q)break}if(q){n++;for(b=m===a.getStep()?a.getAction():k.getComponent(f.CetModel.ID.PATH_STEP.ACTIONS).length();n<b&&(c=k.getChildAt(f.CetModel.ID.PATH_STEP.ACTIONS,n),null==this.getTargetForPathPosition(k,c));n++);return g.getPathPosition(m,n)}for(m=a.getStep();m<d.length;m++){k=e.getEntityById(d[m]);if(k.get(f.CetModel.ID.HAS_TARGET.TARGET)===
b)return g.getPathPosition(m,0);if(c)for(n=k.getComponent(f.CetModel.ID.PATH_STEP.ACTIONS).length(),a=0;a<n;a++)if(q=k.getChildAt(f.CetModel.ID.PATH_STEP.ACTIONS,a),this.getTargetForPathPosition(k,q)===b)return g.getPathPosition(m,a+1)}return null}getPathStepPositionsForNavigation(){return this.getPath().getPathStepPositionsForNavigation()}getPathStepPositionsWithAudio(){return this.getPath().getPathStepPositionsWithAudio()}findStepsPointingToTargets(a){const b=[];if(null==this.scene.getPrezi())return b;
this.scene.getPrezi().forEachChild(f.CetModel.ID.PREZI.PATH,(c)=>{const e=c.get(f.CetModel.ID.HAS_TARGET.TARGET);null!=e&&-1!==a.indexOf(e)&&b.push(c.getId())});return b}getTargetForPathPosition(a,b){if(null!=b){if(b.isDef(f.CetModel.ID.ZOOM_TO_OBJECT))return b.get(f.CetModel.ID.HAS_TARGET.TARGET);if(b.isDef(f.CetModel.ID.ZOOM_TO_OVERVIEW))return a.get(f.CetModel.ID.HAS_TARGET.TARGET)}return null}};var Ib={};Object.defineProperty(Ib,"__esModule",{value:!0});Ib.SmartStructureEditorImpl=class{constructor(a){this.scene=
a;this.pathManager=E.createPathManager(a)}removeFromSmartStructure(a,b){a=b.getChildren().items().indexOf(a.getId());0>a||b.getMutableChildren().removeAt(a)}addToSmartStructure(a,b,c,e){if(0!==a.length){var d=l.Cet.createHierarchyQuery(this.scene).getSmartStructureIdOfEntity(b.id);d=null!=d?this.scene.lookup(d,f.CetModel.ID.SMART_STRUCTURE.W):null;null!=d&&(this.addChapter(d,b,a,c,e),a=a.map((a)=>a.id),l.Cet.createHierarchyQuery(this.scene).getSubTrees(a).map((a)=>this.scene.getEntityById(a)).forEach((a)=>
F.CetRendererModule.updateWorldProperties(a)))}}addChapter(a,b,c,e,f=null,g=!1){var h=b.topicChildren;g=g||e===d.SmartStructureAddIntention.pasteKeepTransform;null==f&&(f=a.getMutableChildren().length());e=new ja.TopicPositionFinder;h=h.slice(0);for(const d of c){c=this.getChapters(a);if(!g){const a=e.findTopicPosition(b,f,h);d.fitInto(a);h.push(d)}f<c.length?a.getMutableChildren().insert(f,d.id):a.getMutableChildren().add(d.id);++f}E.createPathManager(this.scene).fixPath()}getChapterIds(a){return null!=
a.getChildren()?[...a.getChildren().items()]:[]}getChapters(a){return this.getChapterIds(a).map((a)=>this.scene.getEntityById(a))}getSubtreeInPathOrder(a){const b=m.CetModelEditorInternal.getPagesOfChapterUnsorted(a,this.scene);a=m.CetModelEditorInternal.isPlanet(a,this.scene)?[a].concat(b):b;return m.CetModelEditorInternal.createEditorPathQuery(this.scene).sortByPathPosition(a)}getLastPathStepForParentSmartStructure(a,b){a=this.scene.getEntityById(a);a=l.Cet.createHierarchyQuery(this.scene).getParentOrOverview(a);
a=m.CetModelEditorInternal.createEntityQuery(this.scene).getSmartStructure(a);a=this.scene.getEntityById(a).getWrapper(f.CetModel.ID.SMART_STRUCTURE.W).getChildren();return b.findPathInsertPosition(a.getAt(a.length()-1))}moveInSmartStructure(a,b,c){if(null!=a&&null!=b){var e=c.getMutableChildren();if(0>a||a>=e.length())throw"fromIndex is out of range";if(0>b||b>e.length())throw"toIndex is out of range";var d=m.CetModelEditorInternal.createEditorPathQuery(this.scene),f=c.getChildren().getAt(a);c=c.getChildren().getAt(b);
m.CetModelEditorInternal.isPlanetOrStack(c,this.scene)||m.CetModelEditorInternal.isPlanetOrStack(f,this.scene)?(d=null!=c?d.getStepIndexesForEntityId(this.getSubtreeInPathOrder(c)[0])[0]:this.getLastPathStepForParentSmartStructure(f,d),e.move(a,b),this.pathManager.moveToWithDescendants(f,d)):(e.move(a,b),E.createPathManager(this.scene).fixPath())}}};var ib={};Object.defineProperty(ib,"__esModule",{value:!0});ib.StageQueryResultImpl=class{constructor(a){this.hitlist=a;this.logger=Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.StageQueryResultImpl")}apply(a){return new ib.StageQueryResultImpl(a(this.hitlist))}filter(a){return new ib.StageQueryResultImpl(this.hitlist.filter(a))}entities(){return this.hitlist.map((a)=>
a.getData().entity)}firstEntity(){return 0<this.hitlist.length?this.hitlist[0].getData().entity:null}firstEntityId(){return 0<this.hitlist.length?this.hitlist[0].getEntityId():null}log(a=""){this.logger.print(`StageQueryResult:${a}:${this.hitlist.map((a)=>a.getEntityId())}`);return this}};var rc={};Object.defineProperty(rc,"__esModule",{value:!0});rc.TextHelperImpl=class{hasSelection(a){if(!l.Cet.hasShapedText(a))throw"shapedtext component is missing";a=this.getSelection(a);return null==a||null==
a.start||null==a.end?!1:!0}getSelection(a){const b=l.Cet.shapedText(a);if(null==b)throw"shapedtext component is missing";const c=a.get(l.Cet.getSelectionTextRangeComponentKey());return null==c?null:{start:this.clampToMaxLength(a,b,c.start),end:this.clampToMaxLength(a,b,c.end)}}getSelectionStartOffset(a){return null!=this.getSelection(a)?this.getSelection(a).start:null}getSelectionEndOffset(a){return null!=this.getSelection(a)?this.getSelection(a).end:null}setSelection(a,b,c,e){if(!l.Cet.hasShapedText(a))throw"shapedtext component is missing";
const d=this.getSelection(a);if(c===e||null==c||null==e)null!=d&&a.discardOwnComponent(l.Cet.getSelectionTextRangeComponentKey());else if(null==d||d.start!==c||d.end!==e)null==d&&(Q.avro.Avro.createDefaultLogger().logSelectedObject({object_type:"TEXTSNIPPET",topic_relationship:a,parent_type:null==l.Cet.createHierarchyQuery(b).getParentId(a)?"OVERVIEW":"TOPIC",object_id:a.getId()}),Q.avro.Avro.createDefaultLogger().logHighlightText({object_id:a.getId()})),a.set(l.Cet.getSelectionTextRangeComponentKey(),
{start:Math.min(c,e),end:Math.max(c,e)});return a}getSpecialTokens(a){return n.Utils.getUrlsInString(a).concat(n.Utils.getEmailsInString(a))}findSpecialToken(a,b,c){return a.find((a)=>a.pos<=b&&a.end>=c)}getSelectedText(a,b=!1){if(!l.Cet.hasShapedText(a))throw"shapedtext component is missing";if(!this.hasSelection(a))return"";const c=l.Cet.shapedText(a).getRawText();a=this.getSelection(a);return b&&null!=this.findSpecialToken(this.getSpecialTokens(c),a.start,a.end)?"":c.substring(a.start,a.end)}setCaretOffset(a,
b){if(!l.Cet.hasShapedText(a))throw"shapedtext component is missing";null!=b?a.set(l.Cet.getTextCaretOffsetComponentKey(),b):a.discardOwnComponent(l.Cet.getTextCaretOffsetComponentKey());return a}getCaretOffset(a){const b=l.Cet.shapedText(a);if(null==b)throw"shapedtext component is missing";return this.clampToMaxLength(a,b,a.get(l.Cet.getTextCaretOffsetComponentKey()))}setTextSelectionFocused(a,b){if(!l.Cet.hasShapedText(a))throw"shapedtext component is missing";null!=b?a.set(l.Cet.getTextSelectionFocusedComponentKey(),
b):a.discardOwnComponent(l.Cet.getTextSelectionFocusedComponentKey());return a}getTextSelectionFocused(a){if(null==l.Cet.shapedText(a))throw"shapedtext component is missing";return a.get(l.Cet.getTextSelectionFocusedComponentKey())}clampToMaxLength(a,b,c){a=!0===a.get(f.CetModel.ID.POSSIBLY_PLACEHOLDER.IS_PLACEHOLDER)?0:b.getLength();return c>a?a:c}isPlaceholder(a){if(!l.Cet.hasShapedText(a))throw"shapedtext component is missing";return!0===a.get(f.CetModel.ID.POSSIBLY_PLACEHOLDER.IS_PLACEHOLDER)}};
var Jb={},Vc=this&&Jb.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function g(a){try{k(e.next(a))}catch(t){f(t)}}function h(a){try{k(e["throw"](a))}catch(t){f(t)}}function k(a){a.done?c(a.value):d(a.value).then(g,h)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(Jb,"__esModule",{value:!0});Jb.TopicCustomizationConverter=class extends La.BaseConvertStep{constructor(){super("TopicCustomizationConverter",
!1)}createContext(a){return a}shouldConvert(a){if(a.getTopicType()===k.DOM.ENUMS().TOPIC_TYPE().FRAME())return!0;for(a=a.getZObjects().iterator();a.hasNext();){var b=a.next();if(null!=b&&b.getObjectType()===k.ZObjectType.Z_TOPIC_CONTAINER&&(b=b.getTopic(),null!=b&&(b.getObjectType()===k.TopicType.PLANET_CHAPTER||b.getObjectType()===k.TopicType.STACK_CHAPTER)&&(b=b.getPosition(),null!=b&&b.getObjectType()===k.PositionType.WRAP_CHILDREN_NO_BASELINE)))return!0}return!1}convert(a){return Vc(this,void 0,
void 0,function*(){const b=(new Date).getTime();var c=k.DOM.loadXml(k.DOM.saveXml(a));c=sd.Converter.convertFromV2ToV2_1(c);if(0!==c.getErrorLog().length)throw Error(`convertFromV2ToV2_1 failed\n${c.getErrorLog().join("\n")}`);const e=(new Date).getTime()-b;return{iPrezi:c.getResult(),convertWithApi:(a)=>Vc(this,void 0,void 0,function*(){var b=(new Date).getTime();yield a.executeLegacyCommand({name:this.name,runLegacy:(a)=>{a.mscene.getEntityList().forEach((b)=>{if(b.isDef(f.CetModel.ID.Z_TOPIC_CONTAINER)){var c=
b.getMutableWrapper(f.CetModel.ID.Z_TOPIC_CONTAINER.W).getMutableTopic().getEntity();c.isDef(f.CetModel.ID.HAS_TOPIC_PLANET_CHAPTER)&&(c=c.getMutableWrapper(f.CetModel.ID.HAS_TOPIC_PLANET_CHAPTER.W),c.getPosition().is(f.CetModel.ID.WRAP_CHILDREN_NO_BASELINE)&&(b=f.CetModel.ID.ABSOLUTE.inflate(a.mscene,k.DOM.createAbsolute(F.CetRendererModule.getLocalToWorld(b))),c.setPosition(b)))}})}});b=(new Date).getTime()-b;this.logger.info({action:"convert",object:"v2_to_v21",trigger:"machine",payload:{duration:e+
b}})})}})}logConversionError(a){null!=a.type&&null!=a.errorMessage?Q.LoggerModule.logException(this.logger,"v2_to_v21","font_load",a,null,"error"):Q.LoggerModule.logException(this.logger,"v2_to_v21","convert",a,null,"error")}};var Na={};Object.defineProperty(Na,"__esModule",{value:!0});Na.PathQueryHelperImpl=class{constructor(a){this.scene=a;Na.PathQueryHelperImpl.initLogger();this.groupManager=new H.GroupManager}static initLogger(){null==Na.PathQueryHelperImpl.LOGGER&&(Na.PathQueryHelperImpl.LOGGER=
Q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.PathManager"))}getStepIndexForPathStepId(a,b){a=a.items().lastIndexOf(b);return-1!==a?a:null}getStepIdForStepIndex(a,b){return a.getAt(b)}getStepTargetId(a){a=this.scene.getEntityById(a);return null==a?null:a.isDef(f.CetModel.ID.FLY_TO_OBJECT)?a.getWrapper(f.CetModel.ID.FLY_TO_OBJECT.W).getTarget():a.isDef(f.CetModel.ID.FLY_TO_OBJECT_EP)?a.getWrapper(f.CetModel.ID.FLY_TO_OBJECT_EP.W).getTarget():a.isDef(f.CetModel.ID.FLY_TO_OVERVIEW)||
a.isDef(f.CetModel.ID.FLY_TO_OVERVIEW_EP)?this.scene.getPreziW().getOverview().getId():null}getStepIndexesForEntityId(a,b){b=this.scene.getEntityById(b);if(null==b)return[];if(b.isDef(f.CetModel.ID.OVERVIEW))return a.items().reduce((a,b,d)=>{b=this.scene.getEntityById(b);return b.isDef(f.CetModel.ID.FLY_TO_OVERVIEW_EP)||b.isDef(f.CetModel.ID.FLY_TO_OVERVIEW)?a.concat([d]):a},[]);b=b.get(f.CetModel.ID.HAS_TARGET.TARGET_PARENT);return null!=b?b.reduce((b,e)=>{e=a.indexOf(e);return-1!==e?b.concat(e):
b},[]):[]}getPathTargetIds(a){const b=this.scene.getPrezi().getEntityList();return a.items().map((a)=>{a=b.getEntityById(a);return null==a?null:a.get(f.CetModel.ID.HAS_TARGET.TARGET)})}getPathStepTargetId(a,b){return this.getPathTargetIds(a)[b]}getActions(a){let b=[];for(const c of a.items())a=l.Cet.pathKludge.getISomeEditorPathStepW(this.scene.getEntityById(c)),b=[...b,...a.getActions()];return b}getActionsForStep(a){return[...l.Cet.pathKludge.getISomeEditorPathStepW(this.scene.getEntityById(a)).getActions()]}getActionsForStepAndTarget(a,
b){a=this.getActionsForStep(a);let c=[];for(let e=0;e<a.length;++e){const d=a[e],g=d.getEntity();null!=g&&g.isDef(f.CetModel.ID.HAS_TARGET)&&g.getWrapper(f.CetModel.ID.HAS_TARGET.W).getTarget()===b&&c.push(d)}return c}getActionIndexById(a,b){a=this.getActionsForStep(a);let c=0;for(let e of a){if(e.getId()===b)return c;c++}return-1}getActionType(a,b){var c=this.scene.getEntityById(b);return null==c?null:c.isDef(f.CetModel.ID.FADE_IN_OBJECT_EP)||c.isDef(f.CetModel.ID.FADE_IN_OBJECTS_EP)||c.isDef(f.CetModel.ID.FADE_IN_OBJECT)||
c.isDef(f.CetModel.ID.FADE_IN_OBJECTS)?d.ActionType.FADE_IN:c.isDef(f.CetModel.ID.FADE_OUT_OBJECT_EP)||c.isDef(f.CetModel.ID.FADE_OUT_OBJECTS_EP)||c.isDef(f.CetModel.ID.FADE_OUT_OBJECT)||c.isDef(f.CetModel.ID.FADE_OUT_OBJECTS)?d.ActionType.FADE_OUT:c.isDef(f.CetModel.ID.ZOOM_TO_OBJECT_EP)||c.isDef(f.CetModel.ID.ZOOM_TO_OBJECT)?(c=this.getTargetEntitiesForActionById(b).allIds[0],c=this.scene.getEntityById(c),null!=c&&c.isDef(f.CetModel.ID.Z_ZOOM_AREA)?d.ActionType.ZOOM_AREA:-1!==this.getTargetEntitiesForActionById(b).allIds.indexOf(a)?
d.ActionType.ZOOM_BACK:d.ActionType.ZOOM_TO):c.isDef(f.CetModel.ID.ZOOM_TO_OVERVIEW_EP)||c.isDef(f.CetModel.ID.ZOOM_TO_OVERVIEW)?-1!==this.getTargetEntitiesForActionById(b).allIds.indexOf(a)?d.ActionType.ZOOM_BACK:d.ActionType.ZOOM_TO:null}getTargetEntitiesForActionById(a){const b=this.scene.getEntityById(a);let c=[],e=[],d=[];null!=b&&(b.isDef(f.CetModel.ID.HAS_TARGET_GROUPS)&&b.getComponent(f.CetModel.ID.HAS_TARGET_GROUPS.TARGET_GROUPS).items().forEach((a)=>{const b=this.groupManager.getGroupMembers(this.scene,
a).map((a)=>a.getId());e=[...e,a];c=[...c,...b]}),b.isDef(f.CetModel.ID.HAS_TARGET)?(c=[...c,b.getWrapper(f.CetModel.ID.HAS_TARGET.W).getTarget()],d=[...d,b.getWrapper(f.CetModel.ID.HAS_TARGET.W).getTarget()]):b.isDef(f.CetModel.ID.HAS_TARGETS)?(c=[...c,...b.getComponent(f.CetModel.ID.HAS_TARGETS.TARGETS).items()],d=[...d,...b.getComponent(f.CetModel.ID.HAS_TARGETS.TARGETS).items()]):b.isDef(f.CetModel.ID.ZOOM_TO_OVERVIEW_EP)||b.isDef(f.CetModel.ID.ZOOM_TO_OVERVIEW)?(c=[...c,this.scene.getPreziW().getOverview().getId()],
d=[...d,this.scene.getPreziW().getOverview().getId()]):Na.PathQueryHelperImpl.LOGGER.error({action:"get_action_target_on_action",object:a,trigger:"machine",payload:{description:"Target is null"}}));return{groupIds:e,nonGroupedIds:d,allIds:c}}getStartPoint(a){return a.getStartPoint()}hasCustomStartPoint(a){return a.hasCustomStartPoint()}isStartPoint(a,b,c,e){return a.hasCustomStartPoint()?this.idsToPathPosition(a,b,c,e).isSame(a.getStartPoint()):!1}idsToPathPosition(a,b,c,e){b=this.getStepIndexForPathStepId(b,
c);c=this.getActionIndexById(c,e);return a.getPathPosition(b,c+1)}pathPositionToIds(a,b){if(null==b)return{stepId:null,actionId:null};a=this.getStepIdForStepIndex(a,b.getStep());if(0===b.getAction())return{stepId:a,actionId:null};b=this.getActionsForStep(a)[b.getAction()-1];return{stepId:a,actionId:b.getId()}}};var sc={};Object.defineProperty(sc,"__esModule",{value:!0});sc.FranklinPathFixerSystem=class{constructor(){}getName(){return"FranklinPathFixerSystem"}reset(){}process(a,b){E.createPathManager(b).fixPath()}select(){return!0}getTriggerKeys(){return[...f.CetModel.ID.EDITOR_PATH.getFields(),
f.CetModel.ID.PREZI.PATH,f.CetModel.ID.PREZI.EDITOR_PATH,f.CetModel.ID.SMART_STRUCTURE.CHILDREN]}changesPdomComponents(){return!0}};var Kb={},fe=this&&Kb.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function g(a){try{k(e.next(a))}catch(t){f(t)}}function h(a){try{k(e["throw"](a))}catch(t){f(t)}}function k(a){a.done?c(a.value):d(a.value).then(g,h)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(Kb,"__esModule",
{value:!0});Kb.EnsureFixedBoundsOverview=class extends La.BaseConvertStep{constructor(){super("fixed_bounds_overview",!0)}createContext(a){return a}shouldConvert(a){var b,c;return f.CetModel.isSupportedDocumentGeneration(a,f.DocumentGeneration.OverviewAndContentLayout)?(null===(c=null===(b=a.getOverview())||void 0===b?void 0:b.getOverviewBounds())||void 0===c?void 0:c.getObjectType())!==k.OverviewBoundsType.FIXED_OVERVIEW_BOUNDS:!1}convert(a){return fe(this,void 0,void 0,function*(){return{iPrezi:a,
convertWithApi:(a)=>this.fix(a)}})}fix(a){a.executeApiCommand({name:"ensure_fixed_bounds_overview",run:(a)=>a.overview.fitInto(a.overview.zoomLayoutBox)});return Promise.resolve()}};var m={},Lb=this&&m.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function g(a){try{k(e.next(a))}catch(t){f(t)}}function h(a){try{k(e["throw"](a))}catch(t){f(t)}}function k(a){a.done?c(a.value):d(a.value).then(g,h)}k((e=e.apply(a,b||
[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});class ge{}m.CetModelEditorImpl=class{constructor(){this.templateDataCache={};this.NOT_USED_THEME_ID="not-used";this.TOPIC_SHAPE_URLS_KILLME=new Set("http://0103.static.prezi.com.s3.amazonaws.com/media/3/0/7/f203b6cb677e6186aa999014dda499d7c33e2.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/0/9/d0d59a3b634c662c303b5e3a6e2671190cf29.png http://0103.static.prezi.com.s3.amazonaws.com/media/a/2/1/c51b879d030fa377c71322cf2d36f0b6fffb6.png http://0103.static.prezi.com.s3.amazonaws.com/media/e/7/b/3337e46e8902f289ba8ef3f40633c2ae3aceb.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/4/2/9894455635d5e9bdb5e09bad6c38a1b309e3e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/5/6/d/e08cb2f096e8eb9edba8fcd3182270c9978bd.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/2/d/1ce794bac3d4e28a0e7771b8205bd34346c59.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/5/c/8e5792c02fc747d5bd13797cea29ae62c797b.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/9/e/2c8525b7e8cbaf644345983c161e34080cd58.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/9/5/584035813ae60590d5447c9ff595f38877cd9.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/b/a/b6175f4d5f1980e8dc5ea663d135b01c1a74d.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/1/0/3/206d653e7394892c5de337971af2c26b6e396.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/5/f/3/78f9de2c3a5c9ad3fd18843b13ef0222e8552.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/5/c/b2886234a1768d482b726bee31585729b9d95.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/d/5/0c2c7285114167a2dd1afc7c9ea27503ec876.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/6/5/59bc47f3f36680c773c1f4d762cab4f3c394c.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/c/9/aa8e6cda06ec6a3cffaa5def001a6b9ccbcf7.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/b/3/02a6653070ddc610d36cbf4cfa13b0e4e038e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/5/8/7/0075c06e790d16020e5c662e4ff47e9f33c00.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/6/1/5728434f7c7411c105949066b91bb5e2ef4ac.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/d/3/462f48fd7a81f47a89514272d6897a3db9105.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/1/8/442d0e0ca564ebc198ba2cfdaffc8d1007bba.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/8/3/14493c27bb4c7bca7e26c515846e8b739e7dd.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/f/3/4593c187ecdb5dbf466a767e67d68d5476cd9.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/3/e/75717656ed17b5778bac7591af55e4ef58d6d.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/d/e/19e8ffcb9d8763c7ec11a88de2a148578c9b7.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/5/5/a346ba8e5d55f2ff2b8ca6b2bfb8fd38575a5.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/b/7/189ab552d8cd7bf5276c137a9a40b723541bf.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/d/f/9/2c8ef124de440114300c4eb38c3daab8c42ae.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/1/1/80c842c9c91c584370c0c3ef82e66dbbcf862.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/3/e/75717656ed17b5778bac7591af55e4ef58d6d.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/6/2/2633bd2ec942bae6f64ccd54258624127a234.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/9/3/066c7a3420b5024ef7d823e271435f321cbed.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/6/2/2633bd2ec942bae6f64ccd54258624127a234.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/a/b/93a051c2f7b1ca9664bebb9f11880f8f62ce4.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/6/2/2633bd2ec942bae6f64ccd54258624127a234.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/8/0/9eb53b2531886501b17952af94342020c8a02.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/6/2/2633bd2ec942bae6f64ccd54258624127a234.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/f/f/1b1db2bf3b688cba116e31414b2f7afcbe281.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/6/2/2633bd2ec942bae6f64ccd54258624127a234.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/6/1/80458aa5cac09b38060699f6da5508dc584e1.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/6/2/2633bd2ec942bae6f64ccd54258624127a234.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/b/2/5b80ac3dcbfd5f51073c0e049edc879e73acf.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/a/1/199f693339fb9ca9003fc16d4faa318c664f8.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/4/3/deb9721d6cdf0ed94da3eb7607416af335e6a.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/c/6/7e8dabd7df1f589e2499d36a0dd40db968c15.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/d/f/aed1d9167f6487eca4bf3e85127170099ab28.png http://0103.static.prezi.com.s3.amazonaws.com/media/d/c/e/621ed7f0d341e7a7083eeacdb07711eab7894.png http://0103.static.prezi.com.s3.amazonaws.com/media/2/9/d/0ebd4dd8d2ea54c5f12a27999c14bbe99a231.png http://0103.static.prezi.com.s3.amazonaws.com/media/b/a/7/6a170ce8893699584bfefb8aeade815547292.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/7/1/dc0f4f730cb5e98e377aeeb53a95cd1b89208.png http://0103.static.prezi.com.s3.amazonaws.com/media/1/9/8/bdf6a3ad147d8929796fd389f8b26da2d33ac.png http://0103.static.prezi.com.s3.amazonaws.com/media/a/3/d/5d8172eb38ab5a76205b089480b16ca5a4525.png http://0103.static.prezi.com.s3.amazonaws.com/media/7/5/7/042acbac8e46688dc2d354e9711f3d7d937c2.png http://0103.static.prezi.com.s3.amazonaws.com/media/e/2/e/bea669f1bece33d4529f8fc7268c7e27cb4fb.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/b/5/02c88b72bdf16568db4667febf2d114ce0418.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/9/f/d/81653e5ec95da025324a9d7b1e229738bd592.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/d/6/c/43565b2023d40f7cd7435a6717d4083d60197.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/3/3/b1d923624b438b8aaef3f9e511104c927ed93.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/e/3/f/f3ff02f4ec12dc2e66cdc108d3b7d9daeb98c.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/6/e/c67c73f6abeaa2a0d29d237177cb1f06e4484.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/9/0/4/6ca95c3586cc63bb575addc934849888a50fa.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/d/d/deb65c6246360f2ce7dd18d71749136016102.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/d/4/9eeff6ac8714a38cc5d21006d14f7f6c3bb4e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/1/1/1/9f6549964771dec6552e69bcc9c689bbb456f.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/7/3/09a367ec7986264881858d5c79586e6fa44fb.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/e/3/b7df97e000a31b30ac1bb9783b31133e8af09.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/5/4/85334a48ae8b3730aba01b5adbc65cf890485.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/e/f/caa8353c0c8a0fe9d97e5a8f86726d4696a20.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/7/8/6920d9f46caeaeb64b90487d175969a7ee838.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/b/1/bd835ef2a29b2c66ed83a31ae8c6caa64f418.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/2/8/87a8d504037c6400349b3f207bb1807153f92.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/6/8/8dc8f939f67d992194668fce41779fc0ed0f6.png http://0103.static.prezi.com.s3.amazonaws.com/media/8/d/5/944a475b4b3785cdff6e8eec68cd98afa316a.png http://0103.static.prezi.com.s3.amazonaws.com/media/d/f/0/546eed797380fc35dceb6f32dbea065ea1da7.png http://0103.static.prezi.com.s3.amazonaws.com/media/a/0/4/50e20687b4bfed189ee358183fac714d2ffc5.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/8/8/9a100d266cb3489212c49540d70af1c7895a2.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/b/8/2be2b95eb1685821410f33adb891d84d3c7b8.png http://0103.static.prezi.com.s3.amazonaws.com/media/e/2/c/6638f86ea5f5e29e5e6cfae4244bb49410cde.png http://0103.static.prezi.com.s3.amazonaws.com/media/c/f/0/492012342374aed7860f4e2fb8cfce2d604ea.png http://0103.static.prezi.com.s3.amazonaws.com/media/e/b/8/28d54de67111a4f08287573a672d74a1fc829.png http://0103.static.prezi.com.s3.amazonaws.com/media/5/7/2/e387f0c4e49f2e2f7d0bcd44f0435fc7d681a.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/0/f/0ef7dc297f0775be2ecb17da0da5536d0a5a4.png http://0103.static.prezi.com.s3.amazonaws.com/media/5/6/9/614c396389265458bc379837a76e81966a012.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/5/4/d6b2722f031955df10d568ef082137275a00c.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/d/c/84e302d1a989178815fb534d7ae392d3f171e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/7/9/8170a22c0fd6386fe7932b65661432b6b792c.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/c/6/33762703fbd4bd9f93d22dc1ab004f27b2e60.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/d/9/c5fb67ebae5f776834fc6e19ac1ba388de40f.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/8/1/77989c48f32653970834bfb68dcf0b61dffdf.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/5/1/f/06daead8509254aeb7b4faec96dc422763215.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/f/5/a9671f27cb11a779dfebb5de75d87beb81c1b.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/9/d/e/305cfc5bcdb8c65b4a1f5265fba753000feba.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/1/3/d/b7aa7eab152fba890dc71c322600d08c5e447.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/9/5/2/c1367472bcfd15bcdaa1b95c8d51d4c8a98a1.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/d/b/41a03f78af6d522409223d12326dab2f1dd01.png http://0103.static.prezi.com.s3.amazonaws.com/media/0/1/f/7590c6464c76a0a91bd9a4a632958d5791f3e.png http://0103.static.prezi.com.s3.amazonaws.com/media/a/8/b/3fac2c2061d964b74e68c7f7c6ac24c88db52.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/5/2/fa54331cd1ce810f42548c81cb90ae9edff08.png http://0103.static.prezi.com.s3.amazonaws.com/media/a/a/5/1c0c6ca2209a9be00b7eaf3ec51015fc84fec.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/7/7/0731fc82b64d15e74939b1a058a225f820230.png http://0103.static.prezi.com.s3.amazonaws.com/media/e/f/9/1754ef1ab63f9c1c48fef51ec9a79746de393.png http://0103.static.prezi.com.s3.amazonaws.com/media/5/6/9/4bb1625d7525e0c8463aecff32b03e86c7eba.png http://0103.static.prezi.com.s3.amazonaws.com/media/8/5/f/3d7fc45e2dac4fbee1e172b72a66ac0dc5b95.png http://0103.static.prezi.com.s3.amazonaws.com/media/3/b/d/8f73f52ed5fb1349ed8931ef58ac06c35a99f.png http://0103.static.prezi.com.s3.amazonaws.com/media/3/c/1/49a7d157b7a05afa8954f7a919cee6077324f.png http://0103.static.prezi.com.s3.amazonaws.com/media/7/2/4/3dab7c5b35f9b43aa23da9d8be78ba430b602.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/f/1/51bcfeeb25181f03e59b79087b78fe4431820.png http://0103.static.prezi.com.s3.amazonaws.com/media/3/d/1/7673cd23e1bb8c9c529d58d12da6b3b8dcc1e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/8/5/b7e42edf0185f76935019d9a1cd875fbc7d16.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/f/e/cac2576b3cfc059ed80fe98ecbf21e505cdf9.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/3/1/24b30ca78128597205dafe23631fb2a577e66.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/f/f/b/4c88d606f5590871a3ef51673801e662c290e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/e/a/3/16bca4d8efa59f20cd14ea163c9952ceeee28.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/e/0/9/ed4252a1535066a1f55454dc08d76ff8ca310.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/a/8/5d08018ebb5e13d1a8d7a387633429d14b66a.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/9/0/f9ca72e0bf5a1ac2292b1f8bbff9f916c3620.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/5/7/50b571128fe6cd2e5694ef9d0cad5898d5d32.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/b/e/282ebeb935fa30bc9e2f4d933e55102ba8fba.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/8/0/b0840f619504dce054edfe9432fe640e9b144.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/1/d/eeef85bf57ff11b2aad35cf59760ebcdf7af6.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/3/1/578aecd4915a1ca904d9efc7f5134803ff083.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/1/d/5/e706a7ca365a14b73482cbc67acb02aa8c0df.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/3/c/e67522ff3ee5d11cec798f8887458bb4d666c.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/2/9/c372e4f97783d0aded9deec5512db4f0e1e47.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/c/6/509fa132afc5deea1d46fca9ac2728bd09ecf.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/4/0/853825eea8a1413aabd2873aa2f0d506894fd.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/d/c/a/f0dcb6a52869e919c8dfb761510ebd53b6a16.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/6/e/c94cb5befc29d8d83d6842347c8f94f6ca677.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/0/4/64101004d6f4cd7fc33a09eae9aa88fa4bd68.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/5/d/57b7300aa79b5fda33c0f9c73ee5a3675d4a8.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/2/1/1d968a4c289878cb601fc89a6ca64e36f4ef2.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/5/f/056eae8a8c79321551366fa96c7b2e6dcaeb1.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/2/2/afe918a54dff45017d7ee5dc7609f0273f555.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/e/7/0506e5b58eab41b3dcbb7e7158f545f601352.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/a/8/c19e6425f52889d8fec9a84223fb79cfe1b78.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/f/e/5911b23b1cd9cdfb85bf22dc831e45cad68d8.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/f/a/947531775c4248efd8135970e1777860203a0.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/9/7/5aaf893c2562a3a9c48027173e4d272241466.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/5/a/49af3ecd73863dfb086e5809a79137c8fb6aa.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/c/f/2519166796de02f161b86dffe0dc41a33628b.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/2/5/de0f6e69f887ec13c5167f5df8a07b2f65e78.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/f/f/2/4db075a51f6838125fa4c42f5e9d753ee15de.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/e/7/4/38b1e0ec0e5fc5a9dab9cbbdc57c7d40f396f.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/f/0/2/b91bc77ddf0afb5da9a55fc0d9f4a8abc6274.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/a/f/50fc415ce8c2e0fc49862dac7c1a03444afdd.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/b/f/ba6f1335ad03c1758f4ab10d8965302d8fe2e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/c/8/b/30c1029718191531ba806ac39a31a5d742879.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/b/4/221eaa99bf77a8d94a31caa6d45ed1497de58.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/e/c/6/fb76739a4b1cc1727b4cfd93a8e8b6b638d2d.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/d/5/7/618cfe3395c55f6ce09dfc1d7fb0ddde68f6b.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/0/b/904ab9c3eaf28f2d31bf62b491ab62db9a1a4.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/7/d/65da1c4c8e4fd87158e9eb779275bd9d27db6.png http://0103.static.prezi.com.s3.amazonaws.com/media/4/6/f/fad7c236e7c5d1f924a61c2869b3ac8cfbc7e.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/d/2/6/185415db7ac0bb0a7e5f13f2a1ec570480ddd.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/8/0/14c053577d7c6a8cc82f6bd7d709a54aa8d6b.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/8/6/b7a4983d59ea49d60edc18422e247128dffdf.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/5/8/3/ef1c5a2be60d716d51403eb24023d29816197.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/d/7/3e9b77625af2f886622a8a67607bb95e811e0.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/a/0/6/760633c24b260dcfe004930e847844844e8ab.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/b/3/7/17b0e3ea1ba37d13b38ce2e8f343bbccc2a6b.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/6/0/55d1be2e7831c63ca6966fd6a1aa3a0ad47c5.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/b/8/da603a0a9f118fb6acbe948bea6f546fdbda8.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/9/a/fc7a6c4c8f42a751f24ae59fbb23fcdea13ed.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/6/b/7/caa9ab88890c76a71a26bda6652ac0526aeef.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/e/b/0/b3912c2371c25d568ac8a1a3066df1fe4afb5.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/3/4/e/096b9a1e1aaee1592451618b69f8eed13f0f4.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/7/8/b557625186a5b025b90d49249e4f599fd07fd.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/7/c/8/8daaadfceac830321e7eae0caf9b0cd0aaedc.png http://0103.static.prezi.com.s3.amazonaws.com/media/4/a/4/e3cba0224d6961aac26ab4c9aa319b258e5de.png http://0103.static.prezi.com.s3.amazonaws.com/media/e/6/2/0fb6e29a10dbfd98a7bd092a9449c14503b59.png http://0103.static.prezi.com.s3.amazonaws.com/media/d/6/c/3c4bfc85de1f8507b32c912c475f465218aeb.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/a/b/78a2b87172c9d752b77b810a5d2ad91040dad.png http://0103.static.prezi.com.s3.amazonaws.com/media/c/a/4/4f17c6bf988d68760538977134d93adaf3c37.png http://0103.static.prezi.com.s3.amazonaws.com/media/0/8/6/35663d426145df2faf708fdb28ffb7296e5af.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/8/e/c5958b26472f1a56dc56c703dd46d390e570c.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/0/8/a36e731fbf7073b641f30ff1055c1e2bde723.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/0/2/e3b2c27340f9a799e3cafa6775ca622d71a2a.png http://0103.static.prezi.com.s3.amazonaws.com/media/a/0/7/52704640c01999d9f741f8fe055078b768579.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/a/5/297ae76225b1c2dacdd2b803bdf6d1993b1e8.png http://0103.static.prezi.com.s3.amazonaws.com/media/c/f/b/21ebb1fdc8a67f6b87e2c10eb4ec18e0bef43.png http://0103.static.prezi.com.s3.amazonaws.com/media/d/b/3/9a737162e12809e8562faf91cc4dcbdc7a92a.png http://0103.static.prezi.com.s3.amazonaws.com/media/5/0/a/0c3f24ea6f1a2c9d6406b07ee9ea21ccbca2a.png http://0103.static.prezi.com.s3.amazonaws.com/media/b/6/5/d2f44a4b3c48a09d02043a93665522c9fe3f1.png http://0103.static.prezi.com.s3.amazonaws.com/media/9/b/3/41183fc3059f42f470418f2e3c2179ad7dda4.png http://0103.static.prezi.com.s3.amazonaws.com/media/2/2/a/7786a761efb3f307fd69d6fb3bb7852884491.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/8/d/6/20fc2beaa49ba0e9b8aa14685dacfa7425e69.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/1/c/3/54a1293e96d3acef599d05c02b5268e42db82.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/4/3/8/ecf7d2f7de5d925e6a0a567e8bf62731e8bac.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/2/6/0/763deb4767447bda29a272865031c84a52ca7.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/5/c/7/591c01e87404c70c53017ed55499dbd5b8513.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/f/6/a/2cf2c49272be15790db151fbb846dca6e021f.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/0/a/5/5659dff6b10197fa73039e1bf44212a4dd9b7.png http://0103.static.prezi.com.s3.amazonaws.com/media/d/e/5/8aa2d0ea3bf571c0576320f52fd823be0272c.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/9/e/7d325ce7a12d61d83299fa3caf3c7c0efec8e.png http://0103.static.prezi.com.s3.amazonaws.com/media/2/a/f/a6bf133eda0dbfa0f68396d3018c2a6bb5890.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/b/f/6dfe33ee1e6b6d5a7884f96afc498d29e47b7.pdf http://0103.static.prezi.com.s3.amazonaws.com/media/d/c/9/0d2062067a8e05632cb2f96a9d360173def02.png http://0103.static.prezi.com.s3.amazonaws.com/media/f/6/3/dc2225e4d1383a5e0437e7cd3785c4011f1e8.png http://0103.static.prezi.com.s3.amazonaws.com/media/6/9/f/40a0cfebacf7f525bbcebd93ebf3776285c3a.png http://0103.static.prezi.com.s3.amazonaws.com/media/2/4/9/113f2d04334c71177949e3b66713460628a15.png http://0103.static.prezi.com.s3.amazonaws.com/media/2/b/d/c2d8dc4c13f35537967c7c23d5b1e839b0855.png http://0103.static.prezi.com.s3.amazonaws.com/media/3/f/9/8bb6585e8dfead09c6c06c4c4e0bea9fb5b94.png".split(" "))}parseCopyDataAsync(a,
b){return ca.CopyDataImpl.parseAsync(a,b)}loadAndConvertPreziXmlAsync(a,b){return this.converterPlugins().convertPrezi(k.DOM.loadXml(b),a)}createLegacyInserter(){return new oc.LegacyInserterImpl}createReferenceFrame(a){return new u.ReferenceFrameImpl(a)}createEntityHit(a){return new mc.EntityHitImpl(a)}createStageQueryStrategyFactory(a,b){return sa.EditorFactory.createStageQueryStrategyFactory(a,b)}getStageQueryKey(){null==m.CetModelEditorImpl.stageQueryKey&&(m.CetModelEditorImpl.stageQueryKey=f.CetModel.createValueComponentKey("editStageQuery",
!1,!1));return m.CetModelEditorImpl.stageQueryKey}createStageQueryResult(a){return new ib.StageQueryResultImpl(a)}createSmartStructureEditor(a){return new Ib.SmartStructureEditorImpl(a)}createSmartStructureQuery(a){return new Ib.SmartStructureEditorImpl(a)}createLayoutEditor(){return new Ma.LayoutEditorImpl}createEntityEditor(a){return sa.EditorFactory.createEntityEditor(a)}createEntityQuery(a){return sa.EditorFactory.createEntityEditor(a)}createFranklinPathFixerSystem(a){return a.createShaperSystem(new sc.FranklinPathFixerSystem)}createEditorConnectorFixerSystem(a){return a.createShaperSystem(new Da.EditorConnectorFixerSystem)}createHideDegenerateConnectorsFixerSystem(a){return a.createShaperInflatorSystem(new nc.HideDegenerateConnectorsFixerSystem)}createTopicQuery(a){return sa.EditorFactory.createTopicQuery(a)}createEditorPathQuery(a){return sa.EditorFactory.createPathQuery(a)}createPathQueryHelper(a){return new Na.PathQueryHelperImpl(a)}createStyleEditor(a){return N.StyleEditorImpl.createStyleEditor(a)}createStyleQuery(a){return N.StyleEditorImpl.createStyleQuery(a)}createTopicChildrenEditor(a){return sa.EditorFactory.createTopicChildrenEditor(a)}createPositionFinder(a,
b){return new Ea.PositionFinderImpl(new Bb.CameraControlImpl(b))}createCameraControl(a){return new Bb.CameraControlImpl(a)}isOverview(a,b){return b.getPrezi().getChild(f.CetModel.ID.PREZI.OVERVIEW).getId()===a}isOverviewThatUsesChapters(a,b){if(!a)return!1;const c=b.getPrezi().getChild(f.CetModel.ID.PREZI.OVERVIEW);b=b.getPreziW().getOverview().getUsesChapters();return c.getId()===a&&b}isLogo(a,b){return b.getEntityById(a).isDef(f.CetModel.ID.LOGO)||b.getEntityById(a).isDef(f.CetModel.ID.NEXT_LOGO_V1)}isNextLogo(a,
b){return b.getEntityById(a).isDef(f.CetModel.ID.NEXT_LOGO_V1)}isClickableNextLogo(a,b){a=b.getEntityById(a);return a.isDef(f.CetModel.ID.NEXT_LOGO_V1)&&a.getWrapper(f.CetModel.ID.NEXT_LOGO_V1.W).getLinkUrl()?!0:!1}isPlanetOrStack(a,b){a=this.createTopicQuery(b).getTopicKind(a);return a===d.TopicKind.Stack||a===d.TopicKind.Planet}isStack(a,b){return this.createTopicQuery(b).getTopicKind(a)===d.TopicKind.Stack}isPlanet(a,b){return this.createTopicQuery(b).getTopicKind(a)===d.TopicKind.Planet}isPage(a,
b){return this.createTopicQuery(b).getTopicKind(a)===d.TopicKind.Page}isSubChapter(a,b){return sa.EditorFactory.createTopic(b).isSubChapter(a,b)}isPageOfSubChapter(a,b){a=b.getEntityById(a);return null==a?!1:this.isSubChapter(l.Cet.createHierarchyQuery(b).getParentId(a),b)}isLocked(a,b){a=b.getEntityById(a);return null==a?!1:a.isDef(f.CetModel.ID.LOCKABLE)?a.getWrapper(f.CetModel.ID.LOCKABLE.W).getLocked():!1}getParentSmartStructureId(a,b){a=b.getEntityById(a);if(null==a)return null;a=a.get(f.CetModel.ID.SMART_STRUCTURE.CHILDREN_PARENT);
return null!=a&&0<=a.length?a[0]:null}getSmartStructureIdForBaseLine(a,b){return this.getFirstReferer(f.CetModel.ID.LINEAR_SMART_STRUCTURE.BASELINE_PARENT,a,b)}getSmartStructureIdForChainLink(a,b){return this.getFirstReferer(f.CetModel.ID.CHAIN_SMART_STRUCTURE.CHAIN_LINKS_PARENT,a,b)}getFirstReferer(a,b,c){b=c.getEntityById(b);if(null==b)return null;a=b.get(a);return null!=a&&0<a.length?a[0]:null}getPagesOfChapterUnsorted(a,b){if(!this.isPlanetOrStack(a,b))return[];a=b.getEntityById(a);return l.Cet.createHierarchyQuery(b).getChildrenIds(a).filter((a)=>
this.isPage(a,b))}getPagesOfChapter(a,b){a=this.getPagesOfChapterUnsorted(a,b);return this.createEditorPathQuery(b).sortByPathPosition(a)}getPagesInSubTree(a,b){a=l.Cet.createHierarchyQuery(b).getSubTrees([a]).filter((a)=>this.isPage(a,b));return this.createEditorPathQuery(b).sortByPathPosition(a)}usesChaptersOnOverview(a){return(a=a.getPreziW().getOverview().getUsesChapters())?a:!1}getPageOrChapterId(a,b){const c=b.getEntityById(a);if(null==c)return null;const e=l.Cet.createHierarchyQuery(b);e.isZTopicContainer(a)||
(a=e.getParentOrOverview(c));this.isPlanetOrStack(a,b)&&!this.isPlanet(a,b)&&(a=e.getParentOrOverview(b.getEntityById(a)));return a}getCurrentChapterId(a,b){if(!this.usesChaptersOnOverview(b))return null;if(this.isPlanetOrStack(a,b))return a;a=l.Cet.createHierarchyQuery(b).getAncestorEntities(a).filter((a)=>this.isPlanetOrStack(a,b));return 0<a.length?a[0]:null}findZObject(a,b){a=b.getEntityById(a).getWrapper(f.CetModel.ID.Z_OBJECT.W);return b.getPreziW().getZObjects().indexOf(a)}moveZObject(a,b,
c){-1===b&&(b=c.getPrezi().getComponent(f.CetModel.ID.PREZI.Z_OBJECTS).length());c.getPrezi().moveChild(f.CetModel.ID.PREZI.Z_OBJECTS,a,b)}findMinimumZIndexEntity(a,b){let c=NaN,e=null;for(let d=0;d<a.length;d++){const f=b.getEntityById(a[d]);if(null==f)continue;const g=this.findZObject(f.getId(),b);if(null==e||g<c)c=g,e=f}return{zIndex:c,entity:e}}printHierarchy(a,b=null,c=null){const e=l.Cet.createHierarchyQuery(a).getTopLevelEntities();for(let d=0;d<e.length;d++)this.printHierarchyI(e[d],a,b,c)}printHierarchyI(a,
b,c,e){var d=b.getEntityById(a);a=l.Cet.createHierarchyQuery(b).getChildrenIds(d);const f=new ge;null!=c&&(f.custom1=d.getComponent(c));null!=e&&(f.custom2=d.get(e));if(0===a.length)return f;d={};for(let f=0;f<a.length;f++)d[a[f]]=this.printHierarchyI(a[f],b,c,e);f.children=d;return f}getTopLevelTopics(a){const b=this.createTopicQuery(a),c=l.Cet.createHierarchyQuery(a);return a.getPrezi().getComponent(f.CetModel.ID.PREZI.Z_OBJECTS).items().filter((e)=>{e=a.getEntityById(e);return b.isTopic(e)&&null==
c.getParentId(e)})}getDraggedTopicOriginalTranslationKey(){null==m.CetModelEditorImpl.draggedTopicOriginalTranslationKey&&(m.CetModelEditorImpl.draggedTopicOriginalTranslationKey=f.CetModel.createValueComponentKey("dragged_object_original_translation",!1,!1));return m.CetModelEditorImpl.draggedTopicOriginalTranslationKey}getShowContentKey(){null==m.CetModelEditorImpl.showContentKey&&(m.CetModelEditorImpl.showContentKey=f.CetModel.createValueComponentKey("show_content",!1,!0,!0));return m.CetModelEditorImpl.showContentKey}isTypeOfSmartStructure(a,
b){return null==a?!1:a.isDef(b)&&b===f.CetModel.ID.LINEAR_SMART_STRUCTURE?null!=a.getWrapper(f.CetModel.ID.LINEAR_SMART_STRUCTURE.W).getBaseline():a.isDef(b)}getTransformBetweenAreas(a,b){return Hb.CetLayout.getTransformBetweenAreas(a,b)}createTextHelper(){return new rc.TextHelperImpl}cetSessionFactory(){return l.Cet.cetSessionFactoryInternal(this.converterPlugins())}converterPlugins(){return new Fb.ConverterPluginArray([new Cb.ClassicToNextConverter,new Jb.TopicCustomizationConverter,new Gb.EnsureFilterStyleConverter,
new Kb.EnsureFixedBoundsOverview])}getEditVisibilityKey(){null==m.CetModelEditorImpl.editVisibilityKey&&(m.CetModelEditorImpl.editVisibilityKey=f.CetModel.createValueComponentKey("editVisibility",!1,!1));return m.CetModelEditorImpl.editVisibilityKey}getConnectorArcHeightKey(){null==m.CetModelEditorImpl.connectorArcHeightKey&&(m.CetModelEditorImpl.connectorArcHeightKey=f.CetModel.createValueComponentKey("connectorArcHeightKey",!1,!1));return m.CetModelEditorImpl.connectorArcHeightKey}createLogHelper(a){return new jc.CetModelLogHelperImpl(a)}createDefaultColorHelper(){return new sb.DefaultColorHelperImpl}createTopicLayoutTracker(a,
b=[f.CetModel.ID.VISUAL,f.CetModel.ID.COVER]){return new pc.TopicLayoutTrackerImpl(a,b)}styleColorToColor(a){return null==a?null:q.Geometry.colorFromRGB(a.r/255,a.g/255,a.b/255)}colorToStyleColor(a){return null==a?null:a.getRGBData()}styleBlockFromPdom(a,b){return G.styleBlockFromPdom(a,b)}createProgressiveAssetManager(a,b,c,e,d,f,g,k,l,m,n,q,u,v,y,A,B){return new T.ProgressiveAssetManagerImpl(a,b,c,A,e,d,f,g,k,l,m,n,q,u,v,y,B)}createRunner(a,b,c,e,d){return new Ba.RunnerImpl(a,b,c,e,d)}createRunnerForCetApp(a,
b,c){return Lb(this,void 0,void 0,function*(){const e=yield I.initCetApp(a),d=I.waitForFontAndMasatLoaded(a);e.editScene.update();yield d;e.updateAndRunFixers();a.getMainStage().setScene(e.editScene,e.editScene);return new Ba.RunnerImpl(e.cetApp,e.editScene,b,c)})}addXMLToTemplateDataCacheForTest(a,b){this.templateDataCache[a]=(()=>Lb(this,void 0,void 0,function*(){return k.DOM.loadXml(b)}))()}loadTemplateData(a,b){return Lb(this,void 0,void 0,function*(){const c=a.getTemplateIdFromTemplateInfo(b.templateId,
b.themeId);let e=this.templateDataCache[c];null==e&&(e=(()=>Lb(this,void 0,void 0,function*(){return k.DOM.loadXml(yield a.loadTemplateXml(b.templateId,b.themeId))}))(),this.templateDataCache[c]=e);return e})}defineLayoutBoxRelativeToReferenceObject(a,b,c,e){const d=q.Geometry.obbFromRect(b.getBounds().getData()).transform(a);a=q.Geometry.obbFromRect(e.getBounds().getData()).transform(c);b=a.setSize(a.getWidth(),a.getWidth()*d.getHeight()/d.getWidth());c=this.getTransformBetweenAreas(b,q.Geometry.obbFromData(0,
0,100,100,0));a=d.transform(c);b=b.transform(c);const f=this.getTransformBetweenAreas(a,b).invert();return{transformBox:(a)=>{var b=a.relativeBounds.transform(a.referenceFrame.relativeToWorld);b=b.setSize(b.getWidth(),b.getWidth()*d.getHeight()/d.getWidth());const c=this.getTransformBetweenAreas(b,q.Geometry.obbFromData(0,0,100,100,0));b=b.transform(c).transform(f).transform(c.invert()).transform(a.referenceFrame.relativeToWorld.invert());return new u.LayoutBoxImpl(a.referenceFrame,b)}}}createGroupQuery(){return new H.GroupManager}readTemplateInfo(a){a=
a.getTemplateInfo();return null==a?null:a.getThemeId()===this.NOT_USED_THEME_ID?{templateId:a.getBaseId()}:{templateId:a.getBaseId(),themeId:a.getThemeId()}}createPathElementIdToPlaybackPathPositionMap(a){a=g.Check.as("rapi",a,"BaseEditorApiImpl",Z.BaseEditorApiImpl).executionContext.mscene;return this.createPathElementIdToPlaybackPathPositionMapFromScene(a)}createPathElementIdToPlaybackPathPositionMapFromScene(a){const b=a.getPreziW();l.Cet.pathKludge.assertEditorPathV2(b);return E.createEntityIdToPlaybackPathPositionMap(b,
a)}calculatePageOrTopicTitle(a){let b=[];a.is(d.base.ObjectKind.stackTopic)?b=[...a.cover.contentChildren,...a.visual.contentChildren].filter(d.base.readerIs(d.base.ObjectKind.text)):a.is(d.base.ObjectKind.planetTopic)&&(b=[...a.cover.contentChildren,...a.visual.contentChildren,...a.surface.contentChildren].filter(d.base.readerIs(d.base.ObjectKind.text)));0===b.length&&a.is(d.base.ObjectKind.planetTopic)&&(b=a.contentChildren.filter(d.base.readerIs(d.base.ObjectKind.text)));if(0===b.length&&a.is(d.base.ObjectKind.page)){if(0===
a.index)return this.calculatePageOrTopicTitle(a.parent);b=a.contentChildren.filter(d.base.readerIs(d.base.ObjectKind.text))}0!==b.length||a.is(d.base.ObjectKind.page)||(b=a.master.contentChildren.filter(d.base.readerIs(d.base.ObjectKind.text)));if(0===b.length)return null;a=b.filter((a)=>!a.isPlaceholder);if(0===a.length)return null;a.sort((a,b)=>b.getLineMetrics(0).height-a.getLineMetrics(0).height);a=a[0].getText();return""===a?null:a.trim()}isTopicShapeObjectKILLME(a){const b=a.parent;return b.is(d.base.ObjectKind.visual)||
b.is(d.base.ObjectKind.surface)?this.isTheOnlyOneShapeVisualId(a.id,b)||this.isTopicShapeCheck(a)||this.isKnownTopicShapeAsset(a):!1}isTheOnlyOneShapeVisualId(a,b){var c=(b.is(d.base.ObjectKind.visual)?b.contentChildren:b.parent.visual.contentChildren).filter((a)=>!(a.is(d.base.ObjectKind.slide)||a.visualLayoutRole===d.base.VisualLayoutRole.slideDecorator));b=b.is(d.base.ObjectKind.surface)?b.contentChildren:b.parent.is(d.base.ObjectKind.planetTopic)?b.parent.surface.contentChildren:[];c=[...c,...b];
return 1===c.length&&(c=c[0],c.is(d.base.ObjectKind.shape))?a===c.id:!1}isTopicShapeCheck(a){return this.isVisual(a)&&a.visualLayoutRole===d.base.VisualLayoutRole.topicShape||this.isSurface(a)&&a.surfaceLayoutRole===d.base.SurfaceLayoutRole.surfaceTopicShape}isKnownTopicShapeAsset(a){return a.is(d.base.ObjectKind.pdf)?this.TOPIC_SHAPE_URLS_KILLME.has(a.pdfAsset.url):a.is(d.base.ObjectKind.image)?this.TOPIC_SHAPE_URLS_KILLME.has(a.imageAsset.url):!1}isVisual(a){return a.parent.is(d.base.ObjectKind.visual)}isSurface(a){return a.parent.is(d.base.ObjectKind.surface)}createPlaybackPathQuery(a){return new qc.PlaybackPathQueryImpl(a,
this.createPathQueryHelper(a))}getPathPositionForTarget(a){var b,c=null!==(b=a.findClosestPathPositionWithTarget)&&void 0!==b?b:!0;b=a.navigationControl.getPathNavigator();c=c?b.getCurrentPosition():null;return this.createPlaybackPathQuery(a.navigationControl.getModelScene()).getClosestSuitablePathPosition(c,a.targetId,a.allowForwardActions)}setCameraAndPathFor(a){var b;if(null!=a.pathPosition){const c=null!==(b=a.speedMultiplyer)&&void 0!==b?b:1;a.navigationControl.getCamera().setCameraOnPath(!0);
a.navigationControl.getPathNavigator().go(a.pathPosition,{cameraNavigationType:l.CameraNavigationType.NONE,speedMultiplyer:c})}else a.navigationControl.getCamera().setCameraOnPath(!1)}};m.CetModelEditorInternal=new m.CetModelEditorImpl;var g={};Object.defineProperty(g,"__esModule",{value:!0});g.IllegalArgumentException=class extends Error{constructor(a){super(a);Object.setPrototypeOf(this,g.IllegalArgumentException.prototype)}};g.IllegalStateException=class extends Error{constructor(a){super(a);Object.setPrototypeOf(this,
g.IllegalStateException.prototype)}};g.Check=class{static notNull(a,b){if(null==b)throw new g.IllegalArgumentException(`${a} should not be null`);return b}static undefinedOrNotNull(a,b){if(void 0!==b&&null==b)throw new g.IllegalArgumentException(`${a} should not be null`);}static rgb(a,b){g.Check.notNull(a,b);g.Check.checkValidRgbValue(`Red component of ${a}`,b.r);g.Check.checkValidRgbValue(`Green component of ${a}`,b.g);g.Check.checkValidRgbValue(`Blue component of ${a}`,b.b)}static rgba(a,b){g.Check.rgb(a,
b);g.Check.range(`Alpha component of ${a}`,b.a,0,1)}static point(a,b){g.Check.notNull(a,b);g.Check.finite(`${a}.x`,b.x);g.Check.finite(`${a}.y`,b.y);return b}static anchorPoint(a,b){g.Check.notNull(a,b);g.Check.finite(`${a}.rx`,b.rx);g.Check.finite(`${a}.ry`,b.ry)}static size(a,b){g.Check.notNull(a,b);g.Check.positive(`${a}.width`,b.width);g.Check.positive(`${a}.height`,b.height)}static imageAsset(a,b){g.Check.notNull(a,b);null!=b.offlineAssetId?g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId):
(g.Check.notNull(a+".url",b.url),g.Check.positive(a+".height",b.height),g.Check.positive(a+".width",b.width))}static animatedImageAsset(a,b){g.Check.notNull(a,b);g.Check.notEmpty(a,b.mediaAssetId)}static audioAsset(a,b){g.Check.notNull(a,b);null!=b.offlineAssetId?g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId):g.Check.notNull(a+".url",b.url)}static logoAsset(a,b){g.Check.notNull(a,b);null!=b.offlineAssetId?g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId):g.Check.notNull(a+".url",b.url)}static brandKit(a,
b){g.Check.notNull(a,b);g.Check.notNull(a+".brandId",b.brandId);g.Check.notNull(a+".hash",b.hash);g.Check.notNull(a+".ownerId",b.ownerId)}static swfAsset(a,b){g.Check.notNull(a,b);g.Check.notNull(a+".url",b.url);g.Check.positive(a+".height",b.height);g.Check.positive(a+".width",b.width)}static pdfAsset(a,b){g.Check.notNull(a,b);null!=b.offlineAssetId?g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId):g.Check.notNull(a+".url",b.url);g.Check.positive(a+".width",b.width);g.Check.positive(a+".height",
b.height);g.Check.nonNegative(a+".page",b.page);g.Check.integer(a+".page",b.page)}static slideAsset(a,b){g.Check.notNull(a,b);g.Check.pdfAsset(a+".originalPdfAsset",b.originalPdfAsset);g.Check.pdfAsset(a+".noBackgroundPdfAsset",b.noBackgroundPdfAsset);g.Check.nonNegative(a+".sourcePageNumber",b.sourcePageNumber);g.Check.notEmpty(a+".jobId",b.jobId)}static chartAssetParams(a,b){g.Check.notNull(a,b);g.Check.notNull(`${a}.chartType`,b.chartType);g.Check.positive(`${a}.height`,b.height);g.Check.positive(`${a}.width`,
b.width);g.Check.notNull(`${a}.params`,b.params);"chartId"in b.params?(g.Check.notNull(`${a}.params.chartId`,b.params.chartId),g.Check.notNull(`${a}.params.pdf`,b.params.pdf)):g.Check.chartColors(`${a}.params.colors`,b.params.colors)}static chartAsset(a,b){g.Check.notNull(a,b);null!=b.offlineAssetId?g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId):(g.Check.notNull(a+".url",b.url),g.Check.notNull(a+".chartId",b.chartId));g.Check.positive(a+".height",b.height);g.Check.positive(a+".width",b.width);
g.Check.notNull(a+".chartType",b.chartType)}static videoAsset(a,b){g.Check.notNull(a,b);if(null!=b.offlineAssetId)g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId);else switch(b.videoAssetKind){case d.base.VideoAssetKind.uploadedToPrezi:g.Check.notNull(a+".url",b.url);break;case d.base.VideoAssetKind.youtube:g.Check.notNull(a+".onlineAssetId",b.onlineAssetId);break;default:n.Utils.assertNever(b)}}static themeColors(a,b){g.Check.notNull(a,b);g.Check.color(a+".color1",b.color1);g.Check.color(a+
".color2",b.color2);g.Check.color(a+".color3",b.color3);g.Check.color(a+".color4",b.color4);g.Check.color(a+".color5",b.color5)}static chartStyle(a,b){g.Check.notNull(a,b);g.Check.chartColors(a+".light",b.light);g.Check.chartColors(a+".dark",b.dark)}static chartColors(a,b){g.Check.notNull(a,b);g.Check.color(a+".axis",b.axis);g.Check.color(a+".data1",b.data1);g.Check.color(a+".data2",b.data2);g.Check.color(a+".data3",b.data3);g.Check.color(a+".data4",b.data4);g.Check.color(a+".data5",b.data5);g.Check.color(a+
".background",b.background)}static color(a,b){g.Check.notNull(a,b)}static string(a,b){g.Check.notNull(a,b);g.Check.assert("string"===typeof b,`${a} should be a string`)}static undefinedOrColor(a,b){void 0!==b&&g.Check.notNull(a,b)}static eql(a,b,c){g.Check.notNull(a,b);if(b!==c)throw new g.IllegalArgumentException(`${a} (${b}) should be ${c}`);}static notEqlString(a,b,c){if(b===c)throw new g.IllegalArgumentException(`${a} value should not be ${c}`);}static range(a,b,c,e){g.Check.notNull(a,b);if(!(c<=
b&&b<=e))throw new g.IllegalArgumentException(`${a} (${b}) is outside of range [${c}...${e}]`);}static checkValidRgbValue(a,b){if((b&255)!==b)throw new g.IllegalArgumentException(`${a} (${b}) is not an integer between 0 and 255`);}static undefinedOrFinite(a,b){if(void 0!==b&&!isFinite(b))throw new g.IllegalArgumentException(`${a} (${b}) should be finite number`);}static finite(a,b){g.Check.notNull(a,b);if(!isFinite(b))throw new g.IllegalArgumentException(`${a} (${b}) should be finite number`);return b}static nonNegative(a,
b){g.Check.notNull(a,b);if(0>b||!isFinite(b))throw new g.IllegalArgumentException(`${a} (${b}) should be non negative finite number`);}static positive(a,b){g.Check.notNull(a,b);if(0>=b||!isFinite(b))throw new g.IllegalArgumentException(`${a} (${b}) should be positive finite number`);}static integer(a,b){g.Check.finite(a,b);if(0!==b%1)throw new g.IllegalArgumentException(`${a} (${b}) should be integer`);}static notEmpty(a,b){g.Check.notNull(a,b);return 0<b.length}static audio(a,b){g.Check.notNull(a,
b);null!=b.offlineAssetId?g.Check.notEmpty(a+".offlineAssetId",b.offlineAssetId):(g.Check.notEmpty(a+".audioType",b.audioType),g.Check.notEmpty(a+".url",b.url),g.Check.nonNegative(a+".mediaLengthMilliSecs",b.mediaLengthMilliSecs))}static templateInfo(a,b){g.Check.notNull(a,b);g.Check.notNull(a+".templateId",b.templateId);g.Check.notEqlString(a+".themeId",b.themeId,m.CetModelEditorInternal.NOT_USED_THEME_ID)}static styleBlock(a,b){g.Check.notNull(`${a}`,b);g.Check.notNull(`${a}:arc`,b.arc);g.Check.notNull(`${a}:fill`,
b.fill);g.Check.notNull(`${a}:border`,b.border);g.Check.notNull(`${a}:text`,b.text);g.Check.notNull(`${a}:text:background`,b.text.background);g.Check.undefinedOrFinite(`${a}:arc:connectorAttachPadding`,b.arc.connectorAttachPadding);g.Check.undefinedOrFinite(`${a}:thickness`,b.thickness);g.Check.undefinedOrFinite(`${a}:fill:alpha`,b.fill.alpha);g.Check.undefinedOrColor(`${a}:fill:color`,b.fill.color);g.Check.undefinedOrNotNull(`${a}:fill:fillKind`,b.fill.fillKind);g.Check.undefinedOrFinite(`${a}:fill:gradientEndAlpha`,
b.fill.gradientEndAlpha);g.Check.undefinedOrColor(`${a}:fill:gradientEndColor`,b.fill.gradientEndColor);g.Check.undefinedOrFinite(`${a}:fill:gradientStartAlpha`,b.fill.gradientStartAlpha);g.Check.undefinedOrColor(`${a}:fill:gradientStartColor`,b.fill.gradientStartColor);g.Check.undefinedOrFinite(`${a}:border:alpha`,b.border.alpha);g.Check.undefinedOrColor(`${a}:border:color`,b.border.color);g.Check.undefinedOrFinite(`${a}:border:thickness`,b.border.thickness);g.Check.undefinedOrFinite(`${a}:padding`,
b.padding);g.Check.undefinedOrFinite(`${a}:background:alpha`,b.text.background.alpha);g.Check.undefinedOrColor(`${a}:background:color`,b.text.background.color);g.Check.undefinedOrNotNull(`${a}:background:display`,b.text.background.display);g.Check.undefinedOrFinite(`${a}:background:padding`,b.text.background.padding);g.Check.undefinedOrNotNull(`${a}:background:padding`,b.text.font)}static assertSameFontSource(a,b,c){g.Check.notNull(a,b);g.Check.notNull(a,c);g.Check.assert(b.origin===c.origin,a);g.Check.assert(b.source===
c.source,a)}static as(a,b,c,e){return b instanceof e?b:g.Check.failure(`${a} should be a ${c}`)}static failure(a){throw new g.IllegalArgumentException(a);}static assert(a,b){a||this.failure(b)}static isSupportedDocumentGeneration(a,b){g.Check.assert(f.CetModel.isSupportedDocumentGeneration(a,b),`Document generation should be at least '${b}'`)}};var jb={},Oa=this&&jb.__awaiter||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function g(a){try{k(e.next(a))}catch(t){f(t)}}
function h(a){try{k(e["throw"](a))}catch(t){f(t)}}function k(a){a.done?c(a.value):d(a.value).then(g,h)}k((e=e.apply(a,b||[])).next())})};Object.defineProperty(jb,"__esModule",{value:!0});jb.EditorSessionTesterImpl=class{constructor(a,b,c,e,d){this.fs=a;this.chai=b;this.xml=c;this.idGeneratorSeed=e;this.defaultFontUrl=d;this.defaultTestEditorSessionReseter=null}getTestEditorSession(a=!1){return Oa(this,void 0,void 0,function*(){if(null==this.defaultTestEditorSessionReseter||a)this.defaultTestEditorSessionReseter=
new he(this.fs,this.chai,this.idGeneratorSeed,this.xml,this.defaultFontUrl);return this.defaultTestEditorSessionReseter.reset()})}getTestEditorSessionForXml(a){return Oa(this,void 0,void 0,function*(){return yield(new Wc(this.fs,this.chai,this.idGeneratorSeed,this.defaultFontUrl)).loadXml(a)})}createSubTester(a){return Oa(this,void 0,void 0,function*(){var b=yield this.getTestEditorSession();const c=this.idGeneratorSeed+1;b.setTestIdGenerator(c);yield b.execute((b)=>a(b));b=b.toXml();return new jb.EditorSessionTesterImpl(this.fs,
this.chai,b,c+1,this.defaultFontUrl)})}getGeneratedId(a){null==this.generator&&(this.generator=l.Cet.createTestIdGenerator(this.idGeneratorSeed),this.generatedIds=[]);for(;a>=this.generatedIds.length;)this.generatedIds.push(this.generator.generateId());return this.generatedIds[a]}};class he{constructor(a,b,c,e,d){this.fs=a;this.chai=b;this.idGeneratorSeed=c;this.xmlToLoad=e;this.defaultFontUrl=d;this.sessionXml=this.editorSessionImpl=null;this.sessionCounter=0;this.lastFeatures=""}reset(){return Oa(this,
void 0,void 0,function*(){var a=Fa.FeatureSwitcher.getActiveFeatures().join(",");this.lastFeatures!==a&&(this.editorSessionImpl=null,this.lastFeatures=a);this.sessionCounter++;100===this.sessionCounter&&(this.sessionCounter=0,this.editorSessionImpl=null);null==this.editorSessionImpl&&(a=new Wc(this.fs,this.chai,this.idGeneratorSeed,this.defaultFontUrl),this.editorSessionImpl=null==this.xmlToLoad?yield a.create():yield a.loadXml(this.xmlToLoad),this.sessionXml=this.editorSessionImpl.toXml());this.editorSessionImpl.reset();
a=this.editorSessionImpl.toXml();if(this.sessionXml!==a)throw this.editorSessionImpl=null,Error("undo is broken");return this.editorSessionImpl})}}class Wc extends I.XmlConnectionImpl{constructor(a,b,c,e){super();this.fs=a;this.chai=b;this.idGeneratorSeed=c;this.defaultFontUrl=e;this.mockFontLoading()}create(){return super.create()}loadXml(a){const b=Object.create(null,{loadXml:{get:()=>super.loadXml}});return Oa(this,void 0,void 0,function*(){return b.loadXml.call(this,a)})}createEditorSession(a){a.editScene.setIdleChangeStream(a.editScene.getImmediateChangeStream(l.ChangeEventKind.Entity));
a.editScene.getParentScene().setIdleChangeStream(a.editScene.getParentScene().getImmediateChangeStream(l.ChangeEventKind.Entity));return new ie(a.cetApp,this.externalServiceProvider.assetLoaderProvider,this.mediaService,a.editScene,a.cetSession,a.cetApp.getMainStage().getRenderer().getAssetManager(),a.cetApp,this.idGeneratorSeed,this.chai)}mockFontLoading(){const a=this.externalServiceProvider.assetLoaderProvider.loadBinaryAsset.bind(this.externalServiceProvider.assetLoaderProvider);this.externalServiceProvider.assetLoaderProvider.loadBinaryAsset=
(b,c,e)=>{var d=b.split("?")[0];if(d.endsWith(".keg")){b=d.split("/").pop();const a=(d=this.fs.existsSync(J.getResourceUrl(b)))?J.getResourceUrl(b):this.defaultFontUrl;d||console.warn(`keg '${b}' is not found, using '${a}' instead`);this.fs.readFile(a,(a,b)=>{null!=a?e({type:lb.AssetLoadErrorType.GenericError,errorMessage:null!=a?a.toString():null}):c(b)})}else a(b,c,e)}}}class ie extends Z.EditorSessionImpl{constructor(a,b,c,e,d,f,g,k,l){super(a,b,c,f,e,d,!1,null,0,null,null,null,new Aa.NoBehaviorExtensions,
g);this.idGeneratorSeed=k;this.chai=l;e.useTestIdGenerator(this.idGeneratorSeed)}getScene(){return this.scene}getRunner(){return this.runner}reset(){for(;this.scene.isUndoable();)this.scene.executeUndo();this.scene.useTestIdGenerator(this.idGeneratorSeed)}setTestIdGenerator(a){this.scene.useTestIdGenerator(a)}addFakeMediaAssetInfo(a,b){const c=this.cetApp.getMainStage().getRenderer().getAssetManager(),e=c.getCachedMediaAssetDimensions.bind(c);c.getCachedMediaAssetDimensions=(c)=>c===a?b:e(c);const d=
c.queryConversionResult.bind(c);c.queryConversionResult=(c)=>c===a?Promise.resolve(b):d(c);const f=c.queryMediaAssetDimensions.bind(c);c.queryMediaAssetDimensions=(c)=>Oa(this,void 0,void 0,function*(){const e=yield f(c);e.set(a,b);return e})}tstoJson(){return this.scene.getRootScene().getPrezi().tstoJson()}execute(a){const b=Object.create(null,{execute:{get:()=>super.execute}});return Oa(this,void 0,void 0,function*(){const c=this.tstoJson();var {result:e,endJson:d}=yield b.execute.call(this,(b)=>
{var e=b.tstoJson();this.chai.expect(c).eqls(e);e=a(b);b=b.tstoJson();return{result:e,endJson:b}});const f=this.tstoJson();this.chai.expect(d,f);return e})}}var d={colorFilterFromPdom:function(a){return G.colorFilterFromPdom(a)}};Object.defineProperty(d,"__esModule",{value:!0});(function(a){a[a.FADE_IN=0]="FADE_IN";a[a.FADE_OUT=1]="FADE_OUT";a[a.ZOOM_TO=2]="ZOOM_TO";a[a.ZOOM_BACK=3]="ZOOM_BACK";a[a.ZOOM_AREA=4]="ZOOM_AREA"})(d.ActionType||(d.ActionType={}));(function(a){a.COVER="COVER";a.CHILD="CHILD"})(d.InsertHierarchyDestinationKind||
(d.InsertHierarchyDestinationKind={}));(function(a){a[a.HAS_PDOM_COMPONENT=0]="HAS_PDOM_COMPONENT";a[a.LINE_ARROW=1]="LINE_ARROW";a[a.INTERACTIVE_DECORATOR=2]="INTERACTIVE_DECORATOR";a[a.TOO_LARGE=3]="TOO_LARGE";a[a.TOO_SMALL=4]="TOO_SMALL";a[a.PAGE=5]="PAGE";a[a.Z_TOPIC_CONTAINER=6]="Z_TOPIC_CONTAINER";a[a.Z_TOPIC_CONTAINER_WITHOUT_COVER_AND_VISUAL=7]="Z_TOPIC_CONTAINER_WITHOUT_COVER_AND_VISUAL";a[a.COVER=8]="COVER";a[a.COVER_OF_COVER_EDITED_TOPIC=9]="COVER_OF_COVER_EDITED_TOPIC";a[a.EXTERNAL_OBJECT_INTERSECTING_COVER_EDIT_BOUNDS=
10]="EXTERNAL_OBJECT_INTERSECTING_COVER_EDIT_BOUNDS";a[a.VISUALLIKE=11]="VISUALLIKE";a[a.VISUALLIKE_OF_COVER_EDITED_TOPIC=12]="VISUALLIKE_OF_COVER_EDITED_TOPIC";a[a.VISUALLIKE_OF_CURRENT_TOPIC=13]="VISUALLIKE_OF_CURRENT_TOPIC";a[a.VISIBLE=14]="VISIBLE";a[a.REACHABLE_IN_DOCUMENT=15]="REACHABLE_IN_DOCUMENT";a[a.CLICKED_ENCLOSELY=16]="CLICKED_ENCLOSELY";a[a.CLICKED_PRECISELY=17]="CLICKED_PRECISELY";a[a.CLICKED_IN_WORLD_BOUNDS=18]="CLICKED_IN_WORLD_BOUNDS";a[a.CLICKED_IN_BORDER_AREA=19]="CLICKED_IN_BORDER_AREA";
a[a.CONTAINS_WORLD_AREA=20]="CONTAINS_WORLD_AREA";a[a.INTERSECT_WORLD_AREA=21]="INTERSECT_WORLD_AREA";a[a.MAPPED=22]="MAPPED";a[a.ZOOM_AREA=23]="ZOOM_AREA";a[a.ENABLED=24]="ENABLED";a[a.SMALLER_ZOOM_AREA=25]="SMALLER_ZOOM_AREA";a[a.ENCLOSING_ZOOM_AREA=26]="ENCLOSING_ZOOM_AREA";a[a.LOGO=27]="LOGO";a[a.TRIANGLE=28]="TRIANGLE";a[a.LOCKED=29]="LOCKED"})(d.HitTag||(d.HitTag={}));(function(a){a[a.View=0]="View";a[a.Edit=1]="Edit"})(d.ApplicationMode||(d.ApplicationMode={}));(function(a){a[a.insert=0]="insert";
a[a.paste=1]="paste";a[a.pasteKeepTransform=2]="pasteKeepTransform"})(d.SmartStructureAddIntention||(d.SmartStructureAddIntention={}));(function(a){a[a.Overview=0]="Overview";a[a.Page=1]="Page";a[a.Planet=2]="Planet";a[a.Stack=3]="Stack";a[a.None=4]="None"})(d.TopicKind||(d.TopicKind={}));(function(a){a.content="content";a.structure="structure"})(d.TitleOrigin||(d.TitleOrigin={}));(d.Animation||(d.Animation={})).TRANSFORM_DURATION=600;(function(a){a[a.EndTransaction=0]="EndTransaction";a[a.BeginOtherTransaction=
1]="BeginOtherTransaction";a[a.AbortTransaction=2]="AbortTransaction";a[a.RollbackTransaction=3]="RollbackTransaction"})(d.FinishEventKind||(d.FinishEventKind={}));(function(a){a[a.EditorError=0]="EditorError";a[a.CannotSetSound=1]="CannotSetSound";a[a.Canceled=2]="Canceled"})(d.AudioInsertErrorKind||(d.AudioInsertErrorKind={}));(function(a){a.PRESET_LINE_ARROW_START_END_DISTANCE=200;a.PRESET_LINE_ARROW_ARC_HEIGHT=0;a.PRESET_CIRCLE_RADIUS=100;a.PRESET_RECT_WIDTH=160;a.PRESET_RECT_HEIGHT=90;a.PRESET_BRACKET_FRAME_WIDTH=
160;a.PRESET_BRACKET_FRAME_HEIGHT=90;a.PRESET_TRIANGLE_WIDTH=100;a.PRESET_TRIANGLE_HEIGHT=100;a.PRESET_ZOOM_AREA_WIDTH=160})(d.PresetConstants||(d.PresetConstants={}));d.CetModelEditor=m.CetModelEditorInternal;d.createPathLabelMap=function(a){return C.createLabelMapI(a)};d.getLabelledIdsInOrder=function(a){return C.getLabelledIdsInOrderI(a)};d.createEditorSessionTester=function(a,b,c){return new jb.EditorSessionTesterImpl(a,b,null,42,null!==c&&void 0!==c?c:J.getResourceUrl("Cabin-Regular.keg"))};
(function(a){function b(a,b){return Xa.isKindDescendantOf(a,b)}function c(a){return(c)=>null!=c&&b(c.kind,a)}a.createPathLabelMapFromApi=function(a){return C.createLabelMapFromApiI(a)};(function(a){a.remove="remove";a.reset="reset";a.adjust="adjust"})(a.TopicLayoutEventKind||(a.TopicLayoutEventKind={}));a.layoutBoxFromJSON=function(a){return u.layoutBoxFromJSON(a)};a.temp_newConnection=function(){return new I.ConnectionImpl};a.temp_newXmlConnection=function(){return new I.XmlConnectionImpl};a.temp_createSession=
function(a,b,c,d,f,g,k,l){return new Z.EditorSessionImpl(a,b,c,d,f,g,!1,null,null,k,null,null,new Aa.NoBehaviorExtensions,l)};a.modelColorToCharacterColor=function(a){if(null==a)return null;a=a.asInt();return{r:a>>16&255,g:a>>8&255,b:a&255}};a.characterColorToModelColor=function(a){return null==a?null:X.TextModel.createColor(((a.r&255)<<16)+((a.g&255)<<8)+(a.b&255))};a.getArrowHeadLength=function(){return l.Cet.getArrowHeadLength()};a.getEmptyPreziXMLForTest=function(){return I.ConnectionImpl.emptyPreziXMLForTest()};
(function(a){a.Line1="line1";a.Line2="line2";a.Line3="line3";a.Line4="line4";a.Line5="line5";a.Chainlink="chainlink";a.ChainlinkCamelCase="chainLink";a.Baseline="baseLine"})(a.ArcStyle||(a.ArcStyle={}));(function(a){a.Poly1="poly1";a.Poly2="poly2";a.Poly3="poly3";a.Poly4="poly4";a.Poly5="poly5";a.LegacyFrame1="frame1";a.LegacyFrame2="frame2";a.LegacyFrame3="frame3";a.LegacyFrame4="frame4";a.LegacyFrame5="frame5"})(a.ShapeStyle||(a.ShapeStyle={}));(function(a){a.Filter1="shapelikeFilter1";a.Filter2=
"shapelikeFilter2";a.Filter3="shapelikeFilter3";a.Filter4="shapelikeFilter4";a.Filter5="shapelikeFilter5"})(a.ShapelikeFilterStyle||(a.ShapelikeFilterStyle={}));(function(a){a.Filter1="fullBlendShapelikeFilter1";a.Filter2="fullBlendShapelikeFilter2";a.Filter3="fullBlendShapelikeFilter3";a.Filter4="fullBlendShapelikeFilter4";a.Filter5="fullBlendShapelikeFilter5"})(a.FullBlendShapelikeFilterStyle||(a.FullBlendShapelikeFilterStyle={}));(function(a){a.Filter1="imageFilter1";a.Filter2="imageFilter2";a.Filter3=
"imageFilter3";a.Filter4="imageFilter4";a.Filter5="imageFilter5"})(a.ImageLikeFilterStyle||(a.ImageLikeFilterStyle={}));(function(a){a.Filter1="backgroundFilterStyle1";a.Filter2="backgroundFilterStyle2";a.Filter3="backgroundFilterStyle3";a.Filter4="backgroundFilterStyle4";a.Filter5="backgroundFilterStyle5"})(a.BackgroundFilterStyle||(a.BackgroundFilterStyle={}));(function(a){a.audio="audio";a.pdf="pdf";a.image="image";a.swf="swf";a.logo="logo";a.chart="chart";a.animatedImage="animatedImage";a.video=
"video"})(a.AssetKind||(a.AssetKind={}));(function(a){a.uploadedToPrezi="uploadedToPrezi";a.youtube="youtube";a.vimeo="vimeo"})(a.VideoAssetKind||(a.VideoAssetKind={}));(function(a){a.prezi="prezi";a.brandKit="brandKit"})(a.FontOrigin||(a.FontOrigin={}));a.getBoundsInWorld=function(a){return g.Check.as("layoutBox",a,"LayoutBoxImpl",u.LayoutBoxImpl).getBoundsInWorld()};a.readerIs=function(a){return(b)=>null!=b&&b.is(a)};a.editorIs=function(a){return(b)=>null!=b&&b.is(a)};a.isKindDescendantOf=b;a.refIs=
c;a.isRefInstanceOf=function(a,b){return c(b)(a)};a.createLayoutGroup=function(a){g.Check.notEmpty("layoutables",a);return a[0].createLayoutGroupWith(a.slice(1))};(function(a){a.animatedImage="animatedImage";a.arc="arc";a.arrow="arrow";a.backToParent="backToParent";a.background="background";a.backgroundLayer="backgroundLayer";a.base="base";a.bracketFrame="bracketFrame";a.chart="chart";a.cover="cover";a.fadeIn="fadeIn";a.fadeOut="fadeOut";a.freePathChild="freePathChild";a.group="group";a.hyperlink=
"hyperlink";a.image="image";a.line="line";a.lockable="lockable";a.marker="marker";a.master="master";a.object="object";a.overview="overview";a.page="page";a.pathChild="pathChild";a.pathElement="pathElement";a.pathParent="pathParent";a.pdf="pdf";a.planetTopic="planetTopic";a.shape="shape";a.simpleObject="simpleObject";a.simpleObjectParent="simpleObjectParent";a.slide="slide";a.stackTopic="stackTopic";a.structuredPath="structuredPath";a.styled="styled";a.surface="surface";a.swf="swf";a.text="text";a.topic=
"topic";a.topicParent="topicParent";a.transformedObject="transformedObject";a.unknownObject="unknownObject";a.video="video";a.visitOverview="visitOverview";a.visitPage="visitPage";a.visitPlanet="visitPlanet";a.visitStack="visitStack";a.visitTopic="visitTopic";a.visual="visual";a.zoom="zoom";a.zoomArea="zoomArea"})(a.ObjectKind||(a.ObjectKind={}));(function(a){a[a.noColorFilter=0]="noColorFilter";a[a.solidColorBlend=1]="solidColorBlend"})(a.ColorFilterKind||(a.ColorFilterKind={}));(function(a){a.ConvertedFromCore=
"converted-from-core";a.CircleFrame="circle-frame";a.CustomTopicVisual="custom-topic-visual";a.FreePlanet="free-planet";a.FreePlanetWithGrouping="free-planet-with-grouping";a.PptxWorkflow="pptx-workflow";a.PptxWorkflowWithGrouping="pptx-workflow-with-grouping";a.TopicShape="topic-shape";a.PptxWithTopicShape="pptx-with-topic-shape";a.TopicShapeWithGrouping="topic-shape-with-grouping";a.PptxWithTopicShapeWithGrouping="pptx-with-topic-shape-with-grouping";a.PptxTopicBehaviourExt="pptx-topic-behaviour-ext";
a.TopicBehaviourExt="topic-behaviour-ext";a.UnifiedSmartstructures="unified-smartstructures";a.PptxUnifiedSmartstructures="pptx-unified-smartstructures";a.UnifiedWorkflows="unified-workflows";a.EditorpathV1="editorpath-v1";a.SwfTint="swf-tint";a.LogoLinkAndBackground="logo-link-and-background";a.EditorpathV2="editorpath-v2";a.OverviewAndContentLayout="overview-and-content-layout";a.AnimatedImage="animated-image";a.BrandKit="brand-kit";a.EditableOverview="editable-overview";a.HyperlinkOnAssets="hyperlink-on-assets";
a.RichText="rich-text";a.LockableObjects="lockable-objects";a.VideoPlayerImprovements="video-player-improvements";a.ShowPlaceholdersInPresentMode="show-placeholders-in-present-mode"})(a.DocumentGeneration||(a.DocumentGeneration={}));(function(a){a.OverviewAfterEachChild="OverviewAfterEachChild";a.OverviewAfterLastChild="OverviewAfterLastChild";a.OverviewAfterEachChild_TopicAfterLastChild="OverviewAfterEachChild_TopicAfterLastChild";a.OverviewAfterEachChild_TopicAfterEachChild="OverviewAfterEachChild_TopicAfterEachChild";
a.OverviewAfterLastChild_TopicAfterLastChild="OverviewAfterLastChild_TopicAfterLastChild";a.OverviewAfterLastChild_TopicAfterEachChild="OverviewAfterLastChild_TopicAfterEachChild"})(a.PlaybackPathGenerationStrategy||(a.PlaybackPathGenerationStrategy={}));(function(a){a.WideScreen="16:9";a.SmallScreen="4:3";a.WideScreenWithoutLetterBox="off"})(a.AspectRatioSpecification||(a.AspectRatioSpecification={}));(function(a){a.classic="classic";a.next="next"})(a.LogoKind||(a.LogoKind={}));(function(a){a.none=
"none";a.coverTitle="coverTitle";a.coverIcon="coverIcon"})(a.CoverLayoutRole||(a.CoverLayoutRole={}));(function(a){a.none="none";a.visualAnchor="visualAnchor";a.slideAnchor_4_3="slideAnchor_4_3";a.slideAnchor_16_9="slideAnchor_16_9";a.slideDecorator="slideDecorator";a.contentArea="contentArea";a.topicShape="topicShape"})(a.VisualLayoutRole||(a.VisualLayoutRole={}));(function(a){a.none="none";a.contentTitle="contentTitle";a.contentIcon="contentIcon"})(a.ContentLayoutRole||(a.ContentLayoutRole={}));
(function(a){a.none="none";a.surfaceTopicShape="surfaceTopicShape"})(a.SurfaceLayoutRole||(a.SurfaceLayoutRole={}));(function(a){a.Normal="normal";a.Italic="italic"})(a.FontStyle||(a.FontStyle={}));(function(a){a.Normal="normal";a.Bold="bold"})(a.FontWeight||(a.FontWeight={}));(function(a){a.Left="left";a.Right="right";a.Center="center";a.Justify="justify"})(a.TextAlignment||(a.TextAlignment={}));(function(a){a.None="none";a.Bullet="bullet"})(a.TextListType||(a.TextListType={}));(function(a){a.solid=
"solid";a.linear="linear";a.radial="radial";a.clear="clear"})(a.FillKind||(a.FillKind={}));(function(a){a.allLayersFullAlpha="allLayersFullAlpha";a.fadeBetweenTransparentLayers="fadeBetweenTransparentLayers";a.opaque="opaque"})(a.BackgroundLayerType||(a.BackgroundLayerType={}));(function(a){a[a.Original=0]="Original";a[a.NoBackground=1]="NoBackground"})(a.SlideVariant||(a.SlideVariant={}));(function(a){a.inside="inside";a.outside="outside";a.below="below";a.outsideAndInside="outsideAndInside";a.all=
"all"})(a.ChildVisibilityKind||(a.ChildVisibilityKind={}));(function(a){a.topLeft={rx:-1,ry:-1};a.topCenter={rx:0,ry:-1};a.topRight={rx:1,ry:-1};a.centerLeft={rx:-1,ry:0};a.center={rx:0,ry:0};a.centerRight={rx:1,ry:0};a.bottomLeft={rx:-1,ry:1};a.bottomCenter={rx:0,ry:1};a.bottomRight={rx:1,ry:1}})(a.AnchorPoint||(a.AnchorPoint={}))})(d.base||(d.base={}));(function(a){a=a.EditorsUnderPointStrategy||(a.EditorsUnderPointStrategy={});a[a.replaceCoverWithTopic=0]="replaceCoverWithTopic";a[a.ifCloseToBorder=
1]="ifCloseToBorder"})(d.basePlugin||(d.basePlugin={}));return qd=d});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_cet_model_editor",["require","prezi.engine.dom","prezi.engine.dom.converter.xpdom2","prezi.geometry","prezi_app_utils","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_renderer","prezi_editor_error","prezi_externalserviceprovider","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_nativeapitypes","prezi_ppt_service","prezi_service_assetloader","prezi_service_data","prezi_service_fontcatalogue","prezi_service_media","prezi_templateservice","prezi_textmodel","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_cet_model_editor.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.engine.dom.converter.xpdom2"),require("prezi.geometry"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_renderer"),require("prezi_editor_error"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_nativeapitypes"),require("prezi_ppt_service"),require("prezi_service_assetloader"),require("prezi_service_data"),require("prezi_service_fontcatalogue"),require("prezi_service_media"),require("prezi_templateservice"),require("prezi_textmodel"),require("prezi_utils"));}else{this["prezi_cet_model_editor"]=__factory(this["prezi.engine.dom"],this["prezi.engine.dom.converter.xpdom2"],this["prezi.geometry"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_renderer"],this["prezi_editor_error"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_nativeapitypes"],this["prezi_ppt_service"],this["prezi_service_assetloader"],this["prezi_service_data"],this["prezi_service_fontcatalogue"],this["prezi_service_media"],this["prezi_templateservice"],this["prezi_textmodel"],this["prezi_utils"]);}}).call(this);