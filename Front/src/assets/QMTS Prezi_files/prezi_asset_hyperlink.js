;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_asset_hyperlink";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_i18n":dependencies[2],"prezi_logger":dependencies[3],"prezi_plugin_api":dependencies[4],"prezi_shared_ui":dependencies[5],"prezi_utils":dependencies[6]}};})());};})(arguments);var moduleImpl=(function(){return module(function(d){var k=d.dependencies.prezi_cet_model_editor,f=d.dependencies.prezi_logger,e=d.dependencies.prezi_utils,g=d.dependencies.prezi_shared_ui,h={};Object.defineProperty(h,"__esModule",{value:!0});h.AssetHyperlinkPlugin=class{init(a){this.urlUtils=e.Utils.createUrlUtils();this.uiRoot=a.declareUI({hyperlinkObjectData:null,urlInputFieldText:""},(a,c)=>{var b;null!=a.hyperlinkObjectData&&(a={propertyBarGroupWeight:10,propertyBarWeight:7.5,mode:e.Utils.isEmptyString(null===(b=a.hyperlinkObjectData)||
void 0===b?void 0:b.url)?g.HyperlinkDialogMode.insert:g.HyperlinkDialogMode.edit,urlText:a.urlInputFieldText,applyLink:(a)=>this.applyLink(a),removeLink:(a)=>this.removeLink(a),onLinkOpened:()=>this.logOpenHyperlink(),onUrlTextInputValueChange:(a,b)=>this.onUrlTextInputValueChange(a,b),onPopupOpen:()=>this.onOpenPropertyBarItem()},g.createHyperLinkPropertyBarItem(c,a))});a.onDocumentChange(()=>{this.session.document.read((a)=>this.updateStateFromSelection(this.session.selection.getReadonlySelectionInfo(a).allObjects))});
a.onSelectionChange((a)=>{this.session.document.read((b)=>{const c=a.allObjects.map((a)=>b.lookup.resolve(a));this.updateStateFromSelection(c)})})}updateStateFromSelection(a){a=this.getHyperlinkObjectDataFromSelection(a);const b=!e.Utils.isEmptyString(null===a||void 0===a?void 0:a.url);this.uiRoot.setState({hyperlinkObjectData:a,urlInputFieldText:b?a.url:""})}onUrlTextInputValueChange(a,b){this.uiRoot.setState({urlInputFieldText:b});return!0}onOpenPropertyBarItem(){const a=this.uiRoot.getState().hyperlinkObjectData;
e.Utils.isEmptyString(null===a||void 0===a?void 0:a.url)&&this.session.document.read((b)=>{b=b.lookup.resolve(a.ref);f.avro.Avro.createDefaultLogger().logInsertHyperlink({object_id:b.id,object_type:b})});const b=!e.Utils.isEmptyString(null===a||void 0===a?void 0:a.url);this.uiRoot.setState({urlInputFieldText:b?a.url:""})}applyLink(a){const b=this.uiRoot.getState();this.session.document.executeApiCommand(a,{name:"applyLinkOnAsset",run:(a)=>{a=a.lookup.resolve(b.hyperlinkObjectData.ref);const c=this.urlUtils.ensureProtocolInUrl(b.urlInputFieldText.trim());
e.Utils.isEmptyString(c)?this.logRemovedLink(a,a.hyperlink):e.Utils.isEmptyString(a.hyperlink)?this.logInsertedLink(a,c):this.logEditedLink(a,c);a.hyperlink=c;this.uiRoot.setState({hyperlinkObjectData:Object.assign(Object.assign({},b.hyperlinkObjectData),{url:c}),urlInputFieldText:c})}});this.uiRoot.popup.closePopup("hyperlinkPopup")}removeLink(a){const b=this.uiRoot.getState();this.session.document.executeApiCommand(a,{name:"removeLinkFromAsset",run:(a)=>{a=a.lookup.resolve(b.hyperlinkObjectData.ref);
this.logRemovedLink(a,a.hyperlink);a.hyperlink="";this.uiRoot.setState({hyperlinkObjectData:Object.assign(Object.assign({},b.hyperlinkObjectData),{url:""}),urlInputFieldText:""})}});this.uiRoot.popup.closePopup("hyperlinkPopup")}logEditedLink(a,b){f.avro.Avro.createDefaultLogger().logEditedHyperlink({hyperlink_url:b,object_id:a.id,object_type:a})}logRemovedLink(a,b){f.avro.Avro.createDefaultLogger().logRemovedHyperlink({hyperlink_url:b,object_id:a.id,object_type:a})}logInsertedLink(a,b){f.avro.Avro.createDefaultLogger().logInsertedHyperlink({hyperlink_url:b,
object_id:a.id,object_type:a})}logOpenHyperlink(){const a=this.uiRoot.getState();this.session.document.read((b)=>{b=b.lookup.resolve(a.hyperlinkObjectData.ref);f.avro.Avro.createDefaultLogger().logOpenHyperlink({hyperlink_url:a.hyperlinkObjectData.url,object_id:b.id,object_type:b})})}getHyperlinkObjectDataFromSelection(a){if(1!==a.length)return null;a=a[0];return!a.is(k.base.ObjectKind.hyperlink)||a.is(k.base.ObjectKind.lockable)&&a.locked?null:{ref:a.ref,url:a.hyperlink}}};d={};Object.defineProperty(d,
"__esModule",{value:!0});d.lazyModule={createPlugin(){return new h.AssetHyperlinkPlugin}};return d});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_asset_hyperlink",["require","prezi_cet_model_editor","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_shared_ui","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_asset_hyperlink.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_shared_ui"),require("prezi_utils"));}else{this["prezi_asset_hyperlink"]=__factory(this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_shared_ui"],this["prezi_utils"]);}}).call(this);