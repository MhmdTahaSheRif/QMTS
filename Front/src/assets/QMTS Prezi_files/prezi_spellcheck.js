;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_spellcheck";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_bacon":dependencies[0],"prezi_cet":dependencies[1],"prezi_cet_model":dependencies[2],"prezi_cet_model_editor":dependencies[3],"prezi_editor_store_ui":dependencies[4],"prezi_logger":dependencies[5],"prezi_textmodel":dependencies[6],"prezi_utils":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(f){function D(){null==q&&(q={i:fetch(f.getResourceUrl("hunspell-worker.js")).then((a)=>a.blob()),Ja:fetch(f.getResourceUrl("hunspell.js.mem")).then((a)=>a.blob()),Na:fetch(f.getResourceUrl("hunspell.js")).then((a)=>a.blob())});return q}function r(a,b,c=1){try{return fetch(`${"https://spellcheck.prezicdn.net/dictionaries/"}${b}/${b}${a}`).then((a)=>a.arrayBuffer())}catch(e){return 3>c?r(a,b,c+1):Promise.reject("ERROR: downloading dictionaries failed")}}function A(a,b=0){return E(this,
void 0,void 0,function*(){try{return yield $.ajax({url:`${"https://spellcheck.prezicdn.net/language_profiles/"}${a}`,dataType:"text"})}catch(c){return 3>b?A(a,b+1):Promise.reject("ERROR: downloading language profile failed for: "+a)}})}var F=f.dependencies.prezi_bacon,t=f.dependencies.prezi_cet,B=f.dependencies.prezi_cet_model_editor,u=f.dependencies.prezi_logger,v=f.dependencies.prezi_utils,m=f.dependencies.prezi_cet_model,k={getSpellcheckComponentKey:function(){null==w&&(w=m.CetModel.createValueComponentKey("spelling-mistakes",
!1,!1,!0));return w}};Object.defineProperty(k,"__esModule",{value:!0});let w;var C={Ea:function(a){const b=D();return Promise.all([b.i,b.Ja,b.Na,r(".aff",a),r(".dic",a)]).then(([b,e,d,H,f])=>new Promise((c)=>{const G=new I({Ya:URL.createObjectURL(b),Ka:URL.createObjectURL(d),Oa:URL.createObjectURL(e),xa:H,Xa:f,language:a},()=>c(G))}))}};Object.defineProperty(C,"__esModule",{value:!0});let q=null;class I{constructor(a,b){this.u=new Map;this.w=new Map;this.i=new Worker(a.Ya);this.i.postMessage({action:"start",
memURL:a.Oa,jsURL:a.Ka});this.language=a.language;this.i.onmessage=(c)=>{switch(c.data.action){case "ready":this.i.postMessage({action:"create",aff:a.xa,dic:a.Xa});break;case "create":b();break;case "spell":var e=c.data.word,d=this.u.get(e);if(null!=d){const a=c.data.correct;d.forEach((b)=>b(a));this.u.delete(e)}break;case "suggest":if(e=c.data.word,d=this.w.get(e),null!=d){const a=c.data.suggestions;d.forEach((b)=>b(a));this.w.delete(e)}}}}Sa(a,b){var c;this.u.has(a)?null===(c=this.u.get(a))||void 0===
c?void 0:c.push(b):this.u.set(a,[b]);this.i.postMessage({action:"spell",word:a})}suggest(a,b){var c;this.w.has(a)?null===(c=this.w.get(a))||void 0===c?void 0:c.push(b):this.w.set(a,[b]);this.i.postMessage({action:"suggest",word:a})}getLanguage(){return this.language}}var h={},E=this&&h.Za||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,f){function h(a){try{g(e.next(a))}catch(x){f(x)}}function k(a){try{g(e["throw"](a))}catch(x){f(x)}}
function g(a){a.done?c(a.value):d(a.value).then(h,k)}g((e=e.apply(a,b||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});var g;(function(a){a.initializing="initializing";a.notSupportedLanguage="notSupportedLanguage";a.supportedLanguage="supportedLanguage"})(g=h.J||(h.J={}));class d{constructor(a){this.aa=a;this.o=""}static Ba(){const a=Promise.all(d.pa.map((a)=>A(a))),b=new Promise((a)=>{window.require([f.getResourceUrl("langdetect.js")],(b)=>{a(b)})});return{profile:a,La:b}}static Fa(){null==
d.da&&(d.da=d.Ba());return Promise.all([d.da.La,d.da.profile]).then(([a,b])=>new d(a.createDetector(b)))}update(a){if(""!==this.o)return{kind:g.la,language:this.o};if(null==this.aa)return{kind:g.L};const b=B.CetModelEditor.createTextHelper();let c=0;a.getEntityList().forEach((a)=>{m.CetModel.textKludge.isEntityText(a)&&!b.isPlaceholder(a)&&(a=m.CetModel.textKludge.getRawText(a),c+=a.split(/[\s]+/).length,this.aa.appendString(a))});if(c<d.ta)return{kind:g.L};try{const a=this.aa.getProbabilities();
if(a[0].prob<d.sa)return{kind:g.L};if(-1===d.ua.indexOf(a[0].lang))return u.avro.Avro.createDefaultLogger().logDetectedLanguageAutomatically({dictionary_language:a[0].lang}),{kind:g.Pa};this.o=a[0].lang;u.avro.Avro.createDefaultLogger().logDetectedLanguageAutomatically({dictionary_language:this.o});return{kind:g.la,language:this.o}}catch(e){return{kind:g.L}}}}h.qa=d;d.ta=8;d.sa=.95;d.pa="af ar bg bn cs da de el en es et fa fi fr gu he hi hr hu id it ja kn ko lt lv mk ml mr ne nl no pa pl pt ro ru sk sl so sq sv sw ta te th tl tr uk ur vi zh-cn zh-tw".split(" ");
d.ua="en de es fr it hu pt".split(" ");var l={};Object.defineProperty(l,"__esModule",{value:!0});l.j=class{constructor(a,b,c){this.K=a;this.ia=b;this.scene=c;this.fa=this.ha=this.na=0;this.ca="spellchecking";this.jobId=l.j.Ia++;this.v=this.Ga()}Ga(){var a;const b=this.scene.getEntityById(this.K);return null==b?{}:null!==(a=b.get(k.getSpellcheckComponentKey()))&&void 0!==a?a:{}}Ha(){return"done"===this.ca}Da(){switch(this.ca){case "spellchecking":this.za();break;case "waiting_suggestions":this.Wa()}}Ua(a){null!=
this.v?this.ya(a):this.Ca(a)}za(){var a=this.scene.getEntityById(this.K);null==a||a.isDisposed()||(a=t.Cet.shapedText(a).getRawText().match(/(?:[a-zA-Z'\d\u00C0-\u02AF\uac00-\ud7a3])+/g),null!=a&&(new Set(a)).forEach((a)=>{this.na++;this.ia.Sa(a,(b)=>{b?this.ha++:(this.fa++,this.suggest(a))})}),this.ga("waiting_suggestions"))}Wa(){this.na===this.fa+this.ha&&Object.keys(this.v).length===this.fa&&this.ga("done")}suggest(a){null==this.v[a]&&this.ia.suggest(a,(b)=>{this.v[a]=b.slice(0,l.j.ra)})}ya(a){a=
a.getEntityById(this.K);null!=a&&a.set(k.getSpellcheckComponentKey(),this.v)}Ca(a){a=a.getEntityById(this.K);null!=a&&a.discardOwnComponent(k.getSpellcheckComponentKey())}ga(a){this.ca=a}};l.j.Ia=0;l.j.ra=5;var n={};Object.defineProperty(n,"__esModule",{value:!0});class p{update(){}stop(){}getLanguage(){return""}}class J{constructor(a,b,c,e,d,f){this.Ma=a;this.Ra=b;this.ja=c;this.cancel=e;this.scene=d;this.$=f;this.language=""}update(){const a=this.Ma.update(this.scene);switch(a.kind){case h.J.la:this.ja(new p);
Promise.race([C.Ea(a.language).then((a)=>new n.oa(a,this.scene,this.$)),this.Ra.promise]).then((a)=>this.ja(a));break;case h.J.Pa:this.cancel();break;case h.J.L:break;default:v.Utils.assertNever(a)}}stop(){}getLanguage(){return this.language}}n.oa=class{constructor(a,b,c){this.ba=a;this.scene=b;this.m=new Map;this.M=new Set;this.ma=B.CetModelEditor.createTextHelper();this.Ta=c.onValue((a)=>this.Qa(a));this.Aa()}update(){if(0!==this.m.size||0!==this.M.size){var a=(new Date).getTime()+16;this.M.forEach((a)=>
{a=this.scene.getEntityById(a);null==a||this.ma.isPlaceholder(a)||this.m.set(a.getId(),new l.j(a.getId(),this.ba,this.scene))});this.M.clear();var b=[];for(const c of this.m.keys()){if((new Date).getTime()>a)break;const e=this.m.get(c);null!=e&&(e.Da(),e.Ha()&&(b.push(e),this.m.delete(c)))}this.scene.requestNoDomBatchUpdate((a)=>{for(const c of b)c.Ua(a)})}}stop(){this.Ta();const a=k.getSpellcheckComponentKey();this.scene.requestNoDomBatchUpdate((b)=>{b.getEntityList().forEach((b)=>{m.CetModel.textKludge.isEntityText(b)&&
b.discardOwnComponent(a)})})}getLanguage(){return this.ba.getLanguage()}Qa(a){a.map((a)=>a.type===m.ChangeType.ModifyComponent&&null!=a.componentKey&&a.componentKey===t.Cet.getShapedTextKey()?(null!=a.entities?a.entities:null!=a.entity?[a.entity]:[]).filter((a)=>m.CetModel.textKludge.isEntityText(a)&&t.Cet.hasShapedText(a)).map((a)=>a.getId()):[]).forEach((a)=>a.forEach((a)=>this.M.add(a)))}Aa(){this.scene.getEntityList().forEach((a)=>{m.CetModel.textKludge.isEntityText(a)&&!this.ma.isPlaceholder(a)&&
this.m.set(a.getId(),new l.j(a.getId(),this.ba,this.scene))})}};n.wa=class{constructor(a,b){this.scene=a;this.$=b;this.U=!1;this.activeWorker=new p}getName(){return"Spellchecker"}getId(){return"SpellcheckerWorker"}update(){if(this.U)return-1;this.activeWorker.update();return 200}cancel(){this.U=!0;this.stop()}reset(){this.stop();this.start()}getLanguage(){return this.activeWorker.getLanguage()||""}start(){this.U=!1;this.ea=v.Utils.deferredPromise();Promise.race([h.qa.Fa().then((a)=>new J(a,this.ea,
(a)=>this.activeWorker=a,()=>this.cancel(),this.scene,this.$)),this.ea.promise]).then((a)=>this.activeWorker=a)}stop(){var a;this.activeWorker.stop();this.activeWorker=new p;null===(a=this.ea)||void 0===a?void 0:a.reject(new p)}};var y={};Object.defineProperty(y,"__esModule",{value:!0});y.va=class{constructor(a,b,c,d){this.scene=c;this.Va=d;this.f="NOT_FUNCTIONAL";this.ka=F.Bacon.newBus();this.O=new n.wa(this.scene,b);a.addIdleWorker(this.O,500);d.loadUserSettings().then((a)=>{a.boolean_settings.SPELLCHECK_ENABLED?
this.N("ENABLED",!1):this.N("DISABLED",!1)})}toggleSpellCheckFunctionality(){if("NOT_FUNCTIONAL"!==this.f)switch(this.f){case "ENABLED":this.N("DISABLED",!0);break;case "DISABLED":this.N("ENABLED",!0);break;default:v.Utils.assertNever(this.f)}}N(a,b){this.f=a;u.avro.Avro.createDefaultLogger().logSetSpellCheckVisibility({spell_check_status:this.f});this.ka.push(this.f);b&&this.Va.setUserSetting("SPELLCHECK_ENABLED","ENABLED"===a);"ENABLED"===a?this.O.start():this.O.stop()}getSpellCheckerStatusStream(){return this.ka}isWordCorrect(a,
b){const c=k.getSpellcheckComponentKey();return b.hasComponent(c)?(b=b.get(c),!(a in b)):!0}getSuggestions(a,b){const c=k.getSpellcheckComponentKey();return b.hasComponent(c)&&(b=b.get(c),a in b)?b[a]:[]}getLanguage(){return this.O.getLanguage()}isSpellcheckEnabled(){return"ENABLED"===this.f}};var z={createSpellcheckerService:function(a,b,c,d){return new y.va(a,b,c,d)}};Object.defineProperty(z,"__esModule",{value:!0});z.getSpellcheckComponentKey=k.getSpellcheckComponentKey;return z});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_spellcheck",["require","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_editor_store_ui","prezi_logger","prezi_textmodel","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_spellcheck.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_editor_store_ui"),require("prezi_logger"),require("prezi_textmodel"),require("prezi_utils"));}else{this["prezi_spellcheck"]=__factory(this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_editor_store_ui"],this["prezi_logger"],this["prezi_textmodel"],this["prezi_utils"]);}}).call(this);