;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_topic_shape";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_editor_commander_common":dependencies[3],"prezi_featureswitcher":dependencies[4],"prezi_i18n":dependencies[5],"prezi_logger":dependencies[6],"prezi_plugin_api":dependencies[7],"prezi_plugin_meta":dependencies[8],"prezi_service_data":dependencies[9],"prezi_styleschemeprovider":dependencies[10],"prezi_utils":dependencies[11]}};})());};})(arguments);var moduleImpl=(function(){return module(function(d){function z(b,c,a,e){b.document.executeApiCommand(c,{name:"setCoverLayout",run:(c)=>{if(a.hasTopicShapeLayout(e)){const g=a.getTopicShapeLayout(e);h.EditorCommander.createLayoutCommander(a,b.positionFinder).changeTopicCoverOnAllTopicsCmd(g).run(c);t.avro.Avro.createDefaultLogger().logSelectTopicShape({topic_shape_id:e})}}})}var m=d.dependencies.prezi_cet_model_editor,h=d.dependencies.prezi_editor_commander,q=d.dependencies.prezi_i18n,t=d.dependencies.prezi_logger,f=d.dependencies.prezi_plugin_api,
u=d.dependencies.prezi_styleschemeprovider,r=d.dependencies.prezi_featureswitcher,w={createShapePageContent:function(b,c,a,e,d,g,n,m){const k=c.button(f.ButtonSize.Small,f.ButtonAlign.Center,(c)=>[c.button({id:"cover-layout-test-button",color:f.ButtonColor.Ghost,content:{text:q.I18n.ts("Add test layout")},onClick:()=>{a.setTopicShapeLayoutFromXml(m,{read:b.document.read,toXml:()=>b.document.preziXml});e({coverLayoutInfo:a.getTopicShapeLayoutInfos().filter((a)=>4!==a.category)})}})]);var l=h.EditorCommander.createColorMixCommander();
let v=null;null!=g&&(g=l.createMapping(g),l=g.visualStyleColors.find((a)=>a.paletteColor.type===u.PaletteColorType.TopicAColor),null!=l&&(l=l.paletteColor.color.getRGBData(),v=Object.assign(Object.assign({},l),{intensity:g.visualBlendAlpha})));return[c.simpleList((c)=>({activeId:d,items:n.filter((a)=>4!==a.category).map((e)=>c.image({id:e.id,src:{url:e.thumbnail},onClick:(c)=>z(b,c,a,e.id),blendColor:v,dataLookup:e.id,title:r.isActive("js-developer-features")?e.id:null})),itemType:f.ListItemType.large,
itemLayout:f.ListItemLayout.fixed})),r.isActive("js-bb-snippet-editing")?k:null]}};Object.defineProperty(w,"__esModule",{value:!0});var p={};Object.defineProperty(p,"__esModule",{value:!0});var x=t.avro.Avro,y=m.base.isRefInstanceOf;p.TopicShapePlugin=class{constructor(){this.layoutRepository=h.EditorCommander.getLayoutRepository()}init(b){this.styleSchemeProvider=u.StyleSchemeProviderModule.getStyleSchemeProvider(b);this.layoutRepository.subscribe(()=>this.updateLayoutInfos(this.layoutRepository));
const c=(a)=>(b,c)=>{const e=h.EditorCommander.createLayoutCommander(this.layoutRepository,this.session.positionFinder);this.layoutRepository.hasTopicShapeLayout(a)&&e.handleTopicThemeApplication(b,c,this.layoutRepository.getTopicShapeLayout(a))};this.layoutRepository.loadCoverLayouts((a)=>{b.onTopicThemeApplication(a,c(a));return a});b.onTopicThemeApplication("test_cover_layout",c("test_cover_layout"));this.uiRoot=b.declareUI({currentTopicRef:null,colorPalette:null,coverLayoutId:null,coverLayoutInfo:this.layoutRepository.getTopicShapeLayoutInfos().filter((a)=>
4!==a.category),colorPalettes:this.styleSchemeProvider.getAvailablePalettes(),shapeSidebarOpen:!1,selection:[]},({coverLayoutId:a,colorPalette:b,coverLayoutInfo:c,shapeSidebarOpen:d,selection:n,currentTopicRef:p},k)=>{r.isActive("js-frame-only-editor")||k.createTopMenuItem(f.TopMenuId.Style,{id:"topmenu-theme-item-topic-shape",kind:f.MenuItemKind.largeButton,enabled:!0,weight:5,title:q.I18n.ts("Topic shape"),icon:f.IconSmallId.PlanetTopic,onClick:()=>{x.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"TOPIC_SHAPE"});
d?this.uiRoot.sidebar.close("topic-shape"):this.uiRoot.sidebar.open("topic-shape")}});k.createSidebar("topic-shape",(e)=>({root:{title:q.I18n.ts("Topic shape"),content:w.createShapePageContent(this.session,e,this.layoutRepository,(a)=>this.uiRoot.setState(a),a,b,c,"test_cover_layout")},onOpen:()=>{this.uiRoot.setState({shapeSidebarOpen:!0});x.createDefaultLogger().logShowTopicShapeOptions()},onClose:()=>{this.uiRoot.setState({shapeSidebarOpen:!1})}}));(0===n.length&&y(p,m.base.ObjectKind.topic)||
1===n.length&&y(n[0],m.base.ObjectKind.topic))&&k.createMenuItem({kind:f.MenuItemKind.context,enabled:!0,onClick:()=>{d||(this.uiRoot.setState({shapeSidebarOpen:!0}),this.uiRoot.sidebar.open("topic-shape"))},weight:66,id:"subtopic-layout-context-menu-item",title:q.I18n.ts("Change topic shape")});k.createMenuItem({kind:f.MenuItemKind.dropdown,parent:f.MenuId.Debug,id:"remove-topic-shape-roles",title:"Remove topic shapes roles",enabled:!0,weight:6,onClick:(a)=>{const b=h.EditorCommander.createTopicShapeRolesManager();
this.session.document.executeLegacyCommand(a,b.cleanTopicShapeRolesCmd_internal())}})});b.onCurrentTopicChange((a)=>{const b=this.getCoverLayoutId(),c=this.session.document.read((b)=>b.lookup.base(a).ref);this.uiRoot.setState({coverLayoutId:b,currentTopicRef:c})});b.onDocumentChange(()=>{const a=this.getCoverLayoutId(),b=this.getColorPalette();this.uiRoot.setState({coverLayoutId:a,colorPalette:b})});b.onSelectionChange((a)=>{this.uiRoot.setState({selection:a.allObjects})})}getColorPalette(){const b=
h.EditorCommander.createColorMixCommander();return this.session.document.read((c)=>b.paletteFromPrezi(c.styleSheet))}getCoverLayoutId(){const b=this.uiRoot.getState().currentTopicRef;if(null==b)return null;const c=h.EditorCommander.createLayoutQuery();return this.session.document.read((a)=>c.getMostCommonLayout(a,null===b||void 0===b?void 0:b.id,(a)=>a.coverLayoutId))}updateLayoutInfos(b){this.uiRoot.setState({coverLayoutInfo:b.getTopicShapeLayoutInfos().filter((b)=>4!==b.category)})}};d={};Object.defineProperty(d,
"__esModule",{value:!0});d.lazyModule={createPlugin(){return new p.TopicShapePlugin}};return d});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_topic_shape",["require","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_editor_commander_common","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_service_data","prezi_styleschemeprovider","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_topic_shape.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_editor_commander_common"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_service_data"),require("prezi_styleschemeprovider"),require("prezi_utils"));}else{this["prezi_topic_shape"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_editor_commander_common"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_service_data"],this["prezi_styleschemeprovider"],this["prezi_utils"]);}}).call(this);