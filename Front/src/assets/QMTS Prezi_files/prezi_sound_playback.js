;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_sound_playback";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_app_utils":dependencies[0],"prezi_bacon":dependencies[1],"prezi_cet":dependencies[2],"prezi_cet_model":dependencies[3],"prezi_cet_model_editor":dependencies[4],"prezi_featureswitcher":dependencies[5],"prezi_utils":dependencies[6]}};})());};})(arguments);var moduleImpl=(function(){return module(function(f){var h=f.dependencies.prezi_app_utils,k=f.dependencies.prezi_utils,g={};Object.defineProperty(g,"__esModule",{value:!0});g.ea=class{constructor(a,b,c){this.v=a;this.audioBuffer=b;this.loop=c;this.u=0}initialize(a,b){this.aa=b;this.volume=a}stop(){if(this.M()){this.f.O=!0;const a=this.v.getAudioContext();this.f.J.removeEventListener("ended",this.L);clearInterval(this.f.da);this.f.w.gain.cancelScheduledValues(a.currentTime);this.f.w.gain.setValueAtTime(this.volume,a.currentTime);this.f.w.gain.linearRampToValueAtTime(0,
a.currentTime+.5);this.f.J.stop(a.currentTime+.5);this.f=null}}pause(){if(this.M()){this.f.O=!0;const a=this.v.getAudioContext();this.f.w.gain.cancelScheduledValues(a.currentTime);this.u=a.currentTime-this.f.ja;this.f.J.stop(a.currentTime)}}play(){this.ia()}seek(a){null==this.f?this.u=a:this.M()&&(this.pause(),this.L(),this.u=a,this.play())}M(){return null==this.v.getAudioContext()?!1:null!=this.f}setVolume(a){null!=this.f&&(this.volume=a,this.f.w.gain.setValueAtTime(a,this.v.getAudioContext().currentTime))}isPlaying(){var a;
return null!=(null===(a=this.f)||void 0===a?void 0:a.J)}getBuffer(){return this.audioBuffer}getVolume(){return this.volume}ia(){const a=this.v.getAudioContext();if(null!=a){var b=a.createBufferSource(),c=a.createGain();b.loop=this.loop;c.gain.setValueAtTime(this.volume,a.currentTime);b.buffer=this.audioBuffer;b.connect(c);c.connect(a.destination);var e=a.currentTime-this.u,l=setInterval(()=>{null!=b&&this.aa(a.currentTime-e)},33);this.L=()=>{var a;b===(null===(a=this.f)||void 0===a?void 0:a.J)&&(b.removeEventListener("ended",
this.L),clearInterval(this.f.da),this.f.O||(this.aa(this.audioBuffer.duration),this.u=0),this.f=null)};this.f={J:b,w:c,da:l,ja:e,O:!1};b.addEventListener("ended",this.L);b.start(0,this.u)}}};var d={};Object.defineProperty(d,"__esModule",{value:!0});d.m=class{constructor(a,b,c){this.i=[];this.o=null;this.K=!1;this.j=null;a.onValue((a)=>{this.o=a;this.N()});b.onValue((a)=>{this.ga(a)});c.onValue((a)=>{this.U=a;this.N()})}N(){if(null!=this.o){var a=this.o.getToPos();a&&(this.$()?(a=this.o.getPath().getAllPathSoundsForPathPosition(a),
this.ha(a)):this.ka())}}ga(a){null!=this.o&&(a=a.path.getPathPositionOfStepOrAction(a.stepOrActionId),null!=a&&a.isAfter(this.o.getToPos())||null!=a&&this.$()&&this.N())}ha(a){if(null!=a){for(var b=0;b<a.length;b++)0===b?this.j=a[0]:null!=this.j&&this.j.startPosition.isBefore(a[b].startPosition)&&(this.j=a[b]);for(let b=0;b<this.i.length;b++)null==a.find((a)=>this.i[b].getBuffer()===a.audioBuffer)&&(this.i[b].stop(),this.i.splice(b,1),b--);b=(a)=>{a=null!=this.j&&a.getBuffer()===this.j.audioBuffer;
return this.K?0:a?1:.6};for(let e=0;e<a.length;e++){var c=!1;for(let d=0;d<this.i.length;d++)if(a[e].audioBuffer===this.i[d].getBuffer()&&(c=!0,this.i[d].isPlaying())){this.i[d].setVolume(b(this.i[d]));break}c||(c=this.fa(a[e]),this.i.push(c),c.initialize(b(c),()=>{}),c.play())}}}integration_test_overrideAudioPlayer(a){this.ba=a}fa(a){return null!=this.ba?this.ba(a.audioBuffer):d.m.createAudioPlayer(this,a.audioBuffer,a.loop)}static createAudioPlayer(a,b,c){return null!=d.m.ca?d.m.ca(b):new g.ea(a,
b,c)}ka(){this.i.forEach((a)=>{a.isPlaying()&&a.stop()});this.i=[]}getAudioContext(){return k.AudioUtils.getAudioContext()}isMuted(){return this.K}setMuted(a){this.K=a;this.i.forEach((b)=>{let c=b.getBuffer()===this.j.audioBuffer?1:.6;b.setVolume(a?0:c)})}toggleMuted(){this.setMuted(!this.K)}$(){return this.U===h.EditorMode.playback||this.U===h.EditorMode.view}};f={};Object.defineProperty(f,"__esModule",{value:!0});(function(a){a.createSoundPlayback=function(a,c,e){return new d.m(a,c,e)};a.integration_test_overrideAudioPlayer=
function(a){d.m.ca=a};a.createAudioPlayer=function(a,c,e){return d.m.createAudioPlayer(a,c,e)}})(f.SoundPlaybackModule||(f.SoundPlaybackModule={}));return f});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_sound_playback",["require","prezi_app_utils","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_featureswitcher","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_sound_playback.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_app_utils"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_utils"));}else{this["prezi_sound_playback"]=__factory(this["prezi_app_utils"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_utils"]);}}).call(this);