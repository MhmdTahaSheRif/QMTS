;(function(){var baseUrl;var __factory=function(){var React=arguments[0];var ReactDOM=arguments[1];var ReactTransitionGroup=arguments[2];var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_spotlight";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[3],"prezi_bacon":dependencies[4],"prezi_cet":dependencies[5],"prezi_cet_model":dependencies[6],"prezi_cet_model_editor":dependencies[7],"prezi_utils":dependencies[8],"prezi_widgets":dependencies[9]}};})(),React,ReactDOM,ReactTransitionGroup);};})(arguments);var moduleImpl=(function(){return module(function(g,l,r,t){var q=g.dependencies.prezi_bacon,m=g.dependencies.prezi_cet_model_editor,n=g.dependencies.prezi_utils,k=g.dependencies.prezi_widgets,h={};Object.defineProperty(h,"__esModule",{value:!0});var p=m.base.ObjectKind;h.SpotlightImpl=class{constructor(){this.getRootElement=()=>document;this.getHoleDimensions=(a)=>{if("virtualElementId"in a.around){var b=m.CetModelEditor.createCameraControl(this.cetApp.getMainStage().getCamera());if("viewport"===a.around.virtualElementId)return b=
b.getScreenLayoutBox(),this.holeRectangleFromScreenLayoutBox(a,b);if("viewport-topleft"===a.around.virtualElementId)return b=b.getMarginCorrectedStageLayoutBox(),b=b.translate({x:.5*-b.size.width,y:.5*-b.size.height}).withSize({width:1,height:1}),this.holeRectangleFromScreenLayoutBox(a,b);n.Utils.assertNever(a.around.virtualElementId)}else{if("uiElementSelector"in a.around){a=this.getRootElement().querySelector(a.around.uiElementSelector);if(null==a)return null;b=a.getBoundingClientRect();var c=this.getFirstClickableElementBelowOverlay(b.left+
.5*b.width,b.top+1);const d=this.getFirstClickableElementBelowOverlay(b.left+.5*b.width,b.bottom-1),f=this.elementIsChildOf(c,a),e=this.elementIsChildOf(d,a);return c!==a&&!f||d!==a&&!e?null:{cx:b.left+a.offsetWidth/2,cy:b.top+a.offsetHeight/2,widthHalf:a.offsetWidth/2,heightHalf:a.offsetHeight/2}}if("canvasElementId"in a.around){const d=a.around.canvasElementId;b=this.reader.read((a)=>{a=a.lookup.base(d);if(null!=a){if(a.is(p.transformedObject))return a.layoutBox;if(a.is(p.overview))return a.zoomLayoutBox}return null});
if(null==b)return null;c=m.CetModelEditor.createCameraControl(this.cetApp.getMainStage().getCamera());b=b.withReferenceFrame(c.getScreenLayoutBox().referenceFrame);return this.holeRectangleFromScreenLayoutBox(a,b)}n.Utils.assertNever(a.around)}};this.setRef=(a)=>this.wrapperRef=a;this.spotlightPropsBus=q.Bacon.newBus();this.spotlightPropsProperty=this.spotlightPropsBus.toProperty(null);this.spotlightPropsProperty.onValue(()=>{});this.spotlightPropsBus.onValue((a)=>{this.spotlightProps=a});k.PopupAdjustedStream.getStream().onValue(()=>
{null!=this.spotlightDescription&&this.showSpotlight(this.spotlightDescription)});document.addEventListener("mousemove",(a)=>{if(this.spotlightProps&&null!=this.wrapperRef&&a.target instanceof Element){let b=a.target;for(;null!=b;){if(b===this.wrapperRef){a.stopImmediatePropagation();a.stopPropagation();break}b=b.parentElement}}},!0);document.addEventListener("scroll",()=>{null!=this.spotlightDescription&&this.showSpotlight(this.spotlightDescription)},!0)}init(a,b){this.cetApp=a;b.onValue(()=>{null!=
this.spotlightDescription&&this.showSpotlight(this.spotlightDescription)});this.cetApp.getMainStage().getSceneUpdateStream().onValue(()=>{this.spotlightDescription&&this.showSpotlight(this.spotlightDescription)})}initUi(a){this.reader=a}showSpotlight(a){if(null!=this.spotlightDescription&&null==a||null!=this.spotlightDescription&&null!=a&&this.spotlightDescription.id!==a.id)this.spotlightDescription.onClose();this.spotlightDescription=a;null==a?this.spotlightPropsBus.push(null):this.spotlightPropsBus.push({id:a.id,
overlay:a.overlay?{opacity:a.overlay.opacity,color:a.overlay.color,holes:this.mapToHoleProps(a.overlay.holes)}:null,highlights:a.highlights?this.mapToHoleProps(a.highlights):null,onClose:a.onClose});return()=>{this.spotlightDescription===a&&this.showSpotlight(null)}}elementIsChildOf(a,b){return null==a||null==a.parentElement?!1:a.parentElement===b?!0:this.elementIsChildOf(a.parentElement,b)}getFirstClickableElementBelowOverlay(a,b){const c=this.getRootElement().querySelector('[data-lookup="widget-spotlight-wrapper"]');
var d=document.elementsFromPoint(a,b);let f=null;for(let e of d)if(!this.elementIsChildOf(e,c)&&(d=e.getBoundingClientRect(),d.left<=a&&a<=d.right&&d.top<=b&&b<=d.bottom)){f=e;break}return f}getHoleProps(a){var b=this.getHoleDimensions(a);if(null==b)return null;let {cx:c,cy:d,widthHalf:f,heightHalf:e}=b;a.strict||(f+=20,e+=20);switch(a.shape){case k.HoleShape.rect:return{topLeft:{x:c-f,y:d-e},bottomRight:{x:c+f,y:d+e},shape:a.shape,callout:a.callout,pulse:a.pulse};case k.HoleShape.circle:return b=
Math.sqrt(f*f+e*e),{topLeft:{x:c-b,y:d-b},bottomRight:{x:c+b,y:d+b},shape:a.shape,callout:a.callout,pulse:a.pulse};case k.HoleShape.rounded:return{topLeft:{x:c-f,y:d-e},bottomRight:{x:c+f,y:d+e},shape:a.shape,callout:a.callout,pulse:a.pulse};default:n.Utils.assertNever(a.shape)}}mapToHoleProps(a){return a.map((a)=>this.getHoleProps(a)).filter((a)=>null!=a)}holeRectangleFromScreenLayoutBox(a,b){var c=this.cetApp.getDomLayerManager();const d=c.getOffsetLeft()+c.getWidth()/2+b.center.x;c=c.getOffsetTop()+
c.getHeight()/2+b.center.y;return{cx:d,cy:c,widthHalf:("rect"===a.shape?b.aabb:b).size.width/2,heightHalf:("rect"===a.shape?b.aabb:b).size.height/2}}hideAll(){this.showSpotlight(null)}render(){return l.createElement("div",{ref:this.setRef},l.createElement(h.SpotlightWrapper,{stream:this.spotlightPropsProperty}))}};h.SpotlightWrapper=class extends l.PureComponent{constructor(){super(...arguments);this.unsubscribe=null;this.state={overlayState:null}}componentDidMount(){null!=this.props.stream&&(this.unsubscribe=
this.props.stream.onValue((a)=>this.setState({overlayState:a})))}componentWillReceiveProps(a){a.stream!==this.props.stream&&(null!=this.unsubscribe&&this.unsubscribe(),null!=a.stream&&(this.unsubscribe=a.stream.onValue((a)=>this.setState({overlayState:a}))))}componentWillUnmount(){null!=this.unsubscribe&&this.unsubscribe()}render(){return null!=this.state.overlayState?l.createElement(k.Spotlight,Object.assign({},this.state.overlayState)):null}};g={};Object.defineProperty(g,"__esModule",{value:!0});
(function(a){a[a.Image=0]="Image";a[a.Mp4=1]="Mp4"})(g.CalloutMediaTypes||(g.CalloutMediaTypes={}));g.createSpotlight=function(){const a=new h.SpotlightImpl;return{init:(b,c)=>a.init(b,c),ui:a,controller:a}};g.createSpotlighUiController_Internal=function(a,b){const c=(a)=>{a=e().querySelector(`#${a}`);if(null==a)return null;a=a.getBoundingClientRect();return{cx:a.left+a.width/2,cy:a.top+a.height/2,widthHalf:a.width/2,heightHalf:a.height/2}},d=new h.SpotlightImpl,f=d.getHoleDimensions,e=()=>document.querySelector(`#${a}`);
d.getRootElement=e;d.getHoleDimensions=(a)=>"virtualElementId"in a.around&&"viewport"===a.around.virtualElementId?c(b):"canvasElementId"in a.around?c(a.around.canvasElementId):f(a);return d};return g});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_spotlight",["require","react","react-dom","react-transition-group","prezi.geometry","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_spotlight.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("react"),require("react-dom"),require("react-transition-group"),require("prezi.geometry"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_spotlight"]=__factory(React,ReactDOM,ReactTransitionGroup,this["prezi.geometry"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);