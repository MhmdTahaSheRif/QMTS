;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "14.0-9-g58006c6";},getModuleName:function(){return "prezi_editor_commander";},getModuleVersion:function(){return "release-2023w26-base-4-g4a3c2ed4bcb";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.engine.dom.converter.xpdom2":dependencies[1],"prezi.geometry":dependencies[2],"prezi_app_utils":dependencies[3],"prezi_bacon":dependencies[4],"prezi_cet":dependencies[5],"prezi_cet_model":dependencies[6],"prezi_cet_model_editor":dependencies[7],"prezi_cet_renderer":dependencies[8],"prezi_editor_commander_common":dependencies[9],"prezi_editor_store_mode":dependencies[10],"prezi_editor_store_object":dependencies[11],"prezi_externalserviceprovider":dependencies[12],"prezi_featureswitcher":dependencies[13],"prezi_i18n":dependencies[14],"prezi_logger":dependencies[15],"prezi_plugin_api":dependencies[16],"prezi_ppt_service":dependencies[17],"prezi_service_fontcatalogue":dependencies[18],"prezi_service_media":dependencies[19],"prezi_styleschemeprovider":dependencies[20],"prezi_templateservice":dependencies[21],"prezi_textmodel":dependencies[22],"prezi_textstyleprovider":dependencies[23],"prezi_utils":dependencies[24],"prezi_widgets":dependencies[25]}};})());};})(arguments);var moduleImpl=(function(){return module(function(l){function qb(a){return null!=a&&u.isFromEnum(a,f.base.ShapelikeFilterStyle)}function rb(a,b){return b.map((b)=>{b=a.lookup.transformedObject(b);return a.toDecorator(b)}).filter((a)=>null!=a)}function Ga(a,b,c,d){switch(b.kind){case h.ActionKind.Start:c=d.getScreenLayoutBox().referenceFrame;var {baseState:a}=ba.createCommonDragState(a,b,c);return Object.assign(Object.assign({},a),{resizeAnchor:b.resizeAnchor,isCenterResize:b.isCenterResize,resizeSnapInfos:null,referenceSegments:null,
snapEnabled:!1});case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:d.getScreenLayoutBox().referenceFrame.point(b.stagePosition),isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}function sb(a,b,c){const d=p.LoggerModule.getLoggerManager().generateUniqueId();b.logInfos.forEach((b)=>{const e=a.lookup.transformedObject(b.editorId);
c.info({action:"modify",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(e),trigger:"control_point",payload:{old_scale:b.old_scale,new_scale:e.layoutBox.size.width,old_x:b.old_x,new_x:e.layoutBox.center.x,old_y:b.old_y,new_y:e.layoutBox.center.y,active_container:"overview",object_id:e.id,multiselect_id:d,prezi_mode:"editor",modified_value:"scale",is_topic_customization:e.parent.is(tb.visual)||e.parent.is(tb.cover)}});p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:e,modify_action:"RESIZE",
topic_relationship:e,object_id:e.id})})}function ub(a,b){return.2>=n.Geometry.colorFromRGBA(a.r/255,a.g/255,a.b/255,b).getContrastWith(Gb)}var Hb=null,Ib=l.dependencies["prezi.engine.dom"],ca=l.dependencies.prezi_app_utils,vb=l.dependencies.prezi_bacon,y=l.dependencies.prezi_editor_commander_common,na=l.dependencies.prezi_featureswitcher,wb=l.dependencies.prezi_i18n,Jb=l.dependencies.prezi_logger,L=l.dependencies.prezi_plugin_api,n=l.dependencies["prezi.geometry"],w=l.dependencies.prezi_cet_model,
f=l.dependencies.prezi_cet_model_editor,r=l.dependencies.prezi_styleschemeprovider,u=l.dependencies.prezi_utils,Kb=l.dependencies.prezi_service_fontcatalogue,oa={};Object.defineProperty(oa,"__esModule",{value:!0});oa.TextStyleCommanderImpl=class{getFontScheme(a){const b=(b)=>a.styleSheets.find((a)=>a.className===b);return{title:this.getFontProperties(b("title")),subtitle:this.getFontProperties(b("subtitle")),subtitle2:this.getFontProperties(b("subtitle_2")),body:this.getFontProperties(b("body")),
body2:this.getFontProperties(b("body_2"))}}getFontProperties(a){if(a){const b={fontFamily:a.styleBlock.text.font.description.fontFamily,hasBackground:a.styleBlock.text.background.display,hasBold:a.styleBlock.text.font.weight===f.base.FontWeight.Bold,hasItalic:a.styleBlock.text.font.style===f.base.FontStyle.Italic,isCustom:!1};return Kb.isBuiltinFont(a.styleBlock.text.font.description.fontFamily)?b:Object.assign(Object.assign({},b),{isCustom:!0,customKegProperties:{normalKeg:a.styleBlock.text.font.description.normalKeg,
italicKeg:a.styleBlock.text.font.description.italicKeg,boldKeg:a.styleBlock.text.font.description.boldKeg,boldItalicKeg:a.styleBlock.text.font.description.boldItalicKeg}})}return{fontFamily:"",hasBackground:!1,hasBold:!1,hasItalic:!1,isCustom:!1}}applyFontScheme(a,b,c){b=this.getUpdatedFontStyleDeclarations(b,a,c);a.styleSheet.update([...b.values()])}getUpdatedFontStyleDeclarations(a,b,c){const d=["title","subtitle","subtitle_2","body","body_2"],e=new Map;b.styleSheet.styleSheets.forEach((a)=>{-1<
d.indexOf(a.className)&&e.set(a.className,a)});this.updateFontStyleBlock(a,b,e,"title",c.title);this.updateFontStyleBlock(a,b,e,"subtitle",c.subtitle);this.updateFontStyleBlock(a,b,e,"subtitle_2",c.subtitle2);this.updateFontStyleBlock(a,b,e,"body",c.body);this.updateFontStyleBlock(a,b,e,"body_2",c.body2);return e}updateFontStyleBlock(a,b,c,d,e){b=c.get(d)||{className:d,styledObjectKind:null,rawTypeName:null,styleBlock:b.styleSheet.createEmptyStyleBlock()};c.set(d,Object.assign(Object.assign({},b),
{styleBlock:this.getStyleBlockUpdatedWithFonts(a,b.styleBlock,e)}))}getStyleBlockUpdatedWithFonts(a,b,c){const d=a.getFontDescription(c.fontFamily);return Object.assign(Object.assign({},b),{text:Object.assign(Object.assign({},b.text),{font:{description:d||a.createFontDescription(c.fontFamily,c.customKegProperties.normalKeg,c.customKegProperties.boldKeg,c.customKegProperties.italicKeg,c.customKegProperties.boldItalicKeg),style:c.hasItalic?f.base.FontStyle.Italic:f.base.FontStyle.Normal,weight:c.hasBold?
f.base.FontWeight.Bold:f.base.FontWeight.Normal}})})}};var pa={};Object.defineProperty(pa,"__esModule",{value:!0});var Y=f.base.ObjectKind,qa=f.base.ColorFilterKind,fa=f.base.FillKind,I=f.base.ObjectKind,Lb=f.base.CoverLayoutRole,Mb=f.base.BackgroundFilterStyle;pa.ColorMixCommanderImpl=class{constructor(){if(null==J){J={};Ha={};xb={};Ia={};Ja={};yb={};Ka={};zb={};var a={};a[f.base.ShapeStyle.Poly1]=r.PaletteColorType.BackgroundColor;a[f.base.ShapeStyle.Poly2]=r.PaletteColorType.TopicAColor;a[f.base.ShapeStyle.Poly3]=
r.PaletteColorType.TopicBColor;a[f.base.ShapeStyle.Poly4]=r.PaletteColorType.BorderColor;a[f.base.ShapeStyle.Poly5]=r.PaletteColorType.ExtraColor;T(a,Ja);a={};a[f.base.ArcStyle.Line1]=r.PaletteColorType.BackgroundColor;a[f.base.ArcStyle.Line2]=r.PaletteColorType.TopicAColor;a[f.base.ArcStyle.Line3]=r.PaletteColorType.TopicBColor;a[f.base.ArcStyle.Line4]=r.PaletteColorType.BorderColor;a[f.base.ArcStyle.Line5]=r.PaletteColorType.ExtraColor;a[f.base.ArcStyle.Chainlink]=r.PaletteColorType.BorderColor;
a[f.base.ArcStyle.ChainlinkCamelCase]=r.PaletteColorType.BorderColor;T(a,Ka);a={};a.color1=r.PaletteColorType.BackgroundColor;a.color2=r.PaletteColorType.TopicAColor;a.color3=r.PaletteColorType.TopicBColor;a.color4=r.PaletteColorType.BorderColor;a.color5=r.PaletteColorType.ExtraColor;T(a,Ia);a={};a[f.base.ShapelikeFilterStyle.Filter1]=r.PaletteColorType.BackgroundColor;a[f.base.ShapelikeFilterStyle.Filter2]=r.PaletteColorType.TopicAColor;a[f.base.ShapelikeFilterStyle.Filter3]=r.PaletteColorType.TopicBColor;
a[f.base.ShapelikeFilterStyle.Filter4]=r.PaletteColorType.BorderColor;a[f.base.ShapelikeFilterStyle.Filter5]=r.PaletteColorType.ExtraColor;T(a,Ha);a={};a[f.base.FullBlendShapelikeFilterStyle.Filter1]=r.PaletteColorType.BackgroundColor;a[f.base.FullBlendShapelikeFilterStyle.Filter2]=r.PaletteColorType.TopicAColor;a[f.base.FullBlendShapelikeFilterStyle.Filter3]=r.PaletteColorType.TopicBColor;a[f.base.FullBlendShapelikeFilterStyle.Filter4]=r.PaletteColorType.BorderColor;a[f.base.FullBlendShapelikeFilterStyle.Filter5]=
r.PaletteColorType.ExtraColor;T(a,xb);a={};a[f.base.ImageLikeFilterStyle.Filter1]=r.PaletteColorType.BackgroundColor;a[f.base.ImageLikeFilterStyle.Filter2]=r.PaletteColorType.TopicAColor;a[f.base.ImageLikeFilterStyle.Filter3]=r.PaletteColorType.TopicBColor;a[f.base.ImageLikeFilterStyle.Filter4]=r.PaletteColorType.BorderColor;a[f.base.ImageLikeFilterStyle.Filter5]=r.PaletteColorType.ExtraColor;T(a,yb);a={};a[f.base.BackgroundFilterStyle.Filter1]=r.PaletteColorType.BackgroundColor;a[f.base.BackgroundFilterStyle.Filter2]=
r.PaletteColorType.TopicAColor;a[f.base.BackgroundFilterStyle.Filter3]=r.PaletteColorType.TopicBColor;a[f.base.BackgroundFilterStyle.Filter4]=r.PaletteColorType.BorderColor;a[f.base.BackgroundFilterStyle.Filter5]=r.PaletteColorType.ExtraColor;T(a,Nb);a={};a.title=r.PaletteColorType.PrimaryTextColor;a.subtitle=r.PaletteColorType.PrimaryTextColor;a.body=r.PaletteColorType.PrimaryTextColor;a.subtitle_2=r.PaletteColorType.SecondaryTextColor;a.body_2=r.PaletteColorType.SecondaryTextColor;T(a,zb)}}styleBlockWithColor(a,
b,c=b){b=f.CetModelEditor.colorToStyleColor(b);c=f.CetModelEditor.colorToStyleColor(c);b=Object.assign(Object.assign({},a.fill),{color:b,gradientStartColor:b,gradientEndColor:b,gradientStartAlpha:1,gradientEndAlpha:0});c=Object.assign(Object.assign({},a.border),{color:c});return Object.assign(Object.assign({},a),{fill:b,border:c})}styleBlockWithTextColor(a,b,c){b=f.CetModelEditor.colorToStyleColor(b);b=Object.assign(Object.assign({},a.fill),{color:b,fillKind:fa.solid});const d=f.CetModelEditor.colorToStyleColor(c);
c=c.getAlpha();c=Object.assign(Object.assign({},a.text),{background:Object.assign(Object.assign({},a.text.background),{color:d,alpha:c})});return Object.assign(Object.assign({},a),{fill:b,text:c})}styleBlockWithColorFilter(a,b,c){b=f.CetModelEditor.colorToStyleColor(b);c={kind:qa.solidColorBlend,color:Object.assign(Object.assign({},b),{a:c})};return Object.assign(Object.assign({},a),{colorFilter:c})}shouldUpdateWithColors(a,b){return a.fill.fillKind!==b.fill.fillKind||!this.styleColorEquals(a.fill.color,
b.fill.color)||!this.styleColorEquals(a.fill.gradientStartColor,b.fill.gradientStartColor)||!this.styleColorEquals(a.fill.gradientEndColor,b.fill.gradientEndColor)||a.fill.alpha!==a.fill.alpha||a.fill.gradientStartAlpha!==a.fill.gradientStartAlpha||a.fill.gradientEndAlpha!==a.fill.gradientEndAlpha||!this.styleColorEquals(a.border.color,b.border.color)||a.border.alpha!==b.border.alpha||!this.colorFilterEquals(a.colorFilter,b.colorFilter)||!this.styleColorEquals(a.text.background.color,b.text.background.color)||
a.text.background.alpha!==b.text.background.alpha}colorFilterEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&a.kind===qa.solidColorBlend&&b.kind===qa.solidColorBlend&&this.styleColorEquals(a.color,b.color)&&a.color.a===b.color.a}styleColorEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&a.r===b.r&&a.g===b.g&&a.b===b.b}themeColorEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&this.styleColorEquals(a.color1,b.color1)&&this.styleColorEquals(a.color2,b.color2)&&this.styleColorEquals(a.color3,
b.color3)&&this.styleColorEquals(a.color4,b.color4)&&this.styleColorEquals(a.color5,b.color5)}applyShapeStyles(a){return{name:"applyPaletteCmd",run:(b)=>{const c=new Map;b.styleSheet.styleSheets.forEach((a)=>{c.set(a.className,a)});const d=this.getUpdatedShapeStyles(b,a,c);b.styleSheet.update([...d.values()])}}}getUpdatedShapeStyles(a,b,c){const d=new Map,e=(b,e)=>{const g=d.has(b)?d.get(b):c.has(b)?c.get(b):e?{className:b,styledObjectKind:null,rawTypeName:null,styleBlock:a.styleSheet.createEmptyStyleBlock()}:
null;return null!=g?{styleBlock:g.styleBlock,update:(a)=>{d.set(b,Object.assign(Object.assign({},g),{styleBlock:a}))}}:null};b.shapeStyleColors.forEach((a)=>{const b=e(a.shapeStyle,!1);null!=b&&(a=this.styleBlockWithColor(b.styleBlock,a.paletteColor.color,a.borderColor.color),this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a))});b.visualStyleColors.forEach((a)=>{const c=e(a.visualBlendStyle,!0);a=this.styleBlockWithColorFilter(c.styleBlock,a.paletteColor.color,b.visualBlendAlpha);this.shouldUpdateWithColors(c.styleBlock,
a)&&c.update(a)});b.fullBlendVisualStyleColors.forEach((a)=>{const c=e(a.visualBlendStyle,!0);a=this.styleBlockWithColorFilter(c.styleBlock,a.paletteColor.color,b.fullVisualBlendAlpha);this.shouldUpdateWithColors(c.styleBlock,a)&&c.update(a)});b.imageStyleColors.forEach((a)=>{const c=e(a.imageBlendStyle,!0);a=this.styleBlockWithColorFilter(c.styleBlock,a.paletteColor.color,b.imageBlendAlpha);this.shouldUpdateWithColors(c.styleBlock,a)&&c.update(a)});return d}applyPalette(a,b,c,d,e){const g=new Map;
a.styleSheet.styleSheets.forEach((a)=>{g.set(a.className,a)});let k=new Map;var z=this.getUpdatedShapeStyles(a,c,g);const B=(b,c)=>{const d=k.has(b)?k.get(b):g.has(b)?g.get(b):c?{className:b,styledObjectKind:null,rawTypeName:null,styleBlock:a.styleSheet.createEmptyStyleBlock()}:null;return null!=d?{styleBlock:d.styleBlock,update:(a)=>{k.set(b,Object.assign(Object.assign({},d),{styleBlock:a}))}}:null};c.arcStyleColors.forEach((a)=>{const b=B(a.arcStyle,!1);null!=b&&(a=this.styleBlockWithColor(b.styleBlock,
a.paletteColor.color),this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a))});c.backgroundStyleColors.forEach((a)=>{const b=B(a.bgFilterStyle,!0);a=this.styleBlockWithColorFilter(b.styleBlock,a.paletteColor.color,0);this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a)});e&&(b=(new oa.TextStyleCommanderImpl).getUpdatedFontStyleDeclarations(b,a,e),k=new Map([...k,...b]));c.textStyleColors.forEach((a)=>{const b=B(a.textStyle,!1);null!=b&&(a=this.styleBlockWithTextColor(b.styleBlock,a.paletteColor.color,
a.backgroundColor.color),this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a))});a.styleSheet.update([...k.values(),...z.values()]);let h={};c.themeStyleColors.forEach((a)=>{const b=f.CetModelEditor.colorToStyleColor(a.paletteColor.color);switch(a.themeStyle){case "color1":h=Object.assign(Object.assign({},h),{color1:b});break;case "color2":h=Object.assign(Object.assign({},h),{color2:b});break;case "color3":h=Object.assign(Object.assign({},h),{color3:b});break;case "color4":h=Object.assign(Object.assign({},
h),{color4:b});break;case "color5":h=Object.assign(Object.assign({},h),{color5:b})}});z=Object.assign(Object.assign({},a.styleSheet.themeColors),h);this.themeColorEquals(a.styleSheet.themeColors,z)||(a.styleSheet.themeColors=z);c=c.backgroundStyleColors.find((a)=>a.bgFilterStyle===Mb.Filter1).paletteColor.color;a.background.fill.fillKind===fa.solid&&this.styleColorEquals(a.background.fill.color,c.getRGBData())&&1===a.background.fill.color.a||(a.background.fill={fillKind:fa.solid,color:Object.assign(Object.assign({},
a.styleSheet.themeColors.color1),{a:1})});a.styleSheet.colorPaletteId=d}isContainer(a,b){return b.is(I.overview)||b.is(I.topic)||b.is(I.page)}isCover(a){return a.parent.is(I.cover)}isCoverIcon(a){return this.isCover(a)&&a.coverLayoutRole===Lb.coverIcon}getColorReferenceObjects(a,b){let c=[];switch(a.kind){case Y.cover:c=a.parent.simpleChildren(f.base.ChildVisibilityKind.outside).filter((a)=>!this.isCoverIcon(a));break;case Y.visual:case Y.surface:c=a.parent.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside);
break;case Y.master:c=a.contentChildren;break;case Y.planetTopic:c=a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside);break;case Y.page:c=a.parent.simpleChildren(f.base.ChildVisibilityKind.inside);break;case Y.overview:c=[b.background];break;default:u.Utils.assertNever(a)}return c.filter((a)=>!(a.kind===I.text||a.kind===I.arrow||a.kind===I.line))}updateTextColor(a,b,c,d=null){b=a.lookup.text(b);const e=a.lookup.base(c);if(!this.isContainer(a,e))throw`${c} is not a container object (overview/topic/page)`;
c=this.getColorReferenceObjects(b.parent,a);null==d&&(d=this.getAutoColorsForText(a));a=this.getAutoColorForText(c,b.background,d);this.setTextColor(b,a);return a}getAutoColorsForText(a){a=this.paletteFromPrezi(a.styleSheet);return[a.getColor(r.PaletteColorType.PrimaryTextColor).color,a.getColor(r.PaletteColorType.SecondaryTextColor).color]}getAutoColorForText(a,b,c){let d={a:.01,r:255,g:255,b:255};a.forEach((a)=>{var b;let c;switch(a.kind){case I.shape:c=this.colorFromColorFilter(a.colorFilter);
null==c&&(c=this.colorFromShapeFill(a.fill));break;case I.line:case I.arrow:c=this.colorFromColorFilter(a.colorFilter);null==c&&(c=a.fill);break;case I.image:case I.pdf:case I.swf:c=this.colorFromColorFilter(a.colorFilter);null==c&&(c={a:.1,r:255,g:255,b:255});break;case I.background:c=this.colorFromColorFilter(null===(b=a.layers[0])||void 0===b?void 0:b.colorFilter);if(null==c||0===c.a)c=a.fill.fillKind===fa.solid?a.fill.color:a.fill.startColor;null==c&&(c={a:.1,r:255,g:255,b:255});break;default:c=
{a:.1,r:255,g:255,b:255}}0!==c.a&&(a=d.a+c.a,d={r:(d.a*d.r+c.a*c.r)/a,g:(d.a*d.g+c.a*c.g)/a,b:(d.a*d.b+c.a*c.b)/a,a:d.a+c.a})});null!=b&&(d={r:b.r*b.a+(1-b.a)*d.r,g:b.g*b.a+(1-b.a)*d.g,b:b.b*b.a+(1-b.a)*d.b,a:b.a+(1-b.a)*d.a});let e=this.getContrastBetweenColors(c[0].getRGBData(),d),g=c[0];c.slice(1).forEach((a)=>{const b=this.getContrastBetweenColors(a.getRGBData(),d);b>e&&(e=b,g=a)});return g.getRGBData()}lum(a,b,c){a=[a,b,c].map(function(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,
2.4)});return.2126*a[0]+.7152*a[1]+.0722*a[2]}getContrastBetweenColors(a,b){a=this.lum(a.r,a.g,a.b)+.05;b=this.lum(b.r,b.g,b.b)+.05;return Math.max(a,b)/Math.min(a,b)}setTextColor(a,b){a.getCharacterProps().every((a)=>a.color.b===b.b&&a.color.g===b.g&&a.color.r===b.r)||a.setAllCharacterProps({color:b})}colorFromColorFilter(a){return a.kind===qa.noColorFilter?null:a.color}colorFromShapeFill(a){return a.fillKind===fa.solid?a.color:a.startColor}paletteFromPrezi(a){if(null==a)return null;var b=a.styleSheets.find((a)=>
"subtitle"===a.className);b=null!=b&&null!=b.styleBlock.fill.color?b.styleBlock.fill.color:{r:0,g:0,b:0};var c=a.styleSheets.find((a)=>"subtitle_2"===a.className);c=null!=c&&null!=c.styleBlock.fill.color?c.styleBlock.fill.color:{r:255,g:255,b:255};return r.StyleSchemeProviderModule.createColorPalette(a.colorPaletteId,{backgroundColor:this.styleColorToColor(a.themeColors.color1),topicAColor:this.styleColorToColor(a.themeColors.color2),topicBColor:this.styleColorToColor(a.themeColors.color3),borderColor:this.styleColorToColor(a.themeColors.color4),
extraColor:this.styleColorToColor(a.themeColors.color5),primaryTextColor:this.styleColorToColor(b),secondaryTextColor:this.styleColorToColor(c)})}schemeFromPrezi(a){if(null==a)return null;const b=this.paletteFromPrezi(a),{thumbnailUrl:c}=b,d=a.colorPaletteId;a=h.EditorCommander.createTextStyleCommander().getFontScheme(a);return{id:d,title:"",isCustom:!0,colorScheme:{backgroundColor:b.getColor(r.PaletteColorType.BackgroundColor).color,topicAColor:b.getColor(r.PaletteColorType.TopicAColor).color,topicBColor:b.getColor(r.PaletteColorType.TopicBColor).color,
borderColor:b.getColor(r.PaletteColorType.BorderColor).color,extraColor:b.getColor(r.PaletteColorType.ExtraColor).color,primaryTextColor:b.getColor(r.PaletteColorType.PrimaryTextColor).color,secondaryTextColor:b.getColor(r.PaletteColorType.SecondaryTextColor).color},fontScheme:a,thumbnailUrl:c}}styleColorToColor(a){return n.Geometry.colorFromRGB(a.r/255,a.g/255,a.b/255)}getPaletteColorForEntity(a,b){a=a.getEntityById(b);let c=null;null!=a&&a.getComponent(w.CetModel.ID.STYLED.STYLE_CLASSES).items().forEach((a)=>
{null!=J[a]&&(c=J[a])});return c}getShapefilterStyle(a){return Ha[a]}getShapeStyle(a){return Ja[a]}getArcStyle(a){return Ka[a]}getThemeStyle(a){return Ia[a]}createMapping(a){var b=[f.base.ArcStyle.Line1,f.base.ArcStyle.Line2,f.base.ArcStyle.Line3,f.base.ArcStyle.Line4,f.base.ArcStyle.Line5,f.base.ArcStyle.Chainlink,f.base.ArcStyle.ChainlinkCamelCase],c=[f.base.ShapelikeFilterStyle.Filter1,f.base.ShapelikeFilterStyle.Filter2,f.base.ShapelikeFilterStyle.Filter3,f.base.ShapelikeFilterStyle.Filter4,f.base.ShapelikeFilterStyle.Filter5],
d=[f.base.FullBlendShapelikeFilterStyle.Filter1,f.base.FullBlendShapelikeFilterStyle.Filter2,f.base.FullBlendShapelikeFilterStyle.Filter3,f.base.FullBlendShapelikeFilterStyle.Filter4,f.base.FullBlendShapelikeFilterStyle.Filter5],e=[f.base.ImageLikeFilterStyle.Filter1,f.base.ImageLikeFilterStyle.Filter2,f.base.ImageLikeFilterStyle.Filter3,f.base.ImageLikeFilterStyle.Filter4,f.base.ImageLikeFilterStyle.Filter5],g=[f.base.BackgroundFilterStyle.Filter1,f.base.BackgroundFilterStyle.Filter2,f.base.BackgroundFilterStyle.Filter3,
f.base.BackgroundFilterStyle.Filter4,f.base.BackgroundFilterStyle.Filter5];const k=[f.base.ShapeStyle.Poly1,f.base.ShapeStyle.Poly2,f.base.ShapeStyle.Poly3,f.base.ShapeStyle.Poly4,f.base.ShapeStyle.Poly5].map((b)=>{const c=a.getColor(J[b]);return{shapeStyle:b,paletteColor:c,borderColor:a.getColor(r.PaletteColorType.BorderColor)}});b=b.map((b)=>{const c=a.getColor(J[b]);return{arcStyle:b,paletteColor:c}});c=c.map((b)=>{const c=a.getColor(J[b]);return{visualBlendStyle:b,paletteColor:c}});d=d.map((b)=>
{const c=a.getColor(J[b]);return{visualBlendStyle:b,paletteColor:c}});e=e.map((b)=>{const c=a.getColor(J[b]);return{imageBlendStyle:b,paletteColor:c}});const z=["color1","color2","color3","color4","color5"].map((b)=>{const c=a.getColor(J[b]);return{themeStyle:b,paletteColor:c}});g=g.map((b)=>{const c=a.getColor(J[b]);return{bgFilterStyle:b,paletteColor:c}});const h=["title","subtitle","body","subtitle_2","body_2"].map((b)=>{const c=a.getColor(J[b]),d=a.getColor(Ob(b));return{textStyle:b,paletteColor:c,
backgroundColor:d}});return{arcStyleColors:b,visualStyleColors:c,fullBlendVisualStyleColors:d,imageStyleColors:e,shapeStyleColors:k,themeStyleColors:z,backgroundStyleColors:g,textStyleColors:h,overviewTitleBlendAlpha:1,topicTitleBlendAlpha:1,slideBlendAlpha:.2,visualBlendAlpha:.8,fullVisualBlendAlpha:1,imageBlendAlpha:.8}}};const Ob=(a)=>{switch(a){case "title":case "subtitle":case "body":return r.PaletteColorType.BorderColor;case "body_2":case "subtitle_2":return r.PaletteColorType.ExtraColor}};
let J,Ha={},xb={},Ia={},Ja={},yb={},Ka={},Nb={},zb={};const T=(a,b)=>{Object.keys(a).forEach((c)=>{J[c]=a[c];b[a[c]]=c})};var La={};Object.defineProperty(La,"__esModule",{value:!0});var da=f.base.ObjectKind,Ab=f.base.ContentLayoutRole,Bb=f.base.CoverLayoutRole;La.CounterpartUpdaterImpl=class{constructor(a){this.api=a}getCounterpartText(a){a=this.api.lookup.text(a);let b;this.isCoverObject(a)&&a.coverLayoutRole===Bb.coverTitle?a.parent.is(da.cover)&&a.parent.parent.is(da.planetTopic)&&(b=a.parent.parent.contentChildren.find((a)=>
a.contentLayoutRole===Ab.contentTitle)):this.isPlanetContentObject(a)&&a.contentLayoutRole===Ab.contentTitle&&a.parent.is(da.planetTopic)&&(b=a.parent.cover.contentChildren.find((a)=>a.coverLayoutRole===Bb.coverTitle));return null!=b?b.id:null}updateCounterpartTexts(a,b){var c=this.getCounterpartText(a);null!=c&&(c=this.api.toDecorator(this.api.lookup.text(c)),a=this.api.toDecorator(this.api.lookup.text(a)),null!=c&&c.is(da.text)&&(b===h.UpdateOrigin.current?this.copyRawTextToOtherText(a,c):this.copyRawTextToOtherText(c,
a)))}isCoverObject(a){return a.parent.is(da.cover)}isPlanetContentObject(a){return a.parent.is(da.planetTopic)}copyRawTextToOtherText(a,b){const c=a.getTextWithStyle().text;b.setTextWithStyle({text:c,characterPropss:this.createTextStyleWithLength(b,c.length)});b.isPlaceholder=a.isPlaceholder}createTextStyleWithLength(a,b){a=a.getCharacterProps();return b>a.length?[...a,...Array(b-a.length).fill(a[a.length-1])]:a.slice(0,b)}};var m={};Object.defineProperty(m,"__esModule",{value:!0});m.layoutWaterlily=
{id:"CoverLayoutWaterlily",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutWaterlily.json")};m.layoutLabel={id:"CoverLayoutLabel",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutLabel.json")};m.layoutCircleBrush={id:"CoverLayoutCircleBrush",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleBrush.json")};m.layoutShadow={id:"CoverLayoutShadow",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutShadow.json")};m.layoutPolygon={id:"CoverLayoutPolygon",category:1,complexity:0,
url:l.getResourceUrl("CoverLayoutPolygon.json")};m.layoutBlurred={id:"CoverLayoutBlurred",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutBlurred.json")};m.layoutBrush={id:"CoverLayoutBrush",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutBrush.json")};m.layoutBrush2={id:"CoverLayoutBrush2",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutBrush2.json")};m.layoutPoint={id:"CoverLayoutPoint",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutPoint.json")};m.layoutPotato=
{id:"CoverLayoutPotato",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutPotato.json")};m.layoutSquare={id:"CoverLayoutSquare",category:4,complexity:0,url:l.getResourceUrl("CoverLayoutSquare.json")};m.layoutSquareShape={id:"CoverLayoutSquareShape",category:1,complexity:0,url:l.getResourceUrl("CoverLayoutSquareShape.json")};m.layoutCube={id:"CoverLayoutCube",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutCube.json")};m.layoutCircle={id:"CoverLayoutCircle",category:4,complexity:0,
url:l.getResourceUrl("CoverLayoutCircle.json")};m.layoutCircleShape={id:"CoverLayoutCircleShape",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutCircleShape.json")};m.layoutCircleBorder={id:"CoverLayoutCircleBorder",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleBorder.json")};m.layoutHex={id:"CoverLayoutHex",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutHex.json")};m.layoutCloud={id:"CoverLayoutCloud",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCloud.json")};
m.layoutPicFrame={id:"CoverLayoutPicFrame",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutPicFrame.json")};m.layoutSpeechBubble={id:"CoverLayoutSpeechBubble",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutSpeechBubble.json")};m.layoutPin={id:"CoverLayoutPin",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutPin.json")};m.layoutGem={id:"CoverLayoutGem",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutGem.json")};m.layoutPostit={id:"CoverLayoutPostit",category:1,complexity:0,
url:l.getResourceUrl("CoverLayoutPostit.json")};m.layoutRotatedSquare={id:"CoverLayoutRotatedSquare",category:1,complexity:0,url:l.getResourceUrl("CoverLayoutRotatedSquare.json")};m.layoutTexturedCircle={id:"CoverLayoutTexturedCircle",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutTexturedCircle.json")};m.layoutTexturedSquare={id:"CoverLayoutTexturedSquare",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutTexturedSquare.json")};m.layoutSphere={id:"CoverLayoutSphere",category:0,complexity:0,
url:l.getResourceUrl("CoverLayoutSphere.json")};m.layoutCloudSimple={id:"CoverLayoutCloudSimple",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCloudSimple.json")};m.layoutFlower={id:"CoverLayoutFlower",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutFlower.json")};m.layoutSticky={id:"CoverLayoutSticky",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutSticky.json")};m.layoutJellies={id:"CoverLayoutJellies",category:1,complexity:0,url:l.getResourceUrl("CoverLayoutJellies.json")};
m.layoutCirclesIntersected={id:"CoverLayoutCirclesIntersected",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutCirclesIntersected.json")};m.layoutCircleDotted={id:"CoverLayoutCircleDotted",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleDotted.json")};m.layoutRectLine={id:"CoverLayoutRectLine",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutRectLine.json")};m.layoutRectIntersect={id:"CoverLayoutRectIntersect",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutRectIntersect.json")};
m.layoutDiamond={id:"CoverLayoutDiamond",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutDiamond.json")};m.layoutCircleTintedBorder={id:"CoverLayoutCircleTintedBorder",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleTintedBorder.json")};m.coverLayoutDefinitions=[m.layoutSquare,m.layoutSquareShape,m.layoutCircle,m.layoutCircleShape,m.layoutPotato,m.layoutHex,m.layoutJellies,m.layoutCirclesIntersected,m.layoutRectLine,m.layoutRectIntersect,m.layoutCircleBorder,m.layoutCircleDotted,
m.layoutDiamond,m.layoutCloudSimple,m.layoutPicFrame,m.layoutCircleTintedBorder,m.layoutCube,m.layoutCloud,m.layoutSpeechBubble,m.layoutPin,m.layoutTexturedCircle,m.layoutTexturedSquare,m.layoutWaterlily,m.layoutLabel,m.layoutCircleBrush,m.layoutShadow,m.layoutPolygon,m.layoutBlurred,m.layoutBrush,m.layoutBrush2,m.layoutPoint,m.layoutGem,m.layoutPostit,m.layoutRotatedSquare,m.layoutFlower,m.layoutSphere,m.layoutSticky];var t={};Object.defineProperty(t,"__esModule",{value:!0});t.layoutArDefault={id:"OverviewLayoutArDefault",
category:2,url:l.getResourceUrl("OverviewLayoutArDefault.json")};t.layoutArRight={id:"OverviewLayoutArRight",category:2,url:l.getResourceUrl("OverviewLayoutArRight.json")};t.layoutArZigzag={id:"OverviewLayoutArZigzag",category:2,url:l.getResourceUrl("OverviewLayoutArZigzag.json")};t.layoutArSpeakerCenter={id:"OverviewLayoutArSpeakerCenter",category:2,url:l.getResourceUrl("OverviewLayoutArSpeakerCenter.json")};t.layoutArObjectHalfCut={id:"OverviewLayoutArObjectHalfCut",category:2,url:l.getResourceUrl("OverviewLayoutArObjectHalfCut.json")};
t.layoutArBottomRight={id:"OverviewLayoutArBottomRight",category:2,url:l.getResourceUrl("OverviewLayoutArBottomRight.json")};t.layoutLineToRight={id:"OverviewLayout1",category:1,url:l.getResourceUrl("OverviewLayout1.json")};t.layoutGrid={id:"OverviewLayout2",category:1,url:l.getResourceUrl("OverviewLayout2.json")};t.layoutMarchUp={id:"OverviewLayout4",category:1,url:l.getResourceUrl("OverviewLayout4.json")};t.layoutStraightBottom={id:"OverviewLayout7",category:1,url:l.getResourceUrl("OverviewLayout7.json")};
t.layoutSnakeBottom={id:"OverviewLayout8",category:4,url:l.getResourceUrl("OverviewLayout8.json")};t.layoutIrregularGrid={id:"OverviewLayout9",category:1,url:l.getResourceUrl("OverviewLayout9.json")};t.layoutIkeaFrames={id:"OverviewLayout11",category:4,url:l.getResourceUrl("OverviewLayout11.json")};t.layoutManhattan={id:"OverviewLayout12",category:4,url:l.getResourceUrl("OverviewLayout12.json")};t.layoutSaturn={id:"OverviewLayout13",category:4,url:l.getResourceUrl("OverviewLayout13.json")};t.layoutBeehive=
{id:"OverviewLayout14",category:4,url:l.getResourceUrl("OverviewLayout14.json")};t.layoutClouds={id:"OverviewLayout15",category:4,url:l.getResourceUrl("OverviewLayout15.json")};t.layoutArc={id:"OverviewLayoutArc",category:0,url:l.getResourceUrl("OverviewLayout16.json")};t.layoutLeftCircleCut={id:"OverviewLayoutLeftCircleCut",category:0,url:l.getResourceUrl("OverviewLayoutLeftCircleCut.json")};t.layoutRightCircleCut={id:"OverviewLayoutRightCircleCut",category:0,url:l.getResourceUrl("OverviewLayoutRightCircleCut.json")};
t.layoutFocusIn={id:"OverviewLayoutFocusIn",category:4,url:l.getResourceUrl("OverviewLayoutFocusIn.json")};t.planetLayoutDefinitions=[t.layoutRightCircleCut,t.layoutGrid,t.layoutArc,t.layoutLeftCircleCut,t.layoutLineToRight,t.layoutIrregularGrid,t.layoutMarchUp,t.layoutStraightBottom,t.layoutFocusIn,t.layoutManhattan,t.layoutSaturn,t.layoutBeehive,t.layoutIkeaFrames,t.layoutSnakeBottom,t.layoutClouds,t.layoutArDefault,t.layoutArRight,t.layoutArZigzag,t.layoutArSpeakerCenter,t.layoutArObjectHalfCut,
t.layoutArBottomRight];var ra={};Object.defineProperty(ra,"__esModule",{value:!0});ra.contentLayoutDefinitions="ContentLayout_1by1_v1_01 ContentLayout_1by1_v1_02 ContentLayout_1by1_v1_03 ContentLayout_1by1_v1_03b ContentLayout_1by1_v1_04b ContentLayout_1by1_v1_05 ContentLayout_1by1_v1b_02 ContentLayout_1by1_v1b_03 ContentLayout_1by1_v1b_04b ContentLayout_1by1_v1b_05 ContentLayout_1by1_v2_01 ContentLayout_1by1_v2_02 ContentLayout_1by1_v2_03 ContentLayout_1by1_v2_03b ContentLayout_1by1_v2_04b ContentLayout_1by1_v2_05 ContentLayout_1by1_v2b_02 ContentLayout_1by1_v2b_03 ContentLayout_1by1_v2b_04b ContentLayout_1by1_v2b_05 ContentLayout_1by1_v3_01 ContentLayout_1by1_v3_02 ContentLayout_1by1_v3_03 ContentLayout_1by1_v3_04 ContentLayout_1by1_v3_05 ContentLayout_1by1_v4_01 ContentLayout_1by1_v4_02 ContentLayout_1by1_v4_03 ContentLayout_1by1_v4_04 ContentLayout_1by1_v4_05 ContentLayout_16by9_v1_02 ContentLayout_16by9_v1_02b ContentLayout_16by9_v1_03 ContentLayout_16by9_v1_03b ContentLayout_16by9_v1_04 ContentLayout_16by9_v1_05 ContentLayout_16by9_v1b_01b ContentLayout_16by9_v1b_02 ContentLayout_16by9_v1b_03 ContentLayout_16by9_v1b_04 ContentLayout_16by9_v1b_05 ContentLayout_16by9_v2_02 ContentLayout_16by9_v2_02b ContentLayout_16by9_v2_03 ContentLayout_16by9_v2_03b ContentLayout_16by9_v2_04 ContentLayout_16by9_v2_05 ContentLayout_16by9_v2b_01b ContentLayout_16by9_v2b_02 ContentLayout_16by9_v2b_03 ContentLayout_16by9_v2b_04 ContentLayout_16by9_v2b_05 ContentLayout_16by9_v3_01 ContentLayout_16by9_v3_02 ContentLayout_16by9_v3_03 ContentLayout_16by9_v3_04 ContentLayout_16by9_v3_05 ContentLayout_16by9_v4_02 ContentLayout_16by9_v4_03 ContentLayout_16by9_v4_04".split(" ").map((a)=>
({id:a,category:0,complexity:-1===a.indexOf("v1")?1:0,url:l.getResourceUrl(a+".json")}));var Ma={};Object.defineProperty(Ma,"__esModule",{value:!0});Ma.overviewLayoutDefinitions="RealOverviewLayout01 RealOverviewLayout02 RealOverviewLayout03 RealOverviewLayout04 RealOverviewLayout05 RealOverviewLayout06".split(" ").map((a)=>({id:a,category:0,url:l.getResourceUrl(a+".json")})).concat("RealOverviewLayoutVideo01 RealOverviewLayoutVideo02 RealOverviewLayoutVideo03 RealOverviewLayoutVideo04 RealOverviewLayoutVideo05 RealOverviewLayoutVideo06".split(" ").map((a)=>
({id:a,category:2,url:l.getResourceUrl(a+".json")})));var p=Jb,Na={};Object.defineProperty(Na,"__esModule",{value:!0});Na.LayoutRepositoryImpl=class{constructor(){this.downloadedListeners=[];this.topicShapeLayouts=new Map;this.topicPlanetLayouts=new Map;this.topicContentLayouts=new Map;this.overviewLayouts=new Map;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_commander.Layout")}subscribe(a){this.downloadedListeners.push(a)}notifyDownloadedListeners(){this.downloadedListeners.forEach((a)=>
a())}getFocusedToContentLayoutId(){return this.focusedToContentId}loadPlanetLayouts(a){for(let b of t.planetLayoutDefinitions){const c=b.id===t.layoutFocusIn.id,d=a(b.id,c);this.fetchLayout(b,(a)=>this.loadPlanetLayout(b,a,d,c))}}loadCoverLayouts(a){for(let b of m.coverLayoutDefinitions){const c=a(b.id);this.fetchLayout(b,(a)=>this.loadTopicShapeLayout(b,a,c))}}loadContentLayouts(a){for(let b of ra.contentLayoutDefinitions){const c=a(b.id);this.fetchLayout(b,(a)=>this.loadContentLayout(b,a,c))}}loadOverviewLayouts(a){for(let b of Ma.overviewLayoutDefinitions){const c=
a(b.id);this.fetchLayout(b,(a)=>this.loadOverviewLayout(b,a,c))}}fetchLayout(a,b){null!=a.jsonStr?b(a.jsonStr):null!=a.url&&fetch(a.url).then((a)=>a.text(),(b)=>this.logger.info({action:"fetchingLayout",object:a.id,trigger:JSON.stringify(b)})).then((a)=>a?b(a):{}).catch(()=>this.logger.info({action:"fetchingLayout",object:a.id,trigger:""}))}rewriteUrl(a){return null!=a?a.replace("http://0103.static.prezi.com.s3.amazonaws.com/media","https://s3.amazonaws.com/0103.static.prezi.com/media"):null}loadTopicShapeLayout(a,
b,c){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),complexity:a.complexity,variants:b.variants.map((a)=>({defaultContentAreaType:a.defaultContentAreaType,contentArea1by1:y.relBoxFromJSON(a.contentArea1by1),contentArea16by9:y.relBoxFromJSON(a.contentArea16by9),objects:a.objects.map((a)=>Object.assign(Object.assign({},a),{layoutBox:y.relBoxFromJSON(a.layoutBox)}))}))};a.id===m.layoutSquare.id&&(this.defaultTopicShapeLayoutId=c);this.topicShapeLayouts.set(a.id,{data:b,info:{id:a.id,
thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}loadContentLayout(a,b,c){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),type:b.type,complexity:a.complexity,contentArea:y.relBoxFromJSON(b.contentArea),title:b.title?Object.assign(Object.assign({},b.title),{area:y.relBoxFromJSON(b.title.area),kind:y.ContentLayoutElementKind.titleText}):null,texts:b.texts.map((a)=>Object.assign(Object.assign({},a),{area:y.relBoxFromJSON(a.area),kind:y.ContentLayoutElementKind.bodyText})),
images:b.images.map((a)=>Object.assign(Object.assign({},a),{area:y.relBoxFromJSON(a.area),kind:y.ContentLayoutElementKind.image}))};a.id===ra.contentLayoutDefinitions[0].id&&(this.defaultTopicContentLayoutId=c);this.topicContentLayouts.set(c,{data:b,info:{id:c,thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}loadPlanetLayout(a,b,c,d){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),variants:b.variants.map((a)=>({anchorLayoutBox:y.relBoxFromJSON(a.anchorLayoutBox),
subtopicLayoutBoxes:a.subtopicLayoutBoxes.map((a)=>y.relBoxFromJSON(a))}))};d&&(this.focusedToContentId=c);a.id===t.layoutArc.id&&(this.defaultPlanetLayoutId=c);this.topicPlanetLayouts.set(c,{data:b,info:{id:c,thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}loadOverviewLayout(a,b,c){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),variants:b.variants.map((a)=>({anchorLayoutBox:y.relBoxFromJSON(a.anchorLayoutBox),subtopicLayoutBoxes:a.subtopicLayoutBoxes.map((a)=>
y.relBoxFromJSON(a)),titles:a.titles.map((a)=>Object.assign(Object.assign({},a),{area:y.relBoxFromJSON(a.area)}))}))};this.overviewLayouts.set(c,{data:b,info:{id:c,thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}hasPlanetLayout(a){return this.topicPlanetLayouts.has(a)}hasTopicShapeLayout(a){return this.topicShapeLayouts.has(a)}hasTopicContentLayout(a){return this.topicContentLayouts.has(a)}hasOverviewLayout(a){return this.overviewLayouts.has(a)}getTopicShapeLayout(a){return Object.assign({id:a},
this.topicShapeLayouts.get(a).data)}getPlanetLayout(a){return Object.assign({id:a},this.topicPlanetLayouts.get(a).data)}getTopicContentLayout(a){return Object.assign({id:a},this.topicContentLayouts.get(a).data)}getOverviewLayout(a){return Object.assign({id:a},this.overviewLayouts.get(a).data)}setTopicShapeLayoutFromXml(a,b){b=JSON.stringify(y.convertTopicShapeXmlToJson(b,a));this.loadTopicShapeLayout({id:a,category:1,jsonStr:b},b,a)}setPlanetLayoutFromXml(a,b){b=JSON.stringify(y.convertTopicOverviewXmlToJson(b));
this.loadPlanetLayout({id:a,category:1,jsonStr:b},b,a,!1)}getTopicShapeLayoutInfos(){return[...this.topicShapeLayouts.values()].map((a)=>a.info)}getTopicContentLayoutInfos(){return[...this.topicContentLayouts.values()].map((a)=>a.info)}getPlanetLayoutInfos(){return[...this.topicPlanetLayouts.values()].map((a)=>a.info)}getOverviewLayoutInfos(){return[...this.overviewLayouts.values()].map((a)=>a.info)}getDefaultTopicShapeLayoutInfo(){var a;return null===(a=this.topicShapeLayouts.get(this.defaultTopicShapeLayoutId))||
void 0===a?void 0:a.info}getDefaultPlanetLayoutInfo(){var a;return null===(a=this.topicPlanetLayouts.get(this.defaultPlanetLayoutId))||void 0===a?void 0:a.info}getDefaultTopicContentLayoutInfo(){var a;return null===(a=this.topicContentLayouts.get(this.defaultTopicContentLayoutId))||void 0===a?void 0:a.info}getDefaultOverviewLayoutInfo(){var a;return null===(a=this.overviewLayouts.get(this.defaultOverviewLayoutId))||void 0===a?void 0:a.info}};var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});
Oa.LayoutHelper=class{applyOnTopicZoomArea(a,b,c,d){b=b.withReferenceFrame(a.parent.referenceFrame);c=c.withReferenceFrame(a.parent.referenceFrame);c=a.zoomLayoutBox.withReferenceFrame(a.parent.referenceFrame).align(b.topLeft,b.topRight,c.topLeft,c.topRight);return d(a,c)}unionLayoutBoxAABB(a){return a.map((a)=>a.layoutBox.aabb).reduce((a,c)=>a.union(c))}fitZoomArea(a,b,c){c.fitZoomArea(a,b);return!0}intersectLayoutBoxes(a,b){var c=a.aabb;const d=b.withReferenceFrame(a.referenceFrame).aabb;var e=
a.referenceFrame;b=e.point({x:Math.max(c.topLeft.x,d.topLeft.x),y:Math.max(c.topLeft.y,d.topLeft.y)});c=e.point({x:Math.min(c.bottomRight.x,d.bottomRight.x),y:Math.min(c.bottomRight.y,d.bottomRight.y)});e=e.point({x:(b.x+c.x)/2,y:(b.y+c.y)/2});return a.referenceFrame.layoutBox(e,{width:c.x-b.x,height:c.y-b.y})}areLayoutBoxesClose(a,b,c){return this.closeTo(a.center.x,b.center.x,c)&&this.closeTo(a.center.y,b.center.y,c)&&(this.closeTo(a.size.height,b.size.height,c)||this.closeTo(a.size.width,b.size.width,
c))}closeTo(a,b,c){return Math.abs(a-b)<c}forEachSubtopicWithSrcLayoutBoxes(a,b,c,d){if(c.length>b.subtopicLayoutBoxes.length)throw Error("Wrong layout snippet is used. Number of subtopics mismatch");const e=a.zoomLayoutBox.referenceFrame,g=b.anchorLayoutBox.withReferenceFrame(e);a=a.simpleChildren(f.base.ChildVisibilityKind.inside);a=(0<a.length?this.unionLayoutBoxAABB(a):g).extendToSquare();let k=!0;for(let B=0;B<c.length;++B){const m=c[B];var z=m.simpleChildren(f.base.ChildVisibilityKind.outside),
h=b.subtopicLayoutBoxes[B].withReferenceFrame(e).extendToSquare().align(g.topLeft,g.topRight,a.topLeft,a.topRight);0<z.length?(z=this.unionLayoutBoxAABB(z).extendToSquare(),h=m.layoutBox.align(z.topLeft,z.topRight,h.topLeft,h.topRight),k=k&&d(m,h)):k=k&&d(m,h)}return k}applyFunctionOnTopicZoomAreaWithVariant(a,b,c){b=b.anchorLayoutBox.withReferenceFrame(a.zoomLayoutBox.referenceFrame);var d=a.simpleChildren(f.base.ChildVisibilityKind.inside);d=(0<d.length?this.unionLayoutBoxAABB(d):b).extendToSquare();
return this.applyOnTopicZoomArea(a,b,d,c)}};var Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});var U=f.base.ObjectKind;Pa.VariantAndAreaHelper=class{constructor(a){this.helper=a}getContentArea(a,b){var c=a.coverLayoutId;return b.hasTopicShapeLayout(c)&&(b=b.getTopicShapeLayout(c),c=this.getVariantIndex(a,b),-1<c)?this.getAABBContentAreaFromVariant(b.variants[c],a).extendToSquare():this.getAABBAnchorBoxOfTopic(a).scale(.6979)}getAABBContentAreaFromVariant(a,b){const c=y.defaultContentArea(a),
d=b.zoomLayoutBox.asReferenceFrame;a=this.getAABBAnchorBoxFromTopicShapeDescriptors(a,d).aabb;b=this.getAABBAnchorBoxOfTopic(b);return c.withReferenceFrame(d).aabb.align(a.topLeft,a.topRight,b.topLeft,b.topRight)}getAABBAnchorBoxFromTopicShapeDescriptors(a,b){return a.objects.map((a)=>a.layoutBox).map((a)=>a.withReferenceFrame(b)).reduce((a,b)=>a.union(b.aabb)).extendToSquare()}getAABBAnchorBoxOfTopicMaybe(a){const b=h.EditorCommander.createLayoutQuery();a=[...a.visual.contentChildren,...a.is(U.planetTopic)?
a.surface.contentChildren:[]].filter((a)=>b.isTopicShapeObject(a));return 0<a.length?this.helper.unionLayoutBoxAABB(a):null}getAABBAnchorBoxOfTopic(a){const b=this.getAABBAnchorBoxOfTopicMaybe(a);return(null!==b&&void 0!==b?b:a.layoutBox).extendToSquare()}getVariantIndex(a,b){const c=h.EditorCommander.createLayoutQuery(),d=[...a.visual.contentChildren,...a.is(U.planetTopic)?a.surface.contentChildren:[]].filter((a)=>c.isTopicShapeObject(a)).map((a)=>a.is(U.pdf)?a.pdfAsset.url:a.is(U.image)?a.imageAsset.url:
a.is(U.shape)?"zShape":null).filter((a)=>null!=a);return b.variants.findIndex((a)=>a.objects.some((a)=>a.objectKind===U.pdf?-1<d.indexOf(a.pdfAsset.url):a.objectKind===U.image?-1<d.indexOf(a.imageAsset.url):a.objectKind===U.shape?-1<d.indexOf("zShape"):!1))}};var sa={};Object.defineProperty(sa,"__esModule",{value:!0});sa.TextLayouter=class{constructor(a,b,c,d,e,g,k){this.fitSelectionBoxInto=a;this.getSelectionBox=b;this.setWrapWidth=c;this.wrap=d;this.fitInto=e;this.setBackground=g;this.removeBackground=
k}styleText(a,b){switch(b.kind){case "background":this.setBackground(a,b.cornerRadius);break;case "noBackground":this.removeBackground(a);break;default:u.Utils.assertNever(b)}}positionTextElement(a,b,c,d){var e=c.layoutBox;const g=()=>{this.setWrapWidth(c,d.size.width);this.setWrapWidth(c,c.wrapWidth-(c.textBox.size.width-c.wrapWidth))};g();c.layoutBox.size.height>d.size.height&&(this.wrap(c,d.size.width/d.size.height,!0),this.fitSelectionBoxInto(c,c.layoutBox.withSize(d.size)),g());e=c.layoutBox.move(c.layoutBox.center,
e.center);this.fitInto(c,e);this.alignToAnchor(a,b,c,d)}alignToAnchor(a,b,c,d){var e=c.layoutBox;const g=e.withRotationRad(b);d=d.point(a);e=this.getSelectionBox(c).align(e.topLeft,e.topRight,g.topLeft,g.topRight).point(a);a=d.x-e.x;d=d.y-e.y;this.fitInto(c,c.layoutBox.withRotationRad(b).translate({x:a,y:d}))}};var Qa={};Object.defineProperty(Qa,"__esModule",{value:!0});Qa.ContentLayoutCommander=class{constructor(a,b,c){this.layoutRepository=a;this.variantAndAreaHelper=b;this.layoutHelper=c;this.imageMaskingCommander=
h.EditorCommander.createImageMaskingCommander()}isContentLayoutValid(a,b){var c=[...a.contentChildren];a.is(f.base.ObjectKind.planetTopic)&&(c=c.concat(a.master.contentChildren));let d=this.calculateContentArea(a).referenceArea;c=this.categorizeContentChildren(c);const e=[...b.title?[b.title]:[],...b.texts,...b.images],g=this.findMatchingContent(c,e),k=b.contentArea.withReferenceFrame(a.zoomLayoutBox.asReferenceFrame);b=Array.from(g.matches.keys()).every((b)=>{var c=g.matches.get(b);c=this.calculateTargetLayoutBox(c,
a,k,d);return this.layoutHelper.areLayoutBoxesClose(c.union(b.layoutBox),c,1E-5)});for(let a in g.unmatchedTemplate.values())if(0<a.length)return!1;return b}createTextLayouter(a){return new sa.TextLayouter((b,c)=>{a.toDecorator(a.lookup.text(b.id)).fitSelectionBoxInto(c)},(b)=>a.toDecorator(a.lookup.text(b.id)).selectionBox,(b,c)=>{a.lookup.text(b.id).wrapWidth=c},(b,c,d)=>{a.lookup.text(b.id).wrap(c,d)},(b,c)=>{a.animate(a.lookup.text(b.id)).fitInto(c)},(b,c)=>{b=a.lookup.text(b.id);const d=b.layoutBox;
b.toggleBackground(!0);b.backgroundCornerRadius=Math.min(d.size.height/2,d.size.width/2,c)},(b)=>{a.lookup.text(b.id).toggleBackground(!1)})}changeContentLayout(a,b,c){var d=[...b.contentChildren];b.is(f.base.ObjectKind.planetTopic)&&(d=d.concat(b.master.contentChildren));const e=this.calculateContentArea(b).referenceArea;d=this.categorizeContentChildren(d);const g=[...c.title?[c.title]:[],...c.texts,...c.images];d=this.findMatchingContent(d,g);const k=c.contentArea.withReferenceFrame(b.zoomLayoutBox.asReferenceFrame),
z=[];d.matches.forEach((c,d)=>{this.styleElement(a,c,d);const g=this.calculateTargetLayoutBox(c,b,k,e);this.positionElement(c,d,g,a);z.push([c,d])});d.unmatchedTemplate.forEach((c)=>{const d=this.insertPlaceholderElement(c,b,k,e,a);z.push([c,d])});1<z.length&&z.sort((a,b)=>a[0].zIndex>b[0].zIndex?1:-1).map(([,a])=>a).reduce((a,b)=>{b.moveAbove(a);return b});d.unmatchedOriginal.forEach((a)=>{a.forEach((a)=>{(a.is(f.base.ObjectKind.text)||a.is(f.base.ObjectKind.image))&&a.isPlaceholder&&a.delete()})});
return z.map(([,a])=>a)}calculateContentArea(a){var b,c;let d;if(a.is(f.base.ObjectKind.planetTopic)){var e=a.coverLayoutId;if(this.layoutRepository.hasTopicShapeLayout(e)){e=this.layoutRepository.getTopicShapeLayout(e);const b=this.variantAndAreaHelper.getVariantIndex(a,e);-1!==b&&(d=this.variantAndAreaHelper.getAABBContentAreaFromVariant(e.variants[b],a))}}null==d&&(a.is(f.base.ObjectKind.planetTopic)?d=null===(b=this.variantAndAreaHelper.getAABBAnchorBoxOfTopicMaybe(a))||void 0===b?void 0:b.scale(.7):
a.is(f.base.ObjectKind.page)&&(d=null===(c=this.variantAndAreaHelper.getAABBAnchorBoxOfTopicMaybe(a.parent))||void 0===c?void 0:c.scale(.8)));null==d&&(d=a.zoomLayoutBox.scale(.7));d=d.withReferenceFrame(a.zoomLayoutBox.asReferenceFrame);b=a.zoomLayoutBox.scale(.98);c=a.zoomLayoutBox.scale(.97);e=d;d=d.intersects(c)?a.is(f.base.ObjectKind.planetTopic)?this.layoutHelper.intersectLayoutBoxes(d,b):this.layoutHelper.intersectLayoutBoxes(d,a.zoomLayoutBox.scale(.8)):a.zoomLayoutBox.scale(.7);return{referenceArea:d,
scaledDown:.99>d.size.height*d.size.width/(e.size.height*e.size.width)}}calculateTargetLayoutBox(a,b,c,d){d=c.fitIntoOther(d);return a.area.withReferenceFrame(b.zoomLayoutBox.asReferenceFrame).align(c.topCenter,c.bottomCenter,d.topCenter,d.bottomCenter)}insertPlaceholderElement(a,b,c,d,e){let g;c=this.calculateTargetLayoutBox(a,b,c,d);switch(a.kind){case y.ContentLayoutElementKind.image:g=b.add.image({kind:f.base.AssetKind.image,assetSourceFilename:"gray-square.png",offlineAssetId:"0.6b4f4b8552624",
onlineAssetId:"316251209",url:"http://0103.static.prezi.com.s3.amazonaws.com/media/3/6/2/5/c/ceb034e464485a7cbdeb7889e0f.png",width:711,height:711});g.isPlaceholder=!0;this.styleElement(e,a,g);g.fitInto(c);break;case y.ContentLayoutElementKind.titleText:g=this.createPlaceholderText(b,"subtitle",e,wb.I18n.ts("Click to edit title"),a,c);break;case y.ContentLayoutElementKind.bodyText:g=this.createPlaceholderText(b,"body",e,wb.I18n.ts("Click to edit text"),a,c);break;default:u.Utils.assertNever(a)}e.animate(g).dropIn();
return g}createPlaceholderText(a,b,c,d,e,g){a=a.add.text(b);a.setText(d);a.textStyle=e.style;this.styleElement(c,e,a);a.scale(e.fontSize/a.getFontSizes()[0]);a.isPlaceholder=!0;this.positionElement(e,a,g,c);return a}styleElement(a,b,c){!c.is(f.base.ObjectKind.text)||b.kind!==y.ContentLayoutElementKind.titleText&&b.kind!==y.ContentLayoutElementKind.bodyText?c.is(f.base.ObjectKind.image)&&(null==c.mask?(a=b.area.withReferenceFrame(c.layoutBox.asReferenceFrame).fitIntoOther(c.layoutBox),a=this.imageMaskingCommander.imageMaskForLayoutBox(a,
c.imageAsset),c.mask=a):.01<Math.abs(c.mask.height/c.mask.width-b.area.size.height/b.area.size.width)&&this.adjustMask(b,c)):this.createTextLayouter(a).styleText(c,b.hasBackground?{kind:"background",cornerRadius:b.backgroundCornerRadius}:{kind:"noBackground"})}adjustMask(a,b){var c=a.area.size.height/a.area.size.width;const d=b.mask;a=b.imageAsset;const e=d.height/d.width;let g=Object.assign({},{x:d.x+d.width/2,y:d.y+d.height/2});if(c<e){var k=d.height*c/e;g=Object.assign(Object.assign({},g),{height:k,
width:d.width});c=Math.min(a.width/d.width,Math.sqrt(e/c))}else k=d.width*e/c,g=Object.assign(Object.assign({},g),{height:d.height,width:k}),c=Math.min(a.height/d.height,Math.sqrt(c/e));g=Object.assign(Object.assign({},g),{height:Math.min(c*g.height,a.height-.01),width:Math.min(c*g.width,a.width-.01)});g=Object.assign(Object.assign({},g),{x:Math.max(Math.min(g.x,a.width-g.width/2-.01),g.width/2+.01),y:Math.max(Math.min(g.y,a.height-g.height/2-.01),g.height/2+.01)});b.mask={width:g.width,height:g.height,
x:g.x-g.width/2,y:g.y-g.height/2}}positionElement(a,b,c,d){!b.is(f.base.ObjectKind.text)||a.kind!==y.ContentLayoutElementKind.titleText&&a.kind!==y.ContentLayoutElementKind.bodyText?d.animate(b).fitInto(c):this.createTextLayouter(d).positionTextElement(a.anchor,a.area.rotation,b,c)}categorizeContentChildren(a){const b=new Map(Object.keys(y.ContentLayoutElementKind).map((a)=>[a,[]])),c=a.filter((a)=>a.is(f.base.ObjectKind.text)).map((a)=>a),d=["title","subtitle","subtitle_2"];c.sort(u.Utils.compareBoolean().inverted().on((a)=>
-1!==d.indexOf(a.textStyle)).then(u.Utils.compareNumberWithTolerance(1E-5).inverted().on((a)=>a.getFontSizes().reduceRight((a,b)=>Math.max(a,b),0))).then(u.Utils.compareNumber().on((a)=>a.length)).then(u.Utils.compareNumber().on((a)=>a.layoutBox.center.y)).compare);0<c.length&&(b.get(y.ContentLayoutElementKind.titleText).push(c[0]),c.slice(1).map((a)=>a).sort(u.Utils.compareBoolean().on((a)=>a.isPlaceholder).compare).forEach((a)=>b.get(y.ContentLayoutElementKind.bodyText).push(a)));a.filter((a)=>
a.is(f.base.ObjectKind.animatedImage)||a.is(f.base.ObjectKind.image)||a.is(f.base.ObjectKind.slide)).map((a)=>a).sort(u.Utils.compareBoolean().on((a)=>a.is(f.base.ObjectKind.image)&&a.isPlaceholder).compare).forEach((a)=>b.get(y.ContentLayoutElementKind.image).push(a));return b}findMatchingContent(a,b){const c=new Map(a),d=new Map;let e=[...b];b.forEach((a)=>{const b=c.get(a.kind);if(b&&0<b.length){const g=b.shift();d.set(g,a);e=e.filter((b)=>b!==a);c.set(a.kind,c.get(a.kind).filter((a)=>a!==g))}});
return{unmatchedOriginal:c,matches:d,unmatchedTemplate:e}}};var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0});Ra.PlanetLayoutCommander=class{constructor(a,b,c){this.layoutRepository=a;this.positionFinder=b;this.helper=c}handlePlanetLayoutEvent(a,b,c){switch(c.kind){case f.base.TopicLayoutEventKind.reset:this.applyLayout(a,b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.adjust:this.areSubtopicsInLayoutPosition(c.parent,c.topics.map((a)=>a.id))&&this.applyLayout(a,
b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.remove:if(this.areSubtopicsInLayoutPosition(c.parent,[])){const d=c.parent.topicChildren.filter((a)=>0>c.toBeRemoved.indexOf(a));this.applyLayout(a,b,c.parent,d)}break;default:u.Utils.assertNever(c)}}areSubtopicsInLayoutPosition(a,b){var c=a.layout.id;if(this.layoutRepository.hasPlanetLayout(c)){c=this.layoutRepository.getPlanetLayout(c);var d=a.topicChildren.filter((a)=>0>b.indexOf(a.id));const e=Math.min(d.length,c.variants.length-
1);if(d.length>e)return!1;c=c.variants.find((a)=>a.subtopicLayoutBoxes.length===e);d=d.slice(0,e);const g=(a,b)=>this.helper.areLayoutBoxesClose(a.layoutBox,b,1E-5);return this.helper.applyFunctionOnTopicZoomAreaWithVariant(a,c,(a,b)=>{a=a.zoomLayoutBox.withReferenceFrame(a.parent.referenceFrame);return this.helper.areLayoutBoxesClose(a,b,1E-5)})&&this.helper.forEachSubtopicWithSrcLayoutBoxes(a,c,d,g)}return!1}getMostCommonSubtopicLayoutId(a,b){const c=h.EditorCommander.createLayoutQuery(),d=this.layoutRepository.getPlanetLayoutInfos().map((a)=>
a.id);a=c.getMostCommonLayout(a,b,(a)=>a.layout.id,(a)=>a.is(f.base.ObjectKind.planetTopic)&&-1!==d.indexOf(a.layout.id));null==a&&(a=this.layoutRepository.getDefaultPlanetLayoutInfo().id);return a}applyLayout(a,b,c,d){const e=Math.min(d.length,a.variants.length-1);a=a.variants.find((a)=>a.subtopicLayoutBoxes.length===e);const g=d.slice(0,e);d=d.slice(e);this.applyVariant(c,g,a,b);for(let a of d)b.fitInto(a,this.positionFinder.findTopicPosition(a,g)),g.push(a)}applyVariant(a,b,c,d){this.helper.applyFunctionOnTopicZoomAreaWithVariant(a,
c,(a,b)=>this.helper.fitZoomArea(a,b,d));this.helper.forEachSubtopicWithSrcLayoutBoxes(a,c,b,(a,b)=>{d.fitInto(a,b);return!0})}};var Sa={};Object.defineProperty(Sa,"__esModule",{value:!0});Sa.TopicColorManager=class{updateColorOnTopic(a,b,c,d){const e=h.EditorCommander.createLayoutQuery(),g=h.EditorCommander.createColorGroup(a,[]);a=g.helper.getColorableVisualObjects(b).filter((a)=>e.isTopicShapeObject(a));g.addObjects(a);if(0<d.length){const c=g.helper.getColorFromStyleDeclaration(d[0].styleClass);
var k=g.helper.getColorsForStyle(f.base.ArcStyle),z=g.helper.getColorsForStyle(f.base.ShapeStyle),B=g.helper.getColorsForStyle(f.base.ShapelikeFilterStyle);a=g.helper.getColorsForStyle(f.base.FullBlendShapelikeFilterStyle);b=null;b=k.find((a)=>g.helper.colorEquals(a.color,c));null!=b?b=b.styes.arcStyle:(b=d.find((a)=>a.styleEnum===f.base.ArcStyle),b=null!=b?b.styleClass:null);k=null;k=z.find((a)=>g.helper.colorEquals(a.color,c));null!=k?k=k.styes.shapeStyle:(k=d.find((a)=>a.styleEnum===f.base.ShapeStyle),
k=null!=k?k.styleClass:null);z=null;B=B.find((a)=>g.helper.colorEquals(a.color,c));null!=B?z=B.styes.filterStyle:(B=d.find((a)=>a.styleEnum===f.base.ShapelikeFilterStyle),z=null!=B?B.styleClass:null);B=null;a=a.find((a)=>g.helper.colorEquals(a.color,c));null!=a?B=a.styes.fullBlendFilterStyle:(d=d.find((a)=>a.styleEnum===f.base.FullBlendShapelikeFilterStyle),B=null!=d?d.styleClass:null);g.setPresets({arcStyle:b,shapeStyle:k,filterStyle:z,fullBlendFilterStyle:B})}g.applyColor(c[0],!1)}};var Ta={};Object.defineProperty(Ta,
"__esModule",{value:!0});var E=f.base.ObjectKind;Ta.CoverLayoutApplicator=class{constructor(a,b,c){this.layoutRepository=a;this.variantAndAreaHelper=b;this.helper=c;this.topicColorManager=new Sa.TopicColorManager}applyCoverLayout(a,b,c){const d=h.EditorCommander.createLayoutQuery();var e=h.EditorCommander.createColorGroup(c,[]);e.addObjects(e.helper.getColorableVisualObjects(a).filter((a)=>d.isTopicShapeObject(a)));const g=e.getMainColors().filter((a)=>null!=a);e=e.getPresets().filter((a)=>null!=
a&&null!=a.styleEnum&&null!=a.styleClass);const k=a.layoutBox.extendToSquare(),z=this.variantAndAreaHelper.getContentArea(a,this.layoutRepository),B=this.variantAndAreaHelper.getAABBContentAreaFromVariant(b,a).extendToSquare(),m=this.variantAndAreaHelper.getAABBAnchorBoxOfTopic(a);var l=a.visual.contentChildren.filter((a)=>d.isTopicShapeObject(a));const n=a.is(E.planetTopic)?a.surface.contentChildren.filter((a)=>d.isTopicShapeObject(a)):[],{firstAboveShape:q,firstBelowShape:r}=this.getEditorsAboveAndBelowTopicShapes(a),
p=this.findMatchingObject([...l,...n],b.objects),u=a.zoomLayoutBox.asReferenceFrame,t=[],v=this.variantAndAreaHelper.getAABBAnchorBoxFromTopicShapeDescriptors(b,a.zoomLayoutBox.asReferenceFrame);p.matches.forEach((a,b)=>{this.updateShapeObject(b,a);this.positionObject(b,a.layoutBox.withReferenceFrame(u),v,m)});const w=a.is(E.planetTopic)&&n.length>l.length?a.surface:a.visual,x=p.descToEditor;p.toCreate.forEach((a)=>{const b=this.createShapeObject(w,a);this.updateShapeObject(b,a);this.positionObject(b,
a.layoutBox.withReferenceFrame(u),v,m);x.set(a,b);t.push(b)});0<t.length&&(l=c.lookup.findAll(f.base.ObjectKind.arc),b=l.filter((a)=>null!=a.connectorEnd&&a.connectorEnd.is(f.base.ObjectKind.simpleObject)&&p.toDelete.has(a.connectorEnd)),l=l.filter((a)=>null!=a.connectorStart&&a.connectorStart.is(f.base.ObjectKind.simpleObject)&&p.toDelete.has(a.connectorStart)),b.forEach((a)=>a.connectorEnd=t[0]),l.forEach((a)=>a.connectorStart=t[0]));this.ensureZOrder(t,q,r);this.positionNonTopicShapeObjects(a,
z,B);a.is(E.planetTopic)&&(this.helper.applyOnTopicZoomArea(a,z,B,(a,b)=>this.helper.fitZoomArea(a,b,this.createFitter(c))),a.topicChildren.forEach((a)=>{a.fitInto(a.layoutBox.align(z.topLeft,z.topRight,B.topLeft,B.topRight))}));0<g.length&&this.topicColorManager.updateColorOnTopic(c,a,g,e);a.fitInto(k);return Array.from(p.toDelete).filter((a)=>!a.is(E.slide))}getEditorsAboveAndBelowTopicShapes(a){const b=h.EditorCommander.createLayoutQuery();var c=[...a.simpleChildren(f.base.ChildVisibilityKind.all)];
a.is(f.base.ObjectKind.stackTopic)&&(c=c.concat(u.Utils.flatten(a.pageChildren.map((a)=>a.simpleChildren(f.base.ChildVisibilityKind.all)))));a=c.sort((a,b)=>a.isAbove(b)?-1:1);c=a.findIndex((a)=>!b.isTopicShapeObject(a));const d=a.findIndex((a)=>b.isTopicShapeObject(a)),e=a.slice(d).findIndex((a)=>!b.isTopicShapeObject(a))+d;return{firstAboveShape:c<d?a[d-1]:null,firstBelowShape:e<a.length?a[e]:null}}positionNonTopicShapeObjects(a,b,c){const d=h.EditorCommander.createLayoutQuery();a.is(E.planetTopic)&&
a.simpleChildren(f.base.ChildVisibilityKind.all).filter((a)=>!d.isTopicShapeObject(a)).forEach((a)=>{const d=a.layoutBox.align(b.topLeft,b.topRight,c.topLeft,c.topRight);a.fitInto(d)})}positionObject(a,b,c,d){b=b.align(c.topLeft,c.topRight,d.topLeft,d.topRight);a.is(E.text)&&a.wrap(b.size.width/b.size.height,!1);a.fitInto(b)}createShapeObject(a,b){let c;switch(b.objectKind){case E.pdf:c=a.add.pdf(b.pdfAsset);break;case E.image:c=a.add.image(b.imageAsset);break;case E.shape:c=a.add.shape(b.shapeKind,
b.shapeStyle);c.height=b.layoutBox.size.height;c.width=b.layoutBox.size.width;break;case E.text:c=a.add.text(),c.setText(b.text),c.isPlaceholder=b.isPlaceholder}this.isVisual(c)?c.visualLayoutRole=f.base.VisualLayoutRole.topicShape:this.isSurface(c)&&(c.surfaceLayoutRole=f.base.SurfaceLayoutRole.surfaceTopicShape);return c}updateShapeObject(a,b){switch(b.objectKind){case E.pdf:a.pdfAsset=b.pdfAsset;a.filterStyle!==b.filterStyle&&(a.filterStyle=b.filterStyle);a.applyPresetStyle();null!=b.colorFilter&&
(a.colorFilter=b.colorFilter);break;case E.image:a.imageAsset=b.imageAsset;a.filterStyle!==b.filterStyle&&(a.filterStyle=b.filterStyle);a.applyPresetStyle();null!=b.colorFilter&&(a.colorFilter=b.colorFilter);break;case E.shape:a.shapeStyle!==b.shapeStyle&&(a.shapeStyle=b.shapeStyle);a.applyPresetStyle();null!=b.border&&(a.border=b.border);null!=b.colorFilter&&(a.colorFilter=b.colorFilter);null!=b.fill&&(a.fill=b.fill);break;case E.text:this.updateTextObject(a,b)}this.isVisual(a)?a.visualLayoutRole=
f.base.VisualLayoutRole.topicShape:this.isSurface(a)&&(a.surfaceLayoutRole=f.base.SurfaceLayoutRole.surfaceTopicShape)}updateTextObject(a,b){a.applyPresetStyle();a.setAllCharacterProps(b.characterProps);a.setAllParagraphProps(b.paragraphProps);null!=a.background&&(a.background=b.background)}findMatchingObject(a,b){const c=new Set(a),d=new Map,e=[],g=new Map;b.forEach((a)=>{let b=!1;const k=this.findMatchable(c,a);null!=k&&(d.set(k,a),g.set(a,k),c.delete(k),b=!0);b||e.push(a)});return{toDelete:c,matches:d,
toCreate:e,descToEditor:g}}findMatchable(a,b){for(const c of a.values())if(this.isMatchable(c,b))return c;return null}isMatchable(a,b){return b.objectKind===E.shape?a.is(E.shape)&&a.shapeKind===b.shapeKind:a.is(b.objectKind)}ensureZOrder(a,b,c){if(null!=b){let c=b;a.forEach((a)=>{a.moveBehind(c);c=a})}else null!=c&&a.forEach((a)=>a.moveAbove(c))}isVisual(a){return a.parent.is(E.visual)}isSurface(a){return a.parent.is(E.surface)}createFitter(){return new class{fitInto(a,b){a.fitInto(b)}fitZoomArea(a,
b){a.fitZoomAreaIntoLayoutBox(b)}}}};var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});var Pb=f.base.editorIs;Ua.CoverLayoutCommander=class{constructor(a,b,c,d){this.layoutRepository=a;this.colorMixCommander=b;this.variantAndAreaHelper=c;this.helper=d;this.coverLayoutApplicator=new Ta.CoverLayoutApplicator(a,this.variantAndAreaHelper,this.helper)}changeTopicCoverOnAllTopicsCmd(a){return{name:"changeTopicCoverOnAllTopics",run:(b)=>{if(null==b.styleSheet.colorPaletteId&&na.isActive("js-disable-filterstyle-conversion")){const a=
this.colorMixCommander.createMapping(this.colorMixCommander.paletteFromPrezi(b.styleSheet));this.colorMixCommander.applyShapeStyles(a).run(b)}this.changeTopicCover(b.overview.id,a,"all",b);for(let c of b.lookup.findAll(f.base.ObjectKind.planetTopic))this.changeTopicCover(c.id,a,"all",b)}}}changeTopicCover(a,b,c,d){var e=this.ensurePlanetOrOverview(a,d);a=[e,...e.topicChildren].filter(Pb(f.base.ObjectKind.topicParent)).filter((a)=>a.layout.isValid());e=e.topicChildren.map((a,b)=>({editor:a,idx:b,layoutBox:a.layoutBox}));
e="all"===c?e:e.filter((a)=>0<=c.indexOf(a.editor.id));const g=h.EditorCommander.createLayoutQuery();e=e.filter((a)=>g.hasTopicShapeObject(a.editor));let k=[];for(let a=0;a<e.length;++a){const c=e[a].editor;g.hasTopicShapeObject(c)&&(k=[...k,...this.coverLayoutApplicator.applyCoverLayout(c,b.variants[e[a].idx%b.variants.length],d)],c.coverLayoutId=b.id)}this.removeEditors(k);a.forEach((a)=>a.layout.reset())}getCoverLayoutId(a,b,c){a=b.lookup.base(a);return(a.is(f.base.ObjectKind.planetTopic)||a.is(f.base.ObjectKind.overview))&&
0<a.topicChildren.length?a.topicChildren[0].coverLayoutId:a.is(f.base.ObjectKind.planetTopic)?a.coverLayoutId:c?(c=this.layoutRepository.getDefaultTopicShapeLayoutInfo(),null!=c?c.id:null):null}removeEditors(a){0<a.length&&a[0].createLayoutGroupWith(a.slice(1)).delete()}ensurePlanetOrOverview(a,b){b=b.lookup.base(a);if(!b.is(f.base.ObjectKind.overview)&&!b.is(f.base.ObjectKind.planetTopic))throw Error("Not a planet or overview editor: "+a);return b}};var Va={};Object.defineProperty(Va,"__esModule",
{value:!0});Va.OverviewLayoutCommander=class{constructor(a,b,c){this.layoutRepository=a;this.positionFinder=b;this.helper=c}overviewLayoutIsValid(a,b){return a!==b.layout.id?!1:this.areElementsInLayoutPosition(b,[])}handleOverviewLayoutEvent(a,b,c){switch(c.kind){case f.base.TopicLayoutEventKind.reset:this.applyLayout(a,b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.adjust:this.areElementsInLayoutPosition(c.parent,c.topics.map((a)=>a.id))&&this.applyLayout(a,b,c.parent,
c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.remove:if(this.areElementsInLayoutPosition(c.parent,[])){const d=c.parent.topicChildren.filter((a)=>0>c.toBeRemoved.indexOf(a));this.applyLayout(a,b,c.parent,d)}break;default:u.Utils.assertNever(c)}}areElementsInLayoutPosition(a,b){var c=a.layout.id;if(this.layoutRepository.hasOverviewLayout(c)){c=this.layoutRepository.getOverviewLayout(c);var d=a.topicChildren.filter((a)=>0>b.indexOf(a.id));const e=Math.min(d.length,c.variants.length-
1);c=c.variants.find((a)=>a.subtopicLayoutBoxes.length===e);const g=d.slice(0,e);d=a.zoomLayoutBox;const k=c.anchorLayoutBox.withReferenceFrame(d.referenceFrame),h=c.subtopicLayoutBoxes.every((b,c)=>{c=g[c];b=b.withReferenceFrame(a.zoomLayoutBox.referenceFrame).align(k.topLeft,k.topRight,a.zoomLayoutBox.topLeft,a.zoomLayoutBox.topRight);return this.helper.areLayoutBoxesClose(c.layoutBox,b,1E-5)}),B=a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&"title"===a.textStyle),m=a.contentChildren.find((a)=>
a.is(f.base.ObjectKind.text)&&("subtitle"===a.textStyle||"subtitle_2"===a.textStyle)),l=c.titles.find((a)=>"title"===a.style);c=c.titles.find((a)=>"subtitle"===a.style||"subtitle_2"===a.style);return h&&this.checkTextPos(B,l,d,k)&&this.checkTextPos(m,c,d,k)}return!1}checkTextPos(a,b,c,d){if(null==a)return!0;b=b.area.withReferenceFrame(c.referenceFrame).align(d.topLeft,d.topRight,c.topLeft,c.topRight);return this.helper.areLayoutBoxesClose(a.layoutBox.union(b),b,1E-5)}applyLayout(a,b,c,d){const e=
Math.min(d.length,a.variants.length-1);a=a.variants.find((a)=>a.subtopicLayoutBoxes.length===e);const g=d.slice(0,e);d=d.slice(e);this.applyVariant(c,g,a,b);for(let a of d)b.fitInto(a,this.positionFinder.findTopicPosition(a,g)),g.push(a)}applyVariant(a,b,c,d){const e=a.zoomLayoutBox,g=c.anchorLayoutBox.withReferenceFrame(e.referenceFrame);c.subtopicLayoutBoxes.forEach((a,c)=>{c=b[c];a=a.withReferenceFrame(e.referenceFrame).align(g.topLeft,g.topRight,e.topLeft,e.topRight);d.fitInto(c,a)});const k=
a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&"title"===a.textStyle);a=a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&("subtitle"===a.textStyle||"subtitle_2"===a.textStyle));const h=c.titles.find((a)=>"title"===a.style);c=c.titles.find((a)=>"subtitle"===a.style||"subtitle_2"===a.style);this.applyTitle(k,h,d,e,g);this.applyTitle(a,c,d,e,g)}applyTitle(a,b,c,d,e){var g;if(null!=a&&a.is(f.base.ObjectKind.text)){var k=new sa.TextLayouter((a,b)=>c.fitSelectionBoxInto(a,b),(a)=>c.getSelectionBox(a),
(a,b)=>c.setWrapWidth(a,b),(a,b,d)=>c.wrap(a,b,d),(a,b)=>c.fitInto(a,b),(a,b)=>c.setBackground(a,b),(a)=>c.removeBackground(a));k.styleText(a,b.hasBackground?{kind:"background",cornerRadius:null!==(g=b.backgroundCornerRadius)&&void 0!==g?g:0}:{kind:"noBackground"});d=b.area.withReferenceFrame(d.referenceFrame).align(e.topLeft,e.topRight,d.topLeft,d.topRight);k.positionTextElement(b.anchor,b.area.rotation,a,d)}}};var Wa={};Object.defineProperty(Wa,"__esModule",{value:!0});Wa.LayoutCommanderImpl=class{constructor(a,
b,c){this.layoutRepository=b;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.LayoutCommanderImpl");this.helper=new Oa.LayoutHelper;this.variantAndAreaHelper=new Pa.VariantAndAreaHelper(this.helper);this.contentLayoutCommander=new Qa.ContentLayoutCommander(b,this.variantAndAreaHelper,this.helper);this.planetLayoutCommander=new Ra.PlanetLayoutCommander(b,c,this.helper);this.overviewLayoutCommander=new Va.OverviewLayoutCommander(b,c,this.helper);this.coverLayoutCommander=
new Ua.CoverLayoutCommander(b,a,this.variantAndAreaHelper,this.helper)}handlePlanetLayoutEvent(a,b,c){this.planetLayoutCommander.handlePlanetLayoutEvent(a,b,c)}isValid(a,b){return this.planetLayoutCommander.areSubtopicsInLayoutPosition(b,[])}areSubtopicsInLayoutPosition(a,b){return this.planetLayoutCommander.areSubtopicsInLayoutPosition(a,b)}changeTopicCoverOnAllTopicsCmd(a){return this.coverLayoutCommander.changeTopicCoverOnAllTopicsCmd(a)}handleTopicThemeApplication(a,b,c){this.coverLayoutCommander.changeTopicCover(b.parent.id,
c,[b.id],a)}changeContentLayout(a,b,c){return this.contentLayoutCommander.changeContentLayout(a,b,c)}categorizeContentChildren(a){return this.contentLayoutCommander.categorizeContentChildren(a)}calculateContentArea(a){return this.contentLayoutCommander.calculateContentArea(a)}isContentLayoutValid(a,b){return this.contentLayoutCommander.isContentLayoutValid(a,b)}overviewLayoutIsValid(a,b){return this.overviewLayoutCommander.overviewLayoutIsValid(a,b)}handleOverviewLayoutEvent(a,b,c){this.overviewLayoutCommander.handleOverviewLayoutEvent(a,
b,c)}wrapIntoNewTopicCmd(a){return{name:"wrapIntoNewTopicCmd",run:(b)=>{var c=b.lookup.planetTopic(a);const d=this.planetLayoutCommander.getMostCommonSubtopicLayoutId(b,c.parent.id),e=c.layoutBox,g=c.parent;var k=g.topicChildren.indexOf(c)+1;k=g.add.planet(k,c.theme);c.parent=k;k.applyLayout(d);k.fitInto(e);c=this.coverLayoutCommander.getCoverLayoutId(g.id,b,!0);this.layoutRepository.hasTopicShapeLayout(c)&&(c=this.layoutRepository.getTopicShapeLayout(c),this.coverLayoutCommander.changeTopicCover(g.id,
c,"all",b));return k.id}}}};var ta={};Object.defineProperty(ta,"__esModule",{value:!0});var M=f.base.ObjectKind,Cb=f.base.CoverLayoutRole,Xa=f.base.VisualLayoutRole,Db=f.base.ContentLayoutRole;ta.LayoutQueryImpl=class{constructor(){}getLayoutRole_SceneApi(a,b){b=a.getEntityById(b);if(null==b)return w.CetModel.nilDef();b=b.get(w.CetModel.ID.TOPIC_CHILD.CHILD_PARENT);if(null==b||0===b.length)return w.CetModel.nilDef();a=a.getEntityById(b[0]);if(null==a)return w.CetModel.nilDef();a=a.getWrapper(w.CetModel.ID.TOPIC_CHILD.W).getBehaviour();
return a.is(w.CetModel.ID.COVER)||a.is(w.CetModel.ID.VISUAL)||a.is(w.CetModel.ID.CONTENT)?(a=a.getLayoutRole(),null!=a?a.getEntity().getDef():w.CetModel.nilDef()):w.CetModel.nilDef()}getLayoutRole(a,b){a=a.lookup.simpleObject(b).parent;if(a.is(M.cover))switch(a.contentChildren.find((a)=>a.id===b).coverLayoutRole){case Cb.coverIcon:return w.CetModel.ID.COVER_ICON;case Cb.coverTitle:return w.CetModel.ID.COVER_TITLE}else if(a.is(M.visual))switch(a.contentChildren.find((a)=>a.id===b).visualLayoutRole){case Xa.visualAnchor:return w.CetModel.ID.VISUAL_ANCHOR;
case Xa.slideAnchor_16_9:return w.CetModel.ID.SLIDE_ANCHOR_16_9;case Xa.slideAnchor_4_3:return w.CetModel.ID.SLIDE_ANCHOR_4_3}else if(a.is(M.planetTopic))switch(a.contentChildren.find((a)=>a.id===b).contentLayoutRole){case Db.contentTitle:return w.CetModel.ID.CONTENT_TITLE;case Db.contentIcon:return w.CetModel.ID.CONTENT_ICON}return w.CetModel.nilDef()}hasTopicShapeObject(a){return[...a.visual.contentChildren,...a.is(M.planetTopic)?a.surface.contentChildren:[]].some((a)=>this.isTopicShapeObject(a))}isTopicShapeObject(a){return f.CetModelEditor.isTopicShapeObjectKILLME(a)}getMostCommonLayout(a,
b,c,d=null){a=a.lookup.base(b);if(null==a||!a.is(M.topic)&&!a.is(M.overview))return null;b=[];a.is(M.topic)&&b.push(a);(a.is(M.planetTopic)||a.is(M.overview))&&b.push(...a.topicChildren);b=b.filter((a)=>this.hasTopicShapeObject(a));if(0===b.length)return null;let e=-Infinity;const g=new Map;let k;b.forEach((a)=>{var b;if(null==d||d(a))a=c(a),null!=a&&(g.set(a,(null!==(b=g.get(a))&&void 0!==b?b:0)+1),g.get(a)>e&&(e=g.get(a),k=a))});return k}isSortedBySlideIdx(a){let b=-1;return a.topicChildren.every((a)=>
{a=this.getSlideTopicIndex(a);if(-1===a||a<b)return!1;b=a;return!0})}getSlideTopicIndex(a){return a.is(M.planetTopic)?(a=[...a.visual.contentChildren.filter((a)=>a.is(M.slide)),...a.contentChildren.filter((a)=>a.is(M.slide))],0<a.length?a[0].slideAsset.sourcePageNumber:-1):-1}findPositionBySlideIndex(a,b){b=b.topicChildren;for(let c=0;c<b.length;++c){const d=this.getSlideTopicIndex(b[c]);if(a<d)return c}return b.length}};var Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});var v=f.base.ObjectKind,
ua=f.base.FillKind,va=f.base.ColorFilterKind;Ya.ColorGroupImpl=class{constructor(a,b){this.items=b;this.helper=new Qb(a)}size(){return this.items.length}editorIds(){return this.items.map((a)=>a.id)}addObjects(a){this.items=this.items.concat(a)}getMainColors(){const a=[];this.items.forEach((b)=>{const c=this.getMainColorOfObject(b);null==c||a.some((a)=>this.helper.colorEquals(a,c.color))||a.push(c.color)});return a}getPresets(){const a=[];this.items.forEach((b)=>{b=this.getMainColorOfObject(b);null!=
b&&a.push({styleEnum:b.styleEnum,styleClass:b.styleClass})});return a}applyColor(a,b){this.items.forEach((c)=>{switch(c.kind){case v.arrow:case v.line:null==c.arcStyle||null==a||!b&&this.helper.colorEquals(c.fill,a)||(c.fill=a);break;case v.shape:if(null!=c.shapeStyle&&null!=a){var d=this.getMainColorFromFillData(c.fill);if(b||!this.helper.colorEquals(d,a))c.fill=this.setMainColorOnFillData(c.fill,a)}break;case v.chart:case v.pdf:case v.swf:case v.image:if(d=this.getMainColorFromFilter(c.colorFilter),
b||!this.helper.colorEquals(d,a))c.colorFilter=null==a?{kind:va.noColorFilter}:{kind:va.solidColorBlend,color:a}}})}setPresets(a){this.items.forEach((b)=>{switch(b.kind){case v.arrow:case v.line:null!=b.arcStyle&&null!=a.arcStyle&&(b.arcStyle=a.arcStyle);break;case v.shape:null!=b.shapeStyle&&null!=a.shapeStyle&&(b.shapeStyle=a.shapeStyle);break;case v.chart:case v.pdf:case v.swf:case v.image:null!=b.filterStyle&&u.isFromEnum(b.filterStyle,f.base.FullBlendShapelikeFilterStyle)&&null!=a.fullBlendFilterStyle?
b.filterStyle=a.fullBlendFilterStyle:b.filterStyle=a.filterStyle}})}applyPresets(){this.items.forEach((a)=>{switch(a.kind){case v.arrow:case v.line:null!=a.arcStyle&&a.applyPresetStyle();break;case v.shape:null!=a.shapeStyle&&a.applyPresetStyle();break;case v.chart:case v.pdf:case v.swf:case v.image:a.applyPresetStyle()}})}getMainColorOfObject(a){switch(a.kind){case v.arrow:case v.line:return null!=a.arcStyle?{color:a.fill,styleEnum:f.base.ArcStyle,styleClass:a.arcStyle}:null;case v.shape:return null!=
a.shapeStyle?{color:this.getMainColorFromFillData(a.fill),styleEnum:f.base.ShapeStyle,styleClass:a.shapeStyle}:null;case v.chart:case v.pdf:case v.swf:case v.image:return qb(a.filterStyle)?{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.ShapelikeFilterStyle,styleClass:qb(a.filterStyle)?a.filterStyle:null}:null!=a.filterStyle&&u.isFromEnum(a.filterStyle,f.base.FullBlendShapelikeFilterStyle)?{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.FullBlendShapelikeFilterStyle,
styleClass:a.filterStyle}:{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.ShapelikeFilterStyle,styleClass:null};default:return null}}getMainColorFromFillData(a){return a.fillKind===ua.linear?a.startColor:a.color}getMainColorFromFilter(a){return a.kind===va.solidColorBlend?a.color:null}setMainColorOnFillData(a,b){return a.fillKind===ua.linear?Object.assign(Object.assign({},a),{startColor:Object.assign(Object.assign({},a.startColor),b)}):Object.assign(Object.assign({},a),{color:Object.assign(Object.assign({},
a.color),b)})}};class Qb{constructor(a){this.api=a;this.styleSheetsCache=null}colorEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&a.r===b.r&&a.g===b.g&&a.b===b.b}getColorableVisualObjects(a){let b=[];a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside).forEach((a)=>{switch(a.kind){case v.arrow:case v.line:null!=a.arcStyle&&b.push(a);break;case v.shape:if(this.isVisual(a)&&a.visualLayoutRole===f.base.VisualLayoutRole.visualAnchor&&this.isShapeTransparent(a.fill))break;null!=a.shapeStyle&&
b.push(a);break;case v.chart:case v.image:case v.pdf:case v.swf:b.push(a)}});return b}isVisual(a){return a.parent.is(v.visual)}getColorsForStyle(a){this.cacheStyleSheetsIfNeeded();let b=null;switch(a){case f.base.ArcStyle:return b=(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{arcStyle:a}}),[b(f.base.ArcStyle.Line1),b(f.base.ArcStyle.Line2),b(f.base.ArcStyle.Line3),b(f.base.ArcStyle.Line4),b(f.base.ArcStyle.Line5)];case f.base.ShapeStyle:return b=(a)=>({color:this.getColorFromStyleDeclaration(a),
styes:{shapeStyle:a}}),[b(f.base.ShapeStyle.Poly1),b(f.base.ShapeStyle.Poly2),b(f.base.ShapeStyle.Poly3),b(f.base.ShapeStyle.Poly4),b(f.base.ShapeStyle.Poly5)];case f.base.ShapelikeFilterStyle:return b=(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{filterStyle:a}}),[b(f.base.ShapelikeFilterStyle.Filter1),b(f.base.ShapelikeFilterStyle.Filter2),b(f.base.ShapelikeFilterStyle.Filter3),b(f.base.ShapelikeFilterStyle.Filter4),b(f.base.ShapelikeFilterStyle.Filter5)];case f.base.FullBlendShapelikeFilterStyle:return b=
(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{fullBlendFilterStyle:a}}),[b(f.base.FullBlendShapelikeFilterStyle.Filter1),b(f.base.FullBlendShapelikeFilterStyle.Filter2),b(f.base.FullBlendShapelikeFilterStyle.Filter3),b(f.base.FullBlendShapelikeFilterStyle.Filter4),b(f.base.FullBlendShapelikeFilterStyle.Filter5)];default:return[]}}getColorFromStyleDeclaration(a){this.cacheStyleSheetsIfNeeded();a=this.styleSheetsCache.get(a);if(null==a)return null;const b=a.styleBlock.fill;return null!=a.styleBlock.colorFilter&&
a.styleBlock.colorFilter.kind===va.solidColorBlend?a.styleBlock.colorFilter.color:null==b?null:b.fillKind===ua.solid?Object.assign(Object.assign({},b.color),{a:b.alpha}):Object.assign(Object.assign({},b.gradientStartColor),{a:b.gradientStartAlpha})}cacheStyleSheetsIfNeeded(){null==this.styleSheetsCache&&(this.styleSheetsCache=new Map,this.api.styleSheet.styleSheets.forEach((a)=>{null!=a.className&&this.styleSheetsCache.set(a.className,a)}))}isShapeTransparent(a){return a.fillKind===ua.solid?0===a.color.a:
0===a.startColor.a&&0===a.endColor.a}}var Za={};Object.defineProperty(Za,"__esModule",{value:!0});var wa=f.base.ObjectKind;Za.TemplateCommanderImpl=class{setTemplateDataCmd(a){return{name:"Set template data",run:(b)=>{b.meta.templateInfo={templateId:a}}}}removeIdStyleClassesFromCoversCmd(){return{name:"Remove id",run:(a)=>{a.lookup.findAll(wa.styled).forEach((a)=>{a.is(wa.simpleObject)&&a.parent.is(wa.cover)&&a.applyPresetStyle()})}}}updateTextPlaceholdersCmd(a){return{name:"Update text placeholders",
run:(b)=>{b.lookup.findAll(wa.text).forEach((c)=>{c.isPlaceholder&&(c.setText(a),b.toDecorator(c).updateFontToSupportCurrentLanguage())})}}}updateThemeIdsAndMergeCmd(a,b,c){return{name:"updateThemeIdsAndMergeCmd",runLegacy:(d)=>{p.avro.Avro.createDefaultLogger().logNewObject({object_type:"BACKGROUND",topic_relationship:"CONTENT",parent_type:"OVERVIEW",object_id:d.mscene.getPreziW().getBackground().getId()});this.setTemplateDataCmd(a).run(d.api);d.documentMerge(b,c)}}}};var $a={};Object.defineProperty($a,
"__esModule",{value:!0});$a.TemplateChooserAppEditorImpl=class{constructor(a){this.runner=a}get template(){null==this._template&&(this._template=new Za.TemplateCommanderImpl);return this._template}get scene(){return this.runner.scene}beginAsyncApiCommand(a,b){return this.runner.beginAsyncApiCommand(a,b)}executeApiCommand(a,b){return this.runner.executeApiCommand(a,b)}executeLegacyCommand(a,b){return this.runner.executeLegacyCommand(a,b)}read(a){return this.runner.read(a)}};var D={};Object.defineProperty(D,
"__esModule",{value:!0});var R=f.base.ChildVisibilityKind,x=f.base.ObjectKind,ha;(function(a){a.generalEntitySnap="generalEntitySnap";a.fontSizeSnap="fontSizeSnap";a.topicZoomAreaSnap="topicZoomAreaSnap";a.overviewSnap="overviewSnap"})(ha=D.SnapIntentionKind||(D.SnapIntentionKind={}));class Rb{constructor(){}calculateReferenceEditors(a,b){let c;switch(b.kind){case ha.generalEntitySnap:c=this.calculateReferenceEditorsGeneralEntity(a,b.originalEditorIds,b.coverEditApi.getMode(a));break;case ha.topicZoomAreaSnap:c=
this.calculateReferenceEditorsForTopicZoomArea(a,b.topicId,b.coverEditApi.getMode(a));break;case ha.overviewSnap:c=[...a.overview.topicChildren,...a.overview.contentChildren];break;case ha.fontSizeSnap:c=this.calculateReferenceEditorsForFontSize(a,b.originalEditorId,b.coverEditApi.getMode(a));break;default:u.Utils.assertNever(b)}a=[];for(let d of c)if(this.isVisibleOnScreen(d.layoutBox,b.cameraAccess)&&a.push(d),42<a.length)return[];return a}calculateReferenceZoomLayoutBox(a,b){return this.isZoomAreaVisible(b.coverEditApi.getMode(a))?
(a=this.calculateReferenceZoomLayoutBoxGeneralEntity(a,b.originalEditorIds),null!=a&&this.isVisibleOnScreen(a,b.cameraAccess)?a:null):null}calculateReferenceEditorsForTopicZoomArea(a,b,c){a=a.lookup.base(b);let d;a.is(x.topic)&&(d=a.simpleChildren(this.getChildVisibility(c)));this.getChildVisibility(c)===R.inside&&(a.is(x.page)?d=[...d,...a.parent.simpleChildren(R.inside)]:a.is(x.planetTopic)&&(d=[...d,...a.topicChildren]));return d}calculateReferenceEditorsGeneralEntity(a,b,c){if(0===b.length)return null;
const d=b.map((b)=>a.lookup.transformedObject(b))[0].parent;let e=[];d.is(x.topicParent)&&e.push(...d.topicChildren);switch(d.kind){case x.planetTopic:e.push(...d.simpleChildren(R.inside));break;case x.page:e.push(...d.simpleChildren(R.inside),...d.parent.simpleChildren(R.inside));break;case x.cover:case x.master:e.push(...d.parent.simpleChildren(this.getChildVisibility(c)));break;case x.surface:case x.visual:e.push(...d.parent.simpleChildren(this.getChildVisibility(c)));this.getChildVisibility(c)===
R.inside&&d.parent.is(x.planetTopic)&&e.push(...d.parent.topicChildren);break;case x.overview:e.push(...d.simpleChildren(R.inside));break;default:u.Utils.assertNever(d)}return e.filter((a)=>-1===b.indexOf(a.id))}calculateReferenceEditorsForFontSize(a,b,c){var d=a.lookup.transformedObject(b);if(!d.is(f.base.ObjectKind.text))return null;a=this.calculateReferenceEditorsGeneralEntity(a,[b],c).filter((a)=>a.is(f.base.ObjectKind.text));d=this.getNeighborTopicCoverTexts(d);return[...a,...d]}getNeighborTopicCoverTexts(a){let b=
[];a=a.parent;switch(a.kind){case x.cover:case x.surface:case x.visual:const c=a.parent;a=c.parent;a.kind!==x.planetTopic&&a.kind!==x.overview||b.push(...a.contentChildren);c.parent.topicChildren.filter((a)=>a.id!==c.id).forEach((a)=>{b.push(...a.cover.contentChildren,...a.visual.contentChildren);a.is(x.planetTopic)&&b.push(...a.surface.contentChildren)});break;case x.overview:case x.planetTopic:a.topicChildren.forEach((a)=>{b.push(...a.cover.contentChildren,...a.visual.contentChildren);a.is(x.planetTopic)&&
b.push(...a.surface.contentChildren)});break;case x.page:case x.master:break;default:u.Utils.assertNever(a)}return b.filter((a)=>a.is(f.base.ObjectKind.text))}calculateReferenceZoomLayoutBoxGeneralEntity(a,b){b=b.map((b)=>a.lookup.transformedObject(b));if(0===b.length)return null;const c=b[0].parent;switch(c.kind){case x.cover:case x.master:case x.surface:case x.visual:case x.page:return c.parent.zoomLayoutBox;case x.planetTopic:return c.zoomLayoutBox.withReferenceFrame(b[0].layoutBox.referenceFrame);
case x.overview:return a.overview.zoomLayoutBox.withReferenceFrame(b[0].layoutBox.referenceFrame);default:u.Utils.assertNever(c)}}isVisibleOnScreen(a,b){b=b.getScreenLayoutBox();return a.intersects(b)}getChildVisibility(a){switch(a.kind){case L.CoverEditModeKind.None:return null;case L.CoverEditModeKind.Advanced:case L.CoverEditModeKind.Title:return R.outside;case L.CoverEditModeKind.InsideAdvanced:return R.inside;default:return u.Utils.assertNever(a)}}isZoomAreaVisible(a){switch(a.kind){case L.CoverEditModeKind.Advanced:case L.CoverEditModeKind.InsideAdvanced:case L.CoverEditModeKind.None:return!0;
case L.CoverEditModeKind.Title:return!1;default:return u.Utils.assertNever(a)}}}D.SnapFilter=Rb;var q={};Object.defineProperty(q,"__esModule",{value:!0});var P=f.base.AnchorPoint,S;(function(a){a.topOnly="topOnly";a.bottomOnly="bottomOnly";a.topAndBottom="topAndBottom";a.all="all"})(S=q.BaselineSegmentStrategy||(q.BaselineSegmentStrategy={}));q.noSnapResultData={translationVector:n.Geometry.fromPoint({x:0,y:0}),snapResults:[]};class V{static getFixPoint(a,b){return b?P.center:{rx:-a.rx,ry:-a.ry}}static getReferenceSegments(a,
b,c){const d=new D.SnapFilter;var e=d.calculateReferenceEditors(a,c).filter((a)=>this.filterByRotation(a.layoutBox,b,c.cameraAccess));e=V.getReferenceSegmentsFromEditor(e,c.cameraAccess);c.kind===D.SnapIntentionKind.generalEntitySnap&&(a=d.calculateReferenceZoomLayoutBox(a,c),null!=a&&this.filterByRotation(a,b,c.cameraAccess)&&e.push(...V.getReferenceSegmentsFromLayoutBox(a,c.cameraAccess).map((a)=>Object.assign(Object.assign({},a),{ownerId:"lb"}))));return e}static getAllAlignSnapResultsOnAxis(a,
b){if(0===a.length)return q.noSnapResultData;b=b.filter((b)=>V.isTwoLinesParallel(b.P,b.Q,a[0].P,a[0].Q));if(0===b.length)return q.noSnapResultData;b=b.map((b)=>{const c=a.map((a)=>{const c=V.getTranslationVector(b,a);return{referenceSegment:b,subjectSegment:a,translationVector:c}}).filter((a)=>null!=a.translationVector);return 0===c.length?null:c.reduce((a,b)=>a.translationVector.length()<b.translationVector.length()?a:b)}).filter((a)=>null!=a).sort((a,b)=>a.translationVector.length()-b.translationVector.length());
const c=b[0];b=b.filter((a)=>.001>Math.abs(a.translationVector.getX()-c.translationVector.getX())&&.001>Math.abs(a.translationVector.getY()-c.translationVector.getY())).map((a)=>({kind:h.SnapResultKind.Align,referenceSegment:a.referenceSegment,subjectSegment:{P:n.Geometry.fromPoint(a.subjectSegment.P).add(a.translationVector).toPoint(),Q:n.Geometry.fromPoint(a.subjectSegment.Q).add(a.translationVector).toPoint()},originalSubjectSegment:a.subjectSegment}));return{translationVector:c.translationVector,
snapResults:b}}static filterByRotation(a,b,c){const d=Math.PI/2;a=(a.withReferenceFrame(c.getScreenLayoutBox().referenceFrame).rotationRad%d+d)%d;b=(b%d+d)%d;return.01>Math.abs(a-b)||Math.abs(a-b)>d-.01}static getReferenceSegmentsFromEditor(a,b){const c=[];a.forEach((a)=>{var d=a.layoutBox.withReferenceFrame(b.getScreenLayoutBox().referenceFrame);d=(a.is(f.base.ObjectKind.text)?xa.getSegmentsForText(a,d):xa.getSegments(d)).filter((a)=>V.isSegmentVisibleOnScreen(b,a));c.push(...d.map((b)=>Object.assign(Object.assign({},
b),{owerId:a.id})))});return c}static getReferenceSegmentsFromLayoutBox(a,b){return xa.getSegments(a.withReferenceFrame(b.getScreenLayoutBox().referenceFrame)).filter((a)=>V.isSegmentVisibleOnScreen(b,a))}static isTwoLinesParallel(a,b,c,d){return.01>Math.abs((b.y-a.y)*(c.x-d.x)-(d.y-c.y)*(a.x-b.x))}static getIntersectionOfTwoLines(a,b,c,d){const e=b.y-a.y;b=a.x-b.x;a=e*a.x+b*a.y;const g=d.y-c.y;d=c.x-d.x;c=g*c.x+d*c.y;const k=e*d-g*b;return Math.abs(k)<Number.EPSILON?null:{x:(d*a-b*c)/k,y:(e*c-g*
a)/k}}static getTranslationVector(a,b){const c=n.Geometry.fromPoint(a.P).sub(n.Geometry.fromPoint(a.Q)).perpendicular();b=this.getIntersectionOfTwoLines(a.P,n.Geometry.fromPoint(a.P).add(c).toPoint(),b.P,b.Q);return null==b?null:n.Geometry.fromPoint(a.P).sub(n.Geometry.fromPoint(b))}static isSegmentVisibleOnScreen(a,b){a=a.getStageAreaLayoutBox();const c=a.referenceFrame.point(b.P),d=a.referenceFrame.point(b.Q);return a.contains(c)||a.contains(d)||this.doSegmentIntersectLayoutBox(b,a)}static doSegmentIntersectLayoutBox(a,
b){return null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.topLeft,b.topRight,!0)||null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.topLeft,b.bottomLeft,!0)||null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.bottomLeft,b.bottomRight,!0)||null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.bottomRight,b.topRight,!0)}static getScaleToReferenceLine(a,b,c){c=this.getIntersectionOfTwoLines(a,b,c.P,c.Q);if(null==c)return 1;c=n.Geometry.distance(b,c);a=n.Geometry.distance(b,
a);return a<Number.EPSILON?1:c/a}static scaleLayoutBoxWithAnchorPoint(a,b,c){switch(b){case P.center:case P.bottomLeft:case P.topLeft:case P.bottomRight:case P.topRight:return a.scale(c);case P.centerLeft:case P.centerRight:return a.withSize({width:a.size.width*c,height:a.size.height});case P.topCenter:case P.bottomCenter:return a.withSize({width:a.size.width,height:a.size.height*c});default:return a.scale(c)}}static calculateAngle(a,b){a=Math.abs(a-b);return a<Math.PI?a:Math.abs(a-2*Math.PI)}static referenceDistance(a,
b,c){return n.Geometry.distance(b.point({x:0,y:0}).withReferenceFrame(c),b.point({x:0,y:a}).withReferenceFrame(c))}static calculateFontSizeInScreen(a,b,c){a=b.withReferenceFrame(a.getScreenLayoutBox().referenceFrame).size.height/b.size.height;return c*a}static getSiblingsForIntention(a,b){return(new D.SnapFilter).calculateReferenceEditors(a,b)}static getSiblingsRotationsWithMirroredAngles(a,b,c,d){a=V.getSiblingsForIntention(a,{kind:D.SnapIntentionKind.generalEntitySnap,cameraAccess:b,coverEditApi:c,
originalEditorIds:d});const e=new Eb;a.forEach((a)=>{e.add(a.rotationRad,a.ref);e.add(-a.rotationRad,a.ref);e.add(a.rotationRad-Math.PI,a.ref);e.add(-a.rotationRad+Math.PI,a.ref)});return e}}q.SnapHelper=V;const Sb=[0,Math.PI/4,Math.PI/2,3*Math.PI/4,Math.PI,5*Math.PI/4,3*Math.PI/2,7*Math.PI/4];class Eb{constructor(){this.info=new Map;Sb.forEach((a)=>{this.info.set(a,[])})}add(a,b){for(;a<-Math.PI;)a+=2*Math.PI;for(;a>Math.PI;)a-=2*Math.PI;for(const c of this.info.keys())if(.001>Math.abs(c-a)){this.info.get(c).push(b);
return}a in this.info||this.info.set(a,[]);this.info.get(a).push(b)}keys(){return[...this.info.keys()]}getEntitiesWithRotation(a){var b;return null!==(b=this.info.get(a))&&void 0!==b?b:[]}}q.RotationSnapInfo=Eb;class xa{static getHorizontalSegments(a){return[{P:a.topLeft,Q:a.topRight},{P:a.centerLeft,Q:a.centerRight},{P:a.bottomLeft,Q:a.bottomRight}]}static getVerticalSegments(a){return[{P:a.topLeft,Q:a.bottomLeft},{P:a.topCenter,Q:a.bottomCenter},{P:a.topRight,Q:a.bottomRight}]}static getSegments(a){return[...this.getHorizontalSegments(a),
...this.getVerticalSegments(a)]}static getSegmentsForText(a,b){return[...this.getMiddleAndTextBaselineSegments(a,b,S.topAndBottom),...this.getVerticalSegments(b)]}static getMiddleAndTextBaselineSegments(a,b,c){return[...this.getTextBaselineSegments(a,b,c),{P:b.centerLeft,Q:b.centerRight}]}static getTextBaselineSegments(a,b,c){const d=b.size.width/a.layoutBox.size.width,e=[];c!==S.topOnly&&c!==S.topAndBottom&&c!==S.all||e.push({P:b.topLeft,Q:b.topRight});let g,k;null!=a.background?(g=(a.layoutBox.size.height-
a.glyphBox.size.height)/2,k=a.lineCount):(g=0,k=a.lineCount-1);for(let f=0;f<k;f++){const k=a.getLineMetrics(f);c===S.all&&e.push({P:{x:b.topLeft.x,y:b.topLeft.y+(g+k.ascent)*d},Q:{x:b.topRight.x,y:b.topRight.y+(g+k.ascent)*d}});g+=k.height}if(c===S.bottomOnly||c===S.topAndBottom||c===S.all)null!=a.background?e.push({P:b.bottomLeft,Q:b.bottomRight}):(a=a.getLineMetrics(a.lineCount-1),e.push({P:{x:b.topLeft.x,y:b.topLeft.y+(g+a.ascent)*d},Q:{x:b.topRight.x,y:b.topRight.y+(g+a.ascent)*d}}));return e}static getSegmentsForAnchorPointHorizontal(a,
b,c){return c?[{P:a.topLeft,Q:a.topRight},{P:a.bottomLeft,Q:a.bottomRight}]:0>b.ry?[{P:a.topLeft,Q:a.topRight}]:0<b.ry?[{P:a.bottomLeft,Q:a.bottomRight}]:[]}static getSegmentsForAnchorPointVertical(a,b,c){return c?[{P:a.topLeft,Q:a.bottomLeft},{P:a.topRight,Q:a.bottomRight}]:0>b.rx?[{P:a.topLeft,Q:a.bottomLeft}]:0<b.rx?[{P:a.topRight,Q:a.bottomRight}]:[]}}q.SegmentCalculator=xa;var W={};Object.defineProperty(W,"__esModule",{value:!0});W.UniverseLimitHelper=class{constructor(a){this.cameraAccess=a}getScaleToLimit(a,
b,c,d){c=c.map((b)=>a.toDecorator(a.lookup.transformedObject(b)));const e=this.cameraAccess.getWorldReferenceFrame(),g=1===c.length?c[0].layoutBox:c.map((a)=>a.selectionBox.aabb).reduce((a,b)=>a.union(b)),k=0===b.rx?g.withReferenceFrame(e).size.height/d.withReferenceFrame(e).size.height:g.withReferenceFrame(e).size.width/d.withReferenceFrame(e).size.width;d=u.Utils.flatten(c.map((a)=>this.getAllTopicChildren(a)));c=c.map((a)=>this.getScaleBasedOnEditorKind(a,b)*k);d=d.map((a)=>this.getScaleBasedOnEditorKind(a,
b));return Math.max(...c,...d)}getScaleBasedOnEditorKind(a,b){return a.kind===f.base.ObjectKind.arrow||a.kind===f.base.ObjectKind.line?this.getScaleArcLayoutboxToLimit(a.layoutBox):a.kind===f.base.ObjectKind.planetTopic||a.kind===f.base.ObjectKind.stackTopic?Math.max(this.getScaleLayoutboxToLimit(a.layoutBox,b),this.getScaleLayoutboxToLimit(a.zoomLayoutBox,b)*W.UniverseLimitHelper.SCALE_TO_CAMERA_ZOOM_IN_LIMIT):this.getScaleLayoutboxToLimit(a.layoutBox,b)}getDraggedZoomAreaScaleToLimit(a,b,c,d,e){b=
b.zoomLayoutBox;const g=this.cameraAccess.getWorldReferenceFrame(),k=0===d.rx?b.withReferenceFrame(g).size.height/e.withReferenceFrame(g).size.height:b.withReferenceFrame(g).size.width/e.withReferenceFrame(g).size.width;c=c.map((b)=>a.lookup.simpleObject(b));e=this.getScaleLayoutboxToLimit(e,d)*W.UniverseLimitHelper.SCALE_TO_CAMERA_ZOOM_IN_LIMIT;c=c.map((a)=>this.getScaleBasedOnEditorKind(a,d)*k);return Math.max(e,...c)}getAllTopicChildren(a){return a.kind===f.base.ObjectKind.stackTopic?[...a.simpleChildren(f.base.ChildVisibilityKind.all),
...u.Utils.flatten(a.pageChildren.map((a)=>a.simpleChildren(f.base.ChildVisibilityKind.all)))]:a.kind===f.base.ObjectKind.planetTopic?[...a.simpleChildren(f.base.ChildVisibilityKind.all),...a.topicChildren,...u.Utils.flatten(a.topicChildren.map((a)=>this.getAllTopicChildren(a)))]:[]}getScaleLayoutboxToLimit(a,b){const {x:c,y:d,width:e,height:g}=this.getLayoutBoxPositionAndSizeInWorld(a);return this.roundToTenthousandth(Math.max(Math.abs(c),Math.abs(d))/Math.min(...0===b.rx?[g]:0===b.ry?[e]:[g,e])/
1E3)}getScaleArcLayoutboxToLimit(a){const {x:b,y:c,width:d}=this.getLayoutBoxPositionAndSizeInWorld(a);return this.roundToTenthousandth(Math.max(Math.abs(b),Math.abs(c))/d/1E3)}getScaleArcToLimit(a,b){return this.roundToTenthousandth(Math.max(Math.abs(a.x),Math.abs(a.y))/b/1E3)}getLayoutBoxPositionAndSizeInWorld(a){const b=this.cameraAccess.getWorldReferenceFrame();a=a.withReferenceFrame(b);return{x:a.center.x,y:a.center.y,width:a.size.width,height:a.size.height}}roundToTenthousandth(a){return 1E-4*
Math.round(a/1E-4)}};W.UniverseLimitHelper.SCALE_TO_CAMERA_ZOOM_IN_LIMIT=10;var ab={};Object.defineProperty(ab,"__esModule",{value:!0});var Q=f.base.ObjectKind,Tb=f.basePlugin.EditorsUnderPointStrategy;ab.DragArcCommander=class{constructor(a,b){this.cameraAccess=a;this.coverEditApi=b;this.logger=p.LoggerModule.getLoggerManager().createLogger("DragArcCommander");this.logHelper=ca.AppUtilsModule.getLogHelperUtils();this.arcRotationThreshold=5;this.arcLenghtThreshold=10;this.arcPointDistanceThreshold=
15;this.universeLimitHelper=new W.UniverseLimitHelper(a)}do(a,b,c){c=this.updateState(a,b,c);b=null;const d=a.lookup.arc(c.entityId);if(null!=d&&c.kind!==h.ActionKind.Finish){const e=d.connectorStart,g=d.connectorEnd;b=this.move(a,d,c);e!==d.connectorStart&&this.connectorAction(d,!0,e,d.connectorStart);g!==d.connectorEnd&&this.connectorAction(d,!1,g,d.connectorEnd)}c.kind===h.ActionKind.Finish&&(0===c.arcAnchor.rx?(p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"BEND",
topic_relationship:d,object_id:d.id}),this.logBend(a,c)):(p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"RESIZE",topic_relationship:d,object_id:d.id}),this.logResize(a,c)));a.documentDecorator.set(A.EditorCommanderInternal.getSnapComponentKey(),this.snapAction);return{state:c,snapDestinationId:b}}connectorAction(a,b,c,d){c=null==c?"":c.id;d=null==d?"":d.id;c=null!=d?d:null!=c?c:"";this.logger.info({action:null!=d?"connect":"disconnect",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),
trigger:"control_point",payload:{head_connect_id:b?c:"",tail_connect_id:b?"":c}})}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:return c=this.cameraAccess.getScreenLayoutBox().referenceFrame,a=a.lookup.arc(b.target.entityId),{_DragArcState_:void 0,kind:b.kind,entityId:b.target.entityId,dragStartStagePosition:c.point(b.originalMouseStagePosition),mouseStagePosition:c.point(b.mouseStagePosition),snapEnabled:!1,arcAnchor:b.dragArcAnchor,rotationSnapInfo:null,arcSnapInfos:null,originalData:{distance:n.Geometry.distance(a.start,
a.end),arcHeight:a.arcHeight,rotationRad:a.rotationRad}};case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}logBend(a,b){a=a.lookup.arc(b.entityId);b={action:"modify",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),
trigger:"control_point",payload:{old_arc_height:b.originalData.arcHeight,new_arc_height:a.arcHeight,active_container:a.parent.id,object_id:a.id,multiselect_id:p.LoggerModule.getLoggerManager().generateUniqueId(),prezi_mode:"editor",modified_value:"bend",is_smart_structure:!1,is_topic_customization:a.parent.is(Q.visual)||a.parent.is(Q.cover)}};this.logger.info(b)}logResize(a,b){a=a.lookup.arc(b.entityId);b={action:"modify",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),trigger:"control_point",
payload:{old_size:b.originalData.distance,new_size:n.Geometry.distance(a.start,a.end),old_rotation:b.originalData.rotationRad,new_rotation:a.rotationRad,active_container:a.parent.id,object_id:a.id,multiselect_id:p.LoggerModule.getLoggerManager().generateUniqueId(),prezi_mode:"editor",modified_value:"resize",is_smart_structure:!1,is_topic_customization:a.parent.is(Q.visual)||a.parent.is(Q.cover)}};this.logger.info(b)}move(a,b,c){if(0===c.arcAnchor.rx&&0===c.arcAnchor.ry){var d=b.parent.zoomLayoutBox.rotateRad(b.rotationRad).asReferenceFrame,
e=b.layoutBox.referenceFrame.point(b.middle).withReferenceFrame(d);c=c.mouseStagePosition.withReferenceFrame(d).y-e.y;b.arcHeight+=c;return null}{d=-1===c.arcAnchor.rx;const g=c.mouseStagePosition.withReferenceFrame(b.layoutBox.referenceFrame);e=null;if(c.snapEnabled){const k=this.getSnapToCandidate(a,b,c);null==k||na.isActive("js-remove-line-snapping")?(c=this.calculateArcSnap(a,b,g,d,c),d?b.start=c:b.end=c):(d?b.connectorStart=k:b.connectorEnd=k,e=k.id)}else d?b.start=g:b.end=g;return e}}calculateArcSnap(a,
b,c,d,e){d=d?b.end:b.start;const g=n.Geometry.fromPoint(c).sub(n.Geometry.fromPoint(d));if(na.isActive("js-zoom-limits")){var k=this.universeLimitHelper.getScaleArcToLimit(n.Geometry.fromPoint(d).add(n.Geometry.fromPoint(c)).mul(.5).toPoint(),g.length());if(1<k)return e.kind!==h.ActionKind.Finish?this.snapAction={results:[{kind:h.SnapResultKind.UniverseLimit}]}:p.avro.Avro.createDefaultLogger().logTriggeredUniversalLimit({universal_limit_event:"INSERT_ERROR"}),g.setLength(g.length()*k).add(n.Geometry.fromPoint(d)).toPoint()}null==
e.arcSnapInfos&&(e.arcSnapInfos=this.getArcSnapInfos(a,[b.id]));k=e.arcSnapInfos;const f=this.calculateArcPointsSnap(b,k,c);if(null!=f)return f;a=this.calculateArcRotateSnap(a,b,g,d,c,e.kind,e);c=n.Geometry.fromPoint(a).sub(n.Geometry.fromPoint(d));return this.calculateArcLengthSnap(b,k,c,d,a)}calculateArcPointsSnap(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;b=[...b.map((a)=>a.start),...b.map((a)=>a.end)].filter((b)=>{b=n.Geometry.distance(c,b);return q.SnapHelper.referenceDistance(b,
a.layoutBox.referenceFrame,d)<this.arcPointDistanceThreshold});return 0<b.length?b.reduce((a,b)=>n.Geometry.distance(c,a)<n.Geometry.distance(c,b)?a:b):null}getArcSnapInfos(a,b){return q.SnapHelper.getSiblingsForIntention(a,{kind:D.SnapIntentionKind.generalEntitySnap,cameraAccess:this.cameraAccess,coverEditApi:this.coverEditApi,originalEditorIds:b}).filter(f.base.editorIs(f.base.ObjectKind.arc)).map((a)=>({start:a.start,end:a.end,ref:a.ref,length:a.layoutBox.size.width}))}calculateArcLengthSnap(a,
b,c,d,e){const g=this.cameraAccess.getScreenLayoutBox().referenceFrame,k=c.length();b=b.filter((b)=>q.SnapHelper.referenceDistance(Math.abs(b.length-k),a.layoutBox.referenceFrame,g)<this.arcLenghtThreshold);if(0<b.length){const a=b.map((a)=>a.length).reduce((a,b)=>Math.abs(a-k)<Math.abs(b-k)?a:b);this.snapAction={results:b.filter((b)=>.1>Math.abs(b.length-a)).map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.ref.id}))};return c.setLength(a/k*k).add(n.Geometry.fromPoint(d)).toPoint()}return e}calculateArcRotateSnap(a,
b,c,d,e,g,k){let f=c.getAngle()%(2*Math.PI);0>f&&(f+=2*Math.PI);null==k.rotationSnapInfo&&(k.rotationSnapInfo=q.SnapHelper.getSiblingsRotationsWithMirroredAngles(a,this.cameraAccess,this.coverEditApi,[b.id]));a=k.rotationSnapInfo;c=a.keys().reduce((a,b)=>q.SnapHelper.calculateAngle(a,f)<q.SnapHelper.calculateAngle(b,f)?a:b);k=Math.abs(f-c);const h=n.Geometry.distance(e,d),m=this.cameraAccess.getScreenLayoutBox().referenceFrame;b=q.SnapHelper.referenceDistance(h,b.layoutBox.referenceFrame,m);return Math.abs(Math.sin(k)*
b)<this.arcRotationThreshold?(this.setRotationSnapAction(g,a,c),n.Geometry.fromPoint({x:h,y:0}).rotate(c).add(n.Geometry.fromPoint(d)).toPoint()):e}setRotationSnapAction(a,b,c){b=b.getEntitiesWithRotation(c);a!==h.ActionKind.Finish&&0<b.length&&(this.snapAction={results:b.map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.id}))})}getSnapToCandidate(a,b,c){a=a.editorsUnderPoint(c.mouseStagePosition,[Tb.ifCloseToBorder]).map((a)=>{if(!a.is(Q.simpleObject)||a.is(Q.arc)||b.connectorEnd===a&&-1===
c.arcAnchor.rx||b.connectorStart===a&&1===c.arcAnchor.rx)return null;if(a.parent===b.parent)return a;if(a.parent.is(Q.cover)||a.parent.is(Q.visual))if(b.parent.is(Q.cover)||b.parent.is(Q.visual)){if(a.parent.parent===b.parent.parent)return a}else if(a.parent.parent===b.parent||a.parent.parent.parent===b.parent)return a;return null}).filter((a)=>null!=a);return 0<a.length?a.reduce((a,b)=>a.isAbove(b)?a:b):null}};var ba={createCommonDragState:function(a,b,c){const d=rb(a,b.target.entityIds),e=rb(a,
b.entitiesToTransformInSync),g=1===d.length&&d[0].is(f.base.ObjectKind.text);return{baseState:{kind:b.kind,originalZoomLayoutBox:0<d.length?d[0].parent.zoomLayoutBox:null,originalEditorIds:d.map((a)=>a.id),movedInSyncEditorIds:e.map((a)=>a.id),mouseStagePosition:c.point(b.mouseStagePosition),mouseStartStagePosition:c.point(b.originalMouseStagePosition),dragGroup:g?new ba.SingleTextDragGroupImpl(a.toDecorator(d[0])):a.createDragGroup(d,e),logInfos:d.map((a)=>{const b=a.layoutBox,c=b.center;return{editorId:a.id,
old_x:c.x,old_y:c.y,old_rotation:b.rotationRad,old_scale:b.size.width}})},editors2:d}}};Object.defineProperty(ba,"__esModule",{value:!0});ba.SingleTextDragGroupImpl=class{constructor(a){this.originalDragLayoutBox=a.layoutBox;this.editorId=a.id}getOriginalDragLayoutBoxForEditor(a){return a.id===this.editorId?this.originalDragLayoutBox:null}fitSelectionBoxInto(a,b){a=a.lookup.text(this.editorId);null!=a&&a.is(f.base.ObjectKind.text)&&a.fitInto(b)}};var N={};Object.defineProperty(N,"__esModule",{value:!0});
N.moveThreshold=5;N.MoveSnapHelper=class{static calculateMoveSnap(a,b){const c=b.targetLayoutBox.withReferenceFrame(b.cameraAccess.getScreenLayoutBox().referenceFrame);null==b.referenceSegments&&(b.referenceSegments=q.SnapHelper.getReferenceSegments(a,c.rotationRad,b));if(0===b.referenceSegments.length)return{targetLayoutBox:b.targetLayoutBox,snapResults:[],referenceSegments:b.referenceSegments};a=N.MoveSnapHelper.getHorizontalSegments(a,b,c);var d=q.SegmentCalculator.getVerticalSegments(c);a=N.MoveSnapHelper.getDragAlignSnapResultsOnAxis(a,
b.referenceSegments);d=N.MoveSnapHelper.getDragAlignSnapResultsOnAxis(d,b.referenceSegments);const e=a.translationVector.clone().add(d.translationVector);return{targetLayoutBox:c.translate(e.toPoint()),snapResults:[...a.snapResults,...d.snapResults],referenceSegments:b.referenceSegments}}static getDragAlignSnapResultsOnAxis(a,b){a=q.SnapHelper.getAllAlignSnapResultsOnAxis(a,b);return a.translationVector.length()<N.moveThreshold?a:q.noSnapResultData}static getHorizontalSegments(a,b,c){return b.kind===
D.SnapIntentionKind.generalEntitySnap&&1===b.originalEditorIds.length&&a.lookup.transformedObject(b.originalEditorIds[0]).is(f.base.ObjectKind.text)?q.SegmentCalculator.getMiddleAndTextBaselineSegments(a.lookup.text(b.originalEditorIds[0]),c,q.BaselineSegmentStrategy.topAndBottom):q.SegmentCalculator.getHorizontalSegments(c)}};var F={};Object.defineProperty(F,"__esModule",{value:!0});F.noSnapAction={results:[]};class Ub{do(a,b,c){c=this.updateState(a,b,c);var d=this.doAction(a,c);c=d.state;d=d.targetLayoutBox;
var e=F.noSnapAction,g=!1;na.isActive("js-zoom-limits")&&(g=this.doUniverseLimitCorrigation(a,c,d),c=g.state,d=g.targetLayoutBox,g=g.universeLimitReached);g?(e=b.kind!==h.ActionKind.Finish?{results:[{kind:h.SnapResultKind.UniverseLimit}]}:F.noSnapAction,b.kind!==h.ActionKind.Finish&&p.avro.Avro.createDefaultLogger().logTriggeredUniversalLimit({universal_limit_event:"INSERT_ERROR"})):c.snapEnabled&&(e=this.doSnapAction(a,c,d),d=e.targetLayoutBox,e=b.kind!==h.ActionKind.Finish?e.snapAction:F.noSnapAction);
b=this.finishAction(a,c,d);this.applySnapDecorator(a,e);return b}doUniverseLimitCorrigation(a,b,c){return{targetLayoutBox:c,state:b,universeLimitReached:!1}}applySnapDecorator(a,b){a.documentDecorator.set(A.EditorCommanderInternal.getSnapComponentKey(),b)}}F.SnappableBase=Ub;var bb={};Object.defineProperty(bb,"__esModule",{value:!0});var ya=f.base.ObjectKind;bb.DragMoveCommander=class extends F.SnappableBase{constructor(a,b,c,d){super();this.cameraAccess=a;this.layoutCommander=b;this.positionFinder=
c;this.coverEditApi=d;this.logger=p.LoggerModule.getLoggerManager().createLogger("DragMoveCommander");this.logHelper=ca.AppUtilsModule.getLogHelperUtils()}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var d=!1;if(0<b.target.entityIds.length){const c=a.lookup.base(b.target.entityIds[0]);c.is(ya.transformedObject)&&(d=c.parent,d=d.is(ya.planetTopic)&&d.layout.isValid())}return Object.assign(Object.assign({_DragMoveState_:void 0},ba.createCommonDragState(a,
b,c).baseState),{isParentLayouted:d,proximitySnapParent:null,snapEnabled:!1,referenceSegments:null});case h.ActionKind.Step:return a=this.cameraAccess.getScreenLayoutBox().referenceFrame,c=Object.assign(Object.assign({},c),{kind:b.kind,snapEnabled:!b.isSnapDisableKeyPressed,mouseStagePosition:a.point(b.stagePosition),mouseStartStagePosition:a.point(c.mouseStartStagePosition)});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}doAction(a,
b){a=a.lookup.transformedObject(b.originalEditorIds[0]).parent.referenceFrame;var c=b.dragGroup.originalDragLayoutBox;a=a.layoutBox(c.center,c.size).rotateRad(c.rotationRad);var d=a.referenceFrame;c=b.mouseStagePosition.withReferenceFrame(d);d=b.mouseStartStagePosition.withReferenceFrame(d);c=n.Geometry.fromPoint(c).sub(n.Geometry.fromPoint(d)).toPoint();a=a.translate(c);return{state:b,targetLayoutBox:a}}doSnapAction(a,b,c){a=N.MoveSnapHelper.calculateMoveSnap(a,{kind:D.SnapIntentionKind.generalEntitySnap,
targetLayoutBox:c,referenceSegments:b.referenceSegments,originalEditorIds:b.originalEditorIds,cameraAccess:this.cameraAccess,coverEditApi:this.coverEditApi});return{targetLayoutBox:a.targetLayoutBox,snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){b.dragGroup.fitSelectionBoxInto(a,c,b.kind===h.ActionKind.Finish);b.kind===h.ActionKind.Finish&&this.logMoveFinish(a,b);return{dragState:b}}logMoveFinish(a,b){const c=
p.LoggerModule.getLoggerManager().generateUniqueId();b.logInfos.forEach((b)=>{const d=a.lookup.transformedObject(b.editorId);this.logger.info({action:"modify",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(d),trigger:"drag",payload:{object_id:d.id,active_container:"overview",multiselect_id:c,old_x:b.old_x,old_y:b.old_y,new_x:d.layoutBox.center.x,new_y:d.layoutBox.center.y,prezi_mode:"editor",modified_value:"position",is_smart_structure:!1,is_topic_customization:d.parent.is(ya.visual)||
d.parent.is(ya.cover)}});p.avro.Avro.createDefaultLogger().logDragObject({object_type:d,topic_relationship:d,object_id:d.id})})}};var G={};Object.defineProperty(G,"__esModule",{value:!0});var X=f.base.AnchorPoint,ia;(function(a){a.horizontal="horizontal";a.vertical="vertical"})(ia=G.Orientation||(G.Orientation={}));const Vb=(a,b)=>(c)=>a(c)||b(c);class ja{static calculateResizeZoomLimits(a,b,c,d,e){const g=q.SnapHelper.getFixPoint(b.resizeAnchor,b.isCenterResize);var k=b.originalEditorIds.map((b)=>
a.toDecorator(a.lookup.transformedObject(b)));e=new W.UniverseLimitHelper(e);k=null==b.coTransformedEditorIds||k[0].kind!==f.base.ObjectKind.planetTopic&&k[0].kind!==f.base.ObjectKind.stackTopic?e.getScaleToLimit(a,b.resizeAnchor,b.originalEditorIds,d):e.getDraggedZoomAreaScaleToLimit(a,k[0],b.coTransformedEditorIds,b.resizeAnchor,d);e=0===b.resizeAnchor.rx?c.size.height/d.size.height:c.size.width/d.size.width;return 1>=k&&k>e?{targetLayoutBox:q.SnapHelper.scaleLayoutBoxWithAnchorPoint(d,b.resizeAnchor,
k).move(g,d.point(g)),universeLimitReached:!0}:1<k&&1>e?{targetLayoutBox:d,universeLimitReached:!0}:{targetLayoutBox:c,universeLimitReached:!1}}static calculateResizeSnap(a,b){const c=q.SnapHelper.getFixPoint(b.resizeAnchor,b.isCenterResize),d=ja.getAlignSnapScale(a,c,b);let e=d.scaleFactor,g=d.results;1===e&&(a=ja.getSizeSnapScale(a,b),e=a.scale,g=a.results);return 1===e?{targetLayoutBox:b.scaledLayoutBox,referenceSegments:d.referenceSegments,snapResults:[]}:{targetLayoutBox:q.SnapHelper.scaleLayoutBoxWithAnchorPoint(b.scaledLayoutBox,
b.resizeAnchor,e).move(c,b.originalLayoutBox.point(c)),referenceSegments:d.referenceSegments,snapResults:g}}static getSizeSnapScale(a,b){if(b.kind===D.SnapIntentionKind.generalEntitySnap){const c=a.lookup.transformedObject(b.originalEditorIds[0]),d=()=>{const d=q.SnapHelper.getSiblingsForIntention(a,b);return this.filterObjectsForSizeSnap(c,d)},e=b.scaledLayoutBox.withReferenceFrame(b.cameraAccess.getScreenLayoutBox().referenceFrame);if(b.resizeAnchor===X.centerLeft||b.resizeAnchor===X.centerRight)return this.calculateObjectSizeSnapScale(b.resizeSnapInfos,
d,(a)=>.05>=Math.abs(a.size.width/e.size.width-1),(a)=>a.size.width-e.size.width,(a)=>a.size.width/e.size.width,b.cameraAccess);if(b.resizeAnchor===X.topCenter||b.resizeAnchor===X.bottomCenter)return this.calculateObjectSizeSnapScale(b.resizeSnapInfos,d,(a)=>.05>=Math.abs(a.size.height/e.size.height-1),(a)=>a.size.height-e.size.height,(a)=>a.size.height/e.size.height,b.cameraAccess);if(b.resizeAnchor===X.bottomLeft||b.resizeAnchor===X.bottomRight||b.resizeAnchor===X.topLeft||b.resizeAnchor===X.topRight)return this.calculateObjectSizeSnapScale(b.resizeSnapInfos,
d,Vb((a)=>.05>=Math.abs(a.size.width/e.size.width-1),(a)=>.05>=Math.abs(a.size.height/e.size.height-1)),(a)=>Math.min(a.size.width-e.size.width,a.size.height-e.size.height),(a)=>.05>=Math.abs(a.size.width/e.size.width-1)?a.size.width/e.size.width:a.size.height/e.size.height,b.cameraAccess)}return{scale:1,results:[]}}static getResizeAlignSnapResult(a,b,c,d,e,g){let f;switch(a){case ia.horizontal:f=q.SegmentCalculator.getSegmentsForAnchorPointHorizontal(d,c,b);var h=d.point({rx:c.rx,ry:-1});var m=d.point({rx:c.rx,
ry:1});!0;break;case ia.vertical:f=q.SegmentCalculator.getSegmentsForAnchorPointVertical(d,c,b);h=d.point({rx:-1,ry:c.ry});m=d.point({rx:1,ry:c.ry});!0;break;default:u.Utils.assertNever(a)}a=q.SnapHelper.getAllAlignSnapResultsOnAxis(f,e);return 0<a.snapResults.length?(g=q.SnapHelper.getScaleToReferenceLine(q.SnapHelper.getIntersectionOfTwoLines(h,m,a.snapResults[0].originalSubjectSegment.P,a.snapResults[0].originalSubjectSegment.Q),g,a.snapResults[0].referenceSegment),{snapResults:a.snapResults,translationVector:a.translationVector,
scale:g}):null}static getAlignSnapScale(a,b,c){const d=c.scaledLayoutBox.withReferenceFrame(c.cameraAccess.getScreenLayoutBox().referenceFrame);let e=c.referenceSegments;null==e&&(e=q.SnapHelper.getReferenceSegments(a,d.rotationRad,c));a=d.point(b);a=[this.getResizeAlignSnapResult(ia.horizontal,c.isCenterResize,c.resizeAnchor,d,e,a),this.getResizeAlignSnapResult(ia.vertical,c.isCenterResize,c.resizeAnchor,d,e,a)];var {scaleFactor:g,similar:f}=ja.calculateResizeAlignSnapScale(a);return ja.isResizedLayoutBoxInsideThreshold(d,
c.resizeAnchor,g,c.minScale)?(c=u.Utils.flatten(f.map((a)=>a.snapResults)),{scaleFactor:g,referenceSegments:e,results:c}):{scaleFactor:1,referenceSegments:e,results:[]}}static isResizedLayoutBoxInsideThreshold(a,b,c,d){const e=q.SnapHelper.scaleLayoutBoxWithAnchorPoint(a,b,c);return n.Geometry.distance(a.point(b),e.point(b))<N.moveThreshold&&c>d}static calculateResizeAlignSnapScale(a){a=a.filter((a)=>null!=a).filter((a)=>a.translationVector.length()<N.moveThreshold);if(0===a.length)return{scaleFactor:1,
similar:[]};const b=a.reduce((a,b)=>Math.abs(b.scale-1)<Math.abs(a.scale-1)?b:a);a=a.filter((a)=>.001>Math.abs(a.scale-b.scale));return{scaleFactor:b.scale,similar:a}}static calculateObjectSizeSnapScale(a,b,c,d,e,g){null==a&&(a=b().map((a)=>({ref:a.ref,layoutBoxInScreen:a.layoutBox.withReferenceFrame(g.getScreenLayoutBox().referenceFrame)})));if(0===a.length)return{scale:1,results:[]};a=a.filter((a)=>c(a.layoutBoxInScreen)).sort((a,b)=>Math.abs(d(a.layoutBoxInScreen))-Math.abs(d(b.layoutBoxInScreen)));
if(0===a.length)return{scale:1,results:[]};const f=a[0];a=a.filter((a)=>.001>Math.abs(d(a.layoutBoxInScreen)-d(f.layoutBoxInScreen))).map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.ref.id}));return{scale:e(f.layoutBoxInScreen),results:a}}static filterObjectsForSizeSnap(a,b){const c=[[f.base.ObjectKind.text],[f.base.ObjectKind.shape,f.base.ObjectKind.image,f.base.ObjectKind.animatedImage,f.base.ObjectKind.pdf,f.base.ObjectKind.topic,f.base.ObjectKind.chart,f.base.ObjectKind.slide,f.base.ObjectKind.swf]].find((b)=>
b.find((b)=>null!=a.is(b)));return null!=c?b.filter((a)=>c.find((b)=>null!=a.is(b))):[]}}G.ResizeSnapHelper=ja;var ea={};Object.defineProperty(ea,"__esModule",{value:!0});var za=f.base.AnchorPoint,K=f.base.ObjectKind;ea.DragNonProportionalResizeCommander=class extends F.SnappableBase{constructor(a,b){super();this.cameraAccess=a;this.coverEditApi=b;this.logger=p.LoggerModule.getLoggerManager().createLogger("DragNonProportionalResizeCommander");this.logHelper=ca.AppUtilsModule.getLogHelperUtils()}updateState(a,
b,c){switch(b.kind){case h.ActionKind.Start:a=a.toDecorator(a.lookup.transformedObject(b.target.entityId));c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var d=a.layoutBox.asReferenceFrame,e=c.point(b.originalMouseStagePosition).withReferenceFrame(d);c=a.selectionBox;d=c.withReferenceFrame(d);d=b.isWidthResize?n.Geometry.distance(d.centerLeft,e)<n.Geometry.distance(d.centerRight,e)?za.centerLeft:za.centerRight:n.Geometry.distance(d.topCenter,e)<n.Geometry.distance(d.bottomCenter,e)?za.topCenter:
za.bottomCenter;c=a.is(K.text)?{kind:K.text,wrapWidth:0===a.wrapWidth?a.textBox.size.width:a.wrapWidth,selectionBox:c}:{kind:K.shape,selectionBox:c};e=this.cameraAccess.getScreenLayoutBox().referenceFrame;const g=a.is(K.shape)&&null!=a.border.thickness?a.border.thickness+.1:a.is(K.zoomArea)?.1:0;return{_NonProportionalResizeState_:void 0,kind:b.kind,mouseStagePosition:e.point(b.mouseStagePosition),resizeAnchor:d,mouseStartStagePosition:e.point(b.originalMouseStagePosition),isCenterResize:b.isCenterResize,
original:c,snapEnabled:!0,referenceSegments:null,resizeSnapInfos:null,originalEditorId:a.id,minSize:g};case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}doAction(a,b){var c=a.toDecorator(a.lookup.transformedObject(b.originalEditorId));
a=this.cameraAccess.getScreenLayoutBox().referenceFrame;c=c.layoutBox.asReferenceFrame;const d=b.original.selectionBox.withReferenceFrame(c);var e=b.mouseStagePosition.withReferenceFrame(c);const g=b.mouseStartStagePosition.withReferenceFrame(c);let f=b.minSize;const h=q.SnapHelper.getFixPoint(b.resizeAnchor,b.isCenterResize);e={width:d.size.width+(e.x-g.x)*b.resizeAnchor.rx*(b.isCenterResize?2:1),height:d.size.height+(e.y-g.y)*b.resizeAnchor.ry*(b.isCenterResize?2:1)};f=Math.max(ea.DragNonProportionalResizeCommander.calculateDistance(ea.DragNonProportionalResizeCommander.MINIMUM_SHAPE_SIZE,
a,c),f);e.width<f&&(e.width=f);e.height<f&&(e.height=f);return{targetLayoutBox:d.withSize(e).move(h,d.point(h)),state:Object.assign(Object.assign({},b),{minSize:f})}}doUniverseLimitCorrigation(a,b,c){a=G.ResizeSnapHelper.calculateResizeZoomLimits(a,this.createSnapData(b),c,b.original.selectionBox,this.cameraAccess);return{targetLayoutBox:a.targetLayoutBox,state:b,universeLimitReached:a.universeLimitReached}}doSnapAction(a,b,c){var d=a.toDecorator(a.lookup.transformedObject(b.originalEditorId));d=
b.minSize/d.layoutBox.withReferenceFrame(d.layoutBox.asReferenceFrame).size.width;a=G.ResizeSnapHelper.calculateResizeSnap(a,{kind:D.SnapIntentionKind.generalEntitySnap,isCenterResize:b.isCenterResize,referenceSegments:b.referenceSegments,resizeAnchor:b.resizeAnchor,resizeSnapInfos:b.resizeSnapInfos,scaledLayoutBox:c.withReferenceFrame(b.original.selectionBox.referenceFrame),originalLayoutBox:b.original.selectionBox,cameraAccess:this.cameraAccess,coverEditApi:this.coverEditApi,originalEditorIds:[b.originalEditorId],
minScale:d});return{targetLayoutBox:a.targetLayoutBox,snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){const d=a.toDecorator(a.lookup.transformedObject(b.originalEditorId));if(b.kind!==h.ActionKind.Finish)if(d.is(K.text)&&b.original.kind===K.text)c=b.original.wrapWidth+c.size.width-b.original.selectionBox.size.width,c>=d.minWrapWidth&&(d.wrapWidth=c),c={rx:-b.resizeAnchor.rx,ry:-1},d.fitSelectionBoxInto(d.selectionBox.move(c,
b.original.selectionBox.point(c)));else{if(d.is(K.shape)||d.is(K.zoomArea)){const b=d.is(K.shape)&&null!=d.border.thickness?d.border.thickness:0;a=c.size.height-b;d.width=c.size.width-b;d.height=a;d.fitInto(d.layoutBox.move(d.layoutBox.center,c.center))}}else this.logResize(a,b),p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"RESIZE",topic_relationship:d,object_id:d.id});return{state:b}}logResize(a,b){const c=p.LoggerModule.getLoggerManager().generateUniqueId();a=
a.toDecorator(a.lookup.transformedObject(b.originalEditorId));const d=a.selectionBox,e=0===b.resizeAnchor.ry;b={old_value:b.original.kind===f.base.ObjectKind.text?b.original.wrapWidth:b.original.selectionBox.size.width,new_value:a.kind===f.base.ObjectKind.text?a.wrapWidth:d.size.width,old_x:b.original.selectionBox.center.x,old_y:b.original.selectionBox.center.y,new_x:d.center.x,new_y:d.center.y,active_container:a.parent.id,object_id:a.id,multiselect_id:c,prezi_mode:"editor",modified_value:e?"width":
"height",version:e&&a.is(K.text)?1:0,is_topic_customization:a.parent.is(K.visual)||a.parent.is(K.cover)};b={action:e?"modify_width":"modify_height",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),trigger:"control_point",payload:b};this.logger.info(b)}createSnapData(a){return{kind:a.kind,resizeAnchor:a.resizeAnchor,isCenterResize:a.isCenterResize,originalEditorIds:[a.originalEditorId],snapEnabled:a.snapEnabled,referenceSegments:a.referenceSegments,resizeSnapInfos:a.resizeSnapInfos}}static calculateDistance(a,
b,c){const d=b.point({x:0,y:0});a=b.point({x:a,y:0});return n.Geometry.distance(d.withReferenceFrame(c),a.withReferenceFrame(c))}};ea.DragNonProportionalResizeCommander.MINIMUM_SHAPE_SIZE=10;var Aa={calcResizeBounds:function(a,b,c,d,e,g){a=a.referenceFrame;var k=b.asReferenceFrame;c=c.withReferenceFrame(k);const h=d.withReferenceFrame(k);d=b.point(e).withReferenceFrame(k);const m=b.point(f.base.AnchorPoint.center).withReferenceFrame(k);c=n.Geometry.fromCoordinates(m.x-d.x,m.y-d.y).normalize().dot(n.Geometry.fromCoordinates(h.x-
c.x,h.y-c.y));d=n.Geometry.distance(m,d);g||(c/=2);a=n.Geometry.distance(a.point({x:0,y:0}).withReferenceFrame(k),a.point({x:0,y:10}).withReferenceFrame(k))/b.withReferenceFrame(k).size.width;k=Math.max(a,(d+c)/d);e=q.SnapHelper.getFixPoint(e,g);return{targetLayoutBox:b.scale(k).move(e,b.point(e)),minScale:a}}};Object.defineProperty(Aa,"__esModule",{value:!0});var O={};Object.defineProperty(O,"__esModule",{value:!0});var ka=f.base.AnchorPoint,tb=f.base.ObjectKind;O.minSizeInScreen=10;O.DragResizeSingleTextCommander=
class extends F.SnappableBase{constructor(a,b){super();this.cameraAccess=a;this.coverEditApi=b;this.objectSizeDiffTolerance=.05;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_commander.TextResizeCommander");this.universeLimitHelper=new W.UniverseLimitHelper(this.cameraAccess)}updateState(a,b,c){if(b.kind===h.ActionKind.Start){const d=a.lookup.text(b.target.entityIds[0]);return Object.assign(Object.assign({_ResizeSingleTextState_:void 0,originalSelectionBox:a.toDecorator(d).selectionBox},
Ga(a,b,c,this.cameraAccess)),{fontSnapInfos:null,referenceSegments:null,minScale:null,scaledSelectionBox:null})}return Object.assign(Object.assign({},c),Ga(a,b,c,this.cameraAccess))}doAction(a,b){a=b.originalSelectionBox;const c=Aa.calcResizeBounds(this.cameraAccess.getScreenLayoutBox(),a,b.mouseStagePosition,b.mouseStartStagePosition,b.resizeAnchor,b.isCenterResize);return{targetLayoutBox:b.dragGroup.originalDragLayoutBox.align(a.topLeft,a.topRight,c.targetLayoutBox.topLeft,c.targetLayoutBox.topRight),
state:Object.assign(Object.assign({},b),{minScale:c.minScale,scaledSelectionBox:c.targetLayoutBox})}}doUniverseLimitCorrigation(a,b,c){var d=q.SnapHelper.getFixPoint(b.resizeAnchor,b.isCenterResize);const e=b.scaledSelectionBox;a=this.universeLimitHelper.getScaleToLimit(a,b.resizeAnchor,b.originalEditorIds,b.dragGroup.originalDragLayoutBox);const g=c.size.width/b.dragGroup.originalDragLayoutBox.size.width;return 1>=a&&a>g?(d=q.SnapHelper.scaleLayoutBoxWithAnchorPoint(b.originalSelectionBox,b.resizeAnchor,
a).move(d,b.originalSelectionBox.point(d)),{targetLayoutBox:c.align(e.topLeft,e.topRight,d.topLeft,d.topRight),state:b,universeLimitReached:!0}):1<a&&1>g?{targetLayoutBox:b.dragGroup.originalDragLayoutBox,state:b,universeLimitReached:!0}:{targetLayoutBox:c,state:b,universeLimitReached:!1}}doSnapAction(a,b,c){const d=q.SnapHelper.getFixPoint(b.resizeAnchor,b.isCenterResize),e=b.scaledSelectionBox,g=a.lookup.text(b.originalEditorIds[0]);if(""===g.getText())return{targetLayoutBox:c,snapAction:F.noSnapAction,
state:b};var f=this.getAlignSnapTextScale(a,b,c,e,b.minScale,d);let h=f.scaleFactor,m=null;var l=f.results;1===h&&g.getFontSizes().every((a,b,c)=>a===c[0])&&(l=this.calculateFontSizeSnapScale(a,b,c,g),h=l.scaleFactor,m=l.fontSnapInfos,l=l.results);f=Object.assign(Object.assign({},b),{referenceSegments:f.referenceSegments,fontSnapInfos:m});if(1===h)return{targetLayoutBox:c,snapAction:F.noSnapAction,state:f};b=q.SnapHelper.scaleLayoutBoxWithAnchorPoint(e,b.resizeAnchor,h).move(d,e.point(d));return{targetLayoutBox:c.align(e.topLeft,
e.topRight,b.topLeft,b.topRight),snapAction:{results:l},state:f}}finishAction(a,b,c){b.dragGroup.fitSelectionBoxInto(a,c,b.kind===h.ActionKind.Finish);b.kind===h.ActionKind.Finish&&sb(a,b,this.logger);return{resizeState:b}}calculateFontSizeSnapScale(a,b,c,d){a=null==b.fontSnapInfos?q.SnapHelper.getSiblingsForIntention(a,{kind:D.SnapIntentionKind.fontSizeSnap,cameraAccess:this.cameraAccess,coverEditApi:this.coverEditApi,originalEditorId:d.id}).map((a)=>({ref:a.ref,fontSizesInScreen:a.getFontSizes().map((b)=>
q.SnapHelper.calculateFontSizeInScreen(this.cameraAccess,a.layoutBox,b))})):b.fontSnapInfos;if(0===a.length)return{scaleFactor:1,fontSnapInfos:a,results:[]};d.fitInto(c);const e=q.SnapHelper.calculateFontSizeInScreen(this.cameraAccess,d.layoutBox,d.getFontSizes()[0]);let g=[];for(const b of a)b.fontSizesInScreen.forEach((a)=>{Math.abs(a/e-1)<=this.objectSizeDiffTolerance&&g.push({id:b.ref.id,fontSize:a})});return 0===g.length?{scaleFactor:1,fontSnapInfos:a,results:[]}:{scaleFactor:g[0].fontSize/e,
fontSnapInfos:a,results:g.map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.id}))}}getAlignSnapTextScale(a,b,c,d,e,g){var f=a.lookup.text(b.originalEditorIds[0]),h=this.cameraAccess.getScreenLayoutBox().referenceFrame;const m=c.withReferenceFrame(h);h=d.withReferenceFrame(h);let l=b.referenceSegments;null==l&&(l=q.SnapHelper.getReferenceSegments(a,c.rotationRad,{kind:D.SnapIntentionKind.generalEntitySnap,coverEditApi:this.coverEditApi,cameraAccess:this.cameraAccess,originalEditorIds:b.originalEditorIds}));
a=d.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame).point(g);f=[G.ResizeSnapHelper.getResizeAlignSnapResult(G.Orientation.vertical,b.isCenterResize,b.resizeAnchor,m,l,a),this.getResizeAlignSnapResultForTextBaseline(b,f,m,l,a)];var {scaleFactor:n,similar:p}=G.ResizeSnapHelper.calculateResizeAlignSnapScale(f);return G.ResizeSnapHelper.isResizedLayoutBoxInsideThreshold(h,b.resizeAnchor,n,e)?{scaleFactor:n,referenceSegments:l,results:u.Utils.flatten(p.map((a)=>a.snapResults))}:
{scaleFactor:1,referenceSegments:l,results:[]}}getResizeAlignSnapResultForTextBaseline(a,b,c,d,e){const g=a.resizeAnchor;a=q.SegmentCalculator.getMiddleAndTextBaselineSegments(b,c,a.isCenterResize?q.BaselineSegmentStrategy.topAndBottom:-1===g.ry?q.BaselineSegmentStrategy.topOnly:q.BaselineSegmentStrategy.bottomOnly);d=q.SnapHelper.getAllAlignSnapResultsOnAxis(a,d);return 0<d.snapResults.length?(c=q.SnapHelper.getScaleToReferenceLine(q.SnapHelper.getIntersectionOfTwoLines(c.point({rx:g.rx,ry:1}),c.point({rx:g.rx,
ry:-1}),d.snapResults[0].originalSubjectSegment.P,d.snapResults[0].originalSubjectSegment.Q),e,d.snapResults[0].referenceSegment),{snapResults:d.snapResults,translationVector:d.translationVector,scale:c}):null}};O.DragResizeCommanderBase=class extends F.SnappableBase{constructor(a,b){super();this.cameraAccess=a;this.coverEditApi=b;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_commander.ResizeCommander")}doAction(a,b){a=this.cameraAccess.getScreenLayoutBox().referenceFrame;
var c=b.dragGroup.originalDragLayoutBox.asReferenceFrame,d=b.mouseStagePosition.withReferenceFrame(c);const e=b.mouseStartStagePosition.withReferenceFrame(c);var g=b.dragGroup.originalDragLayoutBox.point(b.resizeAnchor).withReferenceFrame(c);const f=b.dragGroup.originalDragLayoutBox.point(ka.center).withReferenceFrame(c);d=n.Geometry.fromCoordinates(f.x-g.x,f.y-g.y).normalize().dot(n.Geometry.fromCoordinates(e.x-d.x,e.y-d.y));g=n.Geometry.distance(f,g);b.isCenterResize||(d/=2);a=n.Geometry.distance(a.point({x:0,
y:0}).withReferenceFrame(c),a.point({x:0,y:O.minSizeInScreen}).withReferenceFrame(c))/b.dragGroup.originalDragLayoutBox.withReferenceFrame(c).size.width;a=Math.max(a,(g+d)/g);c=q.SnapHelper.getFixPoint(b.resizeAnchor,b.isCenterResize);return{targetLayoutBox:b.dragGroup.originalDragLayoutBox.scale(a).move(c,b.dragGroup.originalDragLayoutBox.point(c)),state:b}}doUniverseLimitCorrigation(a,b,c){a=G.ResizeSnapHelper.calculateResizeZoomLimits(a,b,c,b.dragGroup.originalDragLayoutBox,this.cameraAccess);
return{targetLayoutBox:a.targetLayoutBox,state:b,universeLimitReached:a.universeLimitReached}}doSnapAction(a,b,c){a=G.ResizeSnapHelper.calculateResizeSnap(a,{kind:D.SnapIntentionKind.generalEntitySnap,isCenterResize:b.isCenterResize,referenceSegments:b.referenceSegments,resizeAnchor:b.resizeAnchor,resizeSnapInfos:b.resizeSnapInfos,scaledLayoutBox:c,originalLayoutBox:b.dragGroup.originalDragLayoutBox,minScale:b.minScale,cameraAccess:this.cameraAccess,coverEditApi:this.coverEditApi,originalEditorIds:b.originalEditorIds});
return{targetLayoutBox:a.targetLayoutBox,snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){b.dragGroup.fitSelectionBoxInto(a,c,b.kind===h.ActionKind.Finish);b.kind===h.ActionKind.Finish&&sb(a,b,this.logger);return{resizeState:b}}};O.DragResizeCommander=class extends O.DragResizeCommanderBase{constructor(a,b){super(a,b)}updateState(a,b,c){a=Ga(a,b,c,this.cameraAccess);return Object.assign(Object.assign({_ResizeState_:void 0},
a),{minScale:null})}};O.DrawInsertCommander=class extends O.DragResizeCommanderBase{constructor(a,b){super(a,b);this.getAnchorPoint=(a,b)=>{var c=a.x-b.x;a=a.y-b.y;return 0>=c&&0>=a?ka.topLeft:0>=c&&0<=a?ka.bottomLeft:0<=c&&0>=a?ka.topRight:ka.bottomRight}}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:var d=this.cameraAccess.getScreenLayoutBox().referenceFrame;if(b.target.kind!==h.ActionTargetKind.single)throw Error("Draw insert target must be single");c=d.point(b.mouseStagePosition);
d=d.point(b.originalMouseStagePosition);const e=a.lookup.zoomArea(b.target.entityId);return{_ResizeState_:void 0,minScale:null,kind:b.kind,originalZoomLayoutBox:e.parent.zoomLayoutBox,originalEditorIds:[e.id],movedInSyncEditorIds:[],mouseStagePosition:c,mouseStartStagePosition:d,dragGroup:a.createDragGroup([e],[]),logInfos:[e].map((a)=>{const b=a.layoutBox,c=b.center;return{editorId:a.id,old_x:c.x,old_y:c.y,old_rotation:b.rotationRad,old_scale:b.size.width}}),resizeAnchor:this.getAnchorPoint(c,d),
isCenterResize:!1,resizeSnapInfos:null,referenceSegments:null,snapEnabled:!1};case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}};var Ba={};Object.defineProperty(Ba,"__esModule",{value:!0});
var Wb=f.base.AnchorPoint,Fb=f.base.ObjectKind;Ba.DragRotateCommander=class extends F.SnappableBase{constructor(a,b){super();this.cameraAccess=a;this.coverEditApi=b;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.RotateCommander");this.logHelper=ca.AppUtilsModule.getLogHelperUtils()}doAction(a,b){a=this.calcRotationDelta(b);return{state:b,targetLayoutBox:b.dragGroup.originalDragLayoutBox.rotateRad(a)}}doSnapAction(a,b,c){let d=c.rotationRad%(2*Math.PI);0>d&&(d+=
2*Math.PI);let e=b.rotationSnapInfo;null==e&&(e=q.SnapHelper.getSiblingsRotationsWithMirroredAngles(a,this.cameraAccess,this.coverEditApi,b.originalEditorIds));var g=e;const f=g.keys().reduce((a,b)=>q.SnapHelper.calculateAngle(a,d)<q.SnapHelper.calculateAngle(b,d)?a:b),m=Math.abs(d-f);var l=this.cameraAccess.getScreenLayoutBox().referenceFrame;a=b.dragGroup.originalDragLayoutBox;l=a.withReferenceFrame(l).size;return 15>Math.abs(Math.sqrt(l.width*l.width+l.height*l.height)/2*Math.sin(m))?(c=f-a.rotationRad,
g={results:g.getEntitiesWithRotation(f).map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.id}))},{targetLayoutBox:a.rotateRad(c),snapAction:g,state:Object.assign(Object.assign({},b),{rotationSnapInfo:e})}):{targetLayoutBox:c,snapAction:F.noSnapAction,state:Object.assign(Object.assign({},b),{rotationSnapInfo:e})}}finishAction(a,b,c){b.dragGroup.fitSelectionBoxInto(a,c,b.kind===h.ActionKind.Finish);b.kind===h.ActionKind.Finish&&this.logRotateFinish(a,b);1<b.originalEditorIds.length&&(b.kind!==
h.ActionKind.Finish?a.documentDecorator.set(A.EditorCommanderInternal.getMultiselectDecoratorComponentKey(),c):a.documentDecorator.discardOwnComponent(A.EditorCommanderInternal.getMultiselectDecoratorComponentKey()));return{rotateState:b}}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var {baseState:a}=ba.createCommonDragState(a,b,c);return Object.assign(Object.assign({_RotateState_:void 0},a),{snapEnabled:!1,rotationSnapInfo:null,
referenceSegments:null});case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}calcRotationDelta(a){const b=a.dragGroup.originalDragLayoutBox.asReferenceFrame,c=a.mouseStagePosition.withReferenceFrame(b),d=a.mouseStartStagePosition.withReferenceFrame(b);
a=a.dragGroup.originalDragLayoutBox.point(Wb.center).withReferenceFrame(b);return Ba.DragRotateCommander.calcRad(c,d,a)}logRotateFinish(a,b){const c=p.LoggerModule.getLoggerManager().generateUniqueId();b.logInfos.forEach((b)=>{const d=a.lookup.transformedObject(b.editorId);this.logger.info({action:"modify",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(d),trigger:"control_point",payload:{old_rotation:b.old_rotation,new_rotation:d.layoutBox.rotationRad,old_x:b.old_x,old_y:b.old_y,new_x:d.layoutBox.center.x,
new_y:d.layoutBox.center.y,active_container:"overview",object_id:d.id,multiselect_id:c,prezi_mode:"editor",modified_value:"rotate",is_topic_customization:d.parent.is(Fb.visual)||d.parent.is(Fb.cover)}});p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"ROTATE",topic_relationship:d,object_id:d.id})})}static calcRad(a,b,c){var d=n.Geometry.distance(a,b);const e=n.Geometry.distance(a,c),g=n.Geometry.distance(b,c);d=Math.acos((e*e+g*g-d*d)/(2*e*g));c=n.Geometry.fromPoint(c);
a=n.Geometry.fromPoint(a).sub(c);b=n.Geometry.fromPoint(b).sub(c);return 0<a.cross(b)?-d:d}};var H={};Object.defineProperty(H,"__esModule",{value:!0});var Ca=f.base.ObjectKind;H.TopicZoomAreaInteraction=class{static calcBaseStartState(a,b,c,d){var e=c.lookup.transformedObject(a),g=c.toDecorator(e);e=g.cover.zoomLayoutBox;const f=b?H.TopicZoomAreaInteraction.getFirstLevelContent(g):[];g=this.getAllContent(g);return{kind:h.ActionKind.Start,coTransformedEditorIds:f,originalEditorIds:[a],coTransformContent:b,
coTransformContentAtStart:b,originalZoomLayout:e,dragGroup:0<g.length?c.createDragGroup(g,[]):null,screenLayoutBoxAtStart:d.getScreenLayoutBox()}}static getFirstLevelContent(a){return a.is(Ca.planetTopic)?[...a.topicChildren.reduce((a,c)=>[...a,...c.simpleChildren(f.base.ChildVisibilityKind.outside)],[]),...a.contentChildren,...a.master.contentChildren].map((a)=>a.id):a.is(Ca.stackTopic)?[...a.master.contentChildren,...0<a.pageChildren.length?a.pageChildren[0].contentChildren:[]].map((a)=>a.id):[]}static getAllContent(a){if(a.is(Ca.planetTopic))return[...a.topicChildren,
...a.contentChildren,...a.master.contentChildren];if(a.is(Ca.stackTopic)){const b=a.pageChildren.reduce((a,b)=>a.concat(b.contentChildren),[]);return[...a.master.contentChildren,...b]}return[]}static handleInteraction(a,b,c){b.kind===h.ActionKind.Start?H.TopicZoomAreaInteraction.start(b,c):b.kind===h.ActionKind.Step?H.TopicZoomAreaInteraction.step(a,b,c):b.kind===h.ActionKind.Finish&&H.TopicZoomAreaInteraction.finish(a,b,c)}static start(a,b){a.coTransformedEditorIds.map((c)=>b.toDecorator(b.lookup.transformedObject(c)).set(f.CetModelEditor.getShowContentKey(),
a.coTransformContentAtStart))}static step(a,b,c){H.TopicZoomAreaInteraction.move(a,b,c)}static finish(a,b,c){H.TopicZoomAreaInteraction.move(a,b,c);b.coTransformedEditorIds.map((a)=>c.toDecorator(c.lookup.transformedObject(a)).discardOwnComponent(f.CetModelEditor.getShowContentKey()))}static move(a,b,c){var d=c.lookup.transformedObject(b.originalEditorIds[0]);d=c.toDecorator(d);const e=b.originalZoomLayout.align(b.originalZoomLayout.topLeft,b.originalZoomLayout.topRight,a.topLeft,a.topRight);d.fitZoomAreaIntoLayoutBox(e);
null!=b.dragGroup&&b.dragGroup.fitSelectionBoxInto(c,b.coTransformContent?b.dragGroup.originalDragLayoutBox.align(b.originalZoomLayout.topLeft,b.originalZoomLayout.topRight,a.topLeft,a.topRight):b.dragGroup.originalDragLayoutBox,b.kind===h.ActionKind.Finish)}};var cb={};Object.defineProperty(cb,"__esModule",{value:!0});cb.DragTopicZoomAreaMoveCommander=class extends F.SnappableBase{constructor(a,b){super();this.cameraControl=a;this.coverEditApi=b;this.logger=p.LoggerModule.getLoggerManager().createLogger("DragTopicZoomAreaMoveCommander");
this.logHelper=ca.AppUtilsModule.getLogHelperUtils()}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:return c=this.cameraControl.getScreenLayoutBox().referenceFrame,Object.assign(Object.assign({_DragTopicZoomAreaMoveState_:void 0},H.TopicZoomAreaInteraction.calcBaseStartState(b.target.entityId,b.coTransformContent,a,this.cameraControl)),{mouseStartStagePosition:c.point(b.originalMouseStagePosition),mouseStagePosition:c.point(b.mouseStagePosition),snapEnabled:!1,referenceSegments:null});
case h.ActionKind.Step:return a=this.cameraControl.getScreenLayoutBox().referenceFrame,c=Object.assign(Object.assign({},c),{kind:b.kind,snapEnabled:!b.isSnapDisableKeyPressed,mouseStagePosition:a.point(b.stagePosition),coTransformContent:c.coTransformContentAtStart&&!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}doAction(a,b){var c=this.cameraControl.getScreenLayoutBox().referenceFrame;const d=b.originalZoomLayout.referenceFrame;
a=c.point(b.mouseStagePosition).withReferenceFrame(d);c=c.point(b.mouseStartStagePosition).withReferenceFrame(d);a=n.Geometry.fromPoint(a).sub(n.Geometry.fromPoint(c)).toPoint();return{targetLayoutBox:b.originalZoomLayout.translate(a),state:b}}doSnapAction(a,b,c){a=N.MoveSnapHelper.calculateMoveSnap(a,{kind:D.SnapIntentionKind.topicZoomAreaSnap,targetLayoutBox:c,cameraAccess:this.cameraControl,coverEditApi:this.coverEditApi,referenceSegments:b.referenceSegments,topicId:b.originalEditorIds[0]});return{targetLayoutBox:a.targetLayoutBox,
snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){H.TopicZoomAreaInteraction.handleInteraction(c,b,a);b.kind===h.ActionKind.Finish&&this.logMoveFinish(a,b);this.cameraControl.setScreenLayoutBox(b.screenLayoutBoxAtStart);return{dragTopicZoomAreaState:b}}logMoveFinish(a,b){const c=p.LoggerModule.getLoggerManager().generateUniqueId();a=a.lookup.transformedObject(b.originalEditorIds[0]);this.logger.info({action:"modify",
object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),trigger:"drag",payload:{object_id:a.id,active_container:"overview",multiselect_id:c,old_x:b.originalZoomLayout.center.x,old_y:b.originalZoomLayout.center.y,new_x:a.layoutBox.center.x,new_y:a.layoutBox.center.y,prezi_mode:"editor",modified_value:"position",is_smart_structure:!1,is_topic_customization:a.parent.is(f.base.ObjectKind.visual)||a.parent.is(f.base.ObjectKind.cover)}});p.avro.Avro.createDefaultLogger().logDragObject({object_type:"TOPIC_ZOOM_AREA",
topic_relationship:a,object_id:a.id})}};var Da={};Object.defineProperty(Da,"__esModule",{value:!0});Da.DragTopicZoomAreaResizeCommander=class extends F.SnappableBase{constructor(a,b){super();this.cameraControl=a;this.coverEditApi=b}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraControl.getScreenLayoutBox().referenceFrame;a=H.TopicZoomAreaInteraction.calcBaseStartState(b.target.entityId,b.coTransformContent,a,this.cameraControl);const d=b.resizeAnchor;return Object.assign(Object.assign({_DragResizeTopicZoomAreaState_:void 0},
a),{resizeAnchor:d,mouseStartStagePosition:c.point(b.originalMouseStagePosition),mouseStagePosition:c.point(b.mouseStagePosition),isCenterResize:b.isCenterResize,snapEnabled:!1,referenceSegments:null,resizeSnapInfos:null,minScale:null});case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraControl.getScreenLayoutBox().referenceFrame.point(b.stagePosition),isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed,coTransformContent:c.coTransformContentAtStart&&
!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"TOPIC_ZOOM_AREA",modify_action:"RESIZE",topic_relationship:"CONTENT",object_id:c.originalEditorIds[0]}),Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}doAction(a,b){a=Aa.calcResizeBounds(this.cameraControl.getScreenLayoutBox(),b.originalZoomLayout,b.mouseStagePosition,b.mouseStartStagePosition,b.resizeAnchor,b.isCenterResize);return{targetLayoutBox:a.targetLayoutBox,
state:Object.assign(Object.assign({},b),{minScale:a.minScale})}}doUniverseLimitCorrigation(a,b,c){a=G.ResizeSnapHelper.calculateResizeZoomLimits(a,b,c,b.originalZoomLayout,this.cameraControl);return{targetLayoutBox:a.targetLayoutBox,state:b,universeLimitReached:a.universeLimitReached}}doSnapAction(a,b,c){a=G.ResizeSnapHelper.calculateResizeSnap(a,{kind:D.SnapIntentionKind.topicZoomAreaSnap,isCenterResize:b.isCenterResize,referenceSegments:b.referenceSegments,resizeAnchor:b.resizeAnchor,resizeSnapInfos:b.resizeSnapInfos,
scaledLayoutBox:c,originalLayoutBox:b.originalZoomLayout,minScale:b.minScale,cameraAccess:this.cameraControl,coverEditApi:this.coverEditApi,topicId:b.originalEditorIds[0]});return{targetLayoutBox:a.targetLayoutBox,snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){H.TopicZoomAreaInteraction.handleInteraction(c,b,a);this.cameraControl.setScreenLayoutBox(b.screenLayoutBoxAtStart);return{resizeTopicZoomAreaState:b}}};
Da.DragTopicZoomAreaResizeCommander.MIN_SIZE_IN_SCREEN=10;var la={};Object.defineProperty(la,"__esModule",{value:!0});la.NudgeHelper=class{static calculateNudgeDelta(a,b){b=b?10:1;let c=0,d=0;switch(a){case h.NudgeDirection.Up:d=-b;break;case h.NudgeDirection.Down:d=b;break;case h.NudgeDirection.Left:c=-b;break;case h.NudgeDirection.Right:c=b}return{x:c,y:d}}};var db={};Object.defineProperty(db,"__esModule",{value:!0});var Ea=f.base.ObjectKind;db.NudgeCommander=class{constructor(a){this.cameraAccess=
a;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.NudgeCommander")}do(a,b,c){c=this.updateState(b,c,a);b=c.entityIds.map((b)=>a.lookup.transformedObject(b));if(c.kind!==h.ActionKind.Finish){var d=la.NudgeHelper.calculateNudgeDelta(c.direction,c.isFast);const a=1===b.length?b[0]:b[0].createLayoutGroupWith(b.slice(1)),g=this.cameraAccess.getScreenLayoutBox();a.fitInto(a.layoutBox.withReferenceFrame(g.referenceFrame).translate(d));d=p.LoggerModule.getLoggerManager().generateUniqueId();
this.logNudge(b,d)}return{nudgeState:c}}updateState(a,b,c){const d=(a.kind===h.ActionKind.Start?a.target.entityIds:b.entityIds).filter((a)=>{a=c.lookup.object(a);return null!=a&&a.is(Ea.transformedObject)});switch(a.kind){case h.ActionKind.Start:return{_NudgeState_:void 0,kind:a.kind,entityIds:d,isFast:a.isFast,direction:a.direction};case h.ActionKind.Step:return Object.assign(Object.assign({},b),{kind:a.kind,entityIds:d,isFast:a.isFast});case h.ActionKind.Finish:return Object.assign(Object.assign({},
b),{kind:a.kind,entityIds:d});default:u.Utils.assertNever(a)}}logNudge(a,b){for(const c of a){a=c.is(Ea.simpleObject)&&(c.parent.is(Ea.cover)||c.parent.is(Ea.visual));const d=c.position;a={object_id:c.id,active_container:"overview",multiselect_id:b,old_x:0,old_y:0,new_x:d.x,new_y:d.y,prezi_mode:"editor",modified_value:"position",is_smart_structure:!1,is_topic_customization:a};this.logger.info({action:"modify",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(c),trigger:"nudge",payload:a})}}};
var eb={};Object.defineProperty(eb,"__esModule",{value:!0});var Xb=f.base.ObjectKind;eb.TopicZoomAreaNudgeCommander=class{constructor(a){this.cameraControl=a;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.NudgeCommander")}do(a,b,c){const d=this.cameraControl.getScreenLayoutBox();c=this.updateState(b,c,a);b=a.lookup.topic(c.originalEditorIds[0]);var e=b.cover.zoomLayoutBox;if(c.kind===h.ActionKind.Start||c.kind===h.ActionKind.Step)e=la.NudgeHelper.calculateNudgeDelta(c.direction,
c.isFast),e=b.cover.zoomLayoutBox.withReferenceFrame(d.referenceFrame).translate(e);H.TopicZoomAreaInteraction.handleInteraction(e,c,a);c.kind===h.ActionKind.Start&&(b=Object.assign(Object.assign({},c),{kind:h.ActionKind.Step}),H.TopicZoomAreaInteraction.handleInteraction(e,b,a));this.cameraControl.setScreenLayoutBox(d);return{nudgeTopicZoomAreaState:c}}updateState(a,b,c){switch(a.kind){case h.ActionKind.Start:b=c.lookup.object(a.target.entityId);if(null==b||!b.is(Xb.transformedObject))throw Error("invalid entity is being nudged");
return Object.assign(Object.assign({_NudgeTopicZoomAreaState_:void 0},H.TopicZoomAreaInteraction.calcBaseStartState(a.target.entityId,a.coTransformContent,c,this.cameraControl)),{kind:a.kind,originalEditorIds:[a.target.entityId],isFast:a.isFast,direction:a.direction});case h.ActionKind.Step:return Object.assign(Object.assign({},b),{kind:a.kind,coTransformContent:b.coTransformContentAtStart&&a.snapEnabled,isFast:a.isFast});case h.ActionKind.Finish:return Object.assign(Object.assign({},b),{kind:a.kind});
default:u.Utils.assertNever(a)}}};var Fa={};Object.defineProperty(Fa,"__esModule",{value:!0});var C=f.base.ObjectKind;Fa.TopicNestingCommander=class{constructor(a,b,c){this.cameraAccess=a;this.layoutCommander=b;this.positionFinder=c;this.logger=p.LoggerModule.getLoggerManager().createLogger("TopicNestingCommander");this.logHelper=ca.AppUtilsModule.getLogHelperUtils()}topicNestingDragMove(a,b,c){c=this.updateState(a,b,c);b={subjectIds:c.originalEditorIds,results:[]};this.setAllowedSnapTargetKinds(a,
c.originalEditorIds);var d=this.isOnTopicUnnestingZone(c);b=this.topicProximitySnap(a,c,b);c=b.state;b=b.topicNestingAction;if(d&&c.kind===h.ActionKind.Step&&c.topicNestingEnabled)return b={subjectIds:b.subjectIds,results:[...b.results,{direction:h.TopicNestingDirection.Out,factor:1,nestingThresholdReached:!0,targetTopicId:c.originalEditorIds[0]}]},a.documentDecorator.set(A.EditorCommanderInternal.getTopicNestingComponentKey(),b),{dragState:c,draggedTopicIds:[],nestingTargetTopicId:null,nestingFromTopicId:null,
nestingDirection:h.TopicNestingDirection.Out};if(c.kind===h.ActionKind.Finish&&c.topicNestingEnabled){a.documentDecorator.set(A.EditorCommanderInternal.getTopicNestingComponentKey(),b);d=d?h.TopicNestingDirection.Out:h.TopicNestingDirection.In;const e=this.handleTopicNesting(a,c,d);if(e&&0<e.movedTopics.length)return{dragState:c,draggedTopicIds:e.movedTopics,nestingTargetTopicId:e.nestTargetId,nestingFromTopicId:e.nestFromId,nestingDirection:d}}a.documentDecorator.set(A.EditorCommanderInternal.getTopicNestingComponentKey(),
b);return{dragState:c,draggedTopicIds:[],nestingTargetTopicId:null,nestingFromTopicId:null,nestingDirection:h.TopicNestingDirection.None}}updateTopicUnnestingDecorator(a,b,c){c=c&&this.isOnTopicUnnestingZone(b)?[{direction:h.TopicNestingDirection.Out,factor:1,nestingThresholdReached:!0,targetTopicId:b.originalEditorIds[0]}]:[];b={subjectIds:b.originalEditorIds,results:c};a.documentDecorator.set(A.EditorCommanderInternal.getTopicNestingComponentKey(),b)}isOnTopicUnnestingZone(a){if(!a.topicNestingEnabled)return!1;
const b=this.cameraAccess.getMarginCorrectedStageArea().getTopLeft();return 30>=n.Geometry.distance(a.mouseStagePosition,b)}setAllowedSnapTargetKinds(a,b){b.map((b)=>a.lookup.base(b)).forEach((b)=>{if(b.is(C.transformedObject)){const c=a.toDecorator(b),e=[h.SnapTargetKind.RegularPlanet,h.SnapTargetKind.SlideOnOverview,h.SnapTargetKind.SlideOnPlanet];b.is(C.stackTopic)?c.set(h.EditorCommander.getSnapDescriptionKey(),{allowedSnapTargetKinds:new Set([...e,h.SnapTargetKind.RegularStack])}):c.set(h.EditorCommander.getSnapDescriptionKey(),
{allowedSnapTargetKinds:new Set(e)})}})}getAllowedSnapTargetKinds(a,b){let c=null;a.map((a)=>b.toDecorator(a)).forEach((a)=>{a=a.get(h.EditorCommander.getSnapDescriptionKey());a=null==a?new Set:a.allowedSnapTargetKinds;c=null==c?new Set(a):new Set([...a].filter((a)=>c.has(a)))});return null==c?new Set:c}topicProximitySnap(a,b,c){var d=b.originalEditorIds.map((b)=>a.lookup.transformedObject(b)).filter((a)=>null!=a);if(0<d.length){const e=this.getAllowedSnapTargetKinds(d,a);if(0<e.size){const g=d.map((a)=>
a.id),f=d[0].parent,l=[];if(f.is(C.topic)||f.is(C.overview))b.topicNestingEnabled&&b.kind!==h.ActionKind.Finish?this.calculateProximitySnap(d,f,b.mouseStagePosition).forEach((b)=>{var c=a.lookup.base(b.targetTopicId);const d=c.is(C.planetTopic);c=c.is(C.stackTopic);let g=!1;f.is(C.overview)&&(g=e.has(h.SnapTargetKind.SlideOnOverview));f.is(C.planetTopic)&&(g=e.has(h.SnapTargetKind.SlideOnPlanet));d&&e.has(h.SnapTargetKind.RegularPlanet)&&(g=!0);c&&e.has(h.SnapTargetKind.RegularStack)&&(g=!0);g&&l.push(b)}):
f.topicChildren.forEach((a)=>{0<=g.indexOf(a.id)||l.push({targetTopicId:a.id,factor:1,nestingThresholdReached:!1,direction:h.TopicNestingDirection.In})});d=l.find((a)=>a.nestingThresholdReached);b.kind!==h.ActionKind.Finish&&(b=Object.assign(Object.assign({},b),{proximitySnapParent:null!=d?d.targetTopicId:null}));c=null!=d?{subjectIds:g,results:l}:{subjectIds:c.subjectIds,results:c.results.concat(l)}}}return{state:b,topicNestingAction:c}}calculateProximitySnap(a,b,c){const d=a.map((a)=>a.id);c=c.withReferenceFrame(b.referenceFrame);
var {minDistance:e,topicWithMinDistance:g}=this.getTopicWithClosestDistance(c,b,d,.35,a);return b.topicChildren.filter((a)=>0>d.indexOf(a.id)).map((a)=>{const b=this.projectNumberToRange(a.id===g?e:1,.3,.35,1.3,1);return{nestingThresholdReached:1.05<b,factor:b,targetTopicId:a.id,direction:h.TopicNestingDirection.In}})}getTopicWithClosestDistance(a,b,c,d,e){let g=Number.MAX_SAFE_INTEGER,f=null;b.topicChildren.forEach((b)=>{if(!(0<=c.indexOf(b.id)||b.is(C.stackTopic)&&e.some((a)=>a.is(C.planetTopic)))){var h=
Math.max(Math.abs(a.x-b.layoutBox.center.x)/b.layoutBox.size.width,Math.abs(a.y-b.layoutBox.center.y)/b.layoutBox.size.height);h=Math.min(d,h);h<g&&(g=h,f=b.id)}});return{minDistance:g,topicWithMinDistance:f}}projectNumberToRange(a,b,c,d,e){const g=c-b;return a<b?d:a>c?e:(a-b)/g*e+(c-a)/g*d}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:return Object.assign(Object.assign({},c),{kind:b.kind,topicNestingEnabled:!0});case h.ActionKind.Step:return a=this.cameraAccess.getScreenLayoutBox().referenceFrame,
c=Object.assign(Object.assign({},c),{kind:b.kind,snapEnabled:!b.isSnapDisableKeyPressed,topicNestingEnabled:!b.isTopicNestingDisableKeyPressed,mouseStagePosition:a.point(b.stagePosition),dragGroup:c.dragGroup,isParentLayouted:c.isParentLayouted});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}handleTopicNesting(a,b,c){const d=b.originalEditorIds.map((b)=>a.lookup.base(b)).filter((a)=>a.is(C.transformedObject)).map((b)=>a.lookup.transformedObject(b.id));
if(0===b.originalEditorIds.length||d.length!==b.originalEditorIds.length)return null;switch(c){case h.TopicNestingDirection.In:return this.nestEntitiesIfNeeded(a,b,d);case h.TopicNestingDirection.Out:return this.unnestEntitiesIfNeeded(b,d);case h.TopicNestingDirection.None:return null;default:u.Utils.assertNever(c)}}nestEntitiesIfNeeded(a,b,c){const d=c[0].parent;if(!d.is(C.topic)&&!d.is(C.overview))return null;var e=this.calculateProximitySnap(c,d,b.mouseStagePosition).filter((a)=>a.nestingThresholdReached).sort((a,
b)=>b.factor-a.factor);if(0===e.length)return null;a=a.lookup.topic(e[0].targetTopicId);e=c.filter((a)=>a.is(C.topic));c=c.filter((a)=>!a.is(C.topic));b=[...this.nestTopics(b,a,e,0<c.length),...this.nestSimpleObjects(b,a,c)];return 0<b.length?{movedTopics:b,nestTargetId:a.id,nestFromId:d.id}:null}nestTopics(a,b,c,d){return 0===c.length?[]:b.is(C.planetTopic)?this.nestIntoPlanet(b,c,a,d):b.is(C.stackTopic)&&c.every((a)=>a.is(C.stackTopic))?this.nestIntoStack(b,c):[]}nestSimpleObjects(a,b,c){const d=
b.is(C.stackTopic)?b.pageChildren[0]:b;a=this.reparentSimpleObjects(a,d,c);b.is(C.planetTopic)?this.ensureMovedObjectsAreAboveTargetChildren(c,[...d.simpleChildren(f.base.ChildVisibilityKind.inside)]):b.is(C.stackTopic)&&this.ensureMovedObjectsAreAboveTargetChildren(c,[...d.simpleChildren(f.base.ChildVisibilityKind.inside),...b.visual.contentChildren]);return a}unnestEntitiesIfNeeded(a,b){const c=b[0].parent;if(c.is(C.overview))return null;const d=c.parent.is(C.stackTopic)?c.parent.parent:c.parent,
e=b.filter((a)=>a.is(C.topic));b=b.filter((a)=>!a.is(C.topic));a=[...this.doUnnestTopics(a,d,e,0<b.length),...this.unnestSimpleObjects(a,d,b)];return 0<a.length?{movedTopics:a,nestTargetId:d.id,nestFromId:c.id}:null}doUnnestTopics(a,b,c,d){return 0===c.length?[]:b.is(C.planetTopic)?this.nestIntoPlanet(b,c,a,d):b.is(C.overview)?this.nestIntoOverview(b,c,a,d):[]}unnestSimpleObjects(a,b,c){return this.reparentSimpleObjects(a,b,c)}nestIntoStack(a,b){const c=b.map((a)=>a.id);b.forEach((b)=>b.pageChildren.forEach((b)=>
{b=a.add.inserter(b.copy());b.isValid()&&b.insert()}));b.forEach((a)=>a.delete());return c}nestIntoPlanet(a,b,c,d=!0){const e=new ta.LayoutQueryImpl,g=b[0].parent,h=a.layout.isValid();if(!d&&e.isSortedBySlideIdx(a)){const c=a.parent,d=[...a.topicChildren,...b];a.topicChildren.forEach((a)=>a.parent=c);(e.isSortedBySlideIdx(a)?d.slice().sort((a,b)=>e.getSlideTopicIndex(a)-e.getSlideTopicIndex(b)):d).forEach((b)=>b.parent=a)}else b.forEach((b)=>{this.reparentTopics(c,b,a,d)});c.isParentLayouted&&g.layout.reset();
!d&&h&&a.layout.reset();this.ensureMovedObjectsAreAboveTargetChildren(b,[...a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside)]);return b.map((a)=>a.id)}nestIntoOverview(a,b,c,d){const e=b[0].parent;b.forEach((b)=>{this.reparentTopics(c,b,a,d)});c.isParentLayouted&&e.layout.reset();return b.map((a)=>a.id)}reparentTopics(a,b,c,d){d?this.reparentSimpleObjects(a,c,[b]):(b.parent=c,a=this.positionFinder.findTopicPosition(b,c.topicChildren),b.fitInto(a))}reparentSimpleObjects(a,b,c){if(0===
c.length)return[];const d=c[0].createLayoutGroupWith(c.slice(1));let e=null;for(var g of c){const b=a.dragGroup.getOriginalDragLayoutBoxForEditor(g);e=null==e?b:e.union(b)}a=b.referenceFrame.layoutBox(a.originalZoomLayoutBox.center,a.originalZoomLayoutBox.size).withRotationRad(a.originalZoomLayoutBox.rotationRad);g=a.fitIntoOther(b.zoomLayoutBox);d.tryToSetParent(b);b=b.referenceFrame.layoutBox(e.center,e.size).withRotationRad(e.rotationRad).align(a.topLeft,a.topRight,g.topLeft,g.topRight);d.fitInto(b);
return c.map((a)=>a.id)}ensureMovedObjectsAreAboveTargetChildren(a,b){a=a.slice(0);a.sort((a,b)=>a.isAbove(b)?1:-1);b.sort((a,b)=>a.isAbove(b)?1:-1);b=b.pop();if(null!=b)for(let c=0;c<a.length;c++)0===c?a[0].moveAbove(b):a[c].moveAbove(a[c-1])}};var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.MaskDragCommander=class{constructor(a){this.cameraAccess=a;this.logger=p.avro.Avro.createDefaultLogger()}resizeAreaNonProportional(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;
switch(b.kind){case h.ActionKind.Start:a=a.lookup.image(b.target.entityId);c=this.upscaleLayoutBoxToFullImage(a);c={_MaskAreaNonProportionalResizeState_:void 0,resizeAnchor:b.resizeAnchor,originalLayoutBox:a.layoutBox,originalFullLayoutBox:c,originalMousePosition:d.point(b.originalMouseStagePosition),maxScale:this.calcMaxScale(a),originalMaskPoints:this.calcMaskPoints(a.mask),entityId:b.target.entityId,originalMask:a.mask,isCenterResize:!1,isWidthResize:b.isWidthResize};break;case h.ActionKind.Step:c=
Object.assign(Object.assign({},c),{isCenterResize:b.isCenterResizeKeyPressed});c.isWidthResize?this.doMaskAreaWidthResize(a,c,d.point(b.stagePosition)):this.doMaskAreaHeightResize(a,c,d.point(b.stagePosition));break;case h.ActionKind.Finish:this.logger.logResizeImageInMaskingMode({image_masking_size_change_source:"CANVAS",image_masking_mode:"CROPPING"});break;default:u.Utils.assertNever(b)}return{state:c}}resizeArea(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;switch(b.kind){case h.ActionKind.Start:a=
a.lookup.image(b.target.entityId);c=this.upscaleLayoutBoxToFullImage(a);c={_MaskAreaResizeState_:void 0,resizeAnchor:b.resizeAnchor,originalLayoutBox:a.layoutBox,originalFullLayoutBox:c,originalMousePosition:d.point(b.originalMouseStagePosition),maxScale:this.calcMaxScale(a),originalMaskPoints:this.calcMaskPoints(a.mask),entityId:b.target.entityId,originalMask:a.mask,isCenterResize:!1};break;case h.ActionKind.Step:c=Object.assign(Object.assign({},c),{isCenterResize:b.isCenterResizeKeyPressed});this.doMaskAreaResize(a,
c,d.point(b.stagePosition));break;case h.ActionKind.Finish:this.logger.logResizeImageInMaskingMode({image_masking_size_change_source:"CANVAS",image_masking_mode:"CROPPING"});break;default:u.Utils.assertNever(b)}return{state:c}}calcMaskPoints(a){return{topLeft:{x:a.x,y:a.y},topRight:{x:a.x+a.width,y:a.y},bottomLeft:{x:a.x,y:a.y+a.height},bottomRight:{x:a.x+a.width,y:a.y+a.height},center:{x:a.x+a.width/2,y:a.y+a.height/2}}}calcMaxScale(a){const b=a.mask;a=a.imageAsset;return{left:(b.x+b.width)/b.width,
right:(a.width-b.x)/b.width,top:(b.y+b.height)/b.height,bottom:(a.height-b.y)/b.height}}doMaskAreaHeightResize(a,b,c){this.doMaskAreaResizeI(a,b,c,[b.maxScale.top,b.maxScale.bottom],(a,b)=>({width:b.width,height:b.height*a}))}doMaskAreaWidthResize(a,b,c){this.doMaskAreaResizeI(a,b,c,[b.maxScale.left,b.maxScale.right],(a,b)=>({width:b.width*a,height:b.height}))}doMaskAreaResize(a,b,c){this.doMaskAreaResizeI(a,b,c,[b.maxScale.left,b.maxScale.top,b.maxScale.right,b.maxScale.bottom],(a,b)=>({width:b.width*
a,height:b.height*a}))}doMaskAreaResizeI(a,b,c,d,e){c=this.calculateScale(b.originalMousePosition,c,b.resizeAnchor,b.originalLayoutBox,b.originalLayoutBox.asReferenceFrame,b.isCenterResize);a=a.lookup.image(b.entityId);let g,f;b.isCenterResize?(g=e(Math.min(c,...d.map((a)=>1+2*(a-1))),b.originalMask),f={x:b.originalMaskPoints.center.x-g.width/2,y:b.originalMaskPoints.center.y-g.height/2}):-1===b.resizeAnchor.rx&&-1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.left,b.maxScale.top),b.originalMask),
f={x:b.originalMaskPoints.bottomRight.x-g.width,y:b.originalMaskPoints.bottomRight.y-g.height}):-1===b.resizeAnchor.rx&&1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.left,b.maxScale.bottom),b.originalMask),f={x:b.originalMaskPoints.topRight.x-g.width,y:b.originalMaskPoints.topRight.y}):1===b.resizeAnchor.rx&&-1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.right,b.maxScale.top),b.originalMask),f={x:b.originalMaskPoints.topLeft.x,y:b.originalMaskPoints.bottomLeft.y-g.height}):1===b.resizeAnchor.rx&&
1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.right,b.maxScale.bottom),b.originalMask),f=Object.assign({},b.originalMaskPoints.topLeft)):-1===b.resizeAnchor.rx&&0===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.left),b.originalMask),f={x:b.originalMaskPoints.topRight.x-g.width,y:b.originalMaskPoints.topLeft.y}):1===b.resizeAnchor.rx&&0===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.right),b.originalMask),f=Object.assign({},b.originalMaskPoints.topLeft)):0===b.resizeAnchor.rx&&-1===b.resizeAnchor.ry?
(g=e(Math.min(c,b.maxScale.top),b.originalMask),f={x:b.originalMaskPoints.topLeft.x,y:b.originalMaskPoints.bottomLeft.y-g.height}):0===b.resizeAnchor.rx&&1===b.resizeAnchor.ry&&(g=e(Math.min(c,b.maxScale.bottom),b.originalMask),f=Object.assign({},b.originalMaskPoints.topLeft));a.mask={x:Math.round(f.x),y:Math.round(f.y),width:Math.round(g.width),height:Math.round(g.height)};d=b.isCenterResize?{rx:0,ry:0}:{rx:-b.resizeAnchor.rx,ry:-b.resizeAnchor.ry};a.fitInto(a.layoutBox.move(d,b.originalLayoutBox.point(d)))}resize(a,
b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;if(b.kind===h.ActionKind.Start){var e=a.lookup.image(b.target.entityId);a=this.upscaleLayoutBoxToFullImage(e);return{state:{_MaskImageResizeState_:void 0,resizeAnchor:b.resizeAnchor,originalLayoutBox:e.layoutBox,originalFullLayoutBox:a,originalMousePosition:d.point(b.originalMouseStagePosition),entityId:b.target.entityId,originalMask:e.mask,isCenterResize:!1}}}if(b.kind===h.ActionKind.Finish)return this.logger.logResizeImageInMaskingMode({image_masking_size_change_source:"CANVAS",
image_masking_mode:"MASKING"}),{state:{_MaskImageResizeState_:void 0,resizeAnchor:null,originalMousePosition:null,originalLayoutBox:null,originalFullLayoutBox:null,entityId:null,originalMask:null,isCenterResize:!1}};e=Object.assign(Object.assign({},c),{isCenterResize:b.isCenterResizeKeyPressed});a=a.lookup.image(e.entityId);b=this.calculateResize(c.originalMousePosition,d.point(b.stagePosition),c.resizeAnchor,c.originalFullLayoutBox,c.originalFullLayoutBox.asReferenceFrame,c.isCenterResize);b=this.resizeImageMask(e,
a,b,e.resizeAnchor);a.mask=b;a.fitInto(e.originalLayoutBox);return{state:e}}moveArea(a,b,c){b.kind===h.ActionKind.Start?(a=a.lookup.image(b.target.entityId),c=this.cameraAccess.getScreenLayoutBox().referenceFrame,c={_DragMaskAreaState_:void 0,originalLayoutBox:a.layoutBox,originalMousePosition:c.point(b.originalMouseStagePosition),entityId:b.target.entityId,originalMask:a.mask}):b.kind===h.ActionKind.Finish?this.logger.logPanImageInMaskingMode({image_masking_mode:"CROPPING"}):this.doMoveArea(a,c,
b.stagePosition);return{state:c}}doMoveArea(a,b,c){var d=this.cameraAccess.getScreenLayoutBox().referenceFrame;a=a.lookup.image(b.entityId);var e=b.originalLayoutBox.asReferenceFrame;d=this.calculateMoveDelta(b.originalMousePosition.withReferenceFrame(e),d.point(c).withReferenceFrame(e));c=b.originalLayoutBox.withReferenceFrame(e);b=b.originalMask;e=b.width/c.size.width;const g=b.height/c.size.height;d={x:Math.max(0,Math.min(a.imageAsset.width-b.width,b.x+Math.round(d.x*e))),y:Math.max(0,Math.min(a.imageAsset.height-
b.height,b.y+Math.round(d.y*g))),width:b.width,height:b.height};b={x:(d.x-b.x)/e,y:(d.y-b.y)/g};a.mask=d;a.fitInto(c.translate(b))}moveImage(a,b,c){if(b.kind===h.ActionKind.Start)return c=a.lookup.image(b.target.entityId),a=this.cameraAccess.getScreenLayoutBox().referenceFrame,{state:{_DragMaskImageState_:void 0,originalLayoutBox:c.layoutBox,originalMousePosition:a.point(b.originalMouseStagePosition),entityId:b.target.entityId,originalMask:c.mask}};b.kind===h.ActionKind.Finish?this.logger.logPanImageInMaskingMode({image_masking_mode:"MASKING"}):
(a=a.lookup.image(c.entityId),b=this.calculateMove(a,c,b),a.mask=this.calculateNewMaskArea(c,a,b));return{state:c}}upscaleLayoutBoxToFullImage(a){const b=a.layoutBox.size.width*a.imageAsset.width/a.mask.width,c=a.layoutBox.size.height*a.imageAsset.height/a.mask.height;return a.layoutBox.asReferenceFrame.layoutBox({x:a.layoutBox.topLeft.x-a.mask.x/a.imageAsset.width*b+b/2,y:a.layoutBox.topLeft.y-a.mask.y/a.imageAsset.height*c+c/2},{height:c,width:b})}resizeImageMask(a,b,c,d){const e={width:a.originalMask.width/
b.imageAsset.width*a.originalFullLayoutBox.size.width,height:a.originalMask.height/b.imageAsset.height*a.originalFullLayoutBox.size.height};var g=this.rotate({x:a.originalMask.x/b.imageAsset.width*a.originalFullLayoutBox.size.width,y:a.originalMask.y/b.imageAsset.height*a.originalFullLayoutBox.size.height},c.rotationRad);g={x:g.x+a.originalFullLayoutBox.topLeft.x,y:g.y+a.originalFullLayoutBox.topLeft.y};c=this.calcMinLayoutBox(g,c,e,d,a.isCenterResize);const f=this.rotate({x:(g.x-c.topLeft.x)/c.size.width*
b.imageAsset.width,y:(g.y-c.topLeft.y)/c.size.height*b.imageAsset.height},-c.rotationRad),{width:h,height:l}=a.originalMask,{rx:m,ry:n}=d,p=a.originalFullLayoutBox.size.width/c.size.width;b=(()=>{if(a.isCenterResize||-1===m&&-1===n)return{x:f.x,y:f.y,width:h*p,height:l*p};if(1===m&&1===n)return{x:a.originalMask.x*p,y:a.originalMask.y*p,width:h*p,height:l*p};if(1===m&&-1===n)return{x:a.originalMask.x*p,y:f.y,width:h*p,height:l*p};if(-1===m&&1===n)return{x:f.x,y:a.originalMask.y*p,width:h*p,height:l*
p};throw Error("Unrecognized resize anchor used");})();return{x:Math.round(b.x),y:Math.round(b.y),width:Math.round(b.width),height:Math.round(b.height)}}layoutBoxFromCorners(a,b,c){return a.layoutBox({x:(b.x+c.x)/2,y:(b.y+c.y)/2},{width:c.x-b.x,height:c.y-b.y})}lessWithDelta(a,b){return 1E-6>Math.abs(a-b)?!1:a<b}calcMinLayoutBox(a,b,c,d,e){return e?this.calcMinLayoutBoxCenterResize(a,b,c):this.calcMinLayoutBoxGeneral(a,b,c,d)}calcMinLayoutBoxCenterResize(a,b,c){this.lessWithDelta(a.x,b.topLeft.x)&&
(b=b.scaleToWidth(b.size.width+2*(b.topLeft.x-a.x)));this.lessWithDelta(a.y,b.topLeft.y)&&(b=b.scaleToHeight(b.size.height+2*(b.topLeft.y-a.y)));this.lessWithDelta(b.topRight.x,a.x+c.width)&&(b=b.scaleToWidth(b.size.width+2*(a.x+c.width-b.topRight.x)));this.lessWithDelta(b.bottomRight.y,a.y+c.height)&&(b=b.scaleToHeight(b.size.height+2*(a.y+c.height-b.bottomRight.y)));return b}calcMinLayoutBoxGeneral(a,b,c,d){d={rx:-1*d.rx,ry:-1*d.ry};const e=b.point(d);if(this.lessWithDelta(a.x,b.topLeft.x)){var g=
this.scaleSize(b.size,(b.size.width+(b.topLeft.x-a.x))/b.size.width);b=this.layoutBoxFromCorners(b.referenceFrame,{x:e.x-g.width,y:-1===d.ry?e.y:e.y-g.height},{x:e.x,y:-1===d.ry?e.y+g.height:e.y})}this.lessWithDelta(a.y,b.topLeft.y)&&(g=this.scaleSize(b.size,(b.size.height+(b.topLeft.y-a.y))/b.size.height),b=this.layoutBoxFromCorners(b.referenceFrame,{x:-1===d.rx?e.x:e.x-g.width,y:e.y-g.height},{x:-1===d.rx?e.x+g.width:e.x,y:e.y}));this.lessWithDelta(b.topRight.x,a.x+c.width)&&(g=this.scaleSize(b.size,
(b.size.width+(a.x+c.width-b.topRight.x))/b.size.width),b=this.layoutBoxFromCorners(b.referenceFrame,{x:e.x,y:-1===d.ry?e.y:e.y-g.height},{x:e.x+g.width,y:-1===d.ry?e.y+g.height:e.y}));this.lessWithDelta(b.bottomRight.y,a.y+c.height)&&(a=this.scaleSize(b.size,(b.size.height+(a.y+c.height-b.bottomRight.y))/b.size.height),b=this.layoutBoxFromCorners(b.referenceFrame,{x:-1===d.rx?e.x:e.x-a.width,y:e.y},{x:-1===d.rx?e.x+a.width:e.x,y:e.y+a.height}));return b}scaleSize(a,b){return{width:a.width*b,height:a.height*
b}}rotate(a,b){return{x:a.x*Math.cos(b)+a.y*Math.sin(b),y:-1*a.x*Math.sin(b)+a.y*Math.cos(b)}}calculateNewMaskArea(a,b,c){const d=a.originalLayoutBox,{x:e,y:g}=this.rotate({x:d.topLeft.x-c.topLeft.x,y:d.topLeft.y-c.topLeft.y},c.rotationRad),{width:f,height:h}=a.originalMask;return{x:Math.max(0,Math.min(a.originalMask.x+b.imageAsset.width/d.size.width*e,Math.floor(b.imageAsset.width-f))),y:Math.max(0,Math.min(a.originalMask.y+b.imageAsset.height/d.size.height*g,Math.floor(b.imageAsset.height-h))),
width:f,height:h}}calculateScale(a,b,c,d,e,g){const f=this.cameraAccess.getScreenLayoutBox().referenceFrame,h=d.center.withReferenceFrame(e);c=d.point(c).withReferenceFrame(e);a=a.withReferenceFrame(e);b=b.withReferenceFrame(e);b=n.Geometry.fromCoordinates(h.x-c.x,h.y-c.y).normalize().dot(n.Geometry.fromCoordinates(a.x-b.x,a.y-b.y));g||(b/=2);g=n.Geometry.distance(h,c);d=n.Geometry.distance(f.point({x:0,y:0}).withReferenceFrame(e),f.point({x:0,y:10}).withReferenceFrame(e))/d.withReferenceFrame(e).size.width;
return Math.max(d,(g+b)/g)}calculateResize(a,b,c,d,e,g){a=this.calculateScale(a,b,c,d,e,g);c=g?{rx:0,ry:0}:{rx:-c.rx,ry:-c.ry};return d.scale(a).move(c,d.point(c))}calculateMoveDelta(a,b){return n.Geometry.fromPoint(b).sub(n.Geometry.fromPoint(a)).toPoint()}calculateMove(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame,e=a.parent.referenceFrame,{x:g,y:f}=this.calculateMoveDelta(b.originalMousePosition.withReferenceFrame(e),d.point(c.stagePosition).withReferenceFrame(e));c=b.originalLayoutBox;
return e.layoutBox(c.center,c.size).rotateRad(c.rotationRad).translate({x:b.originalMask.width/a.imageAsset.width*g,y:b.originalMask.height/a.imageAsset.height*f})}};var fb={};Object.defineProperty(fb,"__esModule",{value:!0});fb.OverviewZoomAreaNudgeCommander=class{constructor(a){this.cameraControl=a;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.NudgeCommander")}do(a,b,c){c=this.updateState(b,c,a);if(c.kind===h.ActionKind.Start||c.kind===h.ActionKind.Step){b=
la.NudgeHelper.calculateNudgeDelta(c.direction,c.isFast);const d=this.cameraControl.getScreenLayoutBox();b=a.overview.zoomLayoutBox.withReferenceFrame(d.referenceFrame).translate(b);a.overview.fitInto(b)}return{nudgeOverviewZoomAreaState:c}}updateState(a,b){switch(a.kind){case h.ActionKind.Start:return{_NudgeOverviewZoomAreaState_:void 0,kind:a.kind,isFast:a.isFast,direction:a.direction};case h.ActionKind.Step:return Object.assign(Object.assign({},b),{kind:a.kind,isFast:a.isFast});case h.ActionKind.Finish:return Object.assign(Object.assign({},
b),{kind:a.kind});default:u.Utils.assertNever(a)}}};var ma={};Object.defineProperty(ma,"__esModule",{value:!0});ma.DragOverviewCommander=class extends F.SnappableBase{constructor(a){super();this.cameraAccess=a}updateState(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;switch(b.kind){case h.ActionKind.Start:return{_DragOverviewMoveState_:void 0,kind:b.kind,dragStartStagePosition:d.point(b.originalMouseStagePosition),mouseStagePosition:d.point(b.mouseStagePosition),originalBounds:a.overview.zoomLayoutBox,
snapEnabled:!1,referenceSegments:null};case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:d.point(b.stagePosition),snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}doAction(a,b){var c=b.originalBounds.referenceFrame;a=b.mouseStagePosition.withReferenceFrame(c);c=b.dragStartStagePosition.withReferenceFrame(c);a=n.Geometry.fromPoint(a).sub(n.Geometry.fromPoint(c)).toPoint();
return{targetLayoutBox:b.originalBounds.translate(a),state:b}}doSnapAction(a,b,c){a=N.MoveSnapHelper.calculateMoveSnap(a,{kind:D.SnapIntentionKind.overviewSnap,referenceSegments:b.referenceSegments,targetLayoutBox:c,cameraAccess:this.cameraAccess});return{targetLayoutBox:a.targetLayoutBox,snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){a.overview.fitInto(c);b.kind===h.ActionKind.Finish&&p.avro.Avro.createDefaultLogger().logDragObject({object_type:a.overview,
topic_relationship:a.overview,object_id:null});return{dragOverviewMoveState:b}}};ma.ResizeOverviewCommander=class extends F.SnappableBase{constructor(a){super();this.cameraAccess=a}updateState(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;switch(b.kind){case h.ActionKind.Start:return{_DragOverviewResizeState_:void 0,kind:b.kind,originalBounds:a.overview.zoomLayoutBox,mouseStartStagePosition:d.point(b.originalMouseStagePosition),mouseStagePosition:d.point(b.mouseStagePosition),
isCenterResize:b.isCenterResize,snapEnabled:!1,referenceSegments:null,minScale:0,resizeAnchor:b.resizeAnchor};case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:d.point(b.stagePosition),isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:u.Utils.assertNever(b)}}doAction(a,b){a=Aa.calcResizeBounds(this.cameraAccess.getScreenLayoutBox(),
b.originalBounds,b.mouseStagePosition,b.mouseStartStagePosition,b.resizeAnchor,b.isCenterResize);return{targetLayoutBox:a.targetLayoutBox,state:Object.assign(Object.assign({},b),{minScale:a.minScale})}}doSnapAction(a,b,c){a=G.ResizeSnapHelper.calculateResizeSnap(a,{kind:D.SnapIntentionKind.overviewSnap,isCenterResize:b.isCenterResize,referenceSegments:b.referenceSegments,resizeAnchor:b.resizeAnchor,scaledLayoutBox:c,originalLayoutBox:b.originalBounds,minScale:b.minScale,cameraAccess:this.cameraAccess});
return{targetLayoutBox:a.targetLayoutBox,snapAction:{results:a.snapResults},state:Object.assign(Object.assign({},b),{referenceSegments:a.referenceSegments})}}finishAction(a,b,c){a.overview.fitInto(c);b.kind===h.ActionKind.Finish&&p.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a.overview,modify_action:"RESIZE",topic_relationship:a.overview,object_id:null});return{dragOverviewResizeState:b}}};var gb={};Object.defineProperty(gb,"__esModule",{value:!0});var hb=f.base.ObjectKind;gb.ActionCommanderImpl=
class{constructor(a,b,c,d){this.cameraControl=a;this.layoutCommander=b;this.positionFinder=c;this.coverEditApi=d;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.ActionCommanderImpl")}arc(a,b,c){return(new ab.DragArcCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}dragMove(a,b,c){return(new bb.DragMoveCommander(this.cameraControl,this.layoutCommander,this.positionFinder,this.coverEditApi)).do(a,b,c)}drawInsert(a,b,c){return(new O.DrawInsertCommander(this.cameraControl,
this.coverEditApi)).do(a,b,c)}topicNestingDragMove(a,b,c){return(new Fa.TopicNestingCommander(this.cameraControl,this.layoutCommander,this.positionFinder)).topicNestingDragMove(a,b,c)}updateTopicUnnestingDecorator(a,b,c){(new Fa.TopicNestingCommander(this.cameraControl,this.layoutCommander,this.positionFinder)).updateTopicUnnestingDecorator(a,b,c)}topicZoomAreaMove(a,b,c){return(new cb.DragTopicZoomAreaMoveCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}rotate(a,b,c){return(new Ba.DragRotateCommander(this.cameraControl,
this.coverEditApi)).do(a,b,c)}resize(a,b,c){return(new O.DragResizeCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}resizeSingleText(a,b,c){return(new O.DragResizeSingleTextCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}topicZoomAreaResize(a,b,c){return(new Da.DragTopicZoomAreaResizeCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}nonProportionalResize(a,b,c){return(new ea.DragNonProportionalResizeCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}nudge(a,b,
c){return(new db.NudgeCommander(this.cameraControl)).do(a,b,c)}nudgeTopicZoomArea(a,b,c){return(new eb.TopicZoomAreaNudgeCommander(this.cameraControl)).do(a,b,c)}nudgeOverviewZoomArea(a,b,c){return(new fb.OverviewZoomAreaNudgeCommander(this.cameraControl)).do(a,b,c)}maskResizeImage(a,b,c){return(new Z.MaskDragCommander(this.cameraControl)).resize(a,b,c)}maskResizeArea(a,b,c){return(new Z.MaskDragCommander(this.cameraControl)).resizeArea(a,b,c)}maskNonProportionalResizeArea(a,b,c){return(new Z.MaskDragCommander(this.cameraControl)).resizeAreaNonProportional(a,
b,c)}maskImageMove(a,b,c){return(new Z.MaskDragCommander(this.cameraControl)).moveImage(a,b,c)}maskAreaMove(a,b,c){return(new Z.MaskDragCommander(this.cameraControl)).moveArea(a,b,c)}overviewMove(a,b,c){return(new ma.DragOverviewCommander(this.cameraControl)).do(a,b,c)}overviewResize(a,b,c){return(new ma.ResizeOverviewCommander(this.cameraControl)).do(a,b,c)}deleteObjectCmd(a,b){return{name:"delete object",run:(c)=>{if(0!==a.length){this.logObjectDelete(c,b,a);var d=new Map;for(var e of a){const a=
c.lookup.object(e).parent;d.has(a.id)||d.set(a.id,new Set);d.get(a.id).add(e)}for(let a of d.keys())e=c.lookup.base(a),null!=e&&(e.is(f.base.ObjectKind.topicParent)?e.layout.delete([...d.get(a).values()].map((a)=>c.lookup.transformedObject(a))):d.get(a).forEach((a)=>{c.lookup.object(a).delete()}))}}}}logObjectDelete(a,b,c){const d=p.LoggerModule.getLoggerManager().generateUniqueId(),e=a.lookup.object(c[0]),f=1<c.length?"MULTIPLE":e;p.avro.Avro.createDefaultLogger().logDeleteObject({object_type:f,
topic_relationship:e,delete_type:b,object_id:"MULTIPLE"===f?null:e.id});c.forEach((e)=>{e=a.lookup.object(e);if(null!=e){const a={object_id:e.id,active_container:"overview",multiselect_id:d,prezi_mode:"editor"},f={action:"delete",object:p.LoggerModule.getAvroLoggerHelper().getLogObjectType(e),trigger:b,payload:a};e.is(hb.chart)&&null!=e.chartAsset&&(a.chart_type=e.chartAsset.chartType,f.feature="chart");this.logger.info(f);e.is(hb.simpleObject)&&e.parent.is(hb.cover)&&-1===c.indexOf(e.parent.parent.id)&&
this.logger.info({action:"delete",object:"coveritem",trigger:"machine",payload:{coveritem_id:e.id,topic_id:e.parent.parent.id}});p.avro.Avro.createDefaultLogger().logDeletedObject({object_type:e,topic_relationship:e,delete_type:b,object_id:e.id})}})}};var ib={};Object.defineProperty(ib,"__esModule",{value:!0});var aa=f.base.ObjectKind;ib.CoverCommanderImpl=class{convertToTopicVisualCmd(a){return{name:"convertToTopicVisualCmd",run:(b)=>{a.forEach((a)=>{a=b.lookup.simpleObject(a);a.parent.is(aa.topic)?
a.parent=a.parent.visual:a.parent.is(aa.cover)&&(a.parent=a.parent.parent.visual)})}}}convertToCoverItemCmd(a){return{name:"convertToCoverItemCmd",run:(b)=>{a.forEach((a)=>{a=b.lookup.simpleObject(a);a.parent.is(aa.topic)?a.parent=a.parent.cover:a.parent.is(aa.visual)&&(a.parent=a.parent.parent.cover)})}}}convertToContentItemCmd(a){return{name:"convertToContentItemCmd",run:(b)=>{a.forEach((a)=>{a=b.lookup.simpleObject(a);(a.parent.is(aa.cover)||a.parent.is(aa.visual))&&a.parent.parent.is(aa.planetTopic)&&
(a.parent=a.parent.parent)})}}}};var jb={};Object.defineProperty(jb,"__esModule",{value:!0});jb.ZObjectEditorCommandsBase=class{constructor(a,b,c){this.cameraAccess=a;this.positionFinder=b;this.insertHierarchyDestination=c;this.logger=p.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.ZObjectEditorCommandsBase");this.insertedEntityIdsBus=vb.Bacon.newBus()}simpleObjectParentEditor(a){const b=this.insertHierarchyDestination.getCurrentKind();switch(b){case f.InsertHierarchyDestinationKind.CHILD:return a.lookup.simpleObjectParent(this.insertHierarchyDestination.getCurrentParentId());
case f.InsertHierarchyDestinationKind.COVER:return a.lookup.topic(this.insertHierarchyDestination.getCurrentParentId()).cover;default:u.Utils.assertNever(b)}}getInsertedEntityIdsStream(){return this.insertedEntityIdsBus}getRGBString(a){return"#"+(16777216+(a.r<<16)+(a.g<<8)+a.b).toString(16).slice(1)}};var kb={};Object.defineProperty(kb,"__esModule",{value:!0});var Yb=f.base.ObjectKind;kb.PreziDocCommanderImpl=class extends jb.ZObjectEditorCommandsBase{constructor(a,b,c,d){super(b,c,d);this.scene=
a}copyObjects(a){const b=this.scene.getPrezi().getComponent(w.CetModel.MODEL()).getPdomObject();return Ib.DOM.copyObjects(b,a)}insertCmd(a){return{name:"insertCmd",run:(b)=>{const c=f.CetModelEditor.createLegacyInserter().insertLegacy(b,a,this.positionFinder,this.cameraAccess);this.insertedEntityIdsBus.push({ids:c.ids,objectsIdsToSelect:c.topLevelChapterIds.concat(c.topLevelSimpleObjectIds),dontSelect:!1,flyToId:this.calculateFlyToId(b,a.targetParentId,c.pageIds)});return{ids:c.ids}}}}calculateFlyToId(a,
b,c){a=a.lookup.base(b);return 0<c.length&&null!=a&&a.is(Yb.page)?c[0]:null}};var lb={};Object.defineProperty(lb,"__esModule",{value:!0});lb.ZObjectEditorImpl=class{constructor(a,b,c,d,e,f,h){this.scene=a;this.runner=b;this.insertHierarchyDestination=c;this.mediaService=d;this.assetThumbnailAnnouncer=e;this.cameraControl=f;this.editorSession=h;if(null==this.scene)throw Error("scene cannot be null");if(null==this.insertHierarchyDestination)throw Error("insertHierarchyDestination cannot be null");if(null==
this.mediaService)throw Error("mediaService cannot be null");if(null==this.assetThumbnailAnnouncer)throw Error("assetThumbnailAnnouncer cannot be null");}beginAsyncApiCommand(a,b){return this.runner.beginAsyncApiCommand(a,b)}executeApiCommand(a,b){return this.runner.executeApiCommand(a,b)}executeLegacyCommand(a,b){return this.runner.executeLegacyCommand(a,b)}get action(){null==this._action&&(this._action=new gb.ActionCommanderImpl(this.cameraControl,this.layout,this.editorSession.positionFinder,this.editorSession.coverEdit));
return this._action}get doc(){null==this._doc&&(this._doc=new kb.PreziDocCommanderImpl(this.scene,this.cameraControl,this.editorSession.positionFinder,this.insertHierarchyDestination));return this._doc}get cover(){null==this._cover&&(this._cover=new ib.CoverCommanderImpl);return this._cover}get layout(){null==this._layout&&(this._layout=h.EditorCommander.createLayoutCommander(h.EditorCommander.getLayoutRepository(),this.editorSession.positionFinder));return this._layout}get assetManager(){return this.editorSession.document.progressiveAssetManager}getInsertedEntityIdsStream(){return vb.Bacon.mergeAll([this.doc.getInsertedEntityIdsStream()])}read(a){return this.runner.read(a)}};
var mb={};Object.defineProperty(mb,"__esModule",{value:!0});mb.TopicShapeRolesManagerImpl=class{cleanTopicShapeRolesCmd_internal(){return{name:"Remove topic shapes roles and revert document generation (dev feature)",runLegacy:(a)=>{a.mscene.getPreziW().getMutableZObjects().forEachMutable((a)=>{a.is(w.CetModel.ID.Z_TOPIC_CONTAINER)&&(a=a.getMutableTopic().getEntity(),a.isDef(w.CetModel.ID.HAS_TOPIC_CHILDREN)&&a.getMutableWrapper(w.CetModel.ID.HAS_TOPIC_CHILDREN.W).getMutableTopicChildren().forEachMutable((a)=>
{a=a.getMutableBehaviour();a.is(w.CetModel.ID.VISUAL)&&null!=a.getLayoutRole()&&(a.getLayoutRole().is(w.CetModel.ID.TOPIC_SHAPE)||a.getLayoutRole().is(w.CetModel.ID.CONTENT_AREA))&&a.setLayoutRole(null)}))})}}}};var nb={};Object.defineProperty(nb,"__esModule",{value:!0});nb.ImageMaskingCommanderImpl=class{imageMaskForLayoutBox(a,b){const c=a.size.width/a.size.height;if(b.width<b.height){var d=b.width;a=d/c}else a=b.height,d=a*c;a={width:d,height:a,x:(b.width-d)/2,y:(b.height-a)/2};0>a.x?(d=a.width,
a.width+=2*a.x,a.x=0,a.height*=a.width/d,a.y=(b.height-a.height)/2):0>a.y&&(d=a.height,a.height+=2*a.y,a.y=0,a.width*=a.height/d,a.x=(b.width-a.width)/2);return a}updateMaskAspectRatio(a,b,c){switch(b){case h.MaskAspectRatio.custom:return a;case h.MaskAspectRatio.fix1By1:var d=1;break;case h.MaskAspectRatio.fix16By9:d=16/9;break;case h.MaskAspectRatio.fix4By3:d=4/3;break;default:u.Utils.assertNever(b)}a=Math.floor(c.height*d);if(a<=c.width)return{width:a,height:c.height,x:Math.floor((c.width-a)/2),
y:0};d=Math.floor(c.width/d);return{width:c.width,height:d,x:0,y:Math.floor((c.height-d)/2)}}getLayoutBoxForNewMask(a,b,c){const d=c.asReferenceFrame,e=a.width/c.size.width,f=a.height/c.size.height;a=d.point(this.getMaskCenter(a));const h=d.point(this.getMaskCenter(b));a={x:(h.x-a.x)/e,y:(h.y-a.y)/f};b={width:b.width/e,height:b.height/f};return c.withReferenceFrame(d).translate(a).withSize(b)}getMaskCenter(a){return{x:a.x+a.width/2,y:a.y+a.height/2}}};var ob={};Object.defineProperty(ob,"__esModule",
{value:!0});ob.OnboardingImpl=class{constructor(a,b,c,d){this.steps=a;this.uiRoot=b;this.userSettings=d;this.currentStepInd=-1;this.spotlightOpen=!1;"disable"===c||0===a.length||"force"!==c&&c.some((a)=>this.userSettings.getBoolean(a))||(this.setStepTo(0),this.refreshOnboarding())}declareUI(a){this.isActive()&&this.steps.forEach((b)=>{a.spotlight(Object.assign(Object.assign({overlay:null,highlights:null},b.visual),{id:this.spotlightId(b.id)}))})}get activeStep(){return this.currStep().id}refreshOnboarding(){var a,
b,c,d;if(this.currStep()){this.currStep().disableVisual&&this.currStep().disableVisual(this.uiRoot.getState())?this.switchSpotlightOff(this.currStep().id):this.switchSpotlightOn(this.currStep().id);for(var e=null===(a=this.currStep())||void 0===a?void 0:a.isDone;e&&e(this.uiRoot.getState());)this.setStepTo(this.currentStepInd+1),e=null===(b=this.currStep())||void 0===b?void 0:b.isDone;for(var f=null===(c=this.currStep())||void 0===c?void 0:c.fallback;f&&f.when(this.uiRoot.getState());){a=this.steps.findIndex((a)=>
a.id===f.to);if(a<this.currentStepInd)this.setStepTo(a);else throw Error(`Invalid fallback: from ${this.steps[this.currentStepInd].id} to ${f.to}`);f=null===(d=this.currStep())||void 0===d?void 0:d.fallback}}}isActive(){return!!this.currStep()}finishActiveStep(a){this.currStep()&&this.currStep().id===a&&this.setStepTo(this.currentStepInd+1);this.refreshOnboarding()}rewindTo(a){if(this.isActive()){const b=this.steps.findIndex((b)=>b.id===a);if(-1!==b&&b<=this.currentStepInd)this.setStepTo(b);else throw Error(`Invalid rewindTo: from ${this.steps[this.currentStepInd]?
this.steps[this.currentStepInd].id:"invalid"} to ${a}`);}}restartOnboarding(){0!==this.steps.length&&this.rewindTo(this.steps[0].id)}closeOnboarding(){this.steps.forEach((a)=>this.uiRoot.spotlight.close(this.spotlightId(a.id)));this.setStepTo(null)}setStepTo(a){const b=this.currentStepInd;if(b!==a){this.currentStepInd=a;var c=this.steps[b];if(c){this.switchSpotlightOff(c.id);if(c.onLeave)c.onLeave(this.uiRoot);if(c.onCompleted&&b<a)c.onCompleted(this.uiRoot.getState());c.setFlagsOnCompleted&&b<a&&
c.setFlagsOnCompleted.forEach((a)=>this.userSettings.setBoolean(a,!0))}if(a=this.steps[a])if(this.switchSpotlightOn(a.id),a.onEnter)a.onEnter(this.uiRoot)}}currStep(){return this.steps[this.currentStepInd]}spotlightId(a){return a+"_spotlight"}switchSpotlightOn(a){this.spotlightOpen||(this.uiRoot.spotlight.open(this.spotlightId(a)),this.spotlightOpen=!0)}switchSpotlightOff(a){this.spotlightOpen&&(this.uiRoot.spotlight.close(this.spotlightId(a)),this.spotlightOpen=!1)}};var A={};Object.defineProperty(A,
"__esModule",{value:!0});A.EditorCommanderImpl=class{createTemplateChooserAppEditor(a,b,c){a=f.CetModelEditor.createRunner(a,b,c);return new $a.TemplateChooserAppEditorImpl(a)}createZObjectEditor(a,b,c,d,e,g,h,l,m,n){a=f.CetModelEditor.createRunner(a,b,m,l,e);return new lb.ZObjectEditorImpl(b,a,c,d,g,h,n)}getMultiselectDecoratorComponentKey(){null==A.EditorCommanderImpl.multiselectDecoratorKey&&(A.EditorCommanderImpl.multiselectDecoratorKey=w.CetModel.createValueComponentKey("multiselect_rotation_rad",
!1,!0,!0));return A.EditorCommanderImpl.multiselectDecoratorKey}getSnapComponentKey(){null==A.EditorCommanderImpl.snapKey&&(A.EditorCommanderImpl.snapKey=w.CetModel.createValueComponentKey("snap_intentions",!1,!0,!0));return A.EditorCommanderImpl.snapKey}getTopicNestingComponentKey(){null==A.EditorCommanderImpl.topicNestingKey&&(A.EditorCommanderImpl.topicNestingKey=w.CetModel.createValueComponentKey("topic_nesting_intentions",!1,!0,!0));return A.EditorCommanderImpl.topicNestingKey}getSnapDescriptionKey(){null==
A.EditorCommanderImpl.snapDescriptionKey&&(A.EditorCommanderImpl.snapDescriptionKey=w.CetModel.createValueComponentKey("getSnapDescriptionKey",!1,!0,!0));return A.EditorCommanderImpl.snapDescriptionKey}createColorMixCommander(){return new pa.ColorMixCommanderImpl}createTextStyleCommander(){return new oa.TextStyleCommanderImpl}createLayoutCommander(a,b){return new Wa.LayoutCommanderImpl(new pa.ColorMixCommanderImpl,a,b)}createImageMaskingCommander(){return new nb.ImageMaskingCommanderImpl}getLayoutRepository(){null==
A.EditorCommanderImpl.layoutRepository&&(A.EditorCommanderImpl.layoutRepository=new Na.LayoutRepositoryImpl);return A.EditorCommanderImpl.layoutRepository}createLayoutQuery(){return new ta.LayoutQueryImpl}createCounterpartUpdater(a){return new La.CounterpartUpdaterImpl(a)}createTopicShapeRolesManager(){return new mb.TopicShapeRolesManagerImpl}createColorGroup(a,b){return new Ya.ColorGroupImpl(a,b)}createOnboarding(a,b,c,d){return new ob.OnboardingImpl(a,b,c,d)}};A.EditorCommanderInternal=new A.EditorCommanderImpl;
var pb={};Object.defineProperty(pb,"__esModule",{value:!0});pb.LongRunningExecutorImpl=class{constructor(a){this.session=a}update(a,b,c,d,e,f){null!=this.ctx&&this.ctx.isActive()&&this.currentChangeTag===a||(null!=this.ctx&&this.ctx.isActive()&&this.ctx.end(),this.currentChangeTag=a,this.ctx=this.session.document.beginLongRunningCommand(b,{name:a},(a)=>{switch(a.reason){case L.FinishEventKind.AbortTransaction:case L.FinishEventKind.RollbackTransaction:break;case L.FinishEventKind.BeginOtherTransaction:case L.FinishEventKind.EndTransaction:null!=
e&&e(a.api);break;default:u.Utils.assertNever(a)}this.ctx=null}),null!=f&&f());this.ctx.isActive()&&(this.ctx.execute(b,(a)=>d(a,c)),c.isFinal&&this.ctx.end())}close(a){null!=this.ctx&&this.ctx.isActive()&&this.currentChangeTag===a&&this.ctx.end()}};var h={};Object.defineProperty(h,"__esModule",{value:!0});(function(a){a[a.RegularPlanet=0]="RegularPlanet";a[a.RegularStack=1]="RegularStack";a[a.SlideOnOverview=2]="SlideOnOverview";a[a.SlideOnPlanet=3]="SlideOnPlanet"})(h.SnapTargetKind||(h.SnapTargetKind=
{}));(function(a){a[a.current=0]="current";a[a.counterpart=1]="counterpart"})(h.UpdateOrigin||(h.UpdateOrigin={}));h.EditorCommander=A.EditorCommanderInternal;(function(a){a.single="single";a.multiple="multiple";a.implicit="implicit"})(h.ActionTargetKind||(h.ActionTargetKind={}));(function(a){a[a.object=0]="object";a[a.topicZoomArea=1]="topicZoomArea";a[a.overviewZoomArea=2]="overviewZoomArea"})(h.NudgeActionStartKind||(h.NudgeActionStartKind={}));(function(a){a[a.Left=0]="Left";a[a.Right=1]="Right";
a[a.Up=2]="Up";a[a.Down=3]="Down"})(h.NudgeDirection||(h.NudgeDirection={}));(function(a){a.Align="align";a.Highlight="highlight";a.UniverseLimit="universeLimit"})(h.SnapResultKind||(h.SnapResultKind={}));(function(a){a[a.selfOnly=0]="selfOnly";a[a.nearest=1]="nearest";a[a.mostCommon=2]="mostCommon"})(h.LayoutFindStategy||(h.LayoutFindStategy={}));(function(a){a[a.fix1By1=0]="fix1By1";a[a.fix16By9=1]="fix16By9";a[a.fix4By3=2]="fix4By3";a[a.custom=3]="custom"})(h.MaskAspectRatio||(h.MaskAspectRatio=
{}));(function(a){a.ObjectMove="ObjectMove";a.OverviewMove="OverviewMove";a.TopicZoomAreaMove="TopicZoomAreaMove";a.Resize="Resize";a.TopicZoomAreaResize="TopicZoomAreaResize";a.OverviewResize="OverviewResize";a.NonProportionalResize="NonProportionalResize";a.Rotate="Rotate";a.ArcMove="ArcMove";a.PlaceholderMove="PlaceholderMove";a.MaskImageMove="MaskImageMove";a.MaskAreaMove="MaskAreaMove";a.MaskImageResize="MaskImageResize";a.MaskAreaResize="MaskAreaResize";a.MaskAreaNonProportionalResize="MaskAreaNonProportionalResize";
a.DrawInsert="DrawInsert"})(h.DragActionStartKind||(h.DragActionStartKind={}));(function(a){a.Start="Start";a.Step="Step";a.Finish="Finish"})(h.ActionKind||(h.ActionKind={}));(function(a){a[a.drop=0]="drop";a[a.cancelled=1]="cancelled"})(h.DragPlaceholderActionFinishKind||(h.DragPlaceholderActionFinishKind={}));(function(a){a[a.TOP_LEFT=0]="TOP_LEFT";a[a.TOP_RIGHT=1]="TOP_RIGHT";a[a.BOTTOM_LEFT=2]="BOTTOM_LEFT";a[a.BOTTOM_RIGHT=3]="BOTTOM_RIGHT";a[a.MIDDLE_LEFT=4]="MIDDLE_LEFT";a[a.MIDDLE_RIGHT=5]=
"MIDDLE_RIGHT";a[a.MIDDLE_CENTER=6]="MIDDLE_CENTER";a[a.MIDDLE_TOP=7]="MIDDLE_TOP";a[a.MIDDLE_BOTTOM=8]="MIDDLE_BOTTOM"})(h.ControlPointPosition||(h.ControlPointPosition={}));(function(a){a[a.None=0]="None";a[a.In=1]="In";a[a.Out=2]="Out"})(h.TopicNestingDirection||(h.TopicNestingDirection={}));const Gb=n.Geometry.colorFromRGB(1,1,1),Zb={r:255,g:255,b:255},$b={r:146,g:154,b:163};h.getBgColor=function(a,b){return ub(a,b)?$b:Zb};h.hasLightColor=ub;h.toCssColor=function(a){if(null==a)return"none";{const b=
(a)=>("0"+Math.round(Number(a)).toString(16)).slice(-2).toUpperCase();return`#${b(a.r)}${b(a.g)}${b(a.b)}`}};h.DEFAULT_OVERLAY={opacity:.5,color:"black",holes:[]};h.createLongRunningExecutor=function(a){return new pb.LongRunningExecutorImpl(a)};return Hb=h});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_editor_commander",["require","prezi.engine.dom","prezi.engine.dom.converter.xpdom2","prezi.geometry","prezi_app_utils","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_cet_renderer","prezi_editor_commander_common","prezi_editor_store_mode","prezi_editor_store_object","prezi_externalserviceprovider","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_ppt_service","prezi_service_fontcatalogue","prezi_service_media","prezi_styleschemeprovider","prezi_templateservice","prezi_textmodel","prezi_textstyleprovider","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_editor_commander.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.engine.dom.converter.xpdom2"),require("prezi.geometry"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_editor_commander_common"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_ppt_service"),require("prezi_service_fontcatalogue"),require("prezi_service_media"),require("prezi_styleschemeprovider"),require("prezi_templateservice"),require("prezi_textmodel"),require("prezi_textstyleprovider"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_editor_commander"]=__factory(this["prezi.engine.dom"],this["prezi.engine.dom.converter.xpdom2"],this["prezi.geometry"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_editor_commander_common"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_ppt_service"],this["prezi_service_fontcatalogue"],this["prezi_service_media"],this["prezi_styleschemeprovider"],this["prezi_templateservice"],this["prezi_textmodel"],this["prezi_textstyleprovider"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);